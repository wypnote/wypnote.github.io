<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>codeæ•°å­¦çŸ¥è¯†ç¯‡</title>
      <link href="/2025/07/16/code%E6%95%B0%E5%AD%A6%E7%9F%A5%E8%AF%86%E7%AF%87/"/>
      <url>/2025/07/16/code%E6%95%B0%E5%AD%A6%E7%9F%A5%E8%AF%86%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<h2 id="è´¨æ•°"><a href="#è´¨æ•°" class="headerlink" title="è´¨æ•°"></a>è´¨æ•°</h2><h3 id="AcWing-866-è¯•é™¤æ³•åˆ¤å®šè´¨æ•°"><a href="#AcWing-866-è¯•é™¤æ³•åˆ¤å®šè´¨æ•°" class="headerlink" title="AcWing 866. è¯•é™¤æ³•åˆ¤å®šè´¨æ•°"></a>AcWing 866. è¯•é™¤æ³•åˆ¤å®šè´¨æ•°</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">is_prime</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">2</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= x / i; i ++ )</span><br><span class="line">        <span class="keyword">if</span> (x % i == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (n -- )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        cin &gt;&gt; x;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">is_prime</span>(x)) <span class="built_in">puts</span>(<span class="string">&quot;Yes&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">&quot;No&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="AcWing-867-åˆ†è§£è´¨å› æ•°"><a href="#AcWing-867-åˆ†è§£è´¨å› æ•°" class="headerlink" title="AcWing 867. åˆ†è§£è´¨å› æ•°"></a>AcWing 867. åˆ†è§£è´¨å› æ•°</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">divide</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= x / i; i ++ )</span><br><span class="line">        <span class="keyword">if</span> (x % i == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> s = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">while</span> (x % i == <span class="number">0</span>) x /= i,s ++ ;</span><br><span class="line">                cout &lt;&lt; i &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; s &lt;&lt; endl;</span><br><span class="line">            &#125;</span><br><span class="line">   <span class="keyword">if</span> (x &gt; <span class="number">1</span>) cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; <span class="number">1</span> &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    <span class="keyword">while</span> (n -- )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> x;</span><br><span class="line">        cin &gt;&gt; x;</span><br><span class="line">        <span class="built_in">divide</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="AcWing-868-ç­›è´¨æ•°â€”æœ´ç´ "><a href="#AcWing-868-ç­›è´¨æ•°â€”æœ´ç´ " class="headerlink" title="AcWing 868. ç­›è´¨æ•°â€”æœ´ç´ "></a>AcWing 868. ç­›è´¨æ•°â€”æœ´ç´ </h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1000010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> primes[N], cnt;</span><br><span class="line"><span class="type">bool</span> st[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_primes</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (st[i]) <span class="keyword">continue</span>;</span><br><span class="line">        primes[cnt ++ ] = i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = i + i; j &lt;= n; j += i)</span><br><span class="line">            st[j] = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">get_primes</span>(n);</span><br><span class="line">    cout &lt;&lt; cnt &lt;&lt; endl;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="AcWing-868-ç­›è´¨æ•°â€”çº¿æ€§ç­›æ³•"><a href="#AcWing-868-ç­›è´¨æ•°â€”çº¿æ€§ç­›æ³•" class="headerlink" title="AcWing 868. ç­›è´¨æ•°â€”çº¿æ€§ç­›æ³•"></a>AcWing 868. ç­›è´¨æ•°â€”çº¿æ€§ç­›æ³•</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">1000010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> primes[N], cnt;  <span class="comment">// primes[] ä¿å­˜è´¨æ•°ï¼Œ cnt æ˜¯è´¨æ•°ä¸ªæ•°</span></span><br><span class="line"><span class="type">bool</span> st[N];   <span class="comment">// st[i] = true  è¡¨ç¤º i ä¸æ˜¯è´¨æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">get_primes</span><span class="params">(<span class="type">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!st[i]) primes[cnt ++ ] = i;  <span class="comment">// å¦‚æœ i æœªè¢«æ ‡è®°ï¼Œ i æ˜¯è´¨æ•°</span></span><br><span class="line">        <span class="comment">// iæ˜¯è´¨æ•°å°±ç­›æ‰iä¸primesä¸­æ‰€æœ‰è´¨æ•°çš„ä¹˜ç§¯ï¼›iæ˜¯éè´¨æ•°ç­›æ‰iä¸primesä¸­æ‰€æœ‰&lt;=æœ€å°è´¨å› å­çš„ä¹˜ç§¯</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; primes[j] &lt;= n / i; j ++ )</span><br><span class="line">        &#123;</span><br><span class="line">            st[primes[j] * i] = <span class="literal">true</span>;  <span class="comment">// æ ‡è®° primes[j] * i ä¸ºåˆæ•°</span></span><br><span class="line">            <span class="keyword">if</span> (i % primes[j] == <span class="number">0</span>) <span class="keyword">break</span>;  <span class="comment">// i å«æœ‰ primes[j] è¿™ä¸ªè´¨å› å­ï¼Œ ç»ˆæ­¢</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">get_primes</span>(n);</span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; cnt &lt;&lt; endl;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»£ç è°ƒè¯•</title>
      <link href="/2025/05/30/%E4%BB%A3%E7%A0%81%E8%B0%83%E8%AF%95/"/>
      <url>/2025/05/30/%E4%BB%A3%E7%A0%81%E8%B0%83%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<p><strong>ä¸€äº›ä»£ç è°ƒè¯•çš„ç»éªŒ</strong></p><p>å¦‚æœä¸æ¸…æ¥šå…·ä½“æ˜¯å“ªé‡Œçš„é—®é¢˜ï¼Œç³»ç»Ÿçš„åº“å‡½æ•°å‡ºé—®é¢˜äº† ï¼Œé‚£ä¹ˆå…ˆçœ‹è°ƒç”¨å †æ ˆ</p><p>å¦‚æœçˆ†äº†å†…å­˜æ³„éœ²ï¼Œé‚£ä¹ˆé¦–å…ˆæœä¸‹é¡¹ç›®ä¸­çš„new</p><p>å…¨å±€ ç±»çš„é™æ€å˜é‡åˆå§‹åŒ–  å…ˆäº mainå‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„å•ä¾‹å°±åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œå› ä¸ºæ²¡æœ‰å¤šçº¿ç¨‹é—®é¢˜ï¼Œä¸å­˜åœ¨å…¶å®ƒè°ƒç”¨çš„é—®é¢˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è°ƒè¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>codeæ’åºç¯‡</title>
      <link href="/2025/05/19/code%E6%8E%92%E5%BA%8F%E7%AF%87/"/>
      <url>/2025/05/19/code%E6%8E%92%E5%BA%8F%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<h3 id="åŠ›æ‰£912-æ’åºæ•°ç»„"><a href="#åŠ›æ‰£912-æ’åºæ•°ç»„" class="headerlink" title="åŠ›æ‰£912. æ’åºæ•°ç»„"></a>åŠ›æ‰£912. æ’åºæ•°ç»„</h3><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code>ï¼Œè¯·ä½ å°†è¯¥æ•°ç»„å‡åºæ’åˆ—ã€‚</p><p>ä½ å¿…é¡»åœ¨ <strong>ä¸ä½¿ç”¨ä»»ä½•å†…ç½®å‡½æ•°</strong> çš„æƒ…å†µä¸‹è§£å†³é—®é¢˜ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º <code>O(nlog(n))</code>ï¼Œå¹¶ä¸”ç©ºé—´å¤æ‚åº¦å°½å¯èƒ½å°ã€‚</p><h4 id="å¿«é€Ÿæ’åºå’Œå½’å¹¶æ’åº"><a href="#å¿«é€Ÿæ’åºå’Œå½’å¹¶æ’åº" class="headerlink" title="å¿«é€Ÿæ’åºå’Œå½’å¹¶æ’åº"></a>å¿«é€Ÿæ’åºå’Œå½’å¹¶æ’åº</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">sortArray</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// qsort(nums, 0, nums.size()- 1);</span></span><br><span class="line">        <span class="comment">// merge_sort(nums, 0, nums.size()- 1);</span></span><br><span class="line">        <span class="keyword">return</span> nums;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">qsort</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; q, <span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l &gt;= r) <span class="keyword">return</span> ;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> x = q[(l + r) &gt;&gt; <span class="number">1</span>], i = l - <span class="number">1</span>, j = r + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">do</span> i ++ ; <span class="keyword">while</span>(q[i] &lt; x);</span><br><span class="line">            <span class="keyword">do</span> j -- ; <span class="keyword">while</span> (q[j] &gt; x);</span><br><span class="line">            <span class="keyword">if</span> (i &lt; j)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> t = q[i];</span><br><span class="line">                q[i] = q[j];</span><br><span class="line">                q[j] = t;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">qsort</span>(q, l, j);</span><br><span class="line">        <span class="built_in">qsort</span>(q, j + <span class="number">1</span>, r);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">merge_sort</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; q, <span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l &gt;= r) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">merge_sort</span>(q, l, mid), <span class="built_in">merge_sort</span>(q, mid + <span class="number">1</span>, r);</span><br><span class="line"></span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">tmp</span><span class="params">(r - l + <span class="number">1</span>)</span></span>;</span><br><span class="line">        <span class="type">int</span> k = <span class="number">0</span>, i = l, j = mid + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &lt;= mid &amp;&amp; j &lt;= r)</span><br><span class="line">            <span class="keyword">if</span> (q[i] &lt;= q[j]) tmp[k ++ ] = q[i ++ ];</span><br><span class="line">            <span class="keyword">else</span> tmp[k ++ ] = q[j ++ ];</span><br><span class="line">        <span class="keyword">while</span>(i &lt;= mid) tmp[k ++ ] = q[i ++ ];</span><br><span class="line">        <span class="keyword">while</span> (j &lt;= r) tmp[k ++ ] = q[j ++ ];</span><br><span class="line">       <span class="comment">// æ¯æ¬¡é€’å½’ï¼Œtmpéƒ½æ˜¯ä»0å¼€å§‹çš„</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = l, j = <span class="number">0</span>; i &lt;= r; i ++ , j ++ ) q[i] = tmp[j];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="å †æ’åº-å¤§æ ¹å †å’Œå°æ ¹å †"><a href="#å †æ’åº-å¤§æ ¹å †å’Œå°æ ¹å †" class="headerlink" title="å †æ’åº(å¤§æ ¹å †å’Œå°æ ¹å †)"></a>å †æ’åº(å¤§æ ¹å †å’Œå°æ ¹å †)</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">heap</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ 1-based ç´¢å¼•ï¼Œåœ¨å‰é¢æ’å…¥ä¸€ä¸ªæ— ç”¨çš„æ•°</span></span><br><span class="line">    nums.<span class="built_in">insert</span>(nums.<span class="built_in">begin</span>(), <span class="number">-1</span>);</span><br><span class="line">    <span class="type">int</span> n = nums.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å»ºå †ï¼ˆå°æ ¹å †ï¼‰</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = n / <span class="number">2</span>; i; i--) <span class="built_in">down</span>(nums, i, n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt; <span class="number">1</span>; i--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">swap</span>(nums[<span class="number">1</span>], nums[i]);</span><br><span class="line">        <span class="built_in">down</span>(nums, <span class="number">1</span>, i - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å»æ‰å“¨å…µå…ƒç´ ï¼ˆè¿˜åŸä¸º 0-based æ•°ç»„ï¼‰</span></span><br><span class="line">    nums.<span class="built_in">erase</span>(nums.<span class="built_in">begin</span>());</span><br><span class="line">    <span class="built_in">reverse</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">down</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> u, <span class="type">int</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> t = u;</span><br><span class="line">    <span class="keyword">if</span> (u * <span class="number">2</span> &lt;= size &amp;&amp; nums[u * <span class="number">2</span>] &lt; nums[t]) </span><br><span class="line">        t = u * <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (u * <span class="number">2</span> + <span class="number">1</span> &lt;= size  &amp;&amp; nums[u * <span class="number">2</span> + <span class="number">1</span>] &lt; nums[t]) </span><br><span class="line">        t = u * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (u != t)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">swap</span>(nums[t], nums[u]);</span><br><span class="line">        <span class="built_in">down</span>(nums,t,size);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ğŸ§ éœ€è¦æ³¨æ„ä¸€ç‚¹å°±æ˜¯ï¼Œç®—æ³•æ¨¡æ¿æ˜¯ä»å°åˆ°å¤§è¾“å‡ºæœ€å°çš„æ•°ï¼Œä½†æ•´ä¸ªçš„å †å¹¶ä¸æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Šä¸‹é¢çš„è¿™æ®µä»£ç </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt; <span class="number">1</span>; i--)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">swap</span>(nums[<span class="number">1</span>], nums[i]);</span><br><span class="line">    <span class="built_in">down</span>(nums, <span class="number">1</span>, i - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>âœ…æœ€å¥½çš„æ–¹æ³•è¿˜æ˜¯ä½¿ç”¨å¤§æ ¹å †æ¥å®ç°å‡åºæ’åº</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">heap</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    nums.<span class="built_in">insert</span>(nums.<span class="built_in">begin</span>(), <span class="number">-1</span>);   <span class="comment">// ä¸‹æ ‡ä»1å¼€å§‹</span></span><br><span class="line">    <span class="type">int</span> n = nums.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å»ºç«‹å¤§æ ¹å †</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = n / <span class="number">2</span>; i; i -- ) <span class="built_in">down</span>(nums, i, n);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = n; i &gt; <span class="number">1</span>; i -- )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">swap</span>(nums[<span class="number">1</span>], nums[i]);</span><br><span class="line">        <span class="built_in">up</span>(nums, <span class="number">1</span>, i - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">    num.<span class="built_in">erase</span>(nums.<span class="built_in">begin</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">down</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> u, <span class="type">int</span> size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> t = u;</span><br><span class="line">    <span class="keyword">if</span> (u * <span class="number">2</span> &lt;= size &amp;&amp; nums[u * <span class="number">2</span>] &gt; nums[t]) t = u * <span class="number">2</span>;    </span><br><span class="line">    <span class="keyword">if</span> (u * <span class="number">2</span> + <span class="number">1</span> &lt;= size &amp;&amp; nums[u * <span class="number">2</span> + <span class="number">1</span>] &gt; nums[t]) t = u * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (u != t)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">swap</span>(nums[u], nums[t]);</span><br><span class="line">        <span class="built_in">down</span>(nums, t, size);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¿’ä¸€äº›å®¹å™¨çš„çŸ¥è¯†</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;æ•°æ®ç±»å‹&gt; å˜é‡å;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; s;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; s&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"><span class="function">std::vector&lt;<span class="type">int</span>&gt; <span class="title">s</span><span class="params">(<span class="number">5</span>)</span></span>;  <span class="comment">// è®¾ç½®äº†5ä¸ªå¤§å°çš„å®¹å™¨</span></span><br><span class="line"><span class="function">std::vector&lt;<span class="type">int</span>&gt; <span class="title">s</span><span class="params">(<span class="number">5</span>,<span class="number">100</span>)</span></span>;  <span class="comment">// è¿™ä¸ªå®¹å™¨æ‹¥æœ‰äº”ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ çš„åˆå§‹å€¼ä¸º100</span></span><br></pre></td></tr></table></figure><p>å®¹å™¨çš„å‡ ä¸ªæ–°ç”¨æ³•ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; s;</span><br><span class="line">s.<span class="built_in">push_back</span>(å€¼);  <span class="comment">//å°†å€¼æ·»åŠ åˆ°å®¹å™¨æœ«å°¾</span></span><br><span class="line">s.<span class="built_in">pop_back</span>();  <span class="comment">//å°†æœ«å°¾çš„å€¼åˆ é™¤æ‰</span></span><br><span class="line">s.<span class="built_in">insert</span>(s.<span class="built_in">begin</span>()<span class="number">+2</span>, <span class="number">2</span>); <span class="comment">// åœ¨æŒ‡å®šä½ç½®æ’å…¥å…ƒç´ </span></span><br><span class="line">s.<span class="built_in">assign</span>(<span class="number">10</span>,<span class="number">100</span>); <span class="comment">//å°†sé‡æ–°åˆå§‹åŒ–ä¸ºæ‹¥æœ‰10ä¸ªå…ƒç´   æ¯ä¸ªå…ƒç´ ä½100çš„å®¹å™¨</span></span><br><span class="line">s.<span class="built_in">erase</span>(s.<span class="built_in">begin</span>() + <span class="number">2</span>);   <span class="comment">// åˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ </span></span><br><span class="line">s.<span class="built_in">clear</span>(); <span class="comment">// å°†å®¹å™¨æ¸…ç©º</span></span><br><span class="line">s.<span class="built_in">empty</span>(); <span class="comment">//çœ‹çœ‹æ˜¯ä¸æ˜¯ç©ºçš„</span></span><br></pre></td></tr></table></figure><p>å®¹å™¨æ¯”æ•°ç»„æ›´çµæ´»ï¼Œæ’åºçš„æ—¶å€™å¯ä»¥å½“åšæ•°ç»„æ¥æ“ä½œï¼ï¼ï¼</p><h3 id="åŠ›æ‰£56-åˆå¹¶åŒºé—´"><a href="#åŠ›æ‰£56-åˆå¹¶åŒºé—´" class="headerlink" title="åŠ›æ‰£56. åˆå¹¶åŒºé—´"></a>åŠ›æ‰£56. åˆå¹¶åŒºé—´</h3><p><strong>ACMæ¨¡å¼</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> pair&lt;<span class="type">int</span>,<span class="type">int</span>&gt; PII;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">merge</span><span class="params">(vector&lt;PII&gt; &amp;segs)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    vector&lt;PII&gt; res;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">sort</span>(segs.<span class="built_in">begin</span>(), segs.<span class="built_in">end</span>());</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> st = <span class="number">-2e9</span>, ed = <span class="number">-2e9</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> seg : segs)</span><br><span class="line">        <span class="keyword">if</span>(ed &lt; seg.first)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (st!=<span class="number">-2e9</span>) res.<span class="built_in">push_back</span>(&#123;st, ed&#125;);</span><br><span class="line">            st = seg.first, ed = seg.second;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> ed = <span class="built_in">max</span>(ed, seg.second);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(st != <span class="number">-2e9</span>) res.<span class="built_in">push_back</span>(&#123;st, ed&#125;);</span><br><span class="line">    </span><br><span class="line">    segs = res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    </span><br><span class="line">    vector&lt;PII&gt; segs;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> l, r;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;l, &amp;r);</span><br><span class="line">        segs.<span class="built_in">push_back</span>(&#123;l, r&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">merge</span>(segs);</span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; segs.<span class="built_in">size</span>() &lt;&lt; endl;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ ¸å¿ƒä»£ç æ¨¡å¼</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ­¤é¢˜å…¨ä¸ºéè´Ÿæ•°ï¼Œæ‰€ä»¥st  ed   è®¾ç½®ä¸º-1å³å¯</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">merge</span>(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; intervals) &#123;</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; res;</span><br><span class="line">        <span class="built_in">sort</span>(res.<span class="built_in">begin</span>(),res.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> st = <span class="number">-1</span>, ed = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; intervals.<span class="built_in">size</span>(); i ++ )</span><br><span class="line">            <span class="keyword">if</span>(ed &lt; intervals[i][<span class="number">0</span>])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(st != <span class="number">-1</span>) res.<span class="built_in">push_back</span>(&#123;st, ed&#125;);</span><br><span class="line">                st = intervals[i][<span class="number">0</span>], ed = intervals[i][<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> ed = <span class="built_in">max</span>(ed, intervals[i][<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(st != <span class="number">-1</span>) res.<span class="built_in">push_back</span>(&#123;st, ed&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="åŠ›æ‰£148-æ’åºé“¾è¡¨"><a href="#åŠ›æ‰£148-æ’åºé“¾è¡¨" class="headerlink" title="åŠ›æ‰£148. æ’åºé“¾è¡¨"></a>åŠ›æ‰£148. æ’åºé“¾è¡¨</h3><p>æ–¹æ¡ˆä¸€ï¼šå¼€ä¸€ä¸ªæ•°ç»„ï¼ŒæŠŠé“¾è¡¨çš„å€¼å¤åˆ¶åˆ°æ•°ç»„é‡Œé¢è¿›è¡Œæ’åºï¼Œæ’åºå®Œæˆåå†æŠŠå€¼å¤åˆ¶åˆ°é“¾è¡¨é‡Œé¢</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode() : val(0), next(nullptr) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(nullptr) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x, ListNode *next) : val(x), next(next) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">sortList</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!head) <span class="keyword">return</span> head;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; a;</span><br><span class="line">        <span class="keyword">auto</span> p = head;</span><br><span class="line">        <span class="keyword">while</span>(p != <span class="literal">NULL</span>)&#123;</span><br><span class="line">            a.<span class="built_in">push_back</span>(p-&gt;val);</span><br><span class="line">            p = p-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">delete</span> p;</span><br><span class="line">        <span class="comment">// sort(a.begin(), a.end());</span></span><br><span class="line">        <span class="built_in">qsort</span>(a, <span class="number">0</span>, a.<span class="built_in">size</span>() - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">auto</span> q = head;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">const</span> <span class="keyword">auto</span> &amp;c : a)&#123;</span><br><span class="line">            q-&gt;val = c;</span><br><span class="line">            q = q-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">delete</span> q;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">qsort</span><span class="params">(vector&lt;<span class="type">int</span>&gt; &amp;a, <span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (l &gt;= r) <span class="keyword">return</span> ;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> i = l - <span class="number">1</span>, j = r + <span class="number">1</span>, x = a[l + r &gt;&gt; <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (i &lt; j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">do</span> i ++ ; <span class="keyword">while</span> (a[i] &lt; x);</span><br><span class="line">            <span class="keyword">do</span> j -- ; <span class="keyword">while</span> (a[j] &gt; x);</span><br><span class="line">            <span class="keyword">if</span> (i &lt; j)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">int</span> t = a[i];</span><br><span class="line">                a[i] = a[j];</span><br><span class="line">                a[j] = t;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">qsort</span>(a, l, j);</span><br><span class="line">        <span class="built_in">qsort</span>(a, j + <span class="number">1</span>, r);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// ä½¿ç”¨è‡ªå·±å†™çš„å¿«æ’ï¼Œæ•ˆç‡æå‡äº† 10% ä»¥ä¸Š</span></span><br></pre></td></tr></table></figure><h3 id="åŠ›æ‰£179-æœ€å¤§æ•°ï¼ˆä»…ä»…æ’åºè§£å†³ä¸äº†ï¼‰"><a href="#åŠ›æ‰£179-æœ€å¤§æ•°ï¼ˆä»…ä»…æ’åºè§£å†³ä¸äº†ï¼‰" class="headerlink" title="åŠ›æ‰£179. æœ€å¤§æ•°ï¼ˆä»…ä»…æ’åºè§£å†³ä¸äº†ï¼‰"></a>åŠ›æ‰£179. æœ€å¤§æ•°ï¼ˆä»…ä»…æ’åºè§£å†³ä¸äº†ï¼‰</h3><p>ç°åœ¨èƒ½æƒ³åˆ°çš„å°±æ˜¯ å¦‚æœæœ€é«˜ä½ä¸åŒï¼Œé‚£ä¹ˆæ ¹æ®æœ€é«˜ä½è¿›è¡Œæ’åºï¼Œå¦‚æœæœ€é«˜ä½ç›¸åŒåˆ™æ¯”è¾ƒä¸‹ä¸€ä½ï¼Œä¾æ¬¡ç±»æ¨</p>]]></content>
      
      
      <categories>
          
          <category> codetop </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ—¥å¸¸åˆ·é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿œç¨‹æ¡Œé¢æ§åˆ¶ï¼ˆäºŒï¼‰</title>
      <link href="/2025/05/05/%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E6%8E%A7%E5%88%B6%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
      <url>/2025/05/05/%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E6%8E%A7%E5%88%B6%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h4 id="è¿œç¨‹æ¡Œé¢æ˜¾ç¤ºåŠŸèƒ½ä¸æ•°æ®æ¥æ”¶å¼€å‘"><a href="#è¿œç¨‹æ¡Œé¢æ˜¾ç¤ºåŠŸèƒ½ä¸æ•°æ®æ¥æ”¶å¼€å‘" class="headerlink" title="è¿œç¨‹æ¡Œé¢æ˜¾ç¤ºåŠŸèƒ½ä¸æ•°æ®æ¥æ”¶å¼€å‘"></a>è¿œç¨‹æ¡Œé¢æ˜¾ç¤ºåŠŸèƒ½ä¸æ•°æ®æ¥æ”¶å¼€å‘</h4><p>æ›´æ–°  â€”  å®šæ—¶å™¨</p><p>æ•°æ®  â€”  çº¿ç¨‹</p><p>æ˜¾ç¤º  â€”  åŠŸèƒ½å‡½æ•°</p><ol><li>ææ¸…æ¥šå¹²ä»€ä¹ˆï¼Ÿ  </li><li>é€æ­¥å®ç°ï¼ˆä¸æ–­ç»†åŒ–ï¼‰</li></ol><p>æ˜¾ç¤º   m_picture    DC-&gt;CImage</p><p>æ”¹bug   ä»ä¸Šå¾€ä¸‹è°ƒæ•´   </p><p>è®¾è®¡   å®ç°    æ—¥å¿—</p>]]></content>
      
      
      <categories>
          
          <category> è¿œæ§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿œç¨‹æ¡Œé¢æ§åˆ¶ï¼ˆä¸€ï¼‰ç²¾ç®€ç‰ˆ</title>
      <link href="/2025/04/07/%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E6%8E%A7%E5%88%B6%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2025/04/07/%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E6%8E%A7%E5%88%B6%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h3 id="å•ä¾‹æ¨¡å¼æ˜¯æ€ä¹ˆå®ç°çš„"><a href="#å•ä¾‹æ¨¡å¼æ˜¯æ€ä¹ˆå®ç°çš„" class="headerlink" title="å•ä¾‹æ¨¡å¼æ˜¯æ€ä¹ˆå®ç°çš„"></a>å•ä¾‹æ¨¡å¼æ˜¯æ€ä¹ˆå®ç°çš„</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CServerSocket</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">static</span> CServerSocket* m_instance;</span><br><span class="line">    <span class="type">static</span> CHelper m_helper; <span class="comment">// è¾…åŠ©ç±»ï¼Œç¡®ä¿æ„é€ å’Œææ„</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> CServerSocket* <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!m_instance) m_instance = <span class="keyword">new</span> <span class="built_in">CServerSocket</span>();</span><br><span class="line">        <span class="keyword">return</span> m_instance;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">CServerSocket</span>() &#123; ... &#125; <span class="comment">// ç§æœ‰æ„é€ </span></span><br><span class="line">    ~<span class="built_in">CServerSocket</span>() &#123; ... &#125; <span class="comment">// ç§æœ‰ææ„</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">CHelper</span> &#123; <span class="comment">// RAII ç®¡ç†å•ä¾‹ç”Ÿå‘½å‘¨æœŸ</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="built_in">CHelper</span>() &#123; CServerSocket::<span class="built_in">getInstance</span>(); &#125;</span><br><span class="line">        ~<span class="built_in">CHelper</span>() &#123; CServerSocket::<span class="built_in">releaseInstance</span>(); &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>è®¾è®¡æ€æƒ³</strong>ï¼š</p><ul><li><strong>ç¦æ­¢ç”¨æˆ·ç›´æ¥æ„é€ </strong>ï¼Œå¿…é¡»é€šè¿‡ <code>getInstance()</code> è·å–å”¯ä¸€å¯¹è±¡ã€‚</li><li><code>CHelper</code> è¾…åŠ©ç±»ï¼š<ul><li>æ„é€ æ—¶è‡ªåŠ¨åˆ›å»º <code>CServerSocket</code> å•ä¾‹ã€‚</li><li>ææ„æ—¶è‡ªåŠ¨é‡Šæ”¾ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚</li></ul></li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><table><thead><tr><th><strong>æ¨¡å—</strong></th><th><strong>æ ¸å¿ƒåŠŸèƒ½</strong></th></tr></thead><tbody><tr><td><strong><code>CPacket</code></strong></td><td>åè®®å°è£…ï¼Œæä¾› <strong>æ‰“åŒ…&#x2F;è§£åŒ…</strong> èƒ½åŠ›</td></tr><tr><td><strong><code>CServerSocket</code></strong></td><td>æœåŠ¡å™¨æ ¸å¿ƒï¼Œ<strong>å•ä¾‹ç®¡ç†</strong>ã€<strong>æ”¶å‘æ•°æ®</strong></td></tr><tr><td><strong>å•ä¾‹æ¨¡å¼</strong></td><td>ç¡®ä¿å…¨å±€å”¯ä¸€æœåŠ¡å™¨å®ä¾‹</td></tr><tr><td><strong>å­—èŠ‚å¯¹é½ (<code>#pragma pack</code>)</strong></td><td>ä¿è¯æ•°æ®åŒ…ä¸¥æ ¼å¯¹é½ï¼Œé¿å…è§£æé”™è¯¯</td></tr></tbody></table><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p><ul><li>å°å‹å®¢æˆ·ç«¯-æœåŠ¡å™¨é€šä¿¡ï¼ˆå¦‚æ–‡ä»¶ä¼ è¾“ã€è¿œç¨‹æ§åˆ¶ç­‰ï¼‰ã€‚</li><li>å¯æ‰©å±•æ€§è¾ƒå¼ºï¼Œ<code>sCmd</code> å¯ç”¨äºæ‰©å±•ä¸åŒä¸šåŠ¡é€»è¾‘ã€‚</li></ul><br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CServerSocket* CServerSocket::m_instance = <span class="literal">NULL</span>;  <span class="comment">// é™æ€æˆå‘˜åˆå§‹åŒ–</span></span><br><span class="line">CServerSocket::CHelper CServerSocket::m_helper;   <span class="comment">// RAIIè¾…åŠ©å¯¹è±¡</span></span><br><span class="line">CServerSocket* pserver = CServerSocket::<span class="built_in">getInstance</span>(); <span class="comment">// å…¨å±€è®¿é—®ç‚¹</span></span><br></pre></td></tr></table></figure><h4 id="è®¾è®¡æ¨¡å¼è§£æ"><a href="#è®¾è®¡æ¨¡å¼è§£æ" class="headerlink" title="è®¾è®¡æ¨¡å¼è§£æ"></a>è®¾è®¡æ¨¡å¼è§£æ</h4><ol><li><p><strong>å•ä¾‹æ§åˆ¶</strong></p><ul><li><code>m_instance</code> ä½œä¸ºé™æ€æŒ‡é’ˆï¼Œä¿è¯å…¨è¿›ç¨‹å”¯ä¸€å®ä¾‹</li><li>é€šè¿‡ <code>getInstance()</code> è·å–å”¯ä¸€å®ä¾‹ï¼Œé¦–æ¬¡è°ƒç”¨æ—¶æ„é€ å¯¹è±¡</li></ul></li><li><p><strong>RAII</strong>åŠ©æ‰‹ç±» (<code>CHelper</code>)</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CHelper</span> &#123;<span class="keyword">public</span>:    <span class="built_in">CHelper</span>() &#123; CServerSocket::<span class="built_in">getInstance</span>(); &#125;  <span class="comment">// æ„é€ æ—¶è§¦å‘å•ä¾‹åˆ›å»º    ~CHelper() &#123; CServerSocket::releaseInstance(); &#125; // ææ„æ—¶é‡Šæ”¾å•ä¾‹&#125;;</span></span><br></pre></td></tr></table></figure><ul><li><strong>æ„é€ é˜¶æ®µ</strong>ï¼šç¨‹åºå¯åŠ¨æ—¶ï¼Œå…¨å±€ <code>m_helper</code> çš„æ„é€ è‡ªåŠ¨è§¦å‘å•ä¾‹åˆ›å»º</li><li><strong>ææ„é˜¶æ®µ</strong>ï¼šç¨‹åºé€€å‡ºæ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨ <code>releaseInstance()</code> é‡Šæ”¾èµ„æº</li></ul></li><li><p><strong>å…¨å±€è®¿é—®ç‚¹</strong></p><ul><li><p><code>pserver</code> æä¾›å…¨å±€ç»Ÿä¸€è®¿é—®å…¥å£</p></li><li><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pserver-&gt;<span class="built_in">InitSocket</span>();  <span class="comment">// ä»»ä½•åœ°æ–¹éƒ½å¯ç›´æ¥ä½¿ç”¨</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><p><img src="https://bu.dusays.com/2025/04/07/67f3df51097fb.png"></p><h3 id="CPacket-æ‰“åŒ…æ„é€ å‡½æ•°"><a href="#CPacket-æ‰“åŒ…æ„é€ å‡½æ•°" class="headerlink" title="CPacket æ‰“åŒ…æ„é€ å‡½æ•°"></a><code>CPacket</code> æ‰“åŒ…æ„é€ å‡½æ•°</h3><h4 id="æ„é€ å‡½æ•°åŸå‹"><a href="#æ„é€ å‡½æ•°åŸå‹" class="headerlink" title="æ„é€ å‡½æ•°åŸå‹"></a>æ„é€ å‡½æ•°åŸå‹</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CPacket::<span class="built_in">CPacket</span>(WORD nCmd, <span class="type">const</span> BYTE* pData, <span class="type">size_t</span> nSize) </span><br></pre></td></tr></table></figure><h4 id="å‚æ•°è¯´æ˜"><a href="#å‚æ•°è¯´æ˜" class="headerlink" title="å‚æ•°è¯´æ˜"></a>å‚æ•°è¯´æ˜</h4><table><thead><tr><th>å‚æ•°</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>nCmd</code></td><td><code>WORD</code></td><td>åè®®å‘½ä»¤å­—ï¼ˆ2å­—èŠ‚ï¼‰</td></tr><tr><td><code>pData</code></td><td><code>const BYTE*</code></td><td>è´Ÿè½½æ•°æ®æŒ‡é’ˆ</td></tr><tr><td><code>nSize</code></td><td><code>size_t</code></td><td>è´Ÿè½½æ•°æ®é•¿åº¦</td></tr></tbody></table><h2 id="ä¸»ç¨‹åº"><a href="#ä¸»ç¨‹åº" class="headerlink" title="ä¸»ç¨‹åº"></a>ä¸»ç¨‹åº</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RemoveCtrl.cpp : æ­¤æ–‡ä»¶åŒ…å« &quot;main&quot; å‡½æ•°ã€‚ç¨‹åºæ‰§è¡Œå°†åœ¨æ­¤å¤„å¼€å§‹å¹¶ç»“æŸã€‚</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pch.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;framework.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;RemoveCtrl.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ServerSocket.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;direct.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _DEBUG</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> new DEBUG_NEW</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="comment">//#pragma comment(linker, &quot;/subsystem:windows /entry:WinMainCRTStartup&quot; )</span></span><br><span class="line"><span class="comment">//#pragma comment(linker, &quot;/subsystem:windows /entry:mainCRTStartup&quot; )</span></span><br><span class="line"><span class="comment">//#pragma comment(linker, &quot;/subsystem:console /entry:WinMainCRTStartup&quot; )</span></span><br><span class="line"><span class="comment">//#pragma comment(linker, &quot;/subsystem:console /entry:mainCRTStartup&quot; )</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// å”¯ä¸€çš„åº”ç”¨ç¨‹åºå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">CWinApp theApp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†ç»™å®šçš„äºŒè¿›åˆ¶æ•°æ®ä»¥åå…­è¿›åˆ¶æ ¼å¼æ‰“å°å‡ºæ¥ï¼Œå¹¶å°†è¾“å‡ºå‘é€åˆ°è°ƒè¯•å™¨ï¼ˆé€šè¿‡OutputDebugStringAï¼‰</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dump</span><span class="params">(BYTE* pData, <span class="type">size_t</span> nSize)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    std::string strOut;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; nSize; i++) &#123;</span><br><span class="line">        <span class="type">char</span> buf[<span class="number">8</span>] = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; (i % <span class="number">16</span> == <span class="number">0</span>)) strOut += <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="built_in">snprintf</span>(buf, <span class="built_in">sizeof</span>(buf), <span class="string">&quot;%02X &quot;</span>, pData[i] &amp; <span class="number">0xFF</span>);</span><br><span class="line">        strOut += buf;</span><br><span class="line">    &#125;</span><br><span class="line">    strOut += <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="built_in">OutputDebugStringA</span>(strOut.<span class="built_in">c_str</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">MakeDriverInfo</span><span class="params">()</span> </span>&#123; <span class="comment">// 1 =&gt; A   2 =&gt; B  3 =&gt; C</span></span><br><span class="line">    std::string result;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">26</span>; i++) &#123;</span><br><span class="line">        <span class="comment">//æŸ¥çœ‹æ¯ä¸ªé©±åŠ¨å™¨æ˜¯å¦å­˜åœ¨ï¼ˆé€šè¿‡_chdriveå‡½æ•°ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (_chdrive(i) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//å°†å­˜åœ¨çš„é©±åŠ¨å­—æ¯ï¼ˆå¦‚Aã€Bã€Cï¼‰æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”¨é€—å·åˆ†éš”ã€‚</span></span><br><span class="line">            <span class="keyword">if</span> (result.<span class="built_in">size</span>() &gt; <span class="number">0</span>)</span><br><span class="line">result += <span class="string">&#x27;,&#x27;</span>;</span><br><span class="line">            result += <span class="string">&#x27;A&#x27;</span> + i - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æœ€åè°ƒç”¨ CServerSocket::getInstance()-&gt;Send(CPacket()) å‘é€æ•°æ®åŒ…ã€‚</span></span><br><span class="line">    <span class="comment">//CServerSocket::getInstance()-&gt;Send(CPacket(1,(BYTE*)result.c_str(),result.size()));</span></span><br><span class="line">    <span class="function">CPacket <span class="title">pack</span><span class="params">(<span class="number">1</span>, (BYTE*)result.c_str(), result.size())</span></span>;</span><br><span class="line">    <span class="built_in">Dump</span>((BYTE*)pack.<span class="built_in">Data</span>(), pack.<span class="built_in">Size</span>());</span><br><span class="line"><span class="comment">//CServerSocket::getInstance()-&gt;Send(pack);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;io.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;list&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;RemoteCtrl.h&quot;</span></span></span><br><span class="line"><span class="comment">/*ç»“æ„ä½“å’Œç±»ååˆ†ç›¸ä¼¼  åŒºåˆ«æ˜¯ç»“æ„ä½“é»˜è®¤æ˜¯public   ç±»é»˜è®¤æ˜¯private*/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">file_info</span>&#123;</span><br><span class="line">    <span class="built_in">file_info</span>() &#123;</span><br><span class="line">        IsInvalid = <span class="number">0</span>;</span><br><span class="line">        IsDirectory = <span class="number">-1</span>;</span><br><span class="line">        HasNext = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">memset</span>(szFileName, <span class="number">0</span>, <span class="built_in">sizeof</span>(szFileName));</span><br><span class="line">    &#125;</span><br><span class="line">    BOOL IsInvalid; <span class="comment">// æ˜¯å¦æœ‰æ•ˆ</span></span><br><span class="line">    BOOL HasNext; <span class="comment">// æ˜¯å¦è¿˜æœ‰åç»­    0   å¦  1 æ˜¯</span></span><br><span class="line">    <span class="type">char</span> szFileName[<span class="number">256</span>]; <span class="comment">// æ–‡ä»¶å </span></span><br><span class="line">    BOOL IsDirectory;  <span class="comment">// æ˜¯å¦ä¸ºç›®å½•  0 å¦ 1  æ˜¯ </span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">&#125;FILEINFO, *PFILEINFO;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> nRetCode = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    HMODULE hModule = ::<span class="built_in">GetModuleHandle</span>(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hModule != <span class="literal">nullptr</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ– MFC å¹¶åœ¨å¤±è´¥æ—¶æ˜¾ç¤ºé”™è¯¯  </span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">AfxWinInit</span>(hModule, <span class="literal">nullptr</span>, ::<span class="built_in">GetCommandLine</span>(), <span class="number">0</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> åœ¨æ­¤å¤„ä¸ºåº”ç”¨ç¨‹åºçš„è¡Œä¸ºç¼–å†™ä»£ç ã€‚</span></span><br><span class="line">            <span class="built_in">wprintf</span>(<span class="string">L&quot;é”™è¯¯: MFC åˆå§‹åŒ–å¤±è´¥\n&quot;</span>);</span><br><span class="line">            nRetCode = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// å¥—æ¥å­—åˆå§‹åŒ–</span></span><br><span class="line">       </span><br><span class="line">            <span class="comment">// è§‚å¯Ÿæ–‡ä»¶</span></span><br><span class="line">            <span class="type">int</span> nCmd = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">switch</span> (nCmd)</span><br><span class="line">            &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>: <span class="comment">// æŸ¥çœ‹ç£ç›˜åˆ†åŒº</span></span><br><span class="line">                <span class="built_in">MakeDriverInfo</span>();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                <span class="built_in">MakeDirectoryInfo</span>();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> æ›´æ”¹é”™è¯¯ä»£ç ä»¥ç¬¦åˆéœ€è¦</span></span><br><span class="line">        <span class="built_in">wprintf</span>(<span class="string">L&quot;é”™è¯¯: GetModuleHandle å¤±è´¥\n&quot;</span>);</span><br><span class="line">        nRetCode = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> nRetCode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœ¨é©¬è¿œæ§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿œç¨‹æ¡Œé¢æ§åˆ¶ï¼ˆä¸€ï¼‰</title>
      <link href="/2025/03/15/%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E6%8E%A7%E5%88%B6%EF%BC%88%E4%B8%80%EF%BC%89%E7%B2%BE%E7%AE%80%E7%89%88/"/>
      <url>/2025/03/15/%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E6%8E%A7%E5%88%B6%EF%BC%88%E4%B8%80%EF%BC%89%E7%B2%BE%E7%AE%80%E7%89%88/</url>
      
        <content type="html"><![CDATA[<p>è®°å½•çš„ç¬”è®°æ¯”è¾ƒæ‚ä¹±ï¼ŒæŠŠè‡ªå·±æ„Ÿè§‰é‡è¦çš„å†…å®¹è®°å½•åœ¨è¿™é‡Œäº†</p><br><br><h3 id="æäº¤å’Œæ¨é€"><a href="#æäº¤å’Œæ¨é€" class="headerlink" title="æäº¤å’Œæ¨é€"></a>æäº¤å’Œæ¨é€</h3><p>æäº¤â€”&gt;å­˜æ”¾</p><p>æ¨é€   å°±æ˜¯æŠŠå­˜çš„ä¸œè¥¿æ”¾åˆ°æœåŠ¡å™¨ä¸Šé¢</p><h3 id="åˆ†æ”¯åˆ‡æ¢"><a href="#åˆ†æ”¯åˆ‡æ¢" class="headerlink" title="åˆ†æ”¯åˆ‡æ¢"></a>åˆ†æ”¯åˆ‡æ¢</h3><p>gitä¸€èˆ¬æœ‰å¾ˆå¤šåˆ†æ”¯ï¼Œæˆ‘ä»¬cloneåˆ°æœ¬åœ°çš„æ—¶å€™ä¸€èˆ¬éƒ½æ˜¯masteråˆ†æ”¯ï¼Œé‚£ä¹ˆå¦‚ä½•åˆ‡æ¢åˆ°å…¶ä»–åˆ†æ”¯å‘¢ï¼Ÿä¸»è¦å‘½ä»¤å¦‚ä¸‹ï¼š</p><p><strong>1ã€æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">git branch -a</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ç°åœ¨åœ¨ä»€ä¹ˆåˆ†æ”¯ä¸‹é¢ã€‚</p><p><strong>2ã€æŸ¥çœ‹æœ¬åœ°åˆ†æ”¯</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch</span><br></pre></td></tr></table></figure><p><strong>3ã€åˆ‡æ¢åˆ†æ”¯</strong></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b v0.9rc1 origin/v0.9rc1</span><br></pre></td></tr></table></figure><p>ä¸ªäººæ„Ÿè§‰ï¼Œåˆ†æ”¯çš„ä½œç”¨å°±æ˜¯ä¿å­˜ä»£ç ç‰ˆæœ¬ï¼Œå‡ ä¸ªç‰ˆæœ¬å°±åˆ›å»ºå‡ ä¸ªåˆ†æ”¯ï¼Œæ‰€æœ‰çš„åˆ†æ”¯éƒ½å…ˆæäº¤å­˜æ”¾ï¼Œæœ€åï¼Œåœ¨å­˜æ”¾çš„ä»£ç ç‰ˆæœ¬ä¸­é€‰æ‹©æœ€ç»ˆçš„ä»£ç è¿›è¡Œæ¨é€ï¼Œæ”¾åˆ°æœåŠ¡å™¨ä¸Šé¢ã€‚</p><br><h3 id="è¿œç¨‹ç½‘ç»œç¼–ç¨‹"><a href="#è¿œç¨‹ç½‘ç»œç¼–ç¨‹" class="headerlink" title="è¿œç¨‹ç½‘ç»œç¼–ç¨‹"></a>è¿œç¨‹ç½‘ç»œç¼–ç¨‹</h3><p>ä½¿ç”¨å…¨å±€å˜é‡ï¼Œåœ¨<code>main</code>å‡½æ•°ä¹‹å‰åˆå§‹åŒ–ï¼Œåœ¨<code>main</code>å‡½æ•°ä¹‹åé‡Šæ”¾èµ„æº</p><p> <strong>å•ä¾‹</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§å¸¸ç”¨çš„è½¯ä»¶è®¾è®¡æ¨¡å¼ã€‚åœ¨å®ƒçš„æ ¸å¿ƒç»“æ„ä¸­åªåŒ…å«ä¸€ä¸ªè¢«ç§°ä¸ºå•ä¾‹ç±»çš„ç‰¹æ®Šç±»ã€‚é€šè¿‡å•ä¾‹æ¨¡å¼å¯ä»¥ä¿è¯ç³»ç»Ÿä¸­ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹è€Œä¸”è¯¥å®ä¾‹æ˜“äºå¤–ç•Œè®¿é—®ï¼Œä»è€Œæ–¹ä¾¿å¯¹å®ä¾‹ä¸ªæ•°çš„æ§åˆ¶å¹¶èŠ‚çº¦ç³»ç»Ÿèµ„æºã€‚å¦‚æœå¸Œæœ›åœ¨ç³»ç»Ÿä¸­æŸä¸ªç±»çš„å¯¹è±¡åªèƒ½å­˜åœ¨ä¸€ä¸ªï¼Œå•ä¾‹æ¨¡å¼æ˜¯æœ€å¥½çš„è§£å†³æ–¹æ¡ˆã€‚</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å¯¹äºç³»ç»Ÿä¸­çš„æŸäº›ç±»æ¥è¯´ï¼Œåªæœ‰ä¸€ä¸ªå®ä¾‹å¾ˆé‡è¦ï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªç³»ç»Ÿä¸­å¯ä»¥å­˜åœ¨å¤šä¸ªæ‰“å°ä»»åŠ¡ï¼Œä½†æ˜¯åªèƒ½æœ‰ä¸€ä¸ªæ­£åœ¨å·¥ä½œçš„ä»»åŠ¡ï¼›ä¸€ä¸ªç³»ç»Ÿåªèƒ½æœ‰ä¸€ä¸ªçª—å£ç®¡ç†å™¨æˆ–æ–‡ä»¶ç³»ç»Ÿï¼›ä¸€ä¸ªç³»ç»Ÿåªèƒ½æœ‰ä¸€ä¸ªè®¡æ—¶å·¥å…·æˆ–ID(åºå·)ç”Ÿæˆå™¨ã€‚å¦‚åœ¨Windowsä¸­å°±åªèƒ½æ‰“å¼€ä¸€ä¸ªä»»åŠ¡ç®¡ç†å™¨ã€‚å¦‚æœä¸ä½¿ç”¨æœºåˆ¶å¯¹çª—å£å¯¹è±¡è¿›è¡Œå”¯ä¸€åŒ–ï¼Œå°†å¼¹å‡ºå¤šä¸ªçª—å£ï¼Œå¦‚æœè¿™äº›çª—å£æ˜¾ç¤ºçš„å†…å®¹å®Œå…¨ä¸€è‡´ï¼Œåˆ™æ˜¯é‡å¤å¯¹è±¡ï¼Œæµªè´¹å†…å­˜èµ„æºï¼›å¦‚æœè¿™äº›çª—å£æ˜¾ç¤ºçš„å†…å®¹ä¸ä¸€è‡´ï¼Œåˆ™æ„å‘³ç€åœ¨æŸä¸€ç¬é—´ç³»ç»Ÿæœ‰å¤šä¸ªçŠ¶æ€ï¼Œä¸å®é™…ä¸ç¬¦ï¼Œä¹Ÿä¼šç»™ç”¨æˆ·å¸¦æ¥è¯¯è§£ï¼Œä¸çŸ¥é“å“ªä¸€ä¸ªæ‰æ˜¯çœŸå®çš„çŠ¶æ€ã€‚å› æ­¤æœ‰æ—¶ç¡®ä¿ç³»ç»Ÿä¸­æŸä¸ªå¯¹è±¡çš„å”¯ä¸€æ€§å³ä¸€ä¸ªç±»åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹éå¸¸é‡è¦ã€‚</span><br><span class="line">å¦‚ä½•ä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹å¹¶ä¸”è¿™ä¸ªå®ä¾‹æ˜“äºè¢«è®¿é—®å‘¢ï¼Ÿå®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡å¯ä»¥ç¡®ä¿å¯¹è±¡éšæ—¶éƒ½å¯ä»¥è¢«è®¿é—®ï¼Œä½†ä¸èƒ½é˜²æ­¢æˆ‘ä»¬å®ä¾‹åŒ–å¤šä¸ªå¯¹è±¡ã€‚ä¸€ä¸ªæ›´å¥½çš„è§£å†³åŠæ³•æ˜¯è®©ç±»è‡ªèº«è´Ÿè´£ä¿å­˜å®ƒçš„å”¯ä¸€å®ä¾‹ã€‚è¿™ä¸ªç±»å¯ä»¥ä¿è¯æ²¡æœ‰å…¶ä»–å®ä¾‹è¢«åˆ›å»ºï¼Œå¹¶ä¸”å®ƒå¯ä»¥æä¾›ä¸€ä¸ªè®¿é—®è¯¥å®ä¾‹çš„æ–¹æ³•ã€‚è¿™å°±æ˜¯å•ä¾‹æ¨¡å¼çš„æ¨¡å¼åŠ¨æœºã€‚</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ã€ä¼˜ç‚¹ã€‘</span><br><span class="line">ä¸€ã€å®ä¾‹æ§åˆ¶</span><br><span class="line">å•ä¾‹æ¨¡å¼ä¼šé˜»æ­¢å…¶ä»–å¯¹è±¡å®ä¾‹åŒ–å…¶è‡ªå·±çš„å•ä¾‹å¯¹è±¡çš„å‰¯æœ¬ï¼Œä»è€Œç¡®ä¿æ‰€æœ‰å¯¹è±¡éƒ½è®¿é—®å”¯ä¸€å®ä¾‹ã€‚</span><br><span class="line">äºŒã€çµæ´»æ€§</span><br><span class="line">å› ä¸ºç±»æ§åˆ¶äº†å®ä¾‹åŒ–è¿‡ç¨‹ï¼Œæ‰€ä»¥ç±»å¯ä»¥çµæ´»æ›´æ”¹å®ä¾‹åŒ–è¿‡ç¨‹ã€‚</span><br><span class="line">ã€ç¼ºç‚¹ã€‘</span><br><span class="line">ä¸€ã€å¼€é”€</span><br><span class="line">è™½ç„¶æ•°é‡å¾ˆå°‘ï¼Œä½†å¦‚æœæ¯æ¬¡å¯¹è±¡è¯·æ±‚å¼•ç”¨æ—¶éƒ½è¦æ£€æŸ¥æ˜¯å¦å­˜åœ¨ç±»çš„å®ä¾‹ï¼Œå°†ä»ç„¶éœ€è¦ä¸€äº›å¼€é”€ã€‚å¯ä»¥é€šè¿‡ä½¿ç”¨é™æ€åˆå§‹åŒ–è§£å†³æ­¤é—®é¢˜ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å•ä¾‹æ¨¡å¼çš„ç®€å•ç†è§£</span><br><span class="line">1 å•ä¾‹æ¨¡å¼ åªå…è®¸åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå› æ­¤èŠ‚çœå†…å­˜ï¼ŒåŠ å¿«å¯¹è±¡è®¿é—®é€Ÿåº¦ï¼Œå› æ­¤å¯¹è±¡éœ€è¦è¢«å…¬ç”¨çš„åœºåˆé€‚åˆä½¿ç”¨ï¼Œå¦‚å¤šä¸ªæ¨¡å—ä½¿ç”¨åŒä¸€ä¸ªæ•°æ®æºè¿æ¥å¯¹è±¡ç­‰ç­‰</span><br><span class="line">2 å•ä¾‹çš„ç¼ºç‚¹ å°±æ˜¯ä¸é€‚ç”¨äºå˜åŒ–çš„å¯¹è±¡ï¼Œå¦‚æœåŒä¸€ç±»å‹çš„å¯¹è±¡æ€»æ˜¯è¦åœ¨ä¸åŒçš„ç”¨ä¾‹åœºæ™¯å‘ç”Ÿå˜åŒ–ï¼Œå•ä¾‹å°±ä¼šå¼•èµ·æ•°æ®çš„é”™è¯¯ï¼Œä¸èƒ½ä¿å­˜å½¼æ­¤çš„çŠ¶æ€ã€‚</span><br><span class="line">ç”¨å•ä¾‹æ¨¡å¼ï¼Œå°±æ˜¯åœ¨é€‚ç”¨å…¶ä¼˜ç‚¹çš„çŠ¶æ€ä¸‹ä½¿ç”¨</span><br></pre></td></tr></table></figure><br><br><p>ä¸€äº›è®¾ç½®ï¼Œå…å¾—æ¯æ¬¡éƒ½å¼¹å‡ºçª—å£</p><p>å­ç³»ç»Ÿæ”¹æˆçª—å£Windows</p><p>é“¾æ¥å™¨ å…¥å£ç‚¹  -&gt;mainCRTStarttup</p><p>ä¸ä¼šè®¾ç½®é‚£å°±æ·»åŠ ä»£ç ï¼Œå¯¹ä¸‹é¢çš„ä»£ç è¿›è¡Œæ’åˆ—ç»„åˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#pragma comment(linker, &quot;/subsystem:windows /entry:WinMainCRTStartup&quot; )</span><br><span class="line">#pragma comment(linker, &quot;/subsystem:windows /entry:mainCRTStartup&quot; )</span><br><span class="line">#pragma comment(linker, &quot;/subsystem:console /entry:WinMainCRTStartup&quot; )</span><br><span class="line">#pragma comment(linker, &quot;/subsystem:console /entry:mainCRTStartup&quot; )</span><br></pre></td></tr></table></figure><br><h3 id="åŒ…çš„è®¾è®¡ä¸å®ç°"><a href="#åŒ…çš„è®¾è®¡ä¸å®ç°" class="headerlink" title="åŒ…çš„è®¾è®¡ä¸å®ç°"></a>åŒ…çš„è®¾è®¡ä¸å®ç°</h3><h4 id="åŒ…çš„ç»“æ„"><a href="#åŒ…çš„ç»“æ„" class="headerlink" title="åŒ…çš„ç»“æ„"></a>åŒ…çš„ç»“æ„</h4><p>æœ¬éƒ¨åˆ†ç»“åˆä»£ç æ¥ä»‹ç»åŒ…çš„ç»“æ„ï¼Œå…ˆç»™å‡ºè¿™éƒ¨åˆ†çš„ä»£ç ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CPacket</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">CPacket</span>():<span class="built_in">sHead</span>(<span class="number">0</span>), <span class="built_in">nLength</span>(<span class="number">0</span>), <span class="built_in">sCmd</span>(<span class="number">0</span>), <span class="built_in">sSum</span>(<span class="number">0</span>) &#123;&#125;</span><br><span class="line"><span class="built_in">CPacket</span>(<span class="type">const</span> CPacket&amp; pack) &#123;</span><br><span class="line">sHead = pack.sHead;</span><br><span class="line">nLength = pack.nLength;</span><br><span class="line">sCmd = pack.sCmd;</span><br><span class="line">strData = pack.strData;</span><br><span class="line">sSum = pack.sSum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">CPacket</span>(<span class="type">const</span> BYTE* pData, <span class="type">size_t</span>&amp; nSize) &#123;</span><br><span class="line"><span class="type">size_t</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (; i &lt; nSize; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (*(WORD*)(pData + i) == <span class="number">0xFEFF</span>) &#123;</span><br><span class="line">sHead = *(WORD*)(pData + i);</span><br><span class="line">i += <span class="number">2</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (i + <span class="number">4</span> + <span class="number">2</span> + <span class="number">2</span> &gt; nSize) &#123; <span class="comment">// åŒ…æ•°æ®å¯èƒ½ä¸å…¨ï¼Œæˆ–è€…åŒ…å¤´æœªèƒ½å…¨éƒ¨æ¥æ”¶åˆ°</span></span><br><span class="line">nSize = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">nLength = *(DWORD*)(pData + i); i += <span class="number">4</span>;</span><br><span class="line"><span class="keyword">if</span> (nLength + i &gt; nSize) &#123;<span class="comment">// åŒ…æ²¡æœ‰å®Œå…¨æ¥æ”¶ï¼Œå°±è¿”å›ï¼Œè§£æå¤±è´¥ã€‚</span></span><br><span class="line">nSize = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">sCmd = *(WORD*)(pData + i); i += <span class="number">2</span>;</span><br><span class="line"><span class="keyword">if</span> (nLength &gt; <span class="number">4</span>) &#123;</span><br><span class="line">strData.<span class="built_in">resize</span>(nLength - <span class="number">2</span> - <span class="number">2</span>);</span><br><span class="line"><span class="built_in">memcpy</span>((<span class="type">void</span>*)strData.<span class="built_in">c_str</span>(), pData + i, nLength - <span class="number">4</span>);</span><br><span class="line">i += nLength - <span class="number">4</span>;</span><br><span class="line">&#125;</span><br><span class="line">sSum = *(WORD*)(pData + i); i += <span class="number">2</span>;</span><br><span class="line">WORD sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> j = <span class="number">0</span>; j &lt; strData.<span class="built_in">size</span>(); j++) &#123;</span><br><span class="line">sum += <span class="built_in">BYTE</span>(strData[i]) &amp; <span class="number">0xFF</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (sum == sSum) &#123;</span><br><span class="line">nSize = i;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">nSize = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">~<span class="built_in">CPacket</span>()&#123;&#125;</span><br><span class="line">CPacket&amp; <span class="keyword">operator</span>=(<span class="type">const</span> CPacket&amp; pack) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span> == &amp;pack)&#123;</span><br><span class="line">sHead = pack.sHead;</span><br><span class="line">nLength = pack.nLength;</span><br><span class="line">sCmd = pack.sCmd;</span><br><span class="line">sSum = pack.sSum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">WORD sHead;  <span class="comment">// å›ºå®šä½FE  FF</span></span><br><span class="line">WORD sCmd;  <span class="comment">// æ§åˆ¶å‘½ä»¤</span></span><br><span class="line">DWORD nLength; <span class="comment">// åŒ…é•¿åº¦ï¼ˆä»æ§åˆ¶å‘½ä»¤å¼€å§‹ï¼Œåˆ°å’Œæ ¡éªŒç»“æŸï¼‰</span></span><br><span class="line">std::string strData;  <span class="comment">// åŒ…æ•°æ®</span></span><br><span class="line">WORD sSum; <span class="comment">// å’Œæ ¡éªŒ</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ª<strong>åŒ…</strong>å«äº†<strong>åŒ…å¤´</strong>ã€<strong>åŒ…é•¿åº¦</strong>ã€<strong>æ§åˆ¶å‘½ä»¤</strong>ã€<strong>åŒ…æ•°æ®</strong>å’Œ<strong>æ ¡éªŒå’Œ</strong>ç­‰å­—æ®µã€‚åŒ…ä¸­çš„å†…å®¹ä¹Ÿæ˜¯æŒ‰ç…§è¿™ä¸ªé¡ºåºæ¥çš„ã€‚</p><table><thead><tr><th>å­—æ®µå</th><th>æ•°æ®ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>sHead</code></td><td><code>WORD</code></td><td><strong>åŒ…å¤´æ ‡è¯†</strong>ï¼Œå›ºå®šä¸º<code>0xFEFF</code>ï¼Œç”¨äºæ ‡è¯†æ•°æ®åŒ…çš„å¼€å§‹ã€‚</td></tr><tr><td><code>nLength</code></td><td><code>DWORD</code></td><td><strong>åŒ…é•¿åº¦</strong>ï¼Œè¡¨ç¤ºä»æ§åˆ¶å‘½ä»¤ï¼ˆ<code>sCmd</code>ï¼‰å¼€å§‹ï¼Œåˆ°æ ¡éªŒå’Œï¼ˆ<code>sSum</code>ï¼‰ç»“æŸçš„æ€»é•¿åº¦ã€‚</td></tr><tr><td><code>sCmd</code></td><td><code>WORD</code></td><td><strong>æ§åˆ¶å‘½ä»¤</strong>ï¼Œç”¨äºæ ‡è¯†æ•°æ®åŒ…çš„ç±»å‹æˆ–æ“ä½œæŒ‡ä»¤ã€‚</td></tr><tr><td><code>strData</code></td><td><code>std::string</code></td><td><strong>åŒ…æ•°æ®</strong>ï¼Œå­˜å‚¨å®é™…çš„æ•°æ®å†…å®¹ï¼Œé•¿åº¦å¯å˜ã€‚</td></tr><tr><td><code>sSum</code></td><td><code>WORD</code></td><td><strong>æ ¡éªŒå’Œ</strong>ï¼Œç”¨äºéªŒè¯æ•°æ®åŒ…çš„å®Œæ•´æ€§ã€‚</td></tr></tbody></table><h5 id="1ã€æ‰¾åŒ…å¤´"><a href="#1ã€æ‰¾åŒ…å¤´" class="headerlink" title="1ã€æ‰¾åŒ…å¤´"></a>1ã€æ‰¾åŒ…å¤´</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">size_t</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (; i &lt; nSize; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (*(WORD*)(pData + i) == <span class="number">0xFEFF</span>) &#123;</span><br><span class="line">sHead = *(WORD*)(pData + i);</span><br><span class="line">i += <span class="number">2</span>; <span class="comment">// æ‰¾åˆ°åŒ…å¤´åï¼Œå°±è·³è¿‡åŒ…å¤´ï¼Œç„¶åå°±æ˜¯</span></span><br><span class="line"><span class="keyword">break</span>;  <span class="comment">// è·³å‡ºå¾ªç¯</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2ã€æ‰¾åˆ°åŒ…å¤´åï¼Œåˆ¤æ–­å¦‚æœåŒ…å¤´åçš„æ•°æ®å°äº8å­—èŠ‚ï¼Œé‚£ä¹ˆå°±è¿”å›äº†"><a href="#2ã€æ‰¾åˆ°åŒ…å¤´åï¼Œåˆ¤æ–­å¦‚æœåŒ…å¤´åçš„æ•°æ®å°äº8å­—èŠ‚ï¼Œé‚£ä¹ˆå°±è¿”å›äº†" class="headerlink" title="2ã€æ‰¾åˆ°åŒ…å¤´åï¼Œåˆ¤æ–­å¦‚æœåŒ…å¤´åçš„æ•°æ®å°äº8å­—èŠ‚ï¼Œé‚£ä¹ˆå°±è¿”å›äº†"></a>2ã€æ‰¾åˆ°åŒ…å¤´åï¼Œåˆ¤æ–­å¦‚æœåŒ…å¤´åçš„æ•°æ®å°äº8å­—èŠ‚ï¼Œé‚£ä¹ˆå°±è¿”å›äº†</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (i + <span class="number">4</span> + <span class="number">2</span> + <span class="number">2</span> &gt; nSize) &#123; <span class="comment">// åŒ…æ•°æ®å¯èƒ½ä¸å…¨ï¼Œæˆ–è€…åŒ…å¤´æœªèƒ½å…¨éƒ¨æ¥æ”¶åˆ°</span></span><br><span class="line">nSize = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª8ä¸ªå­—èŠ‚åŒ…æ‹¬åŒ…é•¿åº¦nLengthï¼ˆ4å­—èŠ‚ï¼‰ã€æ§åˆ¶å‘½ä»¤sCmdï¼ˆ2å­—èŠ‚ï¼‰ã€åŒ…æ ¡éªŒå’Œï¼ˆ2å­—èŠ‚ï¼‰ï¼Œè¿™é‡Œåˆ¤æ–­åŒ…æ˜¯ä¸æ˜¯å®Œæ•´çš„ï¼Œä¸å®Œæ•´é‚£å°±è®©nSizeæ¸…é›¶ã€‚</p><h5 id="3ã€è®©nLengthæå–åŒ…é•¿åº¦çš„å€¼ï¼ˆ4å­—èŠ‚ï¼‰ï¼Œç°åœ¨nLengthçš„å€¼å°±æ˜¯ä»æ§åˆ¶å‘½ä»¤å¼€å§‹åˆ°æ ¡éªŒå’Œç»“æŸï¼Œç„¶ååŠ ä¸Šåç§»é‡è·ŸnSizeæ¯”è¾ƒ"><a href="#3ã€è®©nLengthæå–åŒ…é•¿åº¦çš„å€¼ï¼ˆ4å­—èŠ‚ï¼‰ï¼Œç°åœ¨nLengthçš„å€¼å°±æ˜¯ä»æ§åˆ¶å‘½ä»¤å¼€å§‹åˆ°æ ¡éªŒå’Œç»“æŸï¼Œç„¶ååŠ ä¸Šåç§»é‡è·ŸnSizeæ¯”è¾ƒ" class="headerlink" title="3ã€è®©nLengthæå–åŒ…é•¿åº¦çš„å€¼ï¼ˆ4å­—èŠ‚ï¼‰ï¼Œç°åœ¨nLengthçš„å€¼å°±æ˜¯ä»æ§åˆ¶å‘½ä»¤å¼€å§‹åˆ°æ ¡éªŒå’Œç»“æŸï¼Œç„¶ååŠ ä¸Šåç§»é‡è·ŸnSizeæ¯”è¾ƒ"></a>3ã€è®©nLengthæå–åŒ…é•¿åº¦çš„å€¼ï¼ˆ4å­—èŠ‚ï¼‰ï¼Œç°åœ¨nLengthçš„å€¼å°±æ˜¯ä»æ§åˆ¶å‘½ä»¤å¼€å§‹åˆ°æ ¡éªŒå’Œç»“æŸï¼Œç„¶ååŠ ä¸Šåç§»é‡è·ŸnSizeæ¯”è¾ƒ</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// * æ˜¯è§£å¼•ç”¨æ“ä½œç¬¦ï¼Œè¡¨ç¤ºä» (DWORD*)(pData + i) æ‰€æŒ‡å‘çš„ä½ç½®æå– 4 å­—èŠ‚çš„å€¼ã€‚</span></span><br><span class="line"><span class="comment">// æœ€ç»ˆï¼Œè¿™ 4 å­—èŠ‚çš„å€¼è¢«èµ‹å€¼ç»™ nLengthã€‚</span></span><br><span class="line">nLength = *(DWORD*)(pData + i);</span><br><span class="line"><span class="keyword">if</span> (nLength + i &gt; nSize) &#123;<span class="comment">// åŒ…æ²¡æœ‰å®Œå…¨æ¥æ”¶ï¼Œå°±è¿”å›ï¼Œè§£æå¤±è´¥ã€‚</span></span><br><span class="line">nSize = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="4ã€è¯»å–åŒ…é•¿åº¦ï¼Œç„¶åå¦‚æœåŒ…æ²¡æœ‰æ•°æ®éƒ¨åˆ†ï¼Œé‚£å°±è¯´æ˜åŒ…æ²¡æœ‰å®Œå…¨æ¥å—"><a href="#4ã€è¯»å–åŒ…é•¿åº¦ï¼Œç„¶åå¦‚æœåŒ…æ²¡æœ‰æ•°æ®éƒ¨åˆ†ï¼Œé‚£å°±è¯´æ˜åŒ…æ²¡æœ‰å®Œå…¨æ¥å—" class="headerlink" title="4ã€è¯»å–åŒ…é•¿åº¦ï¼Œç„¶åå¦‚æœåŒ…æ²¡æœ‰æ•°æ®éƒ¨åˆ†ï¼Œé‚£å°±è¯´æ˜åŒ…æ²¡æœ‰å®Œå…¨æ¥å—"></a>4ã€è¯»å–åŒ…é•¿åº¦ï¼Œç„¶åå¦‚æœåŒ…æ²¡æœ‰æ•°æ®éƒ¨åˆ†ï¼Œé‚£å°±è¯´æ˜åŒ…æ²¡æœ‰å®Œå…¨æ¥å—</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nLength = *(DWORD*)(pData + i); i += <span class="number">4</span>;</span><br><span class="line"><span class="keyword">if</span> (nLength + i &gt; nSize) &#123;<span class="comment">// åŒ…æ²¡æœ‰å®Œå…¨æ¥æ”¶ï¼Œå°±è¿”å›ï¼Œè§£æå¤±è´¥ã€‚</span></span><br><span class="line">nSize = <span class="number">0</span>; <span class="comment">// è®©nSizeæ¸…é›¶</span></span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="5ã€è¯»å–å‘½ä»¤æ§åˆ¶çš„å†…å®¹"><a href="#5ã€è¯»å–å‘½ä»¤æ§åˆ¶çš„å†…å®¹" class="headerlink" title="5ã€è¯»å–å‘½ä»¤æ§åˆ¶çš„å†…å®¹"></a>5ã€è¯»å–å‘½ä»¤æ§åˆ¶çš„å†…å®¹</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sCmd = *(WORD*)(pData + i); i += <span class="number">2</span>;</span><br><span class="line"><span class="keyword">if</span> (nLength &gt; <span class="number">4</span>) &#123;</span><br><span class="line"><span class="comment">// è°ƒæ•´æ•°æ®çš„å¤§å°  è®©nLength å‡å»æ§åˆ¶å‘½ä»¤å’Œæ£€éªŒå’Œçš„å¤§å°</span></span><br><span class="line">strData.<span class="built_in">resize</span>(nLength - <span class="number">2</span> - <span class="number">2</span>);</span><br><span class="line"><span class="built_in">memcpy</span>((<span class="type">void</span>*)strData.<span class="built_in">c_str</span>(), pData + i, nLength - <span class="number">4</span>);</span><br><span class="line">i += nLength - <span class="number">4</span>; <span class="comment">// è¿™æ˜¯æ•°æ®çš„é•¿åº¦ï¼Œç›¸å½“äºè·³è¿‡äº†</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="6ã€æå–æ ¡éªŒå’Œï¼ˆsSumï¼‰"><a href="#6ã€æå–æ ¡éªŒå’Œï¼ˆsSumï¼‰" class="headerlink" title="6ã€æå–æ ¡éªŒå’Œï¼ˆsSumï¼‰"></a>6ã€æå–æ ¡éªŒå’Œï¼ˆsSumï¼‰</h5><p>æ ¡éªŒå’Œçš„è®¡ç®—éœ€è¦éå†æ•°æ®æ˜¯å› ä¸º<strong>æ ¡éªŒå’Œé€šå¸¸æ˜¯æ ¹æ®æ•°æ®éƒ¨åˆ†çš„å†…å®¹è®¡ç®—å¾—å‡ºçš„</strong>ï¼Œè€Œä¸ä»…ä»…æ˜¯è¯»å–æ ¡éªŒå’Œå­—æ®µæœ¬èº«</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sSum = *(WORD*)(pData + i); i += <span class="number">2</span>;</span><br><span class="line">WORD sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> j = <span class="number">0</span>; j &lt; strData.<span class="built_in">size</span>(); j++) &#123;</span><br><span class="line">sum += <span class="built_in">BYTE</span>(strData[i]) &amp; <span class="number">0xFF</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (sum == sSum) &#123;</span><br><span class="line">nSize = i;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">nSize = <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p><strong>æˆå‘˜å˜é‡é¡ºåºå¯¼è‡´åŒ…é•¿åº¦å’ŒåŒ…æ§åˆ¶å‘½ä»¤ä½ç½®äº’æ¢</strong></p><h5 id="1-æˆå‘˜å˜é‡çš„å†…å­˜å¸ƒå±€"><a href="#1-æˆå‘˜å˜é‡çš„å†…å­˜å¸ƒå±€" class="headerlink" title="1. æˆå‘˜å˜é‡çš„å†…å­˜å¸ƒå±€"></a>1. æˆå‘˜å˜é‡çš„å†…å­˜å¸ƒå±€</h5><p>C++ æ ‡å‡†è§„å®šï¼Œç±»æˆå‘˜å˜é‡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€é¡ºåºä¸å®ƒä»¬åœ¨ç±»å®šä¹‰ä¸­çš„å£°æ˜é¡ºåºä¸€è‡´ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CPacket</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>:    </span><br><span class="line">    WORD sHead;</span><br><span class="line">    WORD sCmd;</span><br><span class="line">    DWORD nLength;</span><br><span class="line">    std::string strData;</span><br><span class="line">    WORD sSum;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ç±»ä¸­ï¼Œæˆå‘˜å˜é‡çš„å†…å­˜å¸ƒå±€é¡ºåºæ˜¯ï¼š<code>sHead</code> â†’ <code>sCmd</code> â†’ <code>nLength</code> â†’ <code>strData</code> â†’ <code>sSum</code>ã€‚</p><h5 id="2-å°åŒ…æ—¶çš„å†…å­˜æ‹·è´"><a href="#2-å°åŒ…æ—¶çš„å†…å­˜æ‹·è´" class="headerlink" title="2. å°åŒ…æ—¶çš„å†…å­˜æ‹·è´"></a>2. å°åŒ…æ—¶çš„å†…å­˜æ‹·è´</h5><p>å¦‚æœä½ ç›´æ¥å°†ç±»å¯¹è±¡çš„å†…å­˜ä½œä¸ºæ•°æ®åŒ…å‘é€ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CPacket packet;</span><br><span class="line">send((const char*)&amp;packet, sizeof(packet));</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼ä¼šå°†ç±»çš„å†…å­˜å¸ƒå±€ç›´æ¥ä½œä¸ºæ•°æ®åŒ…å‘é€ã€‚å¦‚æœç±»çš„æˆå‘˜å˜é‡é¡ºåºä¸æ•°æ®åŒ…çš„æ ¼å¼è¦æ±‚ä¸ä¸€è‡´ï¼Œä¼šå¯¼è‡´æ•°æ®åŒ…çš„å†…å®¹é”™ä¹±ã€‚</p><h5 id="3-åŠ¨æ€æˆå‘˜å˜é‡"><a href="#3-åŠ¨æ€æˆå‘˜å˜é‡" class="headerlink" title="3. åŠ¨æ€æˆå‘˜å˜é‡"></a>3. åŠ¨æ€æˆå‘˜å˜é‡</h5><p>å¦‚æœç±»ä¸­åŒ…å«åŠ¨æ€æˆå‘˜å˜é‡ï¼ˆä¾‹å¦‚ <code>std::string</code> æˆ–æŒ‡é’ˆï¼‰ï¼Œä¸èƒ½ç›´æ¥é€šè¿‡å†…å­˜æ‹·è´çš„æ–¹å¼å‘é€æ•´ä¸ªç±»å¯¹è±¡ï¼Œå› ä¸ºè¿™äº›å˜é‡çš„å®é™…æ•°æ®å­˜å‚¨åœ¨å †ä¸Šï¼Œè€Œä¸æ˜¯ç±»å¯¹è±¡çš„è¿ç»­å†…å­˜ä¸­ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> è¿œæ§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt09TCP-IPç½‘ç»œé€šä¿¡</title>
      <link href="/2025/03/13/Qt09TCP-IP%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/"/>
      <url>/2025/03/13/Qt09TCP-IP%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/</url>
      
        <content type="html"><![CDATA[<p>TCP&#x2F;IPé€šä¿¡ï¼ˆå³SOCKETé€šä¿¡ï¼‰æ˜¯é€šè¿‡ç½‘çº¿å°†<strong>æœåŠ¡å™¨Serverç«¯</strong>å’Œ<strong>å®¢æˆ·æœºClientç«¯</strong>è¿›è¡Œè¿æ¥ï¼Œåœ¨éµå¾ªISO&#x2F;OSIæ¨¡å‹çš„å››å±‚å±‚çº§æ„æ¶çš„åŸºç¡€ä¸Šé€šè¿‡TCP&#x2F;IPåè®®å»ºç«‹çš„é€šè®¯ã€‚æ§åˆ¶å™¨å¯ä»¥è®¾ç½®ä¸ºæœåŠ¡å™¨ç«¯æˆ–å®¢æˆ·ç«¯ã€‚</p><p>å…³äºTCP&#x2F;IPåè®®å¯è¯¦çœ‹ï¼š<a href="https://zhuanlan.zhihu.com/p/33889997">TCP&#x2F;IPåè®®è¯¦è§£ - çŸ¥ä¹ (zhihu.com)</a></p><p> æ€»çš„æ¥è¯´ï¼ŒTCP&#x2F;IPé€šè®¯æœ‰ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><strong>å®¢æˆ·ç«¯</strong>å’Œ<strong>æœåŠ¡å™¨</strong></li><li><strong>QTcpServerï¼ˆç›‘å¬å¥—æ¥å­—ï¼‰<strong>å’Œ</strong>QTcpSocketï¼ˆé€šè®¯å¥—æ¥å­—ï¼‰</strong></li></ul><p>ç›‘å¬å¥—æ¥å­—ï¼Œé¡¾åæ€ä¹‰ï¼Œç›‘å¬å…³äºå„ç§é€šè®¯çš„çŠ¶æ€ï¼Œä¸€æ—¦è¿›è¡Œé€šè®¯ï¼Œç›‘å¬å¥—æ¥å­—ä¼šå¯åŠ¨é€šè®¯å¥—æ¥å­—ï¼Œè¿›è¡Œé€šè®¯</p><p>å®¢æˆ·ç«¯ä½¿ç”¨connectToHostå‡½æ•°ä¸»åŠ¨è¿æ¥æœåŠ¡å™¨åï¼ŒæœåŠ¡å™¨ä¼šè§¦å‘newConnectioè¿™ä¸ªæ§½å‡½æ•°ï¼Œå¹¶è¿›è¡Œå–å‡ºQTcpServerï¼ˆç›‘å¬å¥—æ¥å­—ï¼‰ï¼Œå°†ç›¸å…³å†…å®¹å–å‡ºå¹¶èµ‹ç»™QTcpSocketï¼ˆé€šè®¯å¥—æ¥å­—ï¼‰ã€‚<br>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼Œè§¦å‘readyReadï¼ˆï¼‰ï¼Œè¿›è¡Œå¤„ç†ï¼Œå½¼æ­¤ä¼ é€’æ—¶ï¼ŒåŸç†éƒ½æ˜¯è¿™æ ·çš„ã€‚</p><p><strong>å¯¹åŒæ–¹æ¥è¯´éƒ½èµ·ä½œç”¨çš„éƒ¨åˆ†ï¼š</strong></p><ol><li>ä¸€æ—¦å»ºç«‹è¿æ¥ï¼Œå°±ä¼šè§¦å‘connectedï¼ŒæœåŠ¡å™¨ç‰¹æ®Šä¸€ç‚¹ï¼Œè§¦å‘çš„æ˜¯newConnectio</li><li>äº’ä¼ æ•°æ®ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä¸€æ—¦æ¥å—åˆ°ï¼Œå°±ä¼šè§¦å‘readyread</li></ol><p>æœåŠ¡å™¨ä¸­ï¼Œéœ€è¦ç›‘å¬å¥—æ¥å­—ä»¥åŠé€šè®¯å¥—æ¥å­—ï¼Œç›‘å¬å¥—æ¥å­—ç”¨äºç›‘å¬å®¢æˆ·ç«¯æ˜¯å¦ç»™æœåŠ¡å™¨å‘é€è¯·æ±‚</p><p>æœ¬ç¯‡åšæ–‡åšäº†åˆæ­¥çš„å­¦ä¹ ä¸å°è¯•ï¼Œç¼–å†™äº†ä¸€ä¸ªå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åŸºäºçª—å£é€šä¿¡ä»¥åŠæ–‡ä»¶ä¼ è¾“çš„å°ä¾‹ç¨‹ã€‚</p><h3 id="ä¸€ï¼Œå®¢æˆ·ç«¯"><a href="#ä¸€ï¼Œå®¢æˆ·ç«¯" class="headerlink" title="ä¸€ï¼Œå®¢æˆ·ç«¯"></a><font color="FF0000">ä¸€ï¼Œå®¢æˆ·ç«¯</font></h3><p>å®¢æˆ·ç«¯çš„ä»£ç æ¯”æœåŠ¡å™¨ç¨ç®€å•ï¼Œæ€»çš„æ¥è¯´ï¼Œä½¿ç”¨QTä¸­çš„<strong>QTcpSocketç±»</strong>ä¸æœåŠ¡å™¨è¿›è¡Œé€šä¿¡åªéœ€è¦ä»¥ä¸‹5æ­¥ï¼š</p><p><strong>ï¼ˆ1ï¼‰åˆ›å»ºQTcpSocketå¥—æ¥å­—å¯¹è±¡</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socket = new QTcpSocket(this);</span><br></pre></td></tr></table></figure><p><strong>ï¼ˆ2ï¼‰ä½¿ç”¨è¿™ä¸ªå¯¹è±¡è¿æ¥æœåŠ¡å™¨</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">QString ip = ui.lineEdit_ip-&gt;text();//è·å–ip</span><br><span class="line">int port = ui.lineEdit_2-&gt;text().toInt();//è·å–ç«¯å£æ•°æ®</span><br><span class="line">socket-&gt;connectToHost(ip, port);</span><br></pre></td></tr></table></figure><p><strong>ï¼ˆ3ï¼‰ä½¿ç”¨writeå‡½æ•°å‘æœåŠ¡å™¨å‘é€æ•°æ®</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QByteArray data = ui.lineEdit_3-&gt;text().toUtf8();//è·å–lineEditæ§ä»¶ä¸­çš„æ•°æ®å¹¶å‘é€ç»™æœåŠ¡å™¨</span><br><span class="line">socket-&gt;write(data);</span><br></pre></td></tr></table></figure><p> <strong>ï¼ˆ4ï¼‰å½“socketæ¥æ”¶ç¼“å†²åŒºæœ‰æ–°æ•°æ®åˆ°æ¥æ—¶ï¼Œä¼šå‘å‡ºreadRead()ä¿¡å·ï¼Œå› æ­¤ä¸ºè¯¥ä¿¡å·æ·»åŠ æ§½å‡½æ•°ä»¥è¯»å–æ•°æ®</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> connect(socket, &amp;QTcpSocket::readyRead, this, &amp;QTcpClinet::ReadData);</span><br><span class="line">void QTcpClinet::ReadData()</span><br><span class="line">&#123;</span><br><span class="line">    QByteArray buf = socket-&gt;readAll();</span><br><span class="line">    ui.textEdit-&gt;append(buf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ï¼ˆ5ï¼‰æ–­å¼€ä¸æœåŠ¡å™¨çš„è¿æ¥ï¼ˆå…³äºclose()å’ŒdisconnectFromHost()çš„åŒºåˆ«ï¼Œå¯ä»¥æŒ‰F1çœ‹å¸®åŠ©ï¼‰</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socket-&gt;disconnectFromHost();</span><br></pre></td></tr></table></figure><p><strong>å®¢æˆ·ç«¯ä¾‹ç¨‹ï¼šï¼ˆæ–°å»ºä¸€ä¸ªqté¡¹ç›®QTcpClinetï¼ˆå®¢æˆ·æœºï¼‰ï¼‰</strong></p><ul><li><strong>uiç•Œé¢</strong></li></ul><p><img src="https://bu.dusays.com/2025/03/13/67d2dbe2f1a93.png"></p><p>æœ¬åœ°å›è·¯ipï¼š127.0.0.1 å¯ä»¥è¿æ¥åˆ°æœ¬åœ°ipï¼ˆç”µè„‘å†…éƒ¨å¾ªç¯çš„ipï¼‰</p><p>å¦‚æœè¦å’Œå±€åŸŸç½‘å…¶ä»–ipè¿æ¥ -&gt; åœ¨è¿è¡Œï¼ˆwin+Rï¼‰+cmd+ipconfig -&gt;ipv4åœ°å€ æŸ¥çœ‹æœ¬æœºip</p><ul><li><strong>QTcpClinet.h</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;QtWidgets/QWidget&gt;</span><br><span class="line">#include &quot;ui_QTcpClinet.h&quot;</span><br><span class="line">#include&quot;QTcpSocket.h&quot;</span><br><span class="line">#pragma execution_character_set(&quot;utf-8&quot;)</span><br><span class="line">class QTcpClinet : public QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">    QTcpClinet(QWidget *parent = Q_NULLPTR);</span><br><span class="line">    ~QTcpClinet();</span><br><span class="line">public slots:</span><br><span class="line">    void on_btn_connect_clicked();</span><br><span class="line">    void ReadData();</span><br><span class="line">    void on_btn_push_clicked();</span><br><span class="line">private:</span><br><span class="line">    Ui::QTcpClinetClass ui;</span><br><span class="line">    QTcpSocket* socket;//åˆ›å»ºsocketæŒ‡é’ˆ</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><strong>QTcpClinet.cpp</strong></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;QTcpClinet.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">QTcpClinet::<span class="built_in">QTcpClinet</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QWidget</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line">    ui.<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    socket = <span class="keyword">new</span> <span class="built_in">QTcpSocket</span>(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">QTcpClinet::~<span class="built_in">QTcpClinet</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> <span class="keyword">this</span>-&gt;socket;<span class="comment">//å›æ”¶å†…å­˜</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QTcpClinet::on_btn_connect_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (ui.btn_connect-&gt;<span class="built_in">text</span>()==<span class="built_in">tr</span>(<span class="string">&quot;è¿æ¥æœåŠ¡å™¨&quot;</span>))</span><br><span class="line">  &#123;</span><br><span class="line">    QString ip = ui.lineEdit_ip-&gt;<span class="built_in">text</span>();<span class="comment">//è·å–ip</span></span><br><span class="line">    <span class="type">int</span> port = ui.lineEdit_2-&gt;<span class="built_in">text</span>().<span class="built_in">toInt</span>();<span class="comment">//è·å–ç«¯å£æ•°æ®</span></span><br><span class="line">    <span class="comment">//å–æ¶ˆå·²æœ‰çš„è¿æ¥</span></span><br><span class="line">    socket-&gt;<span class="built_in">abort</span>();</span><br><span class="line">    <span class="comment">//è¿æ¥æœåŠ¡å™¨</span></span><br><span class="line">    socket-&gt;<span class="built_in">connectToHost</span>(ip, port);</span><br><span class="line">    <span class="type">bool</span> isconnect = socket-&gt;<span class="built_in">waitForConnected</span>();<span class="comment">//ç­‰å¾…ç›´åˆ°è¿æ¥æˆåŠŸ</span></span><br><span class="line">    <span class="comment">//å¦‚æœè¿æ¥æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">if</span> (isconnect)</span><br><span class="line">    &#123;</span><br><span class="line">        ui.textEdit-&gt;<span class="built_in">append</span>(<span class="string">&quot;The connection was successful!!&quot;</span>);</span><br><span class="line">        ui.btn_push-&gt;<span class="built_in">setEnabled</span>(<span class="literal">true</span>);<span class="comment">//æŒ‰é’®ä½¿èƒ½</span></span><br><span class="line">        <span class="comment">//ä¿®æ”¹æŒ‰é”®æ–‡å­—</span></span><br><span class="line">        ui.btn_connect-&gt;<span class="built_in">setText</span>(<span class="string">&quot;æ–­å¼€æœåŠ¡å™¨è¿æ¥&quot;</span>);</span><br><span class="line">        <span class="comment">//æ¥æ”¶ç¼“å†²åŒºï¼ˆæœåŠ¡å™¨ï¼‰ä¿¡æ¯</span></span><br><span class="line">        <span class="built_in">connect</span>(socket, &amp;QTcpSocket::readyRead, <span class="keyword">this</span>, &amp;QTcpClinet::ReadData);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        ui.textEdit-&gt;<span class="built_in">append</span>(<span class="string">&quot;The connection falied!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">      <span class="comment">//æ–­å¼€è¿æ¥</span></span><br><span class="line">      socket-&gt;<span class="built_in">disconnectFromHost</span>();</span><br><span class="line">      ui.btn_connect-&gt;<span class="built_in">setText</span>(<span class="string">&quot;è¿æ¥æœåŠ¡å™¨&quot;</span>);</span><br><span class="line">      ui.btn_push-&gt;<span class="built_in">setEnabled</span>(<span class="literal">false</span>);<span class="comment">//å…³é—­å‘é€æŒ‰é’®ä½¿èƒ½</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¥æ”¶ç¼“å†²åŒºä¿¡æ¯å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QTcpClinet::ReadData</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QByteArray buf = socket-&gt;<span class="built_in">readAll</span>();</span><br><span class="line">    ui.textEdit-&gt;<span class="built_in">append</span>(buf);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å‘é€æŒ‰é’®äº‹ä»¶</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QTcpClinet::on_btn_push_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QByteArray data = ui.lineEdit_3-&gt;<span class="built_in">text</span>().<span class="built_in">toUtf8</span>();<span class="comment">//è·å–lineEditæ§ä»¶ä¸­çš„æ•°æ®å¹¶å‘é€ç»™æœåŠ¡å™¨</span></span><br><span class="line">    socket-&gt;<span class="built_in">write</span>(data);</span><br><span class="line">    <span class="comment">//åˆ¤æ–­æ˜¯å¦å†™å…¥æˆåŠŸ</span></span><br><span class="line">    <span class="type">bool</span> iswrite = socket-&gt;<span class="built_in">waitForBytesWritten</span>();</span><br><span class="line">    <span class="keyword">if</span> (iswrite)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//å†™å…¥æˆåŠŸ</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//æ²¡æœ‰å†™å…¥æˆåŠŸ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="äºŒï¼ŒæœåŠ¡å™¨ï¼ˆéœ€è¦ä¸€ç›´è¿è¡Œå“¦ï¼‰"><a href="#äºŒï¼ŒæœåŠ¡å™¨ï¼ˆéœ€è¦ä¸€ç›´è¿è¡Œå“¦ï¼‰" class="headerlink" title="äºŒï¼ŒæœåŠ¡å™¨ï¼ˆéœ€è¦ä¸€ç›´è¿è¡Œå“¦ï¼‰"></a><font color="FF0000">äºŒï¼ŒæœåŠ¡å™¨ï¼ˆéœ€è¦ä¸€ç›´è¿è¡Œå“¦ï¼‰</font></h3><p>æœåŠ¡å™¨é™¤äº†ä½¿ç”¨åˆ°äº†<strong>QTcpSocketç±»</strong>ï¼Œè¿˜éœ€è¦ç”¨åˆ°<strong>QTcpSeverç±»</strong>ã€‚å³ä¾¿å¦‚æ­¤ï¼Œä¹Ÿåªæ˜¯æ¯”å®¢æˆ·ç«¯å¤æ‚ä¸€ç‚¹ç‚¹ï¼Œç”¨åˆ°äº†6ä¸ªæ­¥éª¤ï¼š</p><p><strong>ï¼ˆ1ï¼‰åˆ›å»ºQTcpSeverå¯¹è±¡</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server = new QTcpServer(this);</span><br></pre></td></tr></table></figure><p><strong>ï¼ˆ2ï¼‰ä¾¦å¬ä¸€ä¸ªç«¯å£ï¼Œä½¿å¾—å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨è¿™ä¸ªç«¯å£è®¿é—®æœåŠ¡å™¨</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server-&gt;listen(QHostAddress::Any, 6677);//ç›‘å¬æ‰€æœ‰ipå’Œ6677ç«¯å£</span><br></pre></td></tr></table></figure><p><strong>ï¼ˆ3ï¼‰å½“æœåŠ¡å™¨è¢«å®¢æˆ·ç«¯è®¿é—®æ—¶ï¼Œä¼šå‘å‡ºnewConnection()ä¿¡å·ï¼Œå› æ­¤ä¸ºè¯¥ä¿¡å·æ·»åŠ æ§½å‡½æ•°ï¼Œå¹¶ç”¨ä¸€ä¸ªQTcpSocketå¯¹è±¡æ¥å—å®¢æˆ·ç«¯è®¿é—®</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">connect(server, &amp;QTcpServer::newConnection, this, &amp;TcpServer::ClientConnect);</span><br><span class="line">void TcpServer::ClientConnect()</span><br><span class="line">&#123;</span><br><span class="line">    //è§£ææ‰€æœ‰å®¢æˆ·è¿æ¥</span><br><span class="line">    while (server-&gt;hasPendingConnections())</span><br><span class="line">    &#123;</span><br><span class="line">        //è¿æ¥ä¸Šåé€šè¿‡socketï¼ˆQTcpSocketå¯¹è±¡ï¼‰è·å–è¿æ¥ä¿¡æ¯</span><br><span class="line">        socket = server-&gt;nextPendingConnection();</span><br><span class="line">        QString str = QString(&quot;[ip:%1,port:%2]&quot;).arg(socket-&gt;peerAddress().toString()).arg(socket-&gt;peerPort());//ç›‘å¬å®¢æˆ·ç«¯æ˜¯å¦æœ‰æ¶ˆæ¯å‘é€</span><br><span class="line">        connect(socket, &amp;QTcpSocket::readyRead, this, &amp;TcpServer::ReadData1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ï¼ˆ4ï¼‰ä½¿ç”¨socketçš„writeå‡½æ•°å‘å®¢æˆ·ç«¯å‘é€æ•°æ®</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socket-&gt;write(data);</span><br></pre></td></tr></table></figure><p><strong>ï¼ˆ5ï¼‰å½“socketæ¥æ”¶ç¼“å†²åŒºæœ‰æ–°æ•°æ®åˆ°æ¥æ—¶ï¼Œä¼šå‘å‡ºreadRead()ä¿¡å·ï¼Œå› æ­¤ä¸ºè¯¥ä¿¡å·æ·»åŠ æ§½å‡½æ•°ä»¥è¯»å–æ•°æ®</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//ç›‘å¬å®¢æˆ·ç«¯æ˜¯å¦æœ‰æ¶ˆæ¯å‘é€</span><br><span class="line">connect(socket, &amp;QTcpSocket::readyRead, this, &amp;TcpServer::ReadData1);</span><br><span class="line">//è·å–å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€çš„ä¿¡æ¯</span><br><span class="line">void TcpServer::ReadData1()</span><br><span class="line">&#123;</span><br><span class="line">    QByteArray buf = socket-&gt;readAll();//readAllæœ€å¤šæ¥æ”¶65532çš„æ•°æ®</span><br><span class="line">    QString str = QString(&quot;[ip:%1,port:%2]&quot;).arg(socket-&gt;peerAddress().toString()).arg(socket-&gt;peerPort());</span><br><span class="line">    ui.textEdit_server-&gt;append(str +QString(buf));</span><br><span class="line">    //socket-&gt;write(&quot;ok&quot;);//æœåŠ¡å™¨æ¥æ”¶åˆ°ä¿¡æ¯åè¿”å›ä¸€ä¸ªok</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ï¼ˆ6ï¼‰å–æ¶ˆä¾¦å¬</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server-&gt;close();</span><br></pre></td></tr></table></figure><p> <strong>æœåŠ¡å™¨ä¾‹ç¨‹ï¼šï¼ˆæ·»åŠ ä¸€ä¸ªæ–°çš„qté¡¹ç›®TcpServerï¼ˆæœåŠ¡å™¨ï¼‰ï¼‰</strong></p><ul><li><strong>uiç•Œé¢</strong></li></ul><p><img src="https://bu.dusays.com/2025/03/13/67d2dc19a7d8f.png"></p><ul><li><strong>TcpServer.h</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;QtWidgets/QWidget&gt;</span><br><span class="line">#include&quot;ui_TcpServer.h&quot;</span><br><span class="line">#include&quot;qtcpserver.h&quot;</span><br><span class="line">#include&quot;qtcpsocket.h&quot;</span><br><span class="line"></span><br><span class="line">class TcpServer : public QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">    TcpServer(QWidget *parent = Q_NULLPTR);</span><br><span class="line">    ~TcpServer();</span><br><span class="line">public slots:</span><br><span class="line">    void on_btn_server_clicked();</span><br><span class="line">    void on_btn_listen_clicked();</span><br><span class="line">private:</span><br><span class="line">    Ui::TcpServerClass ui;</span><br><span class="line">    QTcpServer* server;</span><br><span class="line">    QTcpSocket* socket;//ä¸€ä¸ªå®¢æˆ·ç«¯å¯¹åº”ä¸€ä¸ªsocket</span><br><span class="line">    void ClientConnect();</span><br><span class="line">    void ReadData1();</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><strong>TcpServer.cpp</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;TcpServer.h&quot;</span><br><span class="line">#include&quot;qstring.h&quot;</span><br><span class="line">#include&quot;qdebug.h&quot;</span><br><span class="line">#pragma execution_character_set(&quot;utf-8&quot;)</span><br><span class="line">TcpServer::TcpServer(QWidget *parent)</span><br><span class="line">    : QWidget(parent)</span><br><span class="line">&#123;</span><br><span class="line">    ui.setupUi(this);</span><br><span class="line">    server = new QTcpServer(this);</span><br><span class="line">   //å®¢æˆ·æœºè¿æ¥ä¿¡å·æ§½</span><br><span class="line">    connect(server, &amp;QTcpServer::newConnection, this, &amp;TcpServer::ClientConnect);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">TcpServer::~TcpServer()</span><br><span class="line">&#123;</span><br><span class="line">    server-&gt;close();</span><br><span class="line">    server-&gt;deleteLater();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void TcpServer::on_btn_listen_clicked()</span><br><span class="line">&#123;</span><br><span class="line">    if (ui.btn_listen-&gt;text()==&quot;ä¾¦å¬&quot;)</span><br><span class="line">    &#123;</span><br><span class="line">        //ä»è¾“å…¥æ¡†è·å–ç«¯å£å·</span><br><span class="line">        int port = ui.lineEdit_port-&gt;text().toInt();</span><br><span class="line">        //ä¾¦å¬æŒ‡å®šç«¯å£çš„æ‰€æœ‰ip</span><br><span class="line">        if (!server-&gt;listen(QHostAddress::Any, port))</span><br><span class="line">        &#123;</span><br><span class="line">            //è‹¥å‡ºé”™ï¼Œåˆ™è¾“å‡ºé”™è¯¯ä¿¡æ¯</span><br><span class="line">            qDebug() &lt;&lt; server-&gt;errorString();</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        //ä¿®æ”¹æŒ‰é”®æ–‡å­—</span><br><span class="line">        ui.btn_listen-&gt;setText(&quot;å–æ¶ˆä¾¦å¬&quot;);    </span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        socket-&gt;abort();</span><br><span class="line">        //å–æ¶ˆä¾¦å¬</span><br><span class="line">        server-&gt;close();</span><br><span class="line">        //ä¿®æ”¹æŒ‰é”®æ–‡å­—</span><br><span class="line">        ui.btn_listen-&gt;setText(&quot;ä¾¦å¬&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void TcpServer::ClientConnect()</span><br><span class="line">&#123;</span><br><span class="line">    //è§£ææ‰€æœ‰å®¢æˆ·è¿æ¥</span><br><span class="line">    while (server-&gt;hasPendingConnections())</span><br><span class="line">    &#123;</span><br><span class="line">        //è¿æ¥ä¸Šåé€šè¿‡socketè·å–è¿æ¥ä¿¡æ¯</span><br><span class="line">        socket = server-&gt;nextPendingConnection();</span><br><span class="line">        QString str = QString(&quot;[ip:%1,port:%2]&quot;).arg(socket-&gt;peerAddress().toString()).arg(socket-&gt;peerPort());</span><br><span class="line">        //æç¤ºè¿æ¥æˆåŠŸ</span><br><span class="line">        ui.textEdit_server-&gt;append(str+&quot;Connect to the server&quot;);</span><br><span class="line">        //å¤é€‰æ¡†é€‰é¡¹ä¸ºè¿æ¥æœåŠ¡å™¨çš„ip</span><br><span class="line">        ui.comboBox-&gt;addItem(str);</span><br><span class="line">        //å°†socketåœ°å€æ”¾å…¥comboboxå±æ€§å†…</span><br><span class="line">        //ui.comboBox-&gt;setItemData(ui.comboBox-&gt;count()-1, QVariant((int)socket));</span><br><span class="line">        //ç›‘å¬å®¢æˆ·ç«¯æ˜¯å¦æœ‰æ¶ˆæ¯å‘é€</span><br><span class="line">        connect(socket, &amp;QTcpSocket::readyRead, this, &amp;TcpServer::ReadData1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//è·å–å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€çš„ä¿¡æ¯</span><br><span class="line">void TcpServer::ReadData1()</span><br><span class="line">&#123;</span><br><span class="line">    QByteArray buf = socket-&gt;readAll();//readAllæœ€å¤šæ¥æ”¶65532çš„æ•°æ®</span><br><span class="line">    QString str = QString(&quot;[ip:%1,port:%2]&quot;).arg(socket-&gt;peerAddress().toString()).arg(socket-&gt;peerPort());</span><br><span class="line">    ui.textEdit_server-&gt;append(str +QString(buf));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å‘é€ä¿¡æ¯</span><br><span class="line">void TcpServer::on_btn_server_clicked()</span><br><span class="line">&#123;</span><br><span class="line">  if(ui.comboBox-&gt;count()== 0)return;</span><br><span class="line">  //QTcpSocket* skt=  (QTcpSocket*)ui.comboBox-&gt;itemData(ui.comboBox-&gt;currentIndex()).value&lt;int&gt;();</span><br><span class="line">  socket-&gt;write(ui.lineEdit1-&gt;text().toUtf8());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼šwriteä¸­éœ€è¦å†™å…¥charç±»å‹çš„å…ƒç´ æˆ–QByteArrayç±»å‹çš„å…ƒç´ </p><p><img src="https://bu.dusays.com/2025/03/13/67d2dc2f4307e.png"></p><p><strong>æ•ˆæœå±•ç¤ºï¼š</strong></p><p><img src="https://bu.dusays.com/2025/03/13/67d2dc5b93345.gif"></p><h3 id="ä¸‰ï¼ŒTCP-IPæ–‡ä»¶ä¼ è¾“"><a href="#ä¸‰ï¼ŒTCP-IPæ–‡ä»¶ä¼ è¾“" class="headerlink" title="ä¸‰ï¼ŒTCP&#x2F;IPæ–‡ä»¶ä¼ è¾“"></a><font color="FF0000">ä¸‰ï¼ŒTCP&#x2F;IPæ–‡ä»¶ä¼ è¾“</font></h3><p>ä¸Šæ–‡å®ç°äº†æ¶ˆæ¯çš„ä¼ è¾“ï¼Œç”±äº<strong>socket-&gt;readAll();ï¼ˆreadAllæœ€å¤šæ¥æ”¶65532çš„æ•°æ®ï¼‰</strong>ï¼Œå› æ­¤å¯¹äºå¤§æ–‡ä»¶çš„ä¼ è¾“ç”¨æ­¤æ–¹æ³•æ˜¯ä¸å¯å–çš„ã€‚</p><p><strong>TCP&#x2F;IPæ–‡ä»¶ä¼ è¾“çš„æ€è·¯ï¼š</strong></p><ol><li>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿æ¥</li><li>å®¢æˆ·ç«¯é€‰æ‹©æ–‡ä»¶ï¼Œå¹¶å‘é€æ–‡ä»¶ç»™æœåŠ¡å™¨ï¼ˆå‘é€çš„æ˜¯æ–‡ä»¶çš„å¸§å¤´ï¼Œæ ¼å¼ï¼šæ–‡ä»¶å&amp;å¤§å°ï¼‰</li><li>æœåŠ¡å™¨è§¦å‘readyReadï¼Œç„¶åè§£ææ–‡ä»¶å¸§å¤´ï¼ˆè·å–æ–‡ä»¶åå’Œå¤§å°ï¼‰ï¼Œå¹¶è¿”å›å®¢æˆ·ç«¯ä¸€ä¸ªokæ¶ˆæ¯</li><li>å®¢æˆ·ç«¯è§¦å‘readyReadï¼Œç„¶åå‘é€æ–‡ä»¶æ•°æ®ï¼Œé€šè¿‡progressBaræ˜¾ç¤ºè¿›åº¦</li><li>æœåŠ¡å™¨å†æ¬¡è§¦å‘readyReadï¼Œæ¥æ”¶æ–‡ä»¶æ•°æ®ï¼Œå¹¶ä¿å­˜ï¼ˆé€šè¿‡isheadåˆ¤æ–­æ¥æ”¶çš„æ˜¯æ–‡ä»¶å¸§å¤´è¿˜æ˜¯æ–‡ä»¶æ•°æ®ï¼‰</li></ol><p><strong>ä»£ç å®ç°ï¼š</strong></p><p>æ–°å»ºæœåŠ¡å™¨é¡¹ç›®ï¼ˆTcpServerï¼‰</p><ul><li><strong>TcpServer.h</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#pragma once</span><br><span class="line"></span><br><span class="line">#include &lt;QtWidgets/QWidget&gt;</span><br><span class="line">#include &quot;ui_TcpServer.h&quot;</span><br><span class="line">#include&quot;qtcpserver.h&quot;</span><br><span class="line">#include&quot;qtcpsocket.h&quot;</span><br><span class="line">#pragma execution_character_set(&quot;utf-8&quot;)</span><br><span class="line">class TcpServer : public QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">    TcpServer(QWidget *parent = Q_NULLPTR);</span><br><span class="line">    void hasConnect();</span><br><span class="line">private:</span><br><span class="line">    Ui::TcpServerClass ui;</span><br><span class="line">    QTcpServer* server;</span><br><span class="line">    QTcpSocket* socket;</span><br><span class="line">    bool ishead;</span><br><span class="line">    QString fileName;</span><br><span class="line">    int fileSize;//æ¥æ”¶æ–‡ä»¶çš„æ€»å¤§å°</span><br><span class="line">    int recvSize;//å½“å‰æ¥æ”¶æ–‡ä»¶çš„å¤§å°</span><br><span class="line">    QByteArray filebuf;//å½“å‰æ¥æ”¶çš„æ–‡ä»¶æ•°æ®</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><strong>TcpServer.cpp</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;TcpServer.h&quot;</span><br><span class="line">#include&quot;qfile.h&quot;</span><br><span class="line">TcpServer::TcpServer(QWidget *parent)</span><br><span class="line">    : QWidget(parent)</span><br><span class="line">&#123;</span><br><span class="line">    ishead = true;</span><br><span class="line">    ui.setupUi(this);</span><br><span class="line">    server = new QTcpServer(this);</span><br><span class="line">    //ç›‘å¬1122ç«¯å£çš„ip</span><br><span class="line">    server-&gt;listen(QHostAddress::Any, 1122);</span><br><span class="line">    //å¦‚æœæœ‰ç”¨æˆ·è¿æ¥è§¦å‘æ§½å‡½æ•°</span><br><span class="line">    connect(server, &amp;QTcpServer::newConnection, this, &amp;TcpServer::hasConnect);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void TcpServer::hasConnect()</span><br><span class="line">&#123;</span><br><span class="line">    while (server-&gt;hasPendingConnections()&gt;0)//åˆ¤æ–­å½“å‰è¿æ¥äº†å¤šå°‘äºº</span><br><span class="line">    &#123;</span><br><span class="line">        //ç”¨socketå’Œæˆ‘ä»¬çš„å®¢æˆ·ç«¯è¿æ¥ï¼Œä¸€ä¸ªå®¢æˆ·ç«¯å¯¹åº”ä¸€ä¸ªå¥—æ¥å­—socket</span><br><span class="line">        socket = server-&gt;nextPendingConnection();</span><br><span class="line">        //æœåŠ¡å™¨ç•Œé¢ä¸Šè¾“å‡ºå®¢æˆ·ç«¯ä¿¡æ¯</span><br><span class="line">        ui.textEdit-&gt;append(QString(&quot;%1ï¼šæ–°ç”¨æˆ·è¿æ¥&quot;).arg(socket-&gt;peerPort()));</span><br><span class="line">        //å¦‚æœå®¢æˆ·ç«¯å‘é€ä¿¡æ¯è¿‡æ¥äº†ï¼Œè§¦å‘åŒ¿åå‡½æ•°</span><br><span class="line">        connect(socket, &amp;QTcpSocket::readyRead, [=]() &#123;</span><br><span class="line">            QByteArray buf = socket-&gt;readAll();</span><br><span class="line">            //ç”¨ä¸€ä¸ªæ ‡å¿—ä½isheadåˆ¤æ–­æ˜¯å¤´è¿˜æ˜¯æ•°æ®ä½</span><br><span class="line">            if (ishead)</span><br><span class="line">            &#123;</span><br><span class="line">                //å¦‚æœæ˜¯å¤´ï¼Œè§£æå¤´ï¼ˆæ–‡ä»¶åï¼Œæ–‡ä»¶å¤§å°ï¼‰</span><br><span class="line">                QString str = QString(buf);</span><br><span class="line">                ui.textEdit-&gt;append(str);</span><br><span class="line">                QStringList strlist = str.split(&quot;&amp;&quot;);</span><br><span class="line">                fileName = strlist.at(0);//è§£æå¸§å¤´æ–‡ä»¶å</span><br><span class="line">                fileSize = strlist.at(1).toInt();//è§£æå¸§å¤´æ–‡ä»¶å¤§å°</span><br><span class="line">                ishead = false;//ä¸‹æ¬¡æ¥æ”¶åˆ°çš„æ–‡ä»¶å°±æ˜¯æˆ‘ä»¬çš„æ•°æ®</span><br><span class="line">                recvSize = 0;</span><br><span class="line">                filebuf.clear();</span><br><span class="line">                socket-&gt;write(&quot;ok&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                //æ ¹æ®æ–‡ä»¶åå’Œæ–‡ä»¶å¤§å°æ¥æ”¶å’Œä¿å­˜æ–‡ä»¶</span><br><span class="line">                filebuf.append(buf);</span><br><span class="line">                recvSize += buf.size();//æ¯æ¥æ”¶ä¸€æ¬¡æ–‡ä»¶ï¼Œå½“å‰æ–‡ä»¶å¤§å°+1</span><br><span class="line">                //å½“æ¥æ”¶æ–‡ä»¶å¤§å°ç­‰äºæ€»æ–‡ä»¶å¤§å°ï¼Œå³æ–‡ä»¶æ•°æ®æ¥æ”¶å®Œæ¯•</span><br><span class="line">                if (recvSize&gt;=fileSize)</span><br><span class="line">                &#123;</span><br><span class="line">                    //ä¿å­˜æ–‡ä»¶</span><br><span class="line">                    QFile file(ui.lineEdit-&gt;text() + fileName);</span><br><span class="line">                    file.open(QIODevice::WriteOnly);</span><br><span class="line">                    file.write(filebuf);</span><br><span class="line">                    file.close();</span><br><span class="line">                    ishead = true;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ–°å»ºå®¢æˆ·ç«¯é¡¹ç›®ï¼ˆQTcpClientï¼‰</p><ul><li><strong>QTcpClient.h</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;QtWidgets/QWidget&gt;</span><br><span class="line">#include&quot;ui_QTcpClient.h&quot;</span><br><span class="line">#include&quot;qtcpsocket.h&quot;</span><br><span class="line">#pragma execution_character_set(&quot;utf-8&quot;)</span><br><span class="line">class QTcpClient : public QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">    QTcpClient(QWidget *parent = Q_NULLPTR);</span><br><span class="line">public slots:</span><br><span class="line">    void on_btn_connect_clicked();</span><br><span class="line">    void on_btn_choose_clicked();</span><br><span class="line">    void on_btn_open_clicked();</span><br><span class="line">    </span><br><span class="line">private:</span><br><span class="line">    Ui::QTcpClientClass ui;</span><br><span class="line">    QTcpSocket* socket;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><strong>QTcpClient.cpp</strong></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;QTcpClient.h&quot;</span><br><span class="line">#include&quot;qfiledialog.h&quot;</span><br><span class="line">#include&quot;qfileinfo.h&quot;</span><br><span class="line">QTcpClient::QTcpClient(QWidget *parent)</span><br><span class="line">    : QWidget(parent)</span><br><span class="line">&#123;</span><br><span class="line">    ui.setupUi(this);</span><br><span class="line">    socket = new QTcpSocket(this);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">void QTcpClient::on_btn_connect_clicked()</span><br><span class="line">&#123;</span><br><span class="line">    QString ip = ui.lineEdit_ip-&gt;text();//è·å–ip</span><br><span class="line">    int port = ui.lineEdit_port-&gt;text().toInt();//è·å–ç«¯å£æ•°æ®</span><br><span class="line">    socket-&gt;connectToHost(ip, port);//è¿æ¥æœåŠ¡å™¨</span><br><span class="line">    //ç­‰å¾…è¿æ¥æˆåŠŸ</span><br><span class="line">    if (socket-&gt;waitForConnected())</span><br><span class="line">    &#123;</span><br><span class="line">        ui.textEdit-&gt;append(&quot;&lt;font color=&#x27;green&#x27;&gt;è¿æ¥æœåŠ¡å™¨æˆåŠŸï¼&lt;/font&gt;&quot;);    </span><br><span class="line">        ui.btn_open-&gt;setEnabled(true);</span><br><span class="line">        </span><br><span class="line">        //å¦‚æœæœåŠ¡å™¨å‘é€ä¿¡æ¯åˆ°å®¢æˆ·ç«¯ï¼Œè§¦å‘åŒ¿åå‡½æ•°</span><br><span class="line">        connect(socket, &amp;QTcpSocket::readyRead, [=]() &#123;</span><br><span class="line">            //è¯»å–æœåŠ¡å™¨å‘é€çš„ä¿¡æ¯ï¼ˆå³ç¼“å†²åŒºä¿¡æ¯ï¼‰</span><br><span class="line">            QByteArray buf = socket-&gt;readAll();</span><br><span class="line">            if (buf==&quot;ok&quot;)</span><br><span class="line">            &#123;</span><br><span class="line">                QFile file = (ui.label_path-&gt;text());</span><br><span class="line">                if (!file.open(QIODevice::ReadWrite))</span><br><span class="line">                &#123;</span><br><span class="line">                    //è¯»å–æ–‡ä»¶å¤±è´¥</span><br><span class="line">                    return;</span><br><span class="line">                &#125;</span><br><span class="line">                qint64 currentlen = 0;//å½“å‰å·²ç»å‘é€çš„å¤§å°</span><br><span class="line">                qint64 allLength = file.size();//æ€»æ–‡ä»¶å¤§å°</span><br><span class="line">                do</span><br><span class="line">                &#123;</span><br><span class="line">                    char data[1024];</span><br><span class="line">                    qint64 msize = file.read(data, 1024);//è¯»æ–‡ä»¶æ”¾å…¥æ‰“ä»–æ•°ç»„ä¸­ï¼Œè¿”å›è¯»å–åˆ°çš„å¤§å°</span><br><span class="line">                    socket-&gt;write(data, msize);//æŠŠè¯»å–åˆ°çš„dataæ•°æ®å‘é€ç»™æœåŠ¡å™¨</span><br><span class="line">                    currentlen += msize;//å®æ—¶è·å–å½“å‰å‘é€çš„æ–‡ä»¶å¤§å°</span><br><span class="line">                    ui.progressBar-&gt;setValue(currentlen *100 / allLength);//æ›´æ–°ç•Œé¢è¿›åº¦æ¡</span><br><span class="line">                &#125; while (currentlen &lt; allLength);//å½“å‘é€æ–‡ä»¶ç­‰äºæ–‡ä»¶å¤§å°æ—¶ï¼Œå‘é€å®Œæ¯•ï¼Œå¾ªç¯ç»“æŸ</span><br><span class="line">            &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        ui.textEdit-&gt;append(&quot;&lt;font color=&#x27;red&#x27;&gt;è¿æ¥æœåŠ¡å™¨å¤±è´¥ï¼&lt;/font&gt;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//é€‰æ‹©æ–‡ä»¶äº‹ä»¶</span><br><span class="line">void QTcpClient::on_btn_choose_clicked()</span><br><span class="line">&#123;</span><br><span class="line">    QString path = QFileDialog::getOpenFileName(this, &quot;æ‰“å¼€æ–‡ä»¶&quot;, &quot;&quot;, &quot;(*.*)&quot;);</span><br><span class="line">    ui.label_path-&gt;setText(path);</span><br><span class="line">&#125;</span><br><span class="line">//å‘é€æ–‡ä»¶äº‹ä»¶</span><br><span class="line">void QTcpClient::on_btn_open_clicked()</span><br><span class="line">&#123;</span><br><span class="line">    QFileInfo info(ui.label_path-&gt;text());</span><br><span class="line">    //ç”¨QFileInfoï¼šï¼šfileNameï¼Œsizeè·å–æ–‡ä»¶åå’Œå¤§å° æ ¼å¼ï¼šæ–‡ä»¶å&amp;å¤§å°</span><br><span class="line">    //æœåŠ¡å™¨ç”¨è¯¥æ ¼å¼è§£ææ–‡ä»¶åå’Œå¤§å°</span><br><span class="line">    QString head = QString(&quot;%1&amp;%2&quot;).arg(info.fileName()).arg(info.size());</span><br><span class="line">    //å°†è¯¥æ ¼å¼å‘é€ç»™æœåŠ¡å™¨ toUtf8ï¼šQStringè½¬QByteArrayæˆ–charç±»å‹</span><br><span class="line">    socket-&gt;write(head.toUtf8()); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ•ˆæœå±•ç¤ºï¼š</strong></p><p><img src="https://bu.dusays.com/2025/03/13/67d2dc9a83bfe.gif"></p><br><br><br><p><span style="color: red; font-size: 20px;">è½¬è½½è‡ªï¼š<a href="https://www.cnblogs.com/xyf327">å”¯æœ‰è‡ªå·±å¼ºå¤§</a>          å¦‚æœ‰ä¾µæƒï¼Œåœ¨ä¸‹æ–¹è¯„è®º  ç«‹åˆ»åˆ é™¤ã€‚</span></p>]]></content>
      
      
      <categories>
          
          <category> Qt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qtå­¦ä¹  </tag>
            
            <tag> ç½‘ç»œç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt08é¡¹ç›®æ‰“åŒ…å’Œå‘å¸ƒ</title>
      <link href="/2025/03/13/Qt08%E9%A1%B9%E7%9B%AE%E6%89%93%E5%8C%85%E5%92%8C%E5%8F%91%E5%B8%83/"/>
      <url>/2025/03/13/Qt08%E9%A1%B9%E7%9B%AE%E6%89%93%E5%8C%85%E5%92%8C%E5%8F%91%E5%B8%83/</url>
      
        <content type="html"><![CDATA[<p>æ‰“åŒ…æ•´ä½“æ€è·¯ï¼š</p><ul><li>å°†ç¼–è¯‘åçš„exeå¯æ‰§è¡Œæ–‡ä»¶åŠå…¶å„ç§ä¾èµ–dllã€libã€å›¾æ ‡ã€é…ç½®æ–‡ä»¶ç­‰å…ˆæ‰“åŒ…æ”¾åˆ°ä¸€ä¸ªç›®å½•ä¸­</li><li>å¯¹å…¶è¿›è¡Œæ‰“åŒ…å‘å¸ƒï¼ˆä¸¤ç§æ–¹å¼ï¼‰ï¼š</li></ul><ol><li>åˆ©ç”¨VSçš„æ’ä»¶Microsoft Visual Studio Installer Projectså®‰è£…ç¨‹åºæ‰“åŒ…æ’ä»¶è¿›è¡Œæ‰“åŒ…</li><li>åˆ©ç”¨Enigma Virtual Box(å•æ–‡ä»¶å°è£…å·¥å…·) è¿›è¡Œæ‰“åŒ…</li></ol><h3 id="ä¸€ï¼Œå°†ç¼–è¯‘åçš„exeå¯æ‰§è¡Œæ–‡ä»¶åŠå…¶å„ç§ä¾èµ–dllã€libã€å›¾æ ‡ã€é…ç½®æ–‡ä»¶ç­‰å…ˆæ‰“åŒ…æ”¾åˆ°ä¸€ä¸ªç›®å½•ä¸­"><a href="#ä¸€ï¼Œå°†ç¼–è¯‘åçš„exeå¯æ‰§è¡Œæ–‡ä»¶åŠå…¶å„ç§ä¾èµ–dllã€libã€å›¾æ ‡ã€é…ç½®æ–‡ä»¶ç­‰å…ˆæ‰“åŒ…æ”¾åˆ°ä¸€ä¸ªç›®å½•ä¸­" class="headerlink" title="ä¸€ï¼Œå°†ç¼–è¯‘åçš„exeå¯æ‰§è¡Œæ–‡ä»¶åŠå…¶å„ç§ä¾èµ–dllã€libã€å›¾æ ‡ã€é…ç½®æ–‡ä»¶ç­‰å…ˆæ‰“åŒ…æ”¾åˆ°ä¸€ä¸ªç›®å½•ä¸­"></a><font color="FF0000">ä¸€ï¼Œå°†ç¼–è¯‘åçš„exeå¯æ‰§è¡Œæ–‡ä»¶åŠå…¶å„ç§ä¾èµ–dllã€libã€å›¾æ ‡ã€é…ç½®æ–‡ä»¶ç­‰å…ˆæ‰“åŒ…æ”¾åˆ°ä¸€ä¸ªç›®å½•ä¸­</font></h3><p><strong>ï¼ˆ1ï¼‰dumpbinæŒ‡ä»¤æŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶çš„dllä¾èµ–åŒ…</strong></p><p>åœ¨VSå¼€å‘äººå‘˜å‘½ä»¤æç¤ºç¬¦ï¼ˆvsç•Œé¢-&gt;å·¥å…·-&gt;å‘½ä»¤è¡Œ-&gt;å¼€å‘è€…å‘½ä»¤æç¤ºï¼‰ä¸­æ‰§è¡Œ<strong>dumpbin &#x2F;dependents ç¨‹åºè·¯å¾„ ï¼šdumpbin&#x2F;dependents C:\Users\WFD\Desktop\GCtest\Debug\GCtest</strong></p><p><img src="https://bu.dusays.com/2025/03/13/67d2d919ca716.png"></p><p><strong>ï¼ˆ2ï¼‰windeployqt.exeæŒ‡ä»¤è‡ªåŠ¨å°†qtä¾èµ–åŒ…å¤åˆ¶è¿‡æ¥</strong></p><p> 1ï¸âƒ£å…ˆæ‰“å¼€ Qt çš„å‘½ä»¤è¡Œï¼ˆç”¨çš„32ä½ï¼‰</p><p><img src="https://bu.dusays.com/2025/03/13/67d2d931dc01c.png"></p><p>2ï¸âƒ£ä½¿ç”¨â€œcd&#x2F;d è·¯å¾„â€ å‘½ä»¤è¿›å…¥åˆ°åŒ…å«.exe æ–‡ä»¶çš„æ–‡ä»¶å¤¹ã€‚</p><p>3ï¸âƒ£ Qt å‘½ä»¤è¡Œæ‰§è¡Œ windeployqt å·¥å…·ï¼Œè¾“å…¥ï¼š â€œwindeployqt ***.exeâ€ ï¼Œå°±å¯ä»¥å°†qtä¾èµ–åŒ…å¤åˆ¶åˆ°è¯¥æ–‡ä»¶å¤¹ä¸­</p><p><img src="https://bu.dusays.com/2025/03/13/67d2d94c54e1f.png"></p><p><img src="https://bu.dusays.com/2025/03/13/67d2d95753bae.png"></p><p><strong>ï¼ˆ3ï¼‰éQtä¾èµ–åº“çš„æ·»åŠ </strong></p><p><strong>è¦æ³¨æ„releaseç‰ˆæœ¬ä¸debugç‰ˆæœ¬æ‰€éœ€è¦çš„ä¾èµ–æ˜¯ä¸ä¸€æ ·çš„ï¼Œéœ€è¦åˆ†åˆ«æ‰“åŒ…ï¼ï¼ï¼</strong></p><ul><li><strong>æ–¹æ³•ä¸€</strong></li></ul><p>åœ¨é€šè¿‡vsçš„dumpbinæŒ‡ä»¤æŸ¥è¯¢åˆ°å¯æ‰§è¡Œæ–‡ä»¶çš„dllä¾èµ–åŒ…åï¼Œä½¿ç”¨eyerythingè½¯ä»¶æ ¹æ®ä½ç½®å»å¯»æ‰¾dllæ–‡ä»¶ã€‚</p><p>ä¸‹è½½åœ°å€ï¼š<a href="http://www.voidtools.com/">http://www.voidtools.com/</a></p><p><img src="https://bu.dusays.com/2025/03/13/67d2d99b229d6.png"></p><ul><li><strong>æ–¹æ³•äºŒ</strong></li></ul><p>å¦‚æœåŠ¨æ€åº“æœ‰å¾ˆå¤šé‚£ä¹ˆå¤åˆ¶èµ·æ¥å¾ˆéº»çƒ¦ï¼ˆæ¯”å¦‚ä¸Šé¢Qtcore.dllæŸ¥æ‰¾åˆ°å¾ˆå¤šè·¯å¾„ï¼Œä½†æ˜¯ä¸çŸ¥é“ç”¨å“ªä¸ªï¼‰ï¼Œå¯ä»¥ä½¿ç”¨windowçš„æ‰¹å¤„ç†ï¼š</p><p>é€šè¿‡è§‚å¯Ÿç¨‹åºè¿è¡Œæ—¶Vsè¾“å‡ºçª—å£ä¸­åŠ è½½çš„dllåº“ï¼š</p><p><img src="https://bu.dusays.com/2025/03/13/67d2d9b78f0fc.png"></p><ul><li><strong>æ–¹æ³•ä¸‰</strong></li></ul><p>ä½¿ç”¨Dependency Wallker æ‰“å¼€***.exe æŸ¥æ‰¾ä¸å­˜åœ¨çš„.dllï¼Œå…¶ä¸­é»„è‰²çš„é—®å·æ ‡è¯†æ˜¯ä¸å­˜åœ¨çš„ã€‚Dependency Wallkerå¯ä»¥é€’å½’æ˜¾ç¤ºå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆexeï¼‰å’ŒåŠ¨æ€åº“ï¼ˆdllï¼‰è°ƒç”¨çš„åŠ¨æ€åº“ã€‚</p><p>æ‰“å¼€**.exeæ–‡ä»¶ä¹‹åå„ä¸ªèŠ‚ç‚¹å¯èƒ½æ˜¯å±•å¼€çš„å¾ˆä¹±ï¼Œå¯ä»¥å³å‡»ä»»æ„èŠ‚ç‚¹é€‰æ‹©â€œæŠ˜å æ‰€æœ‰(L)â€,ç„¶åå†å•å‡»æ ¹èŠ‚ç‚¹çš„åŠ å·å±•å¼€å°±æ˜¯å¦‚å›¾æ‰€ç¤ºçš„æ ·å¼ï¼Œè¿™æ ·å¾ˆæ¸…æ™°ã€‚</p><p><img src="https://bu.dusays.com/2025/03/13/67d2d9d63494d.png"></p><p>åœ¨å…¨éƒ¨æ·»åŠ å®Œä¾èµ–åº“åï¼Œç‚¹å‡»exeè¿è¡Œæ–‡ä»¶å°±å¯ä»¥æœ¬æœºè¿è¡Œäº†ã€‚æˆ–è€…å°†è¯¥æ–‡ä»¶å¤¹å…¨éƒ¨å‘é€ç»™ç”¨æˆ·ä¹Ÿå¯è¿è¡Œã€‚</p><p>é‚£ä¹ˆå¦‚ä½•åªä½¿ç”¨ä¸€ä¸ªexeæ–‡ä»¶å°±å®Œæˆç¨‹åºçš„è¿è¡Œå‘¢ï¼Ÿ</p><p><strong>ğŸ™„è¿™å°±è¦ç”¨åˆ°ä¸‹é¢è¦è¯´çš„æ‰“åŒ…å’Œå‘å¸ƒäº†ã€‚</strong></p><h3 id="äºŒï¼Œåˆ©ç”¨VSçš„æ’ä»¶Microsoft-Visual-Studio-Installer-Projectså®‰è£…ç¨‹åºæ‰“åŒ…æ’ä»¶è¿›è¡Œæ‰“åŒ…"><a href="#äºŒï¼Œåˆ©ç”¨VSçš„æ’ä»¶Microsoft-Visual-Studio-Installer-Projectså®‰è£…ç¨‹åºæ‰“åŒ…æ’ä»¶è¿›è¡Œæ‰“åŒ…" class="headerlink" title="äºŒï¼Œåˆ©ç”¨VSçš„æ’ä»¶Microsoft Visual Studio Installer Projectså®‰è£…ç¨‹åºæ‰“åŒ…æ’ä»¶è¿›è¡Œæ‰“åŒ…"></a><font color="FF0000">äºŒï¼Œåˆ©ç”¨VSçš„æ’ä»¶Microsoft Visual Studio Installer Projectså®‰è£…ç¨‹åºæ‰“åŒ…æ’ä»¶è¿›è¡Œæ‰“åŒ…</font></h3><p>å®‰è£…è¿‡ç¨‹ä¸å†è¯¦è¿°å‚è§ï¼š<a href="https://www.cnblogs.com/wuyubing/p/12378014.html">Installer Projectsæ’ä»¶çš„å®‰è£…</a></p><p> <strong>ï¼ˆ1ï¼‰æ–°å»ºå®‰è£…é¡¹ç›®</strong></p><p>è§£å†³æ–¹æ¡ˆ-&gt;æ–°å»ºé¡¹ç›®-&gt;setup project</p><p><img src="https://bu.dusays.com/2025/03/13/67d2d9ff7680d.png"></p><p>è¿›å…¥æ–‡ä»¶ç³»ç»Ÿï¼š(setup1-&gt;view-&gt;æ–‡ä»¶ç³»ç»Ÿï¼‰</p><p><img src="https://bu.dusays.com/2025/03/13/67d2da14e0621.png"></p><p> <strong>ï¼ˆ2ï¼‰æ·»åŠ æ–‡ä»¶</strong></p><p>Application Folder-&gt;add-&gt;æ–‡ä»¶ï¼ˆåœ¨æ­¤æ·»åŠ ç›¸å…³çš„ä¾èµ–èµ„æºï¼‰</p><p><img src="https://bu.dusays.com/2025/03/13/67d2da26840fa.png"></p><p> å°†exeæ‰€åœ¨ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶æ·»åŠ åˆ°è¯¥å¤„</p><p> <strong>ï¼ˆ3ï¼‰æ·»åŠ é¡¹ç›®è¾“å‡º</strong></p><p>Application Folder-&gt;add-&gt;é¡¹ç›®è¾“å‡ºï¼ˆä¸»ç¨‹åºå…¥å£ï¼‰</p><p><img src="https://bu.dusays.com/2025/03/13/67d2da3facb0a.png"></p><p>å¯¹ä¸»è¾“å‡ºåˆ›å»ºå¿«æ·æ–¹å¼ï¼Œå¹¶å°†å…¶æ‹–åŠ¨åˆ°Userâ€˜s Desktopå†…</p><p><img src="https://bu.dusays.com/2025/03/13/67d2da4f4073b.png"></p><p><strong>ï¼ˆ4ï¼‰æ‰“åŒ…å‘å¸ƒ</strong></p><p> å¯¹setup1é¡¹ç›®è¿›è¡Œé‡æ–°ç”Ÿæˆï¼Œå³ç”Ÿæˆå®‰è£…ç¨‹åº</p><p><img src="https://bu.dusays.com/2025/03/13/67d2da5f3f9fd.png"></p><h3 id="ä¸‰ï¼Œåˆ©ç”¨Enigma-Virtual-Box-å•æ–‡ä»¶å°è£…å·¥å…·-è¿›è¡Œæ‰“åŒ…"><a href="#ä¸‰ï¼Œåˆ©ç”¨Enigma-Virtual-Box-å•æ–‡ä»¶å°è£…å·¥å…·-è¿›è¡Œæ‰“åŒ…" class="headerlink" title="ä¸‰ï¼Œåˆ©ç”¨Enigma Virtual Box(å•æ–‡ä»¶å°è£…å·¥å…·) è¿›è¡Œæ‰“åŒ…"></a><font color="FF0000">ä¸‰ï¼Œåˆ©ç”¨Enigma Virtual Box(å•æ–‡ä»¶å°è£…å·¥å…·) è¿›è¡Œæ‰“åŒ…</font></h3><p>Enigma è™šæ‹Ÿæ–‡ä»¶æ‰“åŒ…ç³»ç»Ÿå¯ä»¥å°†ç¨‹åºå’Œé…å¥—æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œè€Œæ²¡æœ‰ä»»ä½•æ•ˆç‡çš„æŸå¤±ï¼Œé…å¥—æ–‡ä»¶ä¹Ÿä¸ä¼šè¢«é‡Šæ”¾è‡³ç¡¬ç›˜ã€‚ï¼ˆåŒæ—¶æ”¯æŒX86å’ŒX64äºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ã€‚</p><p>å¦‚å›¾ï¼š</p><p><img src="https://bu.dusays.com/2025/03/13/67d2da99e4610.png"></p><p><img src="https://bu.dusays.com/2025/03/13/67d2daa7c6d41.png"></p><p>å°†ç”Ÿæˆçš„GCtest_boxedæ–‡ä»¶å¤åˆ¶åˆ°è¦è¿è¡Œçš„è®¾å¤‡ä¸Šå³å¯ï¼ˆå¯ä»¥å•ç‹¬è¿è¡Œï¼‰</p><br><br><br><p><span style="color: red; font-size: 20px;">è½¬è½½è‡ªï¼š<a href="https://www.cnblogs.com/xyf327">å”¯æœ‰è‡ªå·±å¼ºå¤§</a>          å¦‚æœ‰ä¾µæƒï¼Œåœ¨ä¸‹æ–¹è¯„è®º  ç«‹åˆ»åˆ é™¤ã€‚</span></p>]]></content>
      
      
      <categories>
          
          <category> Qt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qtå­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt07é¼ æ ‡äº‹ä»¶</title>
      <link href="/2025/03/13/Qt07%E9%BC%A0%E6%A0%87%E4%BA%8B%E4%BB%B6/"/>
      <url>/2025/03/13/Qt07%E9%BC%A0%E6%A0%87%E4%BA%8B%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<p>ä¸ªäººè®¤ä¸ºï¼Œäº‹ä»¶æœºåˆ¶æ˜¯Qtæœ€éš¾ä»¥ç†è§£ä¸”æœ€ä¸ºç²¾å¦™çš„ä¸€éƒ¨åˆ†ã€‚äº‹ä»¶ä¸»è¦åˆ†ä¸ºä¸¤ç§ï¼š</p><ol><li><strong>åœ¨ä¸ç”¨æˆ·äº¤äº’æ—¶å‘ç”Ÿ</strong>ã€‚æ¯”å¦‚æŒ‰ä¸‹é¼ æ ‡ï¼ˆmousePressEventï¼‰ï¼Œæ•²å‡»é”®ç›˜ï¼ˆkeyPressEventï¼‰ç­‰ã€‚</li><li><strong>ç³»ç»Ÿè‡ªåŠ¨å‘ç”Ÿ</strong>ï¼Œæ¯”å¦‚è®¡æ—¶å™¨äº‹ä»¶ï¼ˆtimerEventï¼‰ç­‰ã€‚</li></ol><p>åœ¨å‘ç”Ÿäº‹ä»¶æ—¶ï¼ˆæ¯”å¦‚è¯´ä¸Šé¢è¯´çš„æŒ‰ä¸‹é¼ æ ‡ï¼‰ï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ªQEventå¯¹è±¡ï¼ˆè¿™é‡Œæ˜¯QMouseEventï¼Œä¸ºQEventçš„å­ç±»ï¼‰ï¼Œè¿™ä¸ªQEventå¯¹è±¡ä¼šä¼ ç»™å½“å‰ç»„ä»¶çš„eventå‡½æ•°ã€‚å¦‚æœå½“å‰ç»„ä»¶æ²¡æœ‰å®‰è£…<strong>äº‹ä»¶è¿‡æ»¤å™¨</strong>ï¼ˆè¿™ä¸ªåé¢ä¼šæåˆ°ï¼‰ï¼Œåˆ™ä¼šè¢«eventå‡½æ•°å‘æ”¾åˆ°ç›¸åº”çš„xxxEventå‡½æ•°ä¸­ï¼ˆè¿™é‡Œæ˜¯mousePressEventå‡½æ•°ï¼‰ã€‚</p><p>éœ€è¦åŒºåˆ†çš„æ˜¯ï¼š<strong>äº‹ä»¶ä¸ä¿¡å·å¹¶ä¸ç›¸åŒã€‚</strong></p><p>æ¯”å¦‚ï¼šé¼ æ ‡å•å‡»æŒ‰é’®ï¼Œé¼ æ ‡äº‹ä»¶ï¼ˆQMouseEventï¼‰ï¼Œè€ŒæŒ‰é’®æœ¬èº«å‘å°„clickedï¼ˆï¼‰ä¿¡å·ã€‚ä¸€èˆ¬è€Œè¨€æˆ‘ä»¬åªéœ€è¦å…³æ³¨å•å‡»ä¿¡å·ï¼Œä¸ç”¨è€ƒè™‘é¼ æ ‡äº‹ä»¶ã€‚ä½†æ˜¯å½“æˆ‘ä»¬è¦å¯¹è¯¥æŒ‰é’®åšé¢å¤–æ“ä½œï¼Œä¸æƒ³é€šè¿‡ä¿¡å·å¤„ç†ï¼Œæ­¤æ—¶äº‹ä»¶å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚å…³é—­äº‹ä»¶ï¼ˆQCloseEventï¼‰æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„äº‹ä»¶ã€‚</p><hr><h3 id="ä¸€ï¼Œäº‹ä»¶"><a href="#ä¸€ï¼Œäº‹ä»¶" class="headerlink" title="ä¸€ï¼Œäº‹ä»¶"></a><font color="FF0000">ä¸€ï¼Œäº‹ä»¶</font></h3><p>Qt ä¸­æ‰€æœ‰äº‹ä»¶ç±»éƒ½ç»§æ‰¿äº QEventã€‚åœ¨äº‹ä»¶å¯¹è±¡åˆ›å»ºå®Œæ¯•åï¼ŒQt å°†è¿™ä¸ªäº‹ä»¶å¯¹è±¡ä¼ é€’ç»™ QObject çš„ event()å‡½æ•°ã€‚event()å‡½æ•°å¹¶ä¸ç›´æ¥å¤„ç†äº‹ä»¶ï¼Œè€Œæ˜¯æŒ‰ç…§äº‹ä»¶å¯¹è±¡çš„ç±»å‹åˆ†æ´¾ç»™ç‰¹å®šçš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼ˆeventhandlerï¼‰ã€‚</p><p><img src="https://bu.dusays.com/2025/03/13/67d29bf3e8d89.png"></p><p>ä¿¡å·æ˜¯é€šè¿‡connectï¼ˆï¼‰æ¥ç»‘å®šæ§½å‡½æ•°å¤„ç†å“åº”ï¼Œé‚£ä¹ˆäº‹ä»¶æ˜¯æ€ä¹ˆå¤„ç†çš„å‘¢ï¼Ÿ</p><p><strong>å¤„ç†äº‹ä»¶æœ‰5ç§å¸¸ç”¨çš„æ–¹æ³•ï¼š</strong></p><ol><li>é‡æ–°å®ç°éƒ¨ä»¶çš„paintEventï¼ˆï¼‰ã€mousePressEvent()ç­‰äº‹ä»¶å¤„ç†å‡½æ•°ã€‚è¿™æ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§æ–¹æ³•ï¼Œä¸è¿‡åªèƒ½ç”¨æ¥å¤„ç†ç‰¹å®šéƒ¨ä»¶çš„ç‰¹å®šäº‹ä»¶ï¼ˆå³éœ€è¦æ–°å»ºç±»å»å®ç°ï¼‰</li><li>é‡æ–°å®ç°notifyï¼ˆï¼‰å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°çš„åŠŸèƒ½å¼ºå¤§ï¼Œæä¾›äº†å®Œå…¨çš„æ§åˆ¶ï¼Œå¯ä»¥å†äº‹ä»¶è¿‡æ»¤å™¨å¾—åˆ°äº‹ä»¶ä¹‹é—´å°±è·å¾—ä»–ä»¬ã€‚ä½†æ˜¯ï¼Œå®ƒä¸€æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªäº‹ä»¶ã€‚</li><li>å‘QApplicationå¯¹è±¡ä¸Šå®‰è£…äº‹ä»¶è¿‡æ»¤å™¨ã€‚å› ä¸ºä¸€ä¸ªç¨‹åºåªæœ‰ä¸€ä¸ªQApplicationå¯¹è±¡ï¼Œå®ç°çš„åŠŸèƒ½å’Œnotifyï¼ˆï¼‰å‡½æ•°ç›¸åŒï¼Œä¼˜ç‚¹æ˜¯å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªäº‹ä»¶ã€‚</li><li>é‡æ–°å®ç°eventï¼ˆï¼‰å‡½æ•°ã€‚QObjectç±»çš„eventï¼ˆï¼‰å‡½æ•°å¯ä»¥åœ¨äº‹ä»¶è¾¾åˆ°é»˜è®¤äº‹ä»¶å¤„ç†å‡½æ•°ä¹‹å‰è·å¾—è¯¥äº‹ä»¶ã€‚</li><li>åœ¨å¯¹è±¡ä¸Šå®‰è£…äº‹ä»¶è¿‡æ»¤å™¨ã€‚ä½¿ç”¨äº‹ä»¶è¿‡æ»¤å™¨å¯ä»¥å†ä¸€ä¸ªç•Œé¢ç±»ä¸­åŒæ—¶å¤„ç†ä¸åŒå­éƒ¨ä»¶çš„äº‹ä»¶ï¼ˆåœ¨æœ¬ç±»ä¸­å®ç°ï¼‰</li></ol><p>å®é™…ç¼–ç¨‹ä¸­æœ€å¸¸ç”¨çš„æ˜¯æ–¹æ³•ï¼ˆ1ï¼‰ï¼Œå…¶æ¬¡æ˜¯æ–¹æ³•ï¼ˆ5ï¼‰ã€‚æ–¹æ³•2è¦ç»§æ‰¿QApplicationç±»ï¼Œæ–¹æ³•3éœ€è¦å…¨å±€çš„äº‹ä»¶è¿‡æ»¤å™¨ï¼Œå‡ç¼“äº‹ä»¶çš„ä¼ é€’ã€‚</p><p><strong>é¼ æ ‡äº‹ä»¶ï¼š</strong></p><p>å¸¸ç”¨çš„é¼ æ ‡äº‹ä»¶ï¼šï¼ˆæœ¬ç¯‡å¤„ç†äº‹ä»¶ç”¨çš„æ˜¯æ–¹æ³•ä¸€ï¼šé‡å†™é¼ æ ‡äº‹ä»¶ï¼‰</p><ul><li>void mousePressEvent(QMouseEvent *event);      &#x2F;&#x2F;å•å‡»</li><li>void mouseReleaseEvent(QMouseEvent *event);    &#x2F;&#x2F;é‡Šæ”¾</li><li>void mouseDoubleClickEvent(QMouseEvent *event); &#x2F;&#x2F;åŒå‡»</li><li>void mouseMoveEvent(QMouseEvent *event);      &#x2F;&#x2F;ç§»åŠ¨</li><li>void wheelEvent(QWheelEvent *event);           &#x2F;&#x2F;æ»‘è½®</li></ul><p><strong>é¼ æ ‡äº‹ä»¶ä½¿ç”¨çš„æ—¶å€™ï¼ŒåŠ å¤´æ–‡ä»¶ï¼š #include <QMouseEvent></strong></p><p><strong>é‡å†™äº‹ä»¶æ¡†æ¶ï¼š</strong></p><p><strong>1ï¸âƒ£é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::mousePressEvent</span><span class="params">(QMouseEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯é¼ æ ‡å·¦é”®æŒ‰ä¸‹   </span></span><br><span class="line">    <span class="keyword">if</span>(event-&gt;<span class="built_in">button</span>() == Qt::LeftButton)&#123;</span><br><span class="line">        Â·Â·Â·</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯é¼ æ ‡å³é”®æŒ‰ä¸‹</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(event-&gt;<span class="built_in">button</span>() == Qt::RightButton)&#123;</span><br><span class="line">       Â·Â·Â·</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>2ï¸âƒ£é¼ æ ‡ç§»åŠ¨äº‹ä»¶</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::mouseMoveEvent</span><span class="params">(QMouseEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œå¿…é¡»ä½¿ç”¨buttons()</span></span><br><span class="line">    <span class="keyword">if</span>(event-&gt;<span class="built_in">buttons</span>() &amp; Qt::LeftButton)&#123;  <span class="comment">//è¿›è¡Œçš„æŒ‰ä½ä¸</span></span><br><span class="line">       Â·Â·Â·</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œè§¦å‘äº‹ä»¶éœ€è¦ç‚¹å‡»ä¸€ä¸‹ï¼Œæ‰èƒ½è§¦å‘ã€‚å¯è®¾ç½®ä¸ºè‡ªåŠ¨è§¦å‘:<strong>setMouseTracking(true);</strong> </p><p><strong>3ï¸âƒ£é¼ æ ‡é‡Šæ”¾äº‹ä»¶</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::mouseReleaseEvent</span><span class="params">(QMouseEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   Â·Â·Â·</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>4ï¸âƒ£é¼ æ ‡åŒå‡»äº‹ä»¶</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::mouseDoubleClickEvent</span><span class="params">(QMouseEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯é¼ æ ‡å·¦é”®æŒ‰ä¸‹</span></span><br><span class="line">    <span class="keyword">if</span>(event-&gt;<span class="built_in">button</span>() == Qt::LeftButton)&#123;</span><br><span class="line">      </span><br><span class="line">        Â·Â·Â·</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>5ï¸âƒ£æ»šè½®äº‹ä»¶</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Widget::wheelEvent</span><span class="params">(QWheelEvent *event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å½“æ»šè½®è¿œç¦»ä½¿ç”¨è€…æ—¶</span></span><br><span class="line">    <span class="keyword">if</span>(event-&gt;<span class="built_in">delta</span>() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        Â·Â·Â·</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;<span class="comment">//å½“æ»šè½®å‘ä½¿ç”¨è€…æ–¹å‘æ—‹è½¬æ—¶</span></span><br><span class="line">        Â·Â·Â·</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å®ä¾‹æ¼”ç¤º</strong>ï¼ˆåœ¨labelæ§ä»¶ä¸­ï¼Œç§»åŠ¨é¼ æ ‡è·å–å®æ—¶ä½ç½®ï¼Œå¹¶æ˜¾ç¤ºåœ¨ç•Œé¢ä¸Šï¼‰</p><ul><li><strong>åˆ›å»ºmylabelç±»ï¼ŒåŸºç±»è®¾ç½®ä¸ºQLabel</strong></li></ul><p><img src="https://bu.dusays.com/2025/03/13/67d29c1584eb6.png"></p><p>è¿™é‡Œç”¨äº†ç±»ä¼¼è‡ªå®šä¹‰æ§ä»¶çš„æ–¹æ³•ï¼Œå¯¹Mylabelç±»è¿›è¡Œå°è£…ã€‚è®¾ç½®åŸºç±»QLabel æ˜¯ä¸ºäº†åœ¨uiç•Œé¢ä¸­æå‡labelæ§ä»¶ï¼ˆå³å°†labelæ§ä»¶å’ŒMylabelå…³è”ï¼Œæå‡æ—¶å€™å¿…é¡»äºŒè€…åŸºç±»ç›¸åŒï¼‰</p><ul><li>åœ¨mylabel.hä¸­å£°æ˜é¼ æ ‡äº‹ä»¶</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;qlabel.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">mylabel</span> : <span class="keyword">public</span> QLabel</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">mylabel</span>(QWidget* parent = <span class="number">0</span>);</span><br><span class="line">    ~<span class="built_in">mylabel</span>();</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//é¼ æ ‡ç§»åŠ¨äº‹ä»¶</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mouseMoveEvent</span><span class="params">(QMouseEvent* event)</span></span>;</span><br><span class="line">    <span class="comment">//é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mousePressEvent</span><span class="params">(QMouseEvent* event)</span></span>;</span><br><span class="line">    <span class="comment">//é¼ æ ‡é‡Šæ”¾äº‹ä»¶</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mouseReleaseEvent</span><span class="params">(QMouseEvent* event)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li>åœ¨mylabel.cppä¸­é‡å†™äº‹ä»¶</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mylabel.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;QMouseEvent&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mylabel::<span class="built_in">mylabel</span>(QWidget* parent) :<span class="built_in">QLabel</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">mylabel::~<span class="built_in">mylabel</span>()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//é¼ æ ‡ç§»åŠ¨æ˜¾ç¤ºåæ ‡</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">mylabel::mouseMoveEvent</span><span class="params">(QMouseEvent* event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (event-&gt;<span class="built_in">buttons</span>() &amp; Qt::LeftButton)  <span class="comment">//è¿›è¡Œçš„æŒ‰ä½ä¸ï¼ˆåªæœ‰å·¦é”®ç‚¹å‡»ç§»åŠ¨æ‰æ»¡è¶³ï¼‰</span></span><br><span class="line">    &#123; </span><br><span class="line">        QString str = <span class="built_in">QString</span>(<span class="string">&quot;Move:(X:%1,Y:%2)&quot;</span>).<span class="built_in">arg</span>(event-&gt;<span class="built_in">x</span>()).<span class="built_in">arg</span>(event-&gt;<span class="built_in">y</span>());</span><br><span class="line">         <span class="keyword">this</span>-&gt;<span class="built_in">setText</span>(str);</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//é¼ æ ‡æŒ‰ä¸‹æ˜¾ç¤ºâ€œokï¼Œmouse is pressâ€</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">mylabel::mousePressEvent</span><span class="params">(QMouseEvent* event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setText</span>(<span class="string">&quot;Ok, mouse is press&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//é¼ æ ‡é‡Šæ”¾æ¸…é™¤æ˜¾ç¤º</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">mylabel::mouseReleaseEvent</span><span class="params">(QMouseEvent* event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setText</span>(<span class="string">&quot; &quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åœ¨ä¸»å‡½æ•°ï¼ˆQTest.cppï¼‰ä¸­å£°æ˜mylabelçš„ç±»å¯¹è±¡ï¼ˆå³å£°æ˜ä¸€ä¸ªmylabelç±»çš„labelæ§ä»¶ï¼‰</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;qtest.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">QTest::<span class="built_in">QTest</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QWidget</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line">    ui.<span class="built_in">setupUi</span>(<span class="keyword">this</span>);    <span class="comment">//å£°æ˜mylabelç±»çš„æ§ä»¶</span></span><br><span class="line">    mylabel* label1 = <span class="keyword">new</span> <span class="built_in">mylabel</span>(<span class="keyword">this</span>);</span><br><span class="line">    label1-&gt;<span class="built_in">setGeometry</span>(<span class="built_in">QRect</span>(<span class="number">130</span>, <span class="number">100</span>, <span class="number">271</span>, <span class="number">161</span>));    <span class="comment">//è®¾ç½®è¾¹æ¡†</span></span><br><span class="line">    label1-&gt;<span class="built_in">setFrameShape</span>(QFrame::Panel);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/03/13/67d29c2b5a2ed.png"></p><p> å¦å¤–ï¼Œå½“è°ƒç”¨<strong>setMouseTracking(true)</strong>;æ—¶ï¼ˆå³è®¾ç½®é¼ æ ‡çŠ¶æ€ä¸ºè‡ªåŠ¨è§¦å‘ï¼‰ï¼Œéœ€è¦å°†é¼ æ ‡ç§»åŠ¨äº‹ä»¶çš„ifè¯­å¥å»æ‰ï¼ˆå› ä¸ºä¸éœ€è¦ç‚¹å‡»è§¦å‘äº†ï¼‰</p><p><strong>ä¿®æ”¹maylabel.cppäº‹ä»¶ï¼š</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;mylabel.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;QMouseEvent&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mylabel::<span class="built_in">mylabel</span>(QWidget* parent) :<span class="built_in">QLabel</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//è®¾ç½®é¼ æ ‡çŠ¶æ€ï¼ˆè‡ªåŠ¨è§¦å‘ï¼‰</span></span><br><span class="line">    <span class="built_in">setMouseTracking</span>(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line">mylabel::~<span class="built_in">mylabel</span>()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//é¼ æ ‡ç§»åŠ¨æ˜¾ç¤ºåæ ‡</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">mylabel::mouseMoveEvent</span><span class="params">(QMouseEvent* event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   QString str = <span class="built_in">QString</span>(<span class="string">&quot;Move:(X:%1,Y:%2)&quot;</span>).<span class="built_in">arg</span>(event-&gt;<span class="built_in">x</span>()).<span class="built_in">arg</span>(event-&gt;<span class="built_in">y</span>());</span><br><span class="line">   <span class="keyword">this</span>-&gt;<span class="built_in">setText</span>(str);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//é¼ æ ‡æŒ‰ä¸‹æ˜¾ç¤ºâ€œokï¼Œmouse is pressâ€</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">mylabel::mousePressEvent</span><span class="params">(QMouseEvent* event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setText</span>(<span class="string">&quot;Ok, mouse is press&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//é¼ æ ‡é‡Šæ”¾æ¸…é™¤æ˜¾ç¤º</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">mylabel::mouseReleaseEvent</span><span class="params">(QMouseEvent* event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setText</span>(<span class="string">&quot; &quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ•ˆæœå±•ç¤ºï¼š</strong></p><p><img src="https://bu.dusays.com/2025/03/13/67d29c4cbb6f7.gif"></p><p><strong>ğŸ˜’è¿™é‡Œç”¨çš„æ˜¯ä»£ç åˆ›å»ºlabelæ§ä»¶ï¼Œé‚£ä¹ˆèƒ½ä¸èƒ½ç”¨uiç•Œé¢ç¼–è¾‘ç„¶ååœ¨å¯¹labelæ§ä»¶æå‡å‘¢ï¼Ÿ</strong></p><p>ç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<strong>æ­¤å¤„ä¸èƒ½é€‰æ‹©å…¨å±€åŒ…å«</strong></p><p><img src="https://bu.dusays.com/2025/03/13/67d29c64cf2e2.png"></p><p> <strong>å¦åˆ™ä¼šå‡ºç°ï¼š</strong></p><p><img src="https://bu.dusays.com/2025/03/13/67d29c7542d19.png"></p><p>æˆ‘æƒ³å…¶ä¸­çš„åŸå› ä¸»è¦æ˜¯å› ä¸ºï¼š</p><p>æœ¬å®ä¾‹æ˜¯æ–°å»ºäº†ä¸€ä¸ªmylabelç±»ï¼Œè€Œä¸æ˜¯åƒ<a href="https://www.cnblogs.com/xyf327/p/15097726.html">QTå¸¸ç”¨æ§ä»¶ï¼ˆä¸‰ï¼‰â€”â€”è‡ªå®šä¹‰æ§ä»¶å°è£… - å”¯æœ‰è‡ªå·±å¼ºå¤§ - åšå®¢å›­ (cnblogs.com)</a>è¿™ç¯‡åšæ–‡ä¸­ç›´æ¥æ–°æ·»åŠ äº†ä¸€ä¸ªè®¾è®¡å¸ˆç•Œé¢ç±»ï¼ˆå³åŒ…å«ui .h .cpp)ã€‚å½“é€‰æ‹©å…¨å±€åŒ…å«æ—¶ï¼Œå°±åŒ…å«äº†ä¸»ç±»ã€‚</p><p>å…¶å®ä¹Ÿæœ‰è§£å†³çš„åŠæ³•ï¼šéœ€è¦åœ¨æå‡ç•Œé¢çš„å¤´æ–‡ä»¶å¤„ï¼Œå°†å·¥ç¨‹ç›®å½•ä¸‹è‡ªå®šä¹‰æ§ä»¶çš„åœ°å€æ”¾äºæ­¤å¤„</p><p><img src="https://bu.dusays.com/2025/03/13/67d29c8d1fe53.png"></p><h3 id="äºŒï¼Œäº‹ä»¶çš„åˆ†å‘ï¼ševentå‡½æ•°"><a href="#äºŒï¼Œäº‹ä»¶çš„åˆ†å‘ï¼ševentå‡½æ•°" class="headerlink" title=" äºŒï¼Œäº‹ä»¶çš„åˆ†å‘ï¼ševentå‡½æ•°"></a><font color="FF0000"> äºŒï¼Œäº‹ä»¶çš„åˆ†å‘ï¼ševentå‡½æ•°</font></h3><p>ä¸Šé¢æåˆ°çš„xxxEventå‡½æ•°ï¼Œç§°ä¸ºäº‹ä»¶å¤„ç†å™¨ï¼ˆevent handlerï¼‰ã€‚è€Œeventå‡½æ•°çš„ä½œç”¨å°±åœ¨äºäº‹ä»¶çš„åˆ†å‘ã€‚å¦‚æœæƒ³åœ¨äº‹ä»¶çš„åˆ†å‘ä¹‹å‰å°±è¿›è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚ç›‘å¬ï¼ˆ<strong>é˜»å¡</strong>ï¼‰é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶ã€‚</p><p> å¦‚æœå¸Œæœ›åœ¨äº‹ä»¶åˆ†å‘ä¹‹å‰åšä¸€äº›æ“ä½œï¼Œå°±å¯ä»¥é‡å†™è¿™ä¸ª event()å‡½æ•°äº†ã€‚æ¯”å¦‚æˆ‘ä»¬å¸Œæœ›é˜»å¡é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åœ¨æ–°å»ºçš„Mylabelç±»ä¸­é‡å†™event()å‡½æ•°ï¼ˆ<strong>è¯¥ç±»çš„çˆ¶ç±»æ˜¯QLabel</strong>ï¼‰</p><ul><li><strong>åœ¨Mylabel.hä¸­å£°æ˜eventäº‹ä»¶</strong></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;qlabel.h&quot;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mylabel</span> : <span class="keyword">public</span> QLabel</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Mylabel</span><span class="params">(QWidget* parent = <span class="number">0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mousePressEvent</span><span class="params">(QMouseEvent* event)</span></span>; </span><br><span class="line">    <span class="comment">//é¼ æ ‡é‡Šæ”¾äº‹ä»¶</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mouseReleaseEvent</span><span class="params">(QMouseEvent* event)</span></span>;</span><br><span class="line">    <span class="comment">//å£°æ˜eventäº‹ä»¶</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">event</span><span class="params">(QEvent* e)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><strong>åœ¨Mylabel.cppä¸­é‡å†™eventäº‹ä»¶ã€‚</strong></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Mylabel.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;QMouseEvent&quot;</span></span></span><br><span class="line"></span><br><span class="line">Mylabel::<span class="built_in">Mylabel</span>(QWidget* parent) :<span class="built_in">QLabel</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é‡å†™é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Mylabel::mousePressEvent</span><span class="params">(QMouseEvent* event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;<span class="built_in">setText</span>(<span class="built_in">QString</span>(<span class="string">&quot;mouse is press x:%1,y:%2&quot;</span>).<span class="built_in">arg</span>(event-&gt;<span class="built_in">x</span>()).<span class="built_in">arg</span>(event-&gt;<span class="built_in">y</span>()));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//é‡å†™é¼ æ ‡é‡Šæ”¾äº‹ä»¶</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Mylabel::mouseReleaseEvent</span><span class="params">(QMouseEvent* event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;<span class="built_in">setText</span>(<span class="string">&quot;mouse is release &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//é‡å†™eventäº‹ä»¶</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Mylabel::event</span><span class="params">(QEvent* e)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//å¦‚æœé¼ æ ‡æŒ‰ä¸‹ï¼Œå†äº‹ä»¶åˆ†å‘ä¸­åšæ‹¦æˆª</span></span><br><span class="line">    <span class="keyword">if</span> (e-&gt;<span class="built_in">type</span>()==QEvent::MouseButtonPress)</span><br><span class="line">    &#123;        <span class="comment">//é™æ€è½¬æ¢ï¼ˆå°†QEventçš„å¯¹è±¡è½¬æ¢ä¸ºQMouseEventå¯¹è±¡ï¼‰</span></span><br><span class="line">        QMouseEvent* event = <span class="built_in">static_cast</span>&lt;QMouseEvent*&gt;(e);</span><br><span class="line">        <span class="keyword">this</span>-&gt;<span class="built_in">setText</span>(<span class="built_in">QString</span>(<span class="string">&quot;event mouse is press x:%1,y:%2&quot;</span>).<span class="built_in">arg</span>(event-&gt;<span class="built_in">x</span>()).<span class="built_in">arg</span>(event-&gt;<span class="built_in">y</span>()));</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;<span class="comment">//è¿”å›tureï¼Œè¯´æ˜ç”¨æˆ·è‡ªå·±å¤„ç†äº‹ä»¶ï¼Œä¸å¾€ä¸‹åˆ†å‘ï¼ˆå³æ‹¦æˆªä¸Šé¢çš„æŒ‰ä¸‹äº‹ä»¶ï¼‰</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> QLabel::<span class="built_in">event</span>(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/03/13/67d29cb547ab2.png"></p><p>ç‚¹å‡»é¼ æ ‡å¯ä»¥çœ‹åˆ°ï¼Œè§¦å‘çš„æ˜¯eventçš„äº‹ä»¶ï¼ˆå³é˜»å¡äº†mousePressEventçš„äº‹ä»¶ï¼‰ã€‚<strong>ç‰¹åˆ«éœ€è¦æ³¨æ„çš„æ˜¯ï¼šåœ¨å°†ä¸éœ€è¦é˜»å¡åˆ†å‘çš„æ—¶å€™ï¼Œéœ€è¦åˆ†å‘ç»™çˆ¶ç±»çš„eventå‡½æ•°å¤„ç†ã€‚å³ï¼ˆreturn QLable::event(e)ï¼›)</strong></p><p>ç”±æ­¤å¯ä»¥è§ï¼Œevent()æ˜¯ä¸€ä¸ªé›†ä¸­å¤„ç†ä¸åŒç±»å‹çš„äº‹ä»¶çš„åœ°æ–¹ã€‚å¦‚æœä½ ä¸æƒ³é‡å†™ä¸€å¤§å †äº‹ä»¶å¤„ç†å™¨ï¼Œå°±å¯ä»¥é‡å†™è¿™ä¸ª event()å‡½æ•°ï¼Œé€šè¿‡ QEvent::type()åˆ¤æ–­ä¸åŒçš„äº‹ä»¶ã€‚é‰´äºé‡å†™ event()å‡½æ•°éœ€è¦ååˆ†å°å¿ƒæ³¨æ„çˆ¶ç±»çš„åŒåå‡½æ•°çš„è°ƒç”¨ï¼Œä¸€ä¸ç•™ç¥å°±å¯èƒ½å‡ºç°é—®é¢˜ï¼Œæ‰€ä»¥ä¸€èˆ¬è¿˜æ˜¯å»ºè®®åªé‡å†™äº‹ä»¶å¤„ç†å™¨ï¼ˆå½“ç„¶ï¼Œä¹Ÿå¿…é¡»è®°å¾—æ˜¯ä¸æ˜¯åº”è¯¥è°ƒç”¨çˆ¶ç±»çš„åŒåå¤„ç†å™¨ï¼‰ã€‚</p><h3 id="ä¸‰ï¼Œäº‹ä»¶è¿‡æ»¤å™¨ï¼ˆEven-Filterï¼‰"><a href="#ä¸‰ï¼Œäº‹ä»¶è¿‡æ»¤å™¨ï¼ˆEven-Filterï¼‰" class="headerlink" title="ä¸‰ï¼Œäº‹ä»¶è¿‡æ»¤å™¨ï¼ˆEven Filterï¼‰"></a><strong>ä¸‰ï¼Œäº‹ä»¶è¿‡æ»¤å™¨ï¼ˆEven Filterï¼‰</strong></h3><p> æŸäº›åº”ç”¨åœºæ™¯ä¸‹ï¼Œéœ€è¦æ‹¦æˆªæŸä¸ªç»„ä»¶å‘ç”Ÿçš„äº‹ä»¶ï¼Œè®©è¿™ä¸ªäº‹ä»¶ä¸å†å‘å…¶ä»–ç»„ä»¶è¿›è¡Œä¼ æ’­ï¼Œè¿™æ—¶å€™å¯ä»¥ä¸ºè¿™ä¸ªç»„ä»¶æˆ–å…¶çˆ¶ç»„ä»¶å®‰è£…ä¸€ä¸ªäº‹ä»¶è¿‡æ»¤å™¨ï¼Œ<strong>è¯¥è¿‡æ»¤å™¨åœ¨eventåˆ†å‘ä¹‹å‰è¿›è¡Œæ‹¦æˆªã€‚</strong></p><p><strong>äº‹ä»¶çš„è¿‡æ»¤æœ‰ä¸¤ä¸ªæ­¥éª¤ï¼š</strong></p><p>1ï¸âƒ£å¯¹QObjectç»„ä»¶å®‰è£…è¿‡æ»¤å™¨ï¼ˆ<strong>è°ƒç”¨installEvenFilterå‡½æ•°</strong>ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">QObject::installEventFilter</span> <span class="params">( QObject * filterObj )</span></span>;</span><br></pre></td></tr></table></figure><p>å‚æ•°filterobj æ˜¯æŒ‡è°ä¸ºç»„ä»¶å®‰è£…è¿‡æ»¤å™¨ï¼ˆä¸€èˆ¬æ˜¯çˆ¶ç±»ï¼‰</p><ul><li>è¿™ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ª QObject *ç±»å‹çš„å‚æ•°ã€‚è®°å¾—åˆšåˆšæˆ‘ä»¬è¯´çš„ï¼ŒeventFilter()å‡½æ•°æ˜¯ QObject çš„ä¸€ä¸ªæˆå‘˜å‡½æ•°ï¼Œå› æ­¤ï¼Œä»»æ„ QObject éƒ½å¯ä»¥ä½œä¸ºäº‹ä»¶è¿‡æ»¤å™¨ï¼ˆé—®é¢˜åœ¨äºï¼Œå¦‚æœä½ æ²¡æœ‰é‡å†™ eventFilter()å‡½æ•°ï¼Œè¿™ä¸ªäº‹ä»¶è¿‡æ»¤å™¨æ˜¯æ²¡æœ‰ä»»ä½•ä½œç”¨çš„ï¼Œå› ä¸ºé»˜è®¤ä»€ä¹ˆéƒ½ä¸ä¼šè¿‡æ»¤ï¼‰ã€‚å·²ç»å­˜åœ¨çš„è¿‡æ»¤å™¨åˆ™å¯ä»¥é€šè¿‡**QObject::removeEventFilter()**å‡½æ•°ç§»é™¤ã€‚ </li><li>æˆ‘ä»¬å¯ä»¥å‘ä¸€ä¸ªå¯¹è±¡ä¸Šé¢å®‰è£…å¤šä¸ªäº‹ä»¶å¤„ç†å™¨ ï¼Œåªè¦è°ƒç”¨å¤šæ¬¡installEventFilter()å‡½æ•°ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡å­˜åœ¨å¤šä¸ªäº‹ä»¶è¿‡æ»¤å™¨ï¼Œé‚£ä¹ˆï¼Œæœ€åä¸€ä¸ªå®‰è£…çš„ä¼šç¬¬ä¸€ä¸ªæ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯åè¿›å…ˆæ‰§è¡Œçš„é¡ºåºã€‚</li></ul><p>2ï¸âƒ£äº‹ä»¶è¿‡æ»¤å™¨çš„é‡å†™ï¼ˆ<strong>evenFilterå‡½æ•°</strong>ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">QObject::eventFilter</span> <span class="params">( QObject * watched, QEvent * event )</span></span>;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå‡½æ•°æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªä¸ºå…·ä½“å‘ç”Ÿäº‹ä»¶çš„ç»„ä»¶ï¼Œä¸€ä¸ªä¸ºå‘ç”Ÿçš„äº‹ä»¶ï¼ˆäº§ç”Ÿçš„QEventå¯¹è±¡ï¼‰ã€‚å½“äº‹ä»¶æ˜¯æˆ‘ä»¬æ„Ÿå…´è¶£çš„ç±»å‹ï¼Œå¯ä»¥å°±åœ°è¿›è¡Œå¤„ç†ï¼Œå¹¶ä»¤å…¶ä¸å†è½¬å‘ç»™å…¶ä»–ç»„ä»¶ã€‚å‡½æ•°çš„è¿”å›å€¼ä¹Ÿæ˜¯boolç±»å‹ï¼Œä½œç”¨è·Ÿevenå‡½æ•°ç±»ä¼¼ï¼Œè¿”å›trueä¸ºä¸å†è½¬å‘ï¼Œfalseåˆ™è®©å…¶ç»§ç»­è¢«å¤„ç†ã€‚</p><p><strong>å®ä¾‹</strong>ï¼šé€šè¿‡äº‹ä»¶è¿‡æ»¤å™¨é˜»å¡ä¸Šé¢ä»£ç ä¸­çš„é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;qtest.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;qmouseevent&quot;</span></span></span><br><span class="line"></span><br><span class="line">QTest::<span class="built_in">QTest</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QWidget</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line">    ui.<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//ç¬¬ä¸€æ­¥ï¼šç»™labelæ·»åŠ è¿‡æ»¤å™¨</span></span><br><span class="line">    ui.label-&gt;<span class="built_in">installEventFilter</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ç¬¬äºŒæ­¥ï¼šé‡å†™è¿‡æ»¤äº‹ä»¶</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">QTest::eventFilter</span><span class="params">(QObject* obj, QEvent* e)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (obj == ui.label)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//å¦‚æœé¼ æ ‡æŒ‰ä¸‹ï¼Œå†äº‹ä»¶åˆ†å‘ä¸­åšæ‹¦æˆª</span></span><br><span class="line">        <span class="keyword">if</span> (e-&gt;<span class="built_in">type</span>() == QEvent::MouseButtonPress)</span><br><span class="line">        &#123;</span><br><span class="line">            QMouseEvent* event = <span class="built_in">static_cast</span>&lt;QMouseEvent*&gt;(e);</span><br><span class="line">            ui.label-&gt;<span class="built_in">setText</span>(<span class="built_in">QString</span>(<span class="string">&quot;eventfilter mouse is press x:%1,y:%2&quot;</span>).<span class="built_in">arg</span>(event-&gt;<span class="built_in">x</span>()).<span class="built_in">arg</span>(event-&gt;<span class="built_in">y</span>()));</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;<span class="comment">//è¿”å›tureï¼Œè¯´æ˜ç”¨æˆ·è‡ªå·±å¤„ç†äº‹ä»¶ï¼Œä¸å¾€ä¸‹åˆ†å‘ï¼ˆå³æ‹¦æˆªä¸Šé¢çš„æŒ‰ä¸‹äº‹ä»¶ï¼‰</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> QWidget::<span class="built_in">eventFilter</span>(obj, e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é‡å†™é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QTest::mousePressEvent</span><span class="params">(QMouseEvent* event)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui.label-&gt;<span class="built_in">setText</span>(<span class="built_in">QString</span>(<span class="string">&quot;mouse is press x:%1,y:%2&quot;</span>).<span class="built_in">arg</span>(event-&gt;<span class="built_in">x</span>()).<span class="built_in">arg</span>(event-&gt;<span class="built_in">y</span>()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//é‡å†™äº‹ä»¶åˆ†å‘</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">QTest::event</span><span class="params">(QEvent* e)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//å¦‚æœé¼ æ ‡æŒ‰ä¸‹ï¼Œå†äº‹ä»¶åˆ†å‘ä¸­åšæ‹¦æˆª</span></span><br><span class="line">    <span class="keyword">if</span> (e-&gt;<span class="built_in">type</span>() == QEvent::MouseButtonPress)</span><br><span class="line">    &#123;</span><br><span class="line">        QMouseEvent* event = <span class="built_in">static_cast</span>&lt;QMouseEvent*&gt;(e);</span><br><span class="line">        ui.label-&gt;<span class="built_in">setText</span>(<span class="built_in">QString</span>(<span class="string">&quot;event mouse is press x:%1,y:%2&quot;</span>).<span class="built_in">arg</span>(event-&gt;<span class="built_in">x</span>()).<span class="built_in">arg</span>(event-&gt;<span class="built_in">y</span>()));</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;<span class="comment">//è¿”å›tureï¼Œè¯´æ˜ç”¨æˆ·è‡ªå·±å¤„ç†äº‹ä»¶ï¼Œä¸å¾€ä¸‹åˆ†å‘ï¼ˆå³æ‹¦æˆªä¸Šé¢çš„æŒ‰ä¸‹äº‹ä»¶ï¼‰</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> QWidget::<span class="built_in">event</span>(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¿è¡Œç»“æœï¼š</strong></p><p><img src="https://bu.dusays.com/2025/03/13/67d29ccad815a.png"></p><p>å¯ä»¥çœ‹åˆ°åœ¨è¿‡æ»¤å™¨äº‹ä»¶ä¸­å°±ç›‘å¬äº†é¼ æ ‡æŒ‰å‹ï¼ˆå³é˜»å¡äº†åé¢çš„äº‹ä»¶åˆ†å‘å’Œé¼ æ ‡æŒ‰å‹ï¼‰</p><h3 id="æŒ‰é’®é•¿æŒ‰äº‹ä»¶"><a href="#æŒ‰é’®é•¿æŒ‰äº‹ä»¶" class="headerlink" title="æŒ‰é’®é•¿æŒ‰äº‹ä»¶"></a><font color="FF0000">æŒ‰é’®é•¿æŒ‰äº‹ä»¶</font></h3><p>æœ€è¿‘åœ¨åšqté¡¹ç›®ï¼Œéœ€è¦å¯¹buttonæŒ‰é’®æ·»åŠ ä¸€ä¸ªé•¿æŒ‰äº‹ä»¶ï¼ˆæ¯”å¦‚ç‚¹å‡»æŒ‰é’®ï¼Œå¼€å§‹è¿åŠ¨ã€‚æ¾å¼€æŒ‰é’®ï¼Œè¿åŠ¨åœæ­¢ï¼‰ã€‚æŸ¥äº†äº›è®¸èµ„æ–™ï¼Œï¼ˆå·®ç‚¹è¯¯æŠŠQPushButtonçš„pressä¿¡å·å’Œé•¿æŒ‰äº‹ä»¶æ··æ·†ï¼‰åœ¨æ­¤è®°å½•ä¸€ä¸‹ç»éªŒã€‚</p><h4 id="setAutoRepeat"><a href="#setAutoRepeat" class="headerlink" title="setAutoRepeat"></a><font color="FF0000">setAutoRepeat</font></h4><p>ä»¥å‰ä¸€ç›´ä»¥ä¸ºQPushButtonä¸æ”¯æŒé•¿æŒ‰ï¼Œæ‰å‘ç°è¿˜æœ‰è¿™ä¸ªåŠŸèƒ½ã€‚ç”¨èµ·æ¥å¾ˆç®€å•ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">QPushButton *pBtnSub = <span class="keyword">new</span> <span class="built_in">QPushButton</span>(<span class="keyword">this</span>);</span><br><span class="line">pBtnSub = <span class="built_in">setAutoRepeat</span>(<span class="literal">true</span>);  <span class="comment">//å¯åŠ¨é•¿æŒ‰</span></span><br><span class="line">pBtnSub = <span class="built_in">setAutoRepeatDelay</span>(<span class="number">400</span>);  <span class="comment">// è§¦å‘é•¿æŒ‰æ—¶é—´</span></span><br><span class="line">pBtnSub = <span class="built_in">setAutoRepeatInterval</span>(<span class="number">50</span>);  <span class="comment">// é•¿æŒ‰æ—¶clickä¿¡å·é—´éš”</span></span><br><span class="line"><span class="built_in">connect</span>(pBtnSub,&amp;QPushButton::clicked,[&amp;]&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;send&quot;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>MouseEventä¸­æ²¡æœ‰repeatè¿™ä¸ªä¸œè¥¿çš„ï¼Œæ‰€ä»¥ä¸€ä¸ªæŒ‰é’®è¢«é¼ æ ‡ç‚¹å‡»è¿˜èƒ½è¿ç»­è§¦å‘ï¼Œé‚£åŸºæœ¬å°±æ˜¯ä¸€ä¸ªå®šæ—¶å™¨åšå‡ºæ¥çš„ã€‚</p><p><strong>æ‰€ä»¥åº”è¯¥è¯´æ˜¯é¼ æ ‡æŒ‰ä¸‹Delayæ—¶é—´åä¼šå¯åŠ¨ä¸€ä¸ªå¤šæ¬¡è§¦å‘çš„TimerEventï¼ˆå®šæ—¶å™¨ï¼‰ï¼Œç”±timeOutå†æ¬¡è§¦å‘clickæ§½ã€‚</strong></p><h4 id="QPushButton-ç‚¹å‡»ä¿¡å·åˆ†æ"><a href="#QPushButton-ç‚¹å‡»ä¿¡å·åˆ†æ" class="headerlink" title="QPushButton ç‚¹å‡»ä¿¡å·åˆ†æ"></a><font color="FF0000">QPushButton ç‚¹å‡»ä¿¡å·åˆ†æ</font></h4><p>å†æ¥åˆ†æä¸€ä¸‹QPushButtonçš„ç‚¹å‡»ä¿¡å·ã€‚QPushButtonæœ‰ä¸‰ä¸ªå¾ˆé‡è¦çš„ä¿¡å·è·Ÿç‚¹å‡»æœ‰å…³ï¼š</p><ul><li>pressed</li><li>clicked</li><li>toggled</li></ul><p>è¡¨é¢ä¸Šçœ‹ï¼Œpressedå’Œclickedéƒ½ä¼šåœ¨ç‚¹å‡»æŒ‰é’®æ—¶è§¦å‘ï¼Œå®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿtoggledå¥½åƒæœ‰æ—¶å€™è§¦å‘ï¼Œæœ‰æ—¶å€™ä¸è§¦å‘ï¼Œåˆ°åº•æ€ä¹ˆå›äº‹å‘¢ï¼Ÿä¸‹é¢å°±ä¸€èµ·èŠä¸€ä¸‹è¿™ä¸‰ä¸ªä¿¡å·</p><p><strong>ğŸ˜ŠéªŒè¯è¿‡ç¨‹å°±ä¸æ”¾äº†ï¼Œç›´æ¥ç»™ç»“è®ºå§ï¼</strong></p><p>é¦–å…ˆï¼Œè¿™ä¸‰ä¸ªä¿¡å·éƒ½æ˜¯ä»QAbstractButtonç»§æ‰¿æ¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸‹é¢æƒ…å†µå¯¹QAbstractButtonçš„æ‰€æœ‰å­ç±»éƒ½é€‚ç”¨</p><p><strong>ç»“è®ºï¼š</strong></p><ol><li>pressedæœ€å…ˆæ‰§è¡Œï¼Œç›¸å½“äºæŒ‰ä¸‹æ“ä½œ</li><li>æŒ‰ä¸‹ä¹‹åï¼ŒæŒ‰é’®çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œè§¦å‘toggled</li><li>clickedæœ€åæ‰§è¡Œï¼Œç›¸å½“äºå¼¹èµ·æ“ä½œ</li></ol><br><br><br><p><span style="color: red; font-size: 20px;">è½¬è½½è‡ªï¼š<a href="https://www.cnblogs.com/xyf327">å”¯æœ‰è‡ªå·±å¼ºå¤§</a>          å¦‚æœ‰ä¾µæƒï¼Œåœ¨ä¸‹æ–¹è¯„è®º  ç«‹åˆ»åˆ é™¤ã€‚</span></p>]]></content>
      
      
      <categories>
          
          <category> Qt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qtå­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt06å®šæ—¶å™¨</title>
      <link href="/2025/03/13/Qt06%E5%AE%9A%E6%97%B6%E5%99%A8/"/>
      <url>/2025/03/13/Qt06%E5%AE%9A%E6%97%B6%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<p>Qtä¸­æœ‰ä¸¤ç§æ–¹æ³•æ¥ä½¿ç”¨å®šæ—¶å™¨ï¼Œä¸€ç§æ˜¯å®šæ—¶å™¨äº‹ä»¶ï¼Œå¦ä¸€ç§æ˜¯ä½¿ç”¨ä¿¡å·å’Œæ§½ã€‚</p><p>å¸¸ä½¿ç”¨ä¿¡å·å’Œæ§½ï¼ˆä»£ç çœ‹èµ·æ¥æ¯”è¾ƒæ•´æ´ï¼‰ä½†æ˜¯å½“ä½¿ç”¨å¤šä¸ªå®šæ—¶å™¨çš„æ—¶å€™æœ€å¥½ç”¨å®šæ—¶å™¨äº‹ä»¶æ¥å¤„ç†ã€‚ </p><h3 id="å®šæ—¶å™¨æ–¹å¼ä¸€ï¼šå®šæ—¶å™¨äº‹ä»¶"><a href="#å®šæ—¶å™¨æ–¹å¼ä¸€ï¼šå®šæ—¶å™¨äº‹ä»¶" class="headerlink" title="å®šæ—¶å™¨æ–¹å¼ä¸€ï¼šå®šæ—¶å™¨äº‹ä»¶"></a><font color="FF0000">å®šæ—¶å™¨æ–¹å¼ä¸€ï¼šå®šæ—¶å™¨äº‹ä»¶</font></h3><p><strong>éœ€è¦</strong>ï¼š #include <QTimerEvent></p><p><strong>æ–¹å¼</strong>ï¼š</p><ul><li>åˆ©ç”¨å¯¹void timerEvent(QTimerEvent* e)äº‹ä»¶çš„é‡å†™ã€‚</li><li>å¯åŠ¨å®šæ—¶å™¨ int QObject::startTimer ( int interval ) ;</li></ul><p>å¼€å¯ä¸€ä¸ªå®šæ—¶å™¨ï¼Œè¿”å›å€¼ä¸ºintç±»å‹ã€‚ä»–çš„å‚æ•°intervalæ˜¯æ¯«ç§’çº§åˆ«ã€‚å½“å¼€å¯æˆåŠŸåä¼šè¿”å›è¿™ä¸ªå®šæ—¶å™¨çš„ID, å¹¶ä¸”æ¯éš”interval æ—¶é—´åä¼šè¿›å…¥timerEvent å‡½æ•°ã€‚ç›´åˆ°å®šæ—¶å™¨è¢«æ€æ­»ï¼ˆkillTimerï¼‰</p><ul><li>timerEventçš„è¿”å›å€¼æ˜¯å®šæ—¶å™¨çš„å”¯ä¸€æ ‡è¯†ã€‚å¯ä»¥å’Œe-&gt;timerIdæ¯”è¾ƒ</li><li>void killTimer(int id); &#x2F;&#x2F;åœæ­¢ ID ä¸º id çš„è®¡æ—¶å™¨ï¼ŒID ç”± startTimer()å‡½æ•°è¿”å›</li></ul><p><strong>å®ä¾‹</strong>ï¼šåœ¨ä¸¤ä¸ªlabelä¸­è‡ªåŠ¨è®¡æ•°ï¼Œä¸€ä¸ªé—´éš”ä¸º1ç§’ï¼Œä¸€ä¸ªä¸º2ç§’ã€‚</p><ul><li><strong>åœ¨å¤´æ–‡ä»¶ä¸­å…ˆå£°æ˜void timerEvent(QTimerEvent* e)äº‹ä»¶</strong></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QtWidgets/QWidget&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_Qtcontrol.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Qtcontrol</span> : <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Qtcontrol</span>(QWidget *parent = Q_NULLPTR);</span><br><span class="line">   </span><br><span class="line">    <span class="comment">//é‡å†™å®šæ—¶å™¨äº‹ä»¶</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">timerEvent</span><span class="params">(QTimerEvent* e)</span></span>;</span><br><span class="line">    <span class="type">int</span> ID1;</span><br><span class="line">    <span class="type">int</span> ID2;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::QtcontrolClass ui;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><strong>åœ¨æºæ–‡ä»¶ä¸­å®ç°</strong></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Qtcontrol.h&quot;</span></span></span><br><span class="line">Qtcontrol::<span class="built_in">Qtcontrol</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QWidget</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line">    ui.<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//å¯åŠ¨å®šæ—¶å™¨</span></span><br><span class="line"> ID1=   <span class="built_in">startTimer</span>(<span class="number">1000</span>);<span class="comment">//å¯åŠ¨å®šæ—¶å™¨äº‹ä»¶,åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨å¹¶è¿”å›å®šæ—¶å™¨ID</span></span><br><span class="line"><span class="comment">//å‚æ•°ï¼šå•ä½æ¯«ç§’---æ¯éš”næ¯«ç§’æ—¶é—´ï¼Œå°±æ‰§è¡Œä¸€æ¬¡å®šæ—¶å™¨äº‹ä»¶</span></span><br><span class="line"><span class="comment">//è¿”å›å€¼ï¼šå®šæ—¶å™¨IDå·</span></span><br><span class="line"> ID2 = <span class="built_in">startTimer</span>(<span class="number">2000</span>);<span class="comment">//ä¸¤ç§’å¯åŠ¨ä¸€æ¬¡</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Qtcontrol::timerEvent</span><span class="params">(QTimerEvent* e)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (e-&gt;<span class="built_in">timerId</span>()==ID1)</span><br><span class="line">    &#123;</span><br><span class="line">   <span class="type">static</span> <span class="type">int</span> num = <span class="number">1</span>;</span><br><span class="line">    ui.label-&gt;<span class="built_in">setText</span>(QString::<span class="built_in">number</span>(num++));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (e-&gt;<span class="built_in">timerId</span>()==ID2)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> num = <span class="number">1</span>;</span><br><span class="line">        ui.label_2 -&gt;<span class="built_in">setText</span>(QString::<span class="built_in">number</span>(num++));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºæ‰€æœ‰çš„äº‹ä»¶éƒ½é‡å†™åœ¨äº†timerEventä¸­ï¼Œå› æ­¤å½“éœ€è¦å¤šä¸ªå®šæ—¶å™¨æ—¶ï¼Œå¯ä»¥ç”¨å®šæ—¶å™¨çš„IDå»å¯¹åº”timerEventä¸­çš„äº‹ä»¶ã€‚</p><h3 id="å®šæ—¶å™¨æ–¹å¼äºŒï¼šQTimerç±»ï¼ˆä¿¡å·ä¸æ§½ï¼‰"><a href="#å®šæ—¶å™¨æ–¹å¼äºŒï¼šQTimerç±»ï¼ˆä¿¡å·ä¸æ§½ï¼‰" class="headerlink" title="å®šæ—¶å™¨æ–¹å¼äºŒï¼šQTimerç±»ï¼ˆä¿¡å·ä¸æ§½ï¼‰"></a><font color="FF0000">å®šæ—¶å™¨æ–¹å¼äºŒï¼šQTimerç±»ï¼ˆä¿¡å·ä¸æ§½ï¼‰</font></h3><p><strong>éœ€è¦</strong> ï¼š #include <QTimer></p><p><strong>æ–¹å¼ï¼š</strong></p><ol><li>åˆ©ç”¨å®šæ—¶å™¨ç±»QTimer</li><li>åˆ›å»ºå®šæ—¶å™¨å¯¹è±¡ QTimer *timer&#x3D;new QTimer(this)</li><li>å¯åŠ¨å®šæ—¶å™¨timer-&gt;start( 500ï¼‰ &#x2F;&#x2F;å‚æ•°ï¼šæ¯éš”næ¯«ç§’å‘é€ä¸€ä¸ªä¿¡å·ï¼ˆtimeoutï¼‰</li><li>ç”¨connectè¿æ¥ä¿¡å·å’Œæ§½å‡½æ•°ï¼ˆè‡ªå®šä¹‰æ§½ï¼‰</li><li>æš‚åœ timer-&gt;stop</li></ol><p><strong>å®ä¾‹</strong>ï¼šå¯åŠ¨label æ¯éš”0.5ç§’è®¡æ—¶</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Qtcontrol.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;qtimer.h&quot;</span></span></span><br><span class="line">Qtcontrol::<span class="built_in">Qtcontrol</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QWidget</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line">    ui.<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">QTimer* timer = <span class="keyword">new</span> <span class="built_in">QTimer</span>(<span class="keyword">this</span>);</span><br><span class="line"><span class="comment">//å¯åŠ¨å®šæ—¶å™¨</span></span><br><span class="line">timer-&gt;<span class="built_in">start</span>(<span class="number">500</span>);<span class="comment">//æ¯éš”0.5ç§’ä¼šå‘ä¸€ä¸ªä¿¡å·</span></span><br><span class="line"><span class="built_in">connect</span>(timer, &amp;QTimer::timeout, [=]() &#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> num = <span class="number">1</span>;</span><br><span class="line">    ui.label-&gt;<span class="built_in">setText</span>(QString::<span class="built_in">number</span>(num++));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br><br><p><span style="color: red; font-size: 20px;">è½¬è½½è‡ªï¼š<a href="https://www.cnblogs.com/xyf327">å”¯æœ‰è‡ªå·±å¼ºå¤§</a>          å¦‚æœ‰ä¾µæƒï¼Œåœ¨ä¸‹æ–¹è¯„è®º  ç«‹åˆ»åˆ é™¤ã€‚</span></p>]]></content>
      
      
      <categories>
          
          <category> Qt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qtå­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt05å¤šçº¿ç¨‹å’Œçº¿ç¨‹æ± </title>
      <link href="/2025/03/13/Qt05%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B%E6%B1%A0/"/>
      <url>/2025/03/13/Qt05%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B%E6%B1%A0/</url>
      
        <content type="html"><![CDATA[<h3 id="ä¸€ï¼Œ-æœ€ç®€å•çš„å¤šçº¿ç¨‹QtConcurrent-run"><a href="#ä¸€ï¼Œ-æœ€ç®€å•çš„å¤šçº¿ç¨‹QtConcurrent-run" class="headerlink" title=" ä¸€ï¼Œ æœ€ç®€å•çš„å¤šçº¿ç¨‹QtConcurrent::run()"></a><font color="FF0000"> ä¸€ï¼Œ æœ€ç®€å•çš„å¤šçº¿ç¨‹QtConcurrent::run()</font></h3><ul><li><strong>å…¶å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š</strong></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">QFuture&lt;T&gt; <span class="title">QtConcurrent::run</span><span class="params">(Function function, ...)</span></span></span><br><span class="line"><span class="function">QFuture&lt;T&gt; <span class="title">QtConcurrent::run</span><span class="params">(QThreadPool *pool, Function function, ...)</span></span></span><br></pre></td></tr></table></figure><p>å‚æ•°functionéœ€è¦å¤–éƒ¨å‡½æ•°ï¼šï¼ˆæˆ–è€…lambdaå‡½æ•°ï¼‰ï¼Œåé¢ä¹Ÿå¯è·Ÿå¤–éƒ¨å‡½æ•°çš„å‚æ•°ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">extern</span> <span class="type">void</span> <span class="title">func</span><span class="params">(QString str)</span></span>;</span><br></pre></td></tr></table></figure><p><strong>QtConcurrent :: runï¼ˆï¼‰ä¹Ÿæ¥å—æŒ‡å‘æˆå‘˜å‡½æ•°çš„æŒ‡é’ˆ</strong>ã€‚ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªconstå¼•ç”¨æˆ–ä¸€ä¸ªæŒ‡å‘è¯¥ç±»å®ä¾‹çš„æŒ‡é’ˆã€‚constæˆå‘˜å‡½æ•°ä¸€èˆ¬ä¼ é€’ å¸¸é‡å¼•ç”¨ (const reference)ï¼Œè€Œéå¸¸é‡æˆå‘˜å‡½æ•°ä¸€èˆ¬ä¼ é€’ æŒ‡é’ˆ (pointer)</p><ul><li><strong>åœ¨VSç¯å¢ƒä¸­éœ€è¦å¼•ç”¨ï¼š</strong> <strong>#includeâ€QtConcurrent&#x2F;qtconcurrentrun.hâ€</strong></li></ul><p>ç®€å•çš„è¯´ï¼ŒQtConcurrent::run()å‡½æ•°ä¼šåœ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå¹¶ä¸”è¯¥çº¿ç¨‹å–è‡ªå…¨å±€QThreadPoolï¼Œè¯¥å‡½æ•°çš„è¿”å›å€¼é€šè¿‡QFuture APIæä¾›ã€‚<br>è¯·æ³¨æ„ï¼šè¯¥å‡½æ•°å¯èƒ½ä¸ä¼šç«‹å³è¿è¡Œ; å‡½æ•°åªæœ‰åœ¨çº¿ç¨‹å¯ç”¨æ—¶æ‰ä¼šè¿è¡Œã€‚é€šè¿‡QtConcurrent::run()è¿”å›çš„QFutureä¸æ”¯æŒå–æ¶ˆã€æš‚åœï¼Œè¿”å›çš„QFutureåªèƒ½ç”¨äºæŸ¥è¯¢å‡½æ•°çš„è¿è¡Œ&#x2F;å®ŒæˆçŠ¶æ€å’Œè¿”å›å€¼ã€‚</p><ul><li><strong>å®ä¾‹ï¼šå®ç°å¤šçº¿ç¨‹è€—æ—¶æ“ä½œï¼ˆè°ƒç”¨æˆå‘˜å‡½æ•°ï¼‰</strong></li></ul><p>åœ¨ä¸»ç¨‹åºthreadtest.hä¸­å£°æ˜æˆå‘˜å‡½æ•°ï¼ˆå¹¶æ·»åŠ å¼•ç”¨ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QtWidgets/QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_threadtest.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;workThread.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;qthread.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;QtConcurrent/qtconcurrentrun.h&quot;</span><span class="comment">//QtConcurrentå¼•ç”¨</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> execution_character_set(<span class="string">&quot;utf-8&quot;</span>)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Threadtest</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Threadtest</span>(QWidget *parent = Q_NULLPTR);</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::ThreadtestClass ui;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">work</span><span class="params">()</span></span>;<span class="comment">//æˆå‘˜å‡½æ•°</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸»ç¨‹åºthreadtest.cppä¸­è°ƒç”¨æˆå‘˜å‡½æ•°</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;threadtest.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;qdebug.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">Threadtest::<span class="built_in">Threadtest</span>(QWidget* parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line">    ui.<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="built_in">connect</span>(ui.btn_start, &amp;QPushButton::clicked, [=]()</span><br><span class="line">        &#123;        <span class="comment">//å°†æˆå‘˜å‡½æ•°æ”¾å…¥å‚æ•°ä¸­ï¼ˆæˆå‘˜å‡½æ•°éœ€è¦å¼•ç”¨æŒ‡é’ˆï¼‰</span></span><br><span class="line">            QtConcurrent::<span class="built_in">run</span>(<span class="keyword">this</span>, &amp;Threadtest::work);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Threadtest::work</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;å­çº¿ç¨‹è¿è¡Œï¼š&quot;</span> &lt;&lt; QThread::<span class="built_in">currentThreadId</span>();</span><br><span class="line">    QThread::<span class="built_in">sleep</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;å­çº¿ç¨‹ç»“æŸï¼š&quot;</span> &lt;&lt; QThread::<span class="built_in">currentThreadId</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç‚¹å‡»æŒ‰é’®å³å¯è§¦å‘å­çº¿ç¨‹è¿è¡Œã€‚</p><p><img src="https://bu.dusays.com/2025/03/13/67d2d70d1e369.png"></p><ul><li><strong>å®ä¾‹ï¼šå®ç°å¤šçº¿ç¨‹è€—æ—¶æ“ä½œï¼ˆè°ƒç”¨å¤–éƒ¨å‡½æ•°ï¼Œå¸¦å‚æ•°ï¼‰</strong></li></ul><p>åœ¨ä¸»ç¨‹åºthreadtest.hä¸­å£°æ˜å¤–éƒ¨å‡½æ•°</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QtWidgets/QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_threadtest.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;workThread.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;qthread.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;QtConcurrent/qtconcurrentrun.h&quot;</span><span class="comment">//QtConcurrentå¼•ç”¨</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> execution_character_set(<span class="string">&quot;utf-8&quot;</span>)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Threadtest</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Threadtest</span>(QWidget *parent = Q_NULLPTR);  </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::ThreadtestClass ui;</span><br><span class="line">  </span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="type">void</span> <span class="title">func</span><span class="params">(QString str)</span></span>;<span class="comment">//å¤–éƒ¨å‡½æ•°</span></span><br></pre></td></tr></table></figure><p>åœ¨ä¸»ç¨‹åºthreadtest.cppä¸­è°ƒç”¨å¤–éƒ¨å‡½æ•°</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;threadtest.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;qdebug.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">Threadtest::<span class="built_in">Threadtest</span>(QWidget* parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line">    ui.<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="built_in">connect</span>(ui.btn_start, &amp;QPushButton::clicked, [=]()</span><br><span class="line">        &#123;</span><br><span class="line">            QtConcurrent::<span class="built_in">run</span>(func,<span class="built_in">QString</span>(<span class="string">&quot;extern&quot;</span>));</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br><span class="line"> <span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(QString str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;å­çº¿ç¨‹è¿è¡Œï¼š&quot;</span> &lt;&lt; QThread::<span class="built_in">currentThreadId</span>()&lt;&lt; str;</span><br><span class="line">    QThread::<span class="built_in">sleep</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;å­çº¿ç¨‹ç»“æŸï¼š&quot;</span> &lt;&lt; QThread::<span class="built_in">currentThreadId</span>()&lt;&lt; str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/03/13/67d2d72cb57a3.png"></p><h3 id="äºŒï¼Œçº¿ç¨‹æ± "><a href="#äºŒï¼Œçº¿ç¨‹æ± " class="headerlink" title="äºŒï¼Œçº¿ç¨‹æ± "></a><font color="FF0000">äºŒï¼Œçº¿ç¨‹æ± </font></h3><h4 id="2-1-çº¿ç¨‹æ± åŸç†"><a href="#2-1-çº¿ç¨‹æ± åŸç†" class="headerlink" title="2.1 çº¿ç¨‹æ± åŸç†"></a><font color="FF0000">2.1 çº¿ç¨‹æ± åŸç†</font></h4><p>æˆ‘ä»¬ä½¿ç”¨çº¿ç¨‹çš„æ—¶å€™å°±å»åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™æ ·å®ç°èµ·æ¥éå¸¸ç®€ä¾¿ï¼Œä½†æ˜¯å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœå¹¶å‘çš„çº¿ç¨‹æ•°é‡å¾ˆå¤šï¼Œå¹¶ä¸”æ¯ä¸ªçº¿ç¨‹éƒ½æ˜¯æ‰§è¡Œä¸€ä¸ªæ—¶é—´å¾ˆçŸ­çš„ä»»åŠ¡å°±ç»“æŸäº†ï¼Œè¿™æ ·é¢‘ç¹åˆ›å»ºçº¿ç¨‹å°±ä¼šå¤§å¤§é™ä½ç³»ç»Ÿçš„æ•ˆç‡ï¼Œå› ä¸ºé¢‘ç¹åˆ›å»ºçº¿ç¨‹å’Œé”€æ¯çº¿ç¨‹éœ€è¦æ—¶é—´ã€‚</p><p>é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§åŠæ³•ä½¿å¾—çº¿ç¨‹å¯ä»¥å¤ç”¨ï¼Œå°±æ˜¯æ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶ä¸è¢«é”€æ¯ï¼Œè€Œæ˜¯å¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–çš„ä»»åŠ¡å‘¢ï¼Ÿ</p><p><strong>çº¿ç¨‹æ± </strong>æ˜¯ä¸€ç§å¤šçº¿ç¨‹å¤„ç†å½¢å¼ï¼Œ<strong>å¤„ç†è¿‡ç¨‹ä¸­å°†ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ï¼Œç„¶ååœ¨åˆ›å»ºçº¿ç¨‹åè‡ªåŠ¨å¯åŠ¨è¿™äº›ä»»åŠ¡</strong>ã€‚çº¿ç¨‹æ± çº¿ç¨‹éƒ½æ˜¯åå°çº¿ç¨‹ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½ä½¿ç”¨é»˜è®¤çš„å †æ ˆå¤§å°ï¼Œä»¥é»˜è®¤çš„ä¼˜å…ˆçº§è¿è¡Œï¼Œå¹¶å¤„äºå¤šçº¿ç¨‹å•å…ƒä¸­ã€‚å¦‚æœæŸä¸ªçº¿ç¨‹åœ¨æ‰˜ç®¡ä»£ç ä¸­ç©ºé—²ï¼ˆå¦‚æ­£åœ¨ç­‰å¾…æŸä¸ªäº‹ä»¶ï¼‰, åˆ™çº¿ç¨‹æ± å°†æ’å…¥å¦ä¸€ä¸ªè¾…åŠ©çº¿ç¨‹æ¥ä½¿æ‰€æœ‰å¤„ç†å™¨ä¿æŒç¹å¿™ã€‚å¦‚æœæ‰€æœ‰çº¿ç¨‹æ± çº¿ç¨‹éƒ½å§‹ç»ˆä¿æŒç¹å¿™ï¼Œä½†é˜Ÿåˆ—ä¸­åŒ…å«æŒ‚èµ·çš„å·¥ä½œï¼Œåˆ™çº¿ç¨‹æ± å°†åœ¨ä¸€æ®µæ—¶é—´ååˆ›å»ºå¦ä¸€ä¸ªè¾…åŠ©çº¿ç¨‹ä½†çº¿ç¨‹çš„æ•°ç›®æ°¸è¿œä¸ä¼šè¶…è¿‡æœ€å¤§å€¼ã€‚è¶…è¿‡æœ€å¤§å€¼çš„çº¿ç¨‹å¯ä»¥æ’é˜Ÿï¼Œä½†ä»–ä»¬è¦ç­‰åˆ°å…¶ä»–çº¿ç¨‹å®Œæˆåæ‰å¯åŠ¨ã€‚</p><p><img src="https://bu.dusays.com/2025/03/13/67d2d7749a097.png"></p><h4 id="2-2-QRunnable"><a href="#2-2-QRunnable" class="headerlink" title="2.2 QRunnable"></a><font color="FF0000">2.2 QRunnable</font></h4><p>åœ¨ Qt ä¸­ä½¿ç”¨çº¿ç¨‹æ± éœ€è¦å…ˆåˆ›å»ºä»»åŠ¡ï¼Œæ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­çš„æ¯ä¸€ä¸ªä»»åŠ¡éƒ½éœ€è¦æ˜¯ä¸€ä¸ª QRunnable ç±»å‹ï¼Œå› æ­¤åœ¨ç¨‹åºä¸­éœ€è¦åˆ›å»ºå­ç±»ç»§æ‰¿ QRunnable è¿™ä¸ªç±»ï¼Œç„¶åé‡å†™ run() æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸­ç¼–å†™è¦åœ¨çº¿ç¨‹æ± ä¸­æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶å°†è¿™ä¸ªå­ç±»å¯¹è±¡ä¼ é€’ç»™çº¿ç¨‹æ± ï¼Œè¿™æ ·ä»»åŠ¡å°±å¯ä»¥è¢«çº¿ç¨‹æ± ä¸­çš„æŸä¸ªå·¥ä½œçš„çº¿ç¨‹å¤„ç†æ‰äº†ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨å­ç±»ä¸­å¿…é¡»è¦é‡å†™çš„å‡½æ•°, é‡Œè¾¹æ˜¯ä»»åŠ¡çš„å¤„ç†æµç¨‹</span></span><br><span class="line">[pure <span class="keyword">virtual</span>] <span class="function"><span class="type">void</span> <span class="title">QRunnable::run</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‚æ•°è®¾ç½®ä¸º true: è¿™ä¸ªä»»åŠ¡å¯¹è±¡åœ¨çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¸­å¤„ç†å®Œæ¯•, è¿™ä¸ªä»»åŠ¡å¯¹è±¡å°±ä¼šè‡ªåŠ¨é”€æ¯</span></span><br><span class="line"><span class="comment">// å‚æ•°è®¾ç½®ä¸º false: è¿™ä¸ªä»»åŠ¡å¯¹è±¡åœ¨çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¸­å¤„ç†å®Œæ¯•, å¯¹è±¡éœ€è¦ç¨‹åºçŒ¿æ‰‹åŠ¨é”€æ¯</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QRunnable::setAutoDelete</span><span class="params">(<span class="type">bool</span> autoDelete)</span></span>;</span><br><span class="line"><span class="comment">// è·å–å½“å‰ä»»åŠ¡å¯¹è±¡çš„ææ„æ–¹å¼,è¿”å›true-&gt;è‡ªåŠ¨ææ„, è¿”å›false-&gt;æ‰‹åŠ¨ææ„</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">QRunnable::autoDelete</span><span class="params">()</span> <span class="type">const</span></span>;</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼šåˆ›å»ºä¸€ä¸ªè¦æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡ç±»ï¼Œå¤„ç†æ–¹å¼å¦‚ä¸‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyWork</span> : <span class="keyword">public</span> QObject, <span class="keyword">public</span> QRunnable</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">MyWork</span><span class="params">(QObject *parent = <span class="literal">nullptr</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ä»»åŠ¡æ‰§è¡Œå®Œæ¯•,è¯¥å¯¹è±¡è‡ªåŠ¨é”€æ¯</span></span><br><span class="line">        <span class="built_in">setAutoDelete</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">MyWork</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">override</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ MyWork ç±»æ˜¯ä¸€ä¸ªå¤šé‡ç»§æ‰¿ï¼Œå¦‚æœéœ€è¦åœ¨è¿™ä¸ªä»»åŠ¡ä¸­ä½¿ç”¨ Qt çš„ä¿¡å·æ§½æœºåˆ¶è¿›è¡Œæ•°æ®çš„ä¼ é€’å°±å¿…é¡»ç»§æ‰¿ QObject è¿™ä¸ªç±»ï¼Œå¦‚æœä¸ä½¿ç”¨ä¿¡å·æ§½ä¼ é€’æ•°æ®å°±å¯ä»¥ä¸ç»§æ‰¿äº†ï¼Œåªç»§æ‰¿ QRunnable å³å¯ã€‚</strong></p><h4 id="2-3-QThreadPool"><a href="#2-3-QThreadPool" class="headerlink" title="2.3 QThreadPool"></a><font color="FF0000">2.3 QThreadPool</font></h4><p>Qt ä¸­çš„ QThreadPool ç±»ç®¡ç†äº†ä¸€ç»„ QThreads, é‡Œè¾¹è¿˜ç»´æŠ¤äº†ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ã€‚QThreadPool ç®¡ç†å’Œå›æ”¶å„ä¸ª QThread å¯¹è±¡ï¼Œä»¥å¸®åŠ©å‡å°‘ä½¿ç”¨çº¿ç¨‹çš„ç¨‹åºä¸­çš„çº¿ç¨‹åˆ›å»ºæˆæœ¬ã€‚æ¯ä¸ªQtåº”ç”¨ç¨‹åºéƒ½æœ‰ä¸€ä¸ªå…¨å±€ QThreadPool å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ globalInstance() æ¥è®¿é—®å®ƒã€‚ä¹Ÿå¯ä»¥å•ç‹¬åˆ›å»ºä¸€ä¸ª QThreadPool å¯¹è±¡ä½¿ç”¨ã€‚</p><p>çº¿ç¨‹æ± å¸¸ç”¨çš„ API å‡½æ•°å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–å’Œè®¾ç½®çº¿ç¨‹ä¸­çš„æœ€å¤§çº¿ç¨‹ä¸ªæ•°</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">maxThreadCount</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">setMaxThreadCount</span><span class="params">(<span class="type">int</span> maxThreadCount)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»™çº¿ç¨‹æ± æ·»åŠ ä»»åŠ¡, ä»»åŠ¡æ˜¯ä¸€ä¸ª QRunnable ç±»å‹çš„å¯¹è±¡</span></span><br><span class="line"><span class="comment">// å¦‚æœçº¿ç¨‹æ± ä¸­æ²¡æœ‰ç©ºé—²çš„çº¿ç¨‹äº†, ä»»åŠ¡ä¼šæ”¾åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­, ç­‰å¾…çº¿ç¨‹å¤„ç†</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QThreadPool::start</span><span class="params">(QRunnable * runnable, <span class="type">int</span> priority = <span class="number">0</span>)</span></span>;</span><br><span class="line"><span class="comment">// å¦‚æœçº¿ç¨‹æ± ä¸­æ²¡æœ‰ç©ºé—²çš„çº¿ç¨‹äº†, ç›´æ¥è¿”å›å€¼, ä»»åŠ¡æ·»åŠ å¤±è´¥, ä»»åŠ¡ä¸ä¼šæ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">QThreadPool::tryStart</span><span class="params">(QRunnable * runnable)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çº¿ç¨‹æ± ä¸­è¢«æ¿€æ´»çš„çº¿ç¨‹çš„ä¸ªæ•°(æ­£åœ¨å·¥ä½œçš„çº¿ç¨‹ä¸ªæ•°)</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">QThreadPool::activeThreadCount</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°è¯•æ€§çš„å°†æŸä¸€ä¸ªä»»åŠ¡ä»çº¿ç¨‹æ± çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­åˆ é™¤, å¦‚æœä»»åŠ¡å·²ç»å¼€å§‹æ‰§è¡Œå°±æ— æ³•åˆ é™¤äº†</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">QThreadPool::tryTake</span><span class="params">(QRunnable *runnable)</span></span>;</span><br><span class="line"><span class="comment">// å°†çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—é‡Œè¾¹æ²¡æœ‰å¼€å§‹å¤„ç†çš„æ‰€æœ‰ä»»åŠ¡åˆ é™¤, å¦‚æœå·²ç»å¼€å§‹å¤„ç†äº†å°±æ— æ³•é€šè¿‡è¯¥å‡½æ•°åˆ é™¤äº†</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QThreadPool::clear</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨æ¯ä¸ªQtåº”ç”¨ç¨‹åºä¸­éƒ½æœ‰ä¸€ä¸ªå…¨å±€çš„çº¿ç¨‹æ± å¯¹è±¡, é€šè¿‡è¿™ä¸ªå‡½æ•°ç›´æ¥è®¿é—®è¿™ä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="type">static</span> QThreadPool * <span class="title">QThreadPool::globalInstance</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨ Qt ç¨‹åºä¸­åˆ›å»ºçº¿ç¨‹æ± å¯¹è±¡ï¼Œç›´æ¥ä½¿ç”¨ Qt ä¸ºæ¯ä¸ªåº”ç”¨ç¨‹åºæä¾›çš„çº¿ç¨‹æ± å…¨å±€å¯¹è±¡å³å¯ã€‚å¾—åˆ°çº¿ç¨‹æ± å¯¹è±¡ä¹‹åï¼Œè°ƒç”¨ start() æ–¹æ³•å°±å¯ä»¥å°†ä¸€ä¸ªä»»åŠ¡æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­ï¼Œè¿™ä¸ªä»»åŠ¡å°±å¯ä»¥è¢«çº¿ç¨‹æ± å†…éƒ¨çš„çº¿ç¨‹æ± å¤„ç†æ‰äº†ï¼Œä½¿ç”¨çº¿ç¨‹æ± æ¯”è‡ªå·±åˆ›å»ºçº¿ç¨‹çš„è¿™ç§å¤šç§å¤šçº¿ç¨‹æ–¹å¼æ›´åŠ ç®€å•å’Œæ˜“äºç»´æŠ¤ã€‚</p><p><strong>å…·ä½“çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</strong></p><ul><li><strong>mywork.h</strong></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyWork</span> :<span class="keyword">public</span> QRunnable</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">MyWork</span><span class="params">()</span></span>;</span><br><span class="line">    ~<span class="built_in">MyWork</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>mywork.cpp</strong></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MyWork::<span class="built_in">MyWork</span>() : <span class="built_in">QRunnable</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ä»»åŠ¡æ‰§è¡Œå®Œæ¯•,è¯¥å¯¹è±¡è‡ªåŠ¨é”€æ¯</span></span><br><span class="line">    <span class="built_in">setAutoDelete</span>(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MyWork::run</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ä¸šåŠ¡å¤„ç†ä»£ç </span></span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>mainwindow.cpp</strong></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">MainWindow::<span class="built_in">MainWindow</span>(QWidget *parent) :</span><br><span class="line">    <span class="built_in">QMainWindow</span>(parent),</span><br><span class="line">    <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::MainWindow)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çº¿ç¨‹æ± åˆå§‹åŒ–ï¼Œè®¾ç½®æœ€å¤§çº¿ç¨‹æ± æ•°</span></span><br><span class="line">    QThreadPool::<span class="built_in">globalInstance</span>()-&gt;<span class="built_in">setMaxThreadCount</span>(<span class="number">4</span>);</span><br><span class="line">    <span class="comment">// æ·»åŠ ä»»åŠ¡</span></span><br><span class="line">    MyWork* task = <span class="keyword">new</span> MyWork;</span><br><span class="line">    QThreadPool::<span class="built_in">globalInstance</span>()-&gt;<span class="built_in">start</span>(task);    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±æ­¤çœ‹è§ï¼Œçº¿ç¨‹æ± çš„æ“ä½œå’ŒQThreadçš„runé‡å†™ç±»ä¼¼ã€‚<strong>ä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥æœ€å¤§é™åº¦çš„åˆ©ç”¨çº¿ç¨‹ï¼Œå‡å°‘èµ„æºçš„æµªè´¹</strong></p><p><strong>æ¯”å¦‚æˆ‘ä»¬éœ€è¦åŒæ—¶å¤„ç†ä¸‰ä¸ªäº‹ä»¶</strong>ï¼šç”Ÿæˆéšæœºæ•°ï¼Œå†’æ³¡æ’åºï¼Œå¿«é€Ÿæ’åºï¼ˆå…ˆç”Ÿæˆéšæœºæ•°ï¼Œç„¶åå†å¯¹å…¶åŒæ—¶è¿›è¡Œå†’æ³¡æ’åºå’Œå¿«é€Ÿæ’åºï¼‰</p><p>ç”¨QThreadçš„runé‡å†™çš„è¯ï¼Œéœ€è¦å¼€å¯ä¸‰ä¸ªçº¿ç¨‹ã€‚</p><p>ä½†æ˜¯ç”¨çº¿ç¨‹æ± çš„è¯ï¼Œå®ƒå¯ä»¥æ ¹æ®äº‹ä»¶çš„é•¿çŸ­ï¼Œï¼ˆå°†ç”Ÿæˆéšæœºæ•°å’Œå†’æ³¡æ’åºæ”¾åœ¨åŒä¸€ä¸ªçº¿ç¨‹å»å¤„ç†ï¼‰åªéœ€è¦å¼€å¯ä¸¤ä¸ªçº¿ç¨‹å³å¯ã€‚</p><br><br><br><p><span style="color: red; font-size: 20px;">è½¬è½½è‡ªï¼š<a href="https://www.cnblogs.com/xyf327">å”¯æœ‰è‡ªå·±å¼ºå¤§</a>          å¦‚æœ‰ä¾µæƒï¼Œåœ¨ä¸‹æ–¹è¯„è®º  ç«‹åˆ»åˆ é™¤ã€‚</span></p>]]></content>
      
      
      <categories>
          
          <category> Qt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt04å¤šçº¿ç¨‹</title>
      <link href="/2025/03/13/Qt04%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
      <url>/2025/03/13/Qt04%E5%A4%9A%E7%BA%BF%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h3 id="ä¸€ã€çŸ¥è¯†å›é¡¾"><a href="#ä¸€ã€çŸ¥è¯†å›é¡¾" class="headerlink" title="ä¸€ã€çŸ¥è¯†å›é¡¾"></a><font color="FF0000">ä¸€ã€çŸ¥è¯†å›é¡¾</font></h3><p><strong>1ï¼Œä¸ºä»€ä¹ˆéœ€è¦å¤šçº¿ç¨‹ï¼Ÿ</strong></p><ul><li><font color="FF0000">ä»è®¡ç®—æœºåº•å±‚æ¥è¯´</font>ï¼š çº¿ç¨‹å¯ä»¥æ¯”ä½œæ˜¯è½»é‡çº§çš„è¿›ç¨‹ï¼Œæ˜¯ç¨‹åºæ‰§è¡Œçš„æœ€å°å•ä½,çº¿ç¨‹é—´çš„åˆ‡æ¢å’Œè°ƒåº¦çš„æˆæœ¬è¿œè¿œå°äºè¿›ç¨‹ã€‚å¦å¤–ï¼Œå¤šæ ¸ CPU æ—¶ä»£æ„å‘³ç€å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è¿è¡Œï¼Œè¿™å‡å°‘äº†çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€ã€‚ </li><li><font color="FF0000">ä»å½“ä»£äº’è”ç½‘å‘å±•è¶‹åŠ¿æ¥è¯´</font><strong>ï¼š</strong> ç°åœ¨çš„ç³»ç»ŸåŠ¨ä¸åŠ¨å°±è¦æ±‚ç™¾ä¸‡çº§ç”šè‡³åƒä¸‡çº§çš„å¹¶å‘é‡ï¼Œè€Œå¤šçº¿ç¨‹å¹¶å‘ç¼–ç¨‹æ­£æ˜¯å¼€å‘é«˜å¹¶å‘ç³»ç»Ÿçš„åŸºç¡€ï¼Œåˆ©ç”¨å¥½å¤šçº¿ç¨‹æœºåˆ¶å¯ä»¥å¤§å¤§æé«˜ç³»ç»Ÿæ•´ä½“çš„å¹¶å‘èƒ½åŠ›ä»¥åŠæ€§èƒ½ã€‚</li></ul><p>å†æ·±å…¥åˆ°è®¡ç®—æœºåº•å±‚æ¥æ¢è®¨ï¼š</p><ul><li><font color="FF0000">å•æ ¸æ—¶ä»£</font>ï¼šåœ¨å•æ ¸æ—¶ä»£å¤šçº¿ç¨‹ä¸»è¦æ˜¯ä¸ºäº†æé«˜ CPU å’Œ IO è®¾å¤‡çš„ç»¼åˆåˆ©ç”¨ç‡ã€‚ä¸¾ä¸ªä¾‹å­ï¼šå½“åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„æ—¶å€™ä¼šå¯¼è‡´ CPU è®¡ç®—æ—¶ï¼ŒIO è®¾å¤‡ç©ºé—²ï¼›è¿›è¡Œ IO æ“ä½œæ—¶ï¼ŒCPU ç©ºé—²ã€‚æˆ‘ä»¬å¯ä»¥ç®€å•åœ°è¯´è¿™ä¸¤è€…çš„åˆ©ç”¨ç‡ç›®å‰éƒ½æ˜¯ 50%å·¦å³ã€‚ä½†æ˜¯å½“æœ‰ä¸¤ä¸ªçº¿ç¨‹çš„æ—¶å€™å°±ä¸ä¸€æ ·äº†ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ CPU è®¡ç®—æ—¶ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¿›è¡Œ IO æ“ä½œï¼Œè¿™æ ·ä¸¤ä¸ªçš„åˆ©ç”¨ç‡å°±å¯ä»¥åœ¨ç†æƒ³æƒ…å†µä¸‹è¾¾åˆ° 100%äº†ã€‚ </li><li><font color="FF0000">å¤šæ ¸æ—¶ä»£</font>: å¤šæ ¸æ—¶ä»£å¤šçº¿ç¨‹ä¸»è¦æ˜¯ä¸ºäº†æé«˜ CPU åˆ©ç”¨ç‡ã€‚ä¸¾ä¸ªä¾‹å­ï¼šå‡å¦‚æˆ‘ä»¬è¦è®¡ç®—ä¸€ä¸ªå¤æ‚çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬åªç”¨ä¸€ä¸ªçº¿ç¨‹çš„è¯ï¼ŒCPU åªä¼šä¸€ä¸ª CPU æ ¸å¿ƒè¢«åˆ©ç”¨åˆ°ï¼Œè€Œåˆ›å»ºå¤šä¸ªçº¿ç¨‹å°±å¯ä»¥è®©å¤šä¸ª CPU æ ¸å¿ƒè¢«åˆ©ç”¨åˆ°ï¼Œè¿™æ ·å°±æé«˜äº† CPU çš„åˆ©ç”¨ç‡ã€‚</li></ul><p><strong>2ï¼Œè¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼š</strong></p><p>è¿›ç¨‹ï¼šä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºï¼Œæ‹¥æœ‰ç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œè¦å’Œå…¶ä»–è¿›ç¨‹é€šä¿¡ï¼Œéœ€è¦ä½¿ç”¨è¿›ç¨‹é€šä¿¡çš„æœºåˆ¶ã€‚</p><p>çº¿ç¨‹ï¼šæ²¡æœ‰è‡ªå·±çš„èµ„æºï¼Œéƒ½æ˜¯å…±äº«è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œå¤šä¸ªçº¿ç¨‹é€šä¿¡å­˜åœ¨éšæ‚£ã€‚</p><p>PSï¼šåœ¨æ“ä½œç³»ç»Ÿæ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æ‹¥æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´ï¼Œçº¿ç¨‹çš„å¼€é”€è¿œå°äºè¿›ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰å¤šä¸ªçº¿ç¨‹ã€‚ï¼ˆå› æ­¤æˆ‘ä»¬å¸¸ç”¨å¤šçº¿ç¨‹å¹¶å‘ï¼Œè€Œéå¤šè¿›ç¨‹å¹¶å‘ï¼‰</p><p>ä¸ºäº†æ›´å®¹æ˜“ç†è§£å¤šçº¿ç¨‹çš„ä½œç”¨ï¼Œå…ˆçœ‹ä¸€ä¸ªå®ä¾‹ï¼š</p><p>åœ¨ä¸»çº¿ç¨‹ä¸­è¿è¡Œä¸€ä¸ª10sè€—æ—¶çš„æ“ä½œã€‚ï¼ˆé€šè¿‡æŒ‰é’®æ¥è§¦å‘ï¼‰</p><p><img src="https://bu.dusays.com/2025/03/13/67d28d3da16f3.png"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;threadtest.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;qthread.h&quot;</span></span></span><br><span class="line">Threadtest::<span class="built_in">Threadtest</span>(QWidget* parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line">    ui.<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="built_in">connect</span>(ui.btn_start, &amp;QPushButton::clicked, <span class="keyword">this</span>,  </span><br><span class="line">            &amp;Threadtest::on_pushButton_clicked);</span><br><span class="line">        </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Threadtest::on_pushButton_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QThread::<span class="built_in">sleep</span>(<span class="number">10</span>);<span class="comment">//ä¸»çº¿ç¨‹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæ•´ä¸ªçº¿ç¨‹éƒ½åœ¨å“åº”10ç§’çš„è€—æ—¶æ“ä½œï¼Œå¯¹äºçº¿ç¨‹çš„æ¶ˆæ¯å¾ªç¯exec()å‡½æ•°å°±æœªå“åº”äº†ï¼ˆå°±æ˜¯ä½ åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ‹–åŠ¨ç•Œé¢æ˜¯æ— ååº”çš„ï¼‰</p><p><img src="https://bu.dusays.com/2025/03/13/67d28db830489.png"></p><h3 id="äºŒã€çº¿ç¨‹ç±»QThread"><a href="#äºŒã€çº¿ç¨‹ç±»QThread" class="headerlink" title="äºŒã€çº¿ç¨‹ç±»QThread"></a><font color="FF0000">äºŒã€çº¿ç¨‹ç±»QThread</font></h3><p>Qt ä¸­æä¾›äº†ä¸€ä¸ªçº¿ç¨‹ç±»ï¼Œé€šè¿‡è¿™ä¸ªç±»å°±å¯ä»¥åˆ›å»ºå­çº¿ç¨‹äº†ï¼ŒQt ä¸­ä¸€å…±æä¾›äº†ä¸¤ç§åˆ›å»ºå­çº¿ç¨‹çš„æ–¹å¼ï¼Œåè¾¹ä¼šä¾æ¬¡ä»‹ç»å…¶ä½¿ç”¨æ–¹å¼ã€‚å…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªç±»ä¸­æä¾›çš„ä¸€äº›å¸¸ç”¨ API å‡½æ•°ï¼š</p><ul><li><strong>2.1 å¸¸ç”¨å…±ç”¨æˆå‘˜å‡½æ•°</strong></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// QThread ç±»å¸¸ç”¨ API</span></span><br><span class="line"><span class="comment">// æ„é€ å‡½æ•°</span></span><br><span class="line">QThread::<span class="built_in">QThread</span>(QObject *parent = Q_NULLPTR);</span><br><span class="line"><span class="comment">// åˆ¤æ–­çº¿ç¨‹ä¸­çš„ä»»åŠ¡æ˜¯ä¸æ˜¯å¤„ç†å®Œæ¯•äº†</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">QThread::isFinished</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line"><span class="comment">// åˆ¤æ–­å­çº¿ç¨‹æ˜¯ä¸æ˜¯åœ¨æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">QThread::isRunning</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Qtä¸­çš„çº¿ç¨‹å¯ä»¥è®¾ç½®ä¼˜å…ˆçº§</span></span><br><span class="line"><span class="comment">// å¾—åˆ°å½“å‰çº¿ç¨‹çš„ä¼˜å…ˆçº§</span></span><br><span class="line"><span class="function">Priority <span class="title">QThread::priority</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QThread::setPriority</span><span class="params">(Priority priority)</span></span>;</span><br><span class="line">ä¼˜å…ˆçº§:</span><br><span class="line">    QThread::IdlePriority        --&gt; æœ€ä½çš„ä¼˜å…ˆçº§</span><br><span class="line">    QThread::LowestPriority</span><br><span class="line">    QThread::LowPriority</span><br><span class="line">    QThread::NormalPriority</span><br><span class="line">    QThread::HighPriority</span><br><span class="line">    QThread::HighestPriority</span><br><span class="line">    QThread::TimeCriticalPriority</span><br><span class="line">    QThread::InheritPriority    --&gt; æœ€é«˜çš„ä¼˜å…ˆçº§, é»˜è®¤æ˜¯è¿™ä¸ª</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// é€€å‡ºçº¿ç¨‹, åœæ­¢åº•å±‚çš„äº‹ä»¶å¾ªç¯</span></span><br><span class="line"><span class="comment">// é€€å‡ºçº¿ç¨‹çš„å·¥ä½œå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QThread::exit</span><span class="params">(<span class="type">int</span> returnCode = <span class="number">0</span>)</span></span>;</span><br><span class="line"><span class="comment">// è°ƒç”¨çº¿ç¨‹é€€å‡ºå‡½æ•°ä¹‹å, çº¿ç¨‹ä¸ä¼šé©¬ä¸Šé€€å‡ºå› ä¸ºå½“å‰ä»»åŠ¡æœ‰å¯èƒ½è¿˜æ²¡æœ‰å®Œæˆ, è°ƒå›ç”¨è¿™ä¸ªå‡½æ•°æ˜¯</span></span><br><span class="line"><span class="comment">// ç­‰å¾…ä»»åŠ¡å®Œæˆ, ç„¶åé€€å‡ºçº¿ç¨‹, ä¸€èˆ¬æƒ…å†µä¸‹ä¼šåœ¨ exit() åè¾¹è°ƒç”¨è¿™ä¸ªå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">QThread::wait</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> time = ULONG_MAX)</span></span>;</span><br></pre></td></tr></table></figure><ul><li><strong>2.2 ä¿¡å·æ§½</strong></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å’Œè°ƒç”¨ exit() æ•ˆæœæ˜¯ä¸€æ ·çš„</span></span><br><span class="line"><span class="comment">// è°ƒç”¨è¿™ä¸ªå‡½æ•°ä¹‹å, å†è°ƒç”¨ wait() å‡½æ•°</span></span><br><span class="line">[slot] <span class="function"><span class="type">void</span> <span class="title">QThread::quit</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// å¯åŠ¨å­çº¿ç¨‹</span></span><br><span class="line">[slot] <span class="function"><span class="type">void</span> <span class="title">QThread::start</span><span class="params">(Priority priority = InheritPriority)</span></span>;</span><br><span class="line"><span class="comment">// çº¿ç¨‹é€€å‡º, å¯èƒ½æ˜¯ä¼šé©¬ä¸Šç»ˆæ­¢çº¿ç¨‹, ä¸€èˆ¬æƒ…å†µä¸‹ä¸ä½¿ç”¨è¿™ä¸ªå‡½æ•°</span></span><br><span class="line">[slot] <span class="function"><span class="type">void</span> <span class="title">QThread::terminate</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çº¿ç¨‹ä¸­æ‰§è¡Œçš„ä»»åŠ¡å®Œæˆäº†, å‘å‡ºè¯¥ä¿¡å·</span></span><br><span class="line"><span class="comment">// ä»»åŠ¡å‡½æ•°ä¸­çš„å¤„ç†é€»è¾‘æ‰§è¡Œå®Œæ¯•äº†</span></span><br><span class="line">[signal] <span class="function"><span class="type">void</span> <span class="title">QThread::finished</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// å¼€å§‹å·¥ä½œä¹‹å‰å‘å‡ºè¿™ä¸ªä¿¡å·, ä¸€èˆ¬ä¸ä½¿ç”¨</span></span><br><span class="line">[signal] <span class="function"><span class="type">void</span> <span class="title">QThread::started</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><ul><li><strong>2.3é™æ€å‡½æ•°</strong></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿”å›ä¸€ä¸ªæŒ‡å‘ç®¡ç†å½“å‰æ‰§è¡Œçº¿ç¨‹çš„QThreadçš„æŒ‡é’ˆ</span></span><br><span class="line">[<span class="type">static</span>] <span class="function">QThread *<span class="title">QThread::currentThread</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// è¿”å›å¯ä»¥åœ¨ç³»ç»Ÿä¸Šè¿è¡Œçš„ç†æƒ³çº¿ç¨‹æ•° == å’Œå½“å‰ç”µè„‘çš„ CPU æ ¸å¿ƒæ•°ç›¸åŒ</span></span><br><span class="line">[<span class="type">static</span>] <span class="function"><span class="type">int</span> <span class="title">QThread::idealThreadCount</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// çº¿ç¨‹ä¼‘çœ å‡½æ•°</span></span><br><span class="line">[<span class="type">static</span>] <span class="function"><span class="type">void</span> <span class="title">QThread::msleep</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> msecs)</span></span>;    <span class="comment">// å•ä½: æ¯«ç§’</span></span><br><span class="line">[<span class="type">static</span>] <span class="function"><span class="type">void</span> <span class="title">QThread::sleep</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> secs)</span></span>;    <span class="comment">// å•ä½: ç§’</span></span><br><span class="line">[<span class="type">static</span>] <span class="function"><span class="type">void</span> <span class="title">QThread::usleep</span><span class="params">(<span class="type">unsigned</span> <span class="type">long</span> usecs)</span></span>;    <span class="comment">// å•ä½: å¾®ç§’</span></span><br></pre></td></tr></table></figure><h3 id="ä¸‰ã€Qtä¸­å®ç°å¤šçº¿ç¨‹çš„ä¸¤ç§æ–¹æ³•"><a href="#ä¸‰ã€Qtä¸­å®ç°å¤šçº¿ç¨‹çš„ä¸¤ç§æ–¹æ³•" class="headerlink" title="ä¸‰ã€Qtä¸­å®ç°å¤šçº¿ç¨‹çš„ä¸¤ç§æ–¹æ³•"></a><font color="FF0000">ä¸‰ã€Qtä¸­å®ç°å¤šçº¿ç¨‹çš„ä¸¤ç§æ–¹æ³•</font></h3><p><strong>ğŸ§¡ğŸ§¡3.1.æ´¾ç”ŸQThreadç±»å¯¹è±¡çš„æ–¹æ³•ï¼ˆé‡å†™Runå‡½æ•°ï¼‰</strong></p><p>é¦–å…ˆï¼Œä»¥æ–‡å­—å½¢å¼æ¥è¯´æ˜éœ€è¦å“ªå‡ ä¸ªæ­¥éª¤ã€‚</p><ol><li>è‡ªå®šä¹‰ä¸€ä¸ªè‡ªå·±çš„ç±»ï¼Œä½¿å…¶ç»§æ‰¿è‡ªQThreadç±»ï¼›</li><li>åœ¨è‡ªå®šä¹‰ç±»ä¸­è¦†å†™QThreadç±»ä¸­çš„è™šå‡½æ•°run()ã€‚</li></ol><p>è¿™å¾ˆå¯èƒ½å°±æ˜¯C++ä¸­å¤šæ€çš„ä½¿ç”¨ã€‚è¡¥å……ä¸€ç‚¹ï¼šQThreadç±»ç»§æ‰¿è‡ªQObjectç±»ã€‚</p><p>è¿™é‡Œè¦é‡ç‚¹è¯´ä¸€ä¸‹run()å‡½æ•°äº†ã€‚å®ƒä½œä¸ºçº¿ç¨‹çš„å…¥å£ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹ä»run()å¼€å§‹æ‰§è¡Œï¼Œæˆ‘ä»¬æ‰“ç®—åœ¨çº¿ç¨‹ä¸­å®Œæˆçš„å·¥ä½œéƒ½è¦å†™åœ¨run()å‡½æ•°ä¸­ï¼Œä¸ªäººè®¤ä¸ºå¯ä»¥æŠŠrun()å‡½æ•°ç†è§£ä¸ºçº¿ç¨‹å‡½æ•°ã€‚è¿™ä¹Ÿå°±æ˜¯å­ç±»è¦†å†™åŸºç±»çš„è™šå‡½æ•°ï¼ŒåŸºç±»QThreadçš„run()å‡½æ•°åªæ˜¯ç®€å•å¯åŠ¨exec()æ¶ˆæ¯å¾ªç¯ï¼Œå…³äºè¿™ä¸ªexec()åé¢æœ‰å¾ˆå¤šä¸œè¥¿è¦è®²ï¼Œè¯·åšå¥½å‡†å¤‡ã€‚<br>é‚£ä¹ˆæˆ‘ä»¬å°±æ¥å°è¯•ç”¨å¤šçº¿ç¨‹å®ç°10sè€—æ—¶çš„æ“ä½œï¼šï¼ˆç”¨æŒ‰é’®è§¦å‘)</p><ul><li><strong>1ï¸âƒ£åœ¨ç¼–è¾‘å¥½uiç•Œé¢åï¼Œå…ˆåˆ›å»ºä¸€ä¸ªworkThreadçš„ç±»ã€‚ï¼ˆç»§æ‰¿è‡ªQThreadç±»)</strong></li></ul><p><img src="https://bu.dusays.com/2025/03/13/67d2986e707f0.png"></p><ul><li>2ï¸âƒ£<strong>åœ¨workThread1çš„ç±»ä¸­é‡å†™runå‡½æ•°</strong></li></ul><p>åœ¨workThread.hçš„å£°æ˜runå‡½æ•°ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;qthread.h&gt;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">workThread</span> : <span class="keyword">public</span> QThread</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åœ¨workThread.cppä¸­é‡å†™runå‡½æ•°(å¹¶æ‰“å°å­çº¿ç¨‹çš„ID)ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;workThread.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;qdebug.h&quot;</span></span></span><br><span class="line">workThread::<span class="built_in">workThread</span>(QObject* parent)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//é‡å†™runå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">workThread::run</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;å½“å‰å­çº¿ç¨‹ID:&quot;</span> &lt;&lt; QThread::<span class="built_in">currentThreadId</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;å¼€å§‹æ‰§è¡Œçº¿ç¨‹&quot;</span>;</span><br><span class="line">    QThread::<span class="built_in">sleep</span>(<span class="number">10</span>);</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;çº¿ç¨‹ç»“æŸ&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>3ï¸âƒ£åœ¨ä¸»ç±»ä¸­å¯åŠ¨çº¿ç¨‹</strong></li></ul><p>threadtest.hä¸­å£°æ˜çº¿ç¨‹å’ŒæŒ‰é’®äº‹ä»¶</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QtWidgets/QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_threadtest.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;workThread.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> execution_character_set(<span class="string">&quot;utf-8&quot;</span>)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Threadtest</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Threadtest</span>(QWidget *parent = Q_NULLPTR);</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::ThreadtestClass ui;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">btn_clicked</span><span class="params">()</span></span>;</span><br><span class="line">workThread* thread;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>threadtest.cppä¸­å®ç°ï¼Œå¹¶å¯åŠ¨å­çº¿ç¨‹çº¿ç¨‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;threadtest.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;qthread.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;qdebug.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">Threadtest::<span class="built_in">Threadtest</span>(QWidget* parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line">    ui.<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="built_in">connect</span>(ui.btn_start, &amp;QPushButton::clicked, <span class="keyword">this</span>, &amp;Threadtest::btn_clicked);</span><br><span class="line">   thread = <span class="keyword">new</span> <span class="built_in">workThread</span>(<span class="keyword">this</span>);  </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Threadtest::btn_clicked</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;ä¸»çº¿ç¨‹idï¼š&quot;</span> &lt;&lt; QThread::<span class="built_in">currentThreadId</span>();</span><br><span class="line">    thread-&gt;<span class="built_in">start</span>();<span class="comment">//å¯åŠ¨å­çº¿ç¨‹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å®ç°ï¼Œåœ¨æ‰§è¡Œè€—æ—¶æ“ä½œæ—¶ä¹Ÿå¯æ‹–åŠ¨ç•Œé¢ã€‚</p><p><img src="https://bu.dusays.com/2025/03/13/67d28d3da16f3.png"></p><p><img src="https://bu.dusays.com/2025/03/13/67d298c015337.png"></p><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</strong></p><p><strong>åœ¨ä¸»ç¨‹åºä¸­æ·»åŠ workThreadç±»çš„å¤´æ–‡ä»¶æ—¶ï¼Œéœ€è¦å°†workThread.hæ”¾åœ¨threadtest.hä¸­ï¼ˆä¸ç„¶ä¼šæŠ¥é”™ï¼ï¼ï¼ï¼ï¼‰</strong></p><p><img src="https://bu.dusays.com/2025/03/13/67d298dace251.png"></p><p>ä½¿ç”¨QThread::currentThreadId()æ¥æŸ¥çœ‹å½“å‰çº¿ç¨‹çš„IDï¼Œæ— è®ºæ˜¯å­çº¿ç¨‹è¿˜æ˜¯ä¸»çº¿ç¨‹ï¼Œä¸åŒçº¿ç¨‹å…¶IDæ˜¯ä¸åŒçš„ã€‚æ³¨æ„ï¼Œè¿™æ˜¯ä¸€ä¸ªé™æ€å‡½æ•°ï¼Œå› æ­¤å¯ä»¥ä¸ç»è¿‡å¯¹è±¡æ¥è°ƒç”¨ã€‚</p><p><strong>åˆ›å»ºçš„workThread1ç±»çš„æ‰§è¡Œå®é™…ä¸Šæ˜¯åœ¨ä¸»çº¿ç¨‹é‡Œçš„ï¼Œåªæœ‰runå‡½æ•°å†…çš„ç¨‹åºæ‰ä¼šåœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œï¼ï¼ˆå³QThreadåªæ˜¯çº¿ç¨‹çš„ç®¡ç†ç±»ï¼Œåªæœ‰run()æ‰æ˜¯æˆ‘ä»¬çš„çº¿ç¨‹å‡½æ•°ï¼‰</strong></p><p>å› æ­¤åœ¨QThreadï¼ˆå³åˆ›å»ºçš„ç±»ï¼‰ä¸­çš„æˆå‘˜å˜é‡å±äºä¸»çº¿ç¨‹ï¼Œåœ¨è®¿é—®å‰éœ€è¦åˆ¤æ–­è®¿é—®æ˜¯å¦å®‰å…¨ã€‚runï¼ˆï¼‰ä¸­åˆ›å»ºçš„å˜é‡å±äºå­çº¿ç¨‹ã€‚</p><p>çº¿ç¨‹ä¹‹é—´å…±äº«å†…å­˜æ˜¯ä¸å®‰å…¨çš„ï¼ˆç”±äºå¤šçº¿ç¨‹äº‰å¤ºèµ„æºä¼šå½±å“æ•°æ®å®‰å…¨é—®é¢˜ï¼‰ï¼Œè§£å†³çš„åŠæ³•å°±æ˜¯è¦ä¸Šé”ã€‚</p><p><strong><p align = "center">å…³äºäº’æ–¥é”</p></strong></p><p>ä¸ªäººè®¤ä¸ºï¼Œexec()è¿™ä¸ªç‚¹å¤ªé‡è¦äº†ï¼ŒåŒæ—¶è¿˜ä¸å¤ªå®¹æ˜“ç†è§£ã€‚</p><p>æ¯”å¦‚ä¸‹é¢çš„ä»£ç ä¸­æœ‰ä¸¤ä¸ªexec()ï¼Œæˆ‘ä»¬è®²â€œä¸€å±±ä¸å®¹äºŒè™â€ï¼Œæ”¾åœ¨è¿™é‡Œå°±æ˜¯è¯´ï¼Œä¸€ä¸ªçº¿ç¨‹ä¸­ä¸èƒ½åŒæ—¶è¿è¡Œä¸¤ä¸ªexec()ï¼Œå¦åˆ™å°±ä¼šé€ æˆå¦ä¸€ä¸ªæ¶ˆæ¯å¾ªç¯å¾—ä¸åˆ°æ¶ˆæ¯ã€‚åƒQDialogæ¨¡æ€çª—å£ä¸­çš„exec()å°±æ˜¯å› ä¸ºåœ¨ä¸»çº¿ç¨‹ä¸­åŒæ—¶å¼€äº†ä¸¤ä¸ªexec()ï¼Œå¯¼è‡´ä¸»çª—å£çš„exec()æ¥æ”¶ä¸åˆ°ç”¨æˆ·çš„æ¶ˆæ¯äº†ã€‚ä½†æ˜¯ï¼ä½†æ˜¯ï¼ä½†æ˜¯ï¼æˆ‘ä»¬è¿™é‡Œå´æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰å‡ºç°åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œä¸€ä¸ªæ˜¯ä¸»çº¿ç¨‹ä¸­çš„exec()ï¼Œä¸€ä¸ªæ˜¯å­çº¿ç¨‹ä¸­çš„exec()ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QApplication&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QThread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDebug&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span>:<span class="keyword">public</span> QThread</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;child thread begin&quot;</span>&lt;&lt;endl;</span><br><span class="line">            <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;child thread&quot;</span>&lt;&lt;QThread::<span class="built_in">currentThreadId</span>()&lt;&lt;endl;</span><br><span class="line">            QThread::<span class="built_in">sleep</span>(<span class="number">5</span>);</span><br><span class="line">            <span class="built_in">qDebugu</span>()&lt;&lt;<span class="string">&quot;QThread end&quot;</span>&lt;&lt;endl;</span><br><span class="line">            <span class="keyword">this</span>-&gt;<span class="built_in">exec</span>();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span> ** argv)</span> <span class="comment">//mian()ä½œä¸ºä¸»çº¿ç¨‹</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QApplication <span class="title">app</span><span class="params">(argc,argv)</span></span>;</span><br><span class="line"> </span><br><span class="line">    MyThread thread; <span class="comment">//åˆ›å»ºä¸€ä¸ªQThreadæ´¾ç”Ÿç±»å¯¹è±¡å°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªå­çº¿ç¨‹</span></span><br><span class="line">    thread.<span class="built_in">start</span>(); <span class="comment">//å¯åŠ¨å­çº¿ç¨‹ï¼Œç„¶åä¼šè‡ªåŠ¨è°ƒç”¨çº¿ç¨‹å‡½æ•°run()</span></span><br><span class="line"> </span><br><span class="line">    <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;main thread&quot;</span>&lt;&lt;QThread::<span class="built_in">currentThreadId</span>()&lt;&lt;endl;</span><br><span class="line">    QThread::<span class="built_in">sleep</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="built_in">qDebugu</span>()&lt;&lt;<span class="string">&quot;main thread&quot;</span>&lt;&lt;QThread::<span class="built_in">currentThreadId</span>()&lt;&lt;endl;</span><br><span class="line"> </span><br><span class="line">    thread.<span class="built_in">quit</span>(); <span class="comment">//ä½¿ç”¨quit()æˆ–è€…exit()ä½¿å¾—å­çº¿ç¨‹èƒ½å¤Ÿé€€å‡ºæ¶ˆæ¯å¾ªç¯ï¼Œè€Œä¸è‡³äºé™·åœ¨å­çº¿ç¨‹ä¸­</span></span><br><span class="line">    thread.<span class="built_in">wait</span>(); <span class="comment">//ç­‰å¾…å­çº¿ç¨‹é€€å‡ºï¼Œç„¶åå›æ”¶èµ„æº</span></span><br><span class="line">                   <span class="comment">//thread.wait(5000); //è®¾å®šç­‰å¾…çš„æ—¶é—´</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> app.<span class="built_in">exec</span>();    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœrun()å‡½æ•°ä¸­æ²¡æœ‰æ‰§è¡Œexec()æ¶ˆæ¯å¾ªç¯å‡½æ•°ï¼Œé‚£ä¹ˆrun()æ‰§è¡Œå®Œäº†ä¹Ÿå°±æ„å‘³ç€å­çº¿ç¨‹é€€å‡ºäº†ã€‚ä¸€èˆ¬åœ¨å­çº¿ç¨‹é€€å‡ºçš„æ—¶å€™éœ€è¦ä¸»çº¿ç¨‹å»å›æ”¶èµ„æºï¼Œå¯ä»¥è°ƒç”¨QThreadçš„wait()ï¼Œä½¿ä¸»çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹é€€å‡ºï¼Œç„¶åå›æ”¶èµ„æºã€‚è¿™é‡Œwait()æ˜¯ä¸€ä¸ªé˜»å¡å‡½æ•°ï¼Œæœ‰ç‚¹åƒC++11ä¸­çš„join()å‡½æ•°ã€‚</p><p>ä½†æ˜¯ï¼ä½†æ˜¯ï¼ä½†æ˜¯ï¼run()å‡½æ•°ä¸­è°ƒç”¨äº†exec()å‡½æ•°ï¼Œexec()æ˜¯ä¸€ä¸ªæ¶ˆæ¯å¾ªç¯ï¼Œä¹Ÿå¯ä»¥å«åšäº‹ä»¶å¾ªç¯ï¼Œä¹Ÿæ˜¯ä¼šé˜»å¡çš„ï¼Œç›¸å½“äºä¸€ä¸ªæ­»å¾ªç¯ä½¿å­çº¿ç¨‹å¡åœ¨è¿™é‡Œæ°¸ä¸é€€å‡ºï¼Œå¿…é¡»è°ƒç”¨QThreadçš„quit()å‡½æ•°æˆ–è€…exit()å‡½æ•°æ‰å¯ä»¥ä½¿å­çº¿ç¨‹é€€å‡ºæ¶ˆæ¯å¾ªç¯ï¼Œå¹¶ä¸”æœ‰æ—¶è¿˜ä¸æ˜¯é©¬ä¸Šå°±é€€å‡ºï¼Œéœ€è¦ç­‰åˆ°CPUçš„æ§åˆ¶æƒäº¤ç»™çº¿ç¨‹çš„exec()ã€‚</p><p>æ‰€ä»¥å…ˆè¦thread.quit();ä½¿é€€å‡ºå­çº¿ç¨‹çš„æ¶ˆæ¯å¾ªç¯ï¼Œ ç„¶åthread.wait();åœ¨ä¸»çº¿ç¨‹ä¸­å›æ”¶å­çº¿ç¨‹çš„èµ„æºã€‚</p><p><strong>å€¼å¾—æ³¨æ„çš„æœ‰ä¸¤ç‚¹</strong>ï¼šå­çº¿ç¨‹çš„exet()æ¶ˆæ¯å¾ªç¯å¿…é¡»åœ¨run()å‡½æ•°ä¸­è°ƒç”¨ï¼›å¦‚æœæ²¡æœ‰æ¶ˆæ¯å¾ªç¯çš„è¯ï¼Œåˆ™æ²¡æœ‰å¿…è¦è°ƒç”¨quit( )æˆ–è€…exit()ï¼Œå› ä¸ºè°ƒç”¨äº†ä¹Ÿä¸ä¼šèµ·ä½œç”¨ã€‚</p><p>ç¬¬ä¸€ç§åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼éœ€è¦åœ¨run()ä¸­æ˜¾å¼è°ƒç”¨exec()ï¼Œä½†æ˜¯exec()æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Œç›®å‰è¿˜çœ‹ä¸å‡ºæ¥ï¼Œéœ€è¦åœ¨ç¬¬äºŒç§åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ä¸­æ‰èƒ½çŸ¥é“ã€‚</p><hr><p> <strong>ğŸ’œğŸ’œ3.2.ä½¿ç”¨ä¿¡å·ä¸æ§½æ–¹å¼æ¥å®ç°å¤šçº¿ç¨‹</strong></p><p> åˆšè®²å®Œä½¿ç”¨QThreadæ´¾ç”Ÿç±»å¯¹è±¡çš„æ–¹æ³•åˆ›å»ºçº¿ç¨‹ï¼Œç°åœ¨å°±è¦æ¥è¯´å®ƒä¸€ç‚¹åè¯ã€‚è¿™ç§æ–¹æ³•å­˜åœ¨ä¸€ä¸ªå±€é™æ€§ï¼Œåªæœ‰ä¸€ä¸ªrun()å‡½æ•°èƒ½å¤Ÿåœ¨çº¿ç¨‹ä¸­å»è¿è¡Œï¼Œä½†æ˜¯å½“æœ‰å¤šä¸ªå‡½æ•°åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­è¿è¡Œæ—¶ï¼Œå°±æ²¡åŠæ³•äº†ï¼Œè‡³å°‘å®ç°èµ·æ¥å¾ˆéº»çƒ¦ã€‚æ‰€ä»¥ï¼Œå½“å½“å½“å½“ï¼Œä¸‹é¢å°†ä»‹ç»ç¬¬äºŒç§åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ï¼š<strong>ä½¿ç”¨ä¿¡å·ä¸æ§½çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯æŠŠåœ¨çº¿ç¨‹ä¸­æ‰§è¡Œçš„å‡½æ•°ï¼ˆæˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸ºçº¿ç¨‹å‡½æ•°ï¼‰å®šä¹‰ä¸ºä¸€ä¸ªæ§½å‡½æ•°ã€‚</strong></p><p>ä»ç„¶æ˜¯é¦–å…ˆä»¥æ–‡å­—å½¢å¼è¯´æ˜è¿™ç§æ–¹æ³•çš„å‡ ä¸ªæ­¥éª¤ã€‚</p><ul><li>åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»(mywork)ï¼Œè®©è¿™ä¸ªç±»ä» QObject æ´¾ç”Ÿï¼Œåœ¨è¿™ä¸ªç±»ä¸­æ·»åŠ ä¸€ä¸ªå…¬å…±çš„æˆå‘˜å‡½æ•°(working)ï¼Œå‡½æ•°ä½“å°±æ˜¯æˆ‘ä»¬è¦å­çº¿ç¨‹ä¸­æ‰§è¡Œçš„ä¸šåŠ¡é€»è¾‘</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyWork</span>:<span class="keyword">public</span> QObject</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    .......</span><br><span class="line">    <span class="comment">// å‡½æ•°åè‡ªå·±æŒ‡å®š, å«ä»€ä¹ˆéƒ½å¯ä»¥, å‚æ•°å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚æ·»åŠ </span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">working</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»ºä¸€ä¸ª QThread å¯¹è±¡ï¼Œè¿™å°±æ˜¯å­çº¿ç¨‹çš„å¯¹è±¡</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">QThread* sub = <span class="keyword">new</span> QThread;</span><br></pre></td></tr></table></figure><ul><li>åœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»ºå·¥ä½œçš„ç±»å¯¹è±¡ï¼ˆåƒä¸‡ä¸è¦æŒ‡å®šç»™åˆ›å»ºçš„å¯¹è±¡æŒ‡å®šçˆ¶å¯¹è±¡ï¼‰</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MyWork* work = <span class="keyword">new</span> <span class="built_in">MyWork</span>(<span class="keyword">this</span>);    <span class="comment">// error</span></span><br><span class="line">MyWork* work = <span class="keyword">new</span> MyWork;          <span class="comment">// ok</span></span><br></pre></td></tr></table></figure><ul><li>å°† MyWork å¯¹è±¡ç§»åŠ¨åˆ°åˆ›å»ºçš„å­çº¿ç¨‹å¯¹è±¡ä¸­ï¼Œéœ€è¦è°ƒç”¨ QObject ç±»æä¾›çš„ moveToThread() æ–¹æ³•</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// void QObject::moveToThread(QThread *targetThread);</span></span><br><span class="line"><span class="comment">// å¦‚æœç»™workæŒ‡å®šäº†çˆ¶å¯¹è±¡, è¿™ä¸ªå‡½æ•°è°ƒç”¨å°±å¤±è´¥äº†</span></span><br><span class="line"><span class="comment">// æç¤ºï¼š QObject::moveToThread: Cannot move objects with a parent</span></span><br><span class="line">work-&gt;<span class="built_in">moveToThread</span>(sub);    <span class="comment">// ç§»åŠ¨åˆ°å­çº¿ç¨‹ä¸­å·¥ä½œ</span></span><br></pre></td></tr></table></figure><ul><li>å¯åŠ¨å­çº¿ç¨‹ï¼Œè°ƒç”¨ start(), è¿™æ—¶å€™çº¿ç¨‹å¯åŠ¨äº†ï¼Œä½†æ˜¯ç§»åŠ¨åˆ°çº¿ç¨‹ä¸­çš„å¯¹è±¡å¹¶æ²¡æœ‰å·¥ä½œ</li><li>è°ƒç”¨ MyWork ç±»å¯¹è±¡çš„å·¥ä½œå‡½æ•°ï¼Œè®©è¿™ä¸ªå‡½æ•°å¼€å§‹æ‰§è¡Œï¼Œè¿™æ—¶å€™æ˜¯åœ¨ç§»åŠ¨åˆ°çš„é‚£ä¸ªå­çº¿ç¨‹ä¸­è¿è¡Œçš„</li></ul><p><strong>ä»£ç å®ä¾‹ï¼š</strong></p><ul><li>1ï¸âƒ£<strong>åˆ›å»ºä¸€ä¸ªworkThreadçš„ç±»ã€‚ï¼ˆç»§æ‰¿è‡ªQThreadç±»ï¼‰</strong></li></ul><p>å®šä¹‰æ§½å‡½æ•°ï¼ˆ<strong>å­çº¿ç¨‹æ‰§è¡Œçš„ç¨‹åºéƒ½å¯ä»¥æ”¾åœ¨æ§½å‡½æ•°ä¸­</strong>ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//workThread.cppï¼ˆå…ˆåœ¨workThread.hä¸­å£°æ˜æ§½å‡½æ•°ï¼‰void workThread:: doWork()</span></span><br><span class="line">  &#123;</span><br><span class="line">      <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;å½“å‰çº¿ç¨‹ID:&quot;</span>&lt;&lt;QThread::<span class="built_in">currentThreadId</span>();</span><br><span class="line">      <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;å¼€å§‹æ‰§è¡Œ&quot;</span>;</span><br><span class="line">      QThread::<span class="built_in">sleep</span>(<span class="number">10</span>);    </span><br><span class="line">      <span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;ç»“æŸæ‰§è¡Œ&quot;</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><ul><li>2ï¸âƒ£<strong>ä¸»çº¿ç¨‹ä¸­åˆ†åˆ«å¯¹workThreadç±»å’ŒQTreadç±»å®ä¾‹åŒ–</strong></li></ul><p>åœ¨threadtest.hä¸­å£°æ˜</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QtWidgets/QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_threadtest.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;workThread.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;qthread.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> execution_character_set(<span class="string">&quot;utf-8&quot;</span>)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Threadtest</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Threadtest</span>(QWidget *parent = Q_NULLPTR);  </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::ThreadtestClass ui;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">btn_clicked</span><span class="params">()</span></span>;</span><br><span class="line">    workThread* thread; <span class="comment">//å®ä¾‹åŒ–workThreadç±»</span></span><br><span class="line">    QThread* qthread;   <span class="comment">//å®ä¾‹åŒ–QThreadç±»</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åœ¨threadtest.cppä¸­å®ç°<strong>å¹¶é€šè¿‡moveToThreadå°†è‡ªå·±æ”¾åˆ°çº¿ç¨‹QThreadå¯¹è±¡ä¸­ï¼Œæœ€åå¯åŠ¨çº¿ç¨‹</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;threadtest.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;qthread.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;qdebug.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">Threadtest::<span class="built_in">Threadtest</span>(QWidget* parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line">    ui.<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">   </span><br><span class="line">    <span class="comment">//ä¸èƒ½æŒ‡å®šè‡ªå®šä¹‰ç±»çš„å¯¹è±¡çš„çˆ¶ç±»ä¸ºwidgetï¼Œå³æ²¡æœ‰thisï¼ˆå¾ˆé‡è¦ï¼ï¼ï¼ï¼ï¼‰</span></span><br><span class="line">   thread = <span class="keyword">new</span> <span class="built_in">workThread</span>();  </span><br><span class="line">   qthread1 = <span class="keyword">new</span> <span class="built_in">QThread</span>(<span class="keyword">this</span>);</span><br><span class="line">   thread-&gt;<span class="built_in">moveToThread</span>(qthread1);</span><br><span class="line">   <span class="comment">//çº¿ç¨‹ç»“æŸæ—¶æ¸…ç†çº¿ç¨‹å†…å­˜</span></span><br><span class="line">   <span class="built_in">connect</span>(qthread1, &amp;QThread::finished, qthread1, &amp;QThread::deleteLater);</span><br><span class="line">   <span class="comment">//å°†æŒ‰é’®äº‹ä»¶ï¼ˆä¿¡å·ï¼‰ç»‘å®šæ§½å‡½æ•°</span></span><br><span class="line">   <span class="built_in">connect</span>(ui.btn_start, &amp;QPushButton::clicked, thread, &amp;workThread::dowork);</span><br><span class="line">   <span class="comment">//æ‰“å°ä¸»çº¿ç¨‹</span></span><br><span class="line">   <span class="built_in">connect</span>(ui.btn_start, &amp;QPushButton::clicked, [=]() &#123;</span><br><span class="line">       <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;ä¸»çº¿ç¨‹idï¼š&quot;</span> &lt;&lt; QThread::<span class="built_in">currentThreadId</span>();</span><br><span class="line">       &#125;);</span><br><span class="line">   <span class="comment">//çº¿ç¨‹å¯åŠ¨</span></span><br><span class="line">   qthread1-&gt;<span class="built_in">start</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿è¡Œæ§½å‡½æ•°æ—¶ï¼Œä¸èƒ½åœ¨æ­¤ç›´æ¥è°ƒç”¨ï¼ˆå¦‚ï¼šthread1-&gt;doWork()ï¼‰ã€‚è€Œæ˜¯ç”¨connectè¿æ¥ä¿¡å·å’Œæ§½</p><p>è¿™é‡Œå°†æ‰“å°ä¸»çº¿ç¨‹å’Œæ§½å‡½æ•°éƒ½ç»‘å®šåœ¨äº†buttonæŒ‰é’®çš„clickäº‹ä»¶ä¸Šäº†ã€‚</p><p><img src="https://bu.dusays.com/2025/03/13/67d28d3da16f3.png"></p><p><img src="https://bu.dusays.com/2025/03/13/67d2995e14e1b.png"></p><ul><li><strong>å­çº¿ç¨‹ä¸­ä¸èƒ½æ“ä½œUI</strong></li></ul><p>Qtåˆ›å»ºçš„å­çº¿ç¨‹ä¸­æ˜¯ä¸èƒ½å¯¹UIå¯¹è±¡è¿›è¡Œä»»ä½•æ“ä½œçš„ï¼Œå³QWidgetåŠå…¶æ´¾ç”Ÿç±»å¯¹è±¡ï¼Œè¿™ä¸ªæ˜¯æˆ‘æ‰çš„ç¬¬ä¸€ä¸ªå‘ã€‚å¯èƒ½æ˜¯ç”±äºè€ƒè™‘åˆ°å®‰å…¨æ€§çš„é—®é¢˜ï¼Œæ‰€ä»¥Qtä¸­å­çº¿ç¨‹ä¸èƒ½æ‰§è¡Œä»»ä½•å…³äºç•Œé¢çš„å¤„ç†ï¼ŒåŒ…æ‹¬æ¶ˆæ¯æ¡†çš„å¼¹å‡ºã€‚æ­£ç¡®çš„æ“ä½œåº”è¯¥æ˜¯é€šè¿‡ä¿¡å·æ§½ï¼Œå°†ä¸€äº›å‚æ•°ä¼ é€’ç»™ä¸»çº¿ç¨‹ï¼Œè®©ä¸»çº¿ç¨‹ï¼ˆä¹Ÿå°±æ˜¯Controllerï¼‰å»å¤„ç†ã€‚</p><ul><li><strong>è‡ªå®šä¹‰çš„ç±»ä¸èƒ½æŒ‡å®šçˆ¶å¯¹è±¡</strong></li></ul><p>æ¯”å¦‚ä¸Šé¢ç¨‹åºä¸­çš„ï¼šï¼ˆä¸èƒ½æŒ‡å®šè‡ªå®šä¹‰ç±»å¯¹è±¡ä¸ºwidgetï¼Œå³ä¸å¯ä»¥åŠ thisï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">thread1=<span class="keyword">new</span> <span class="built_in">workThread1</span>();<span class="comment">//åˆå§‹åŒ–</span></span><br></pre></td></tr></table></figure><ul><li><strong>QThreadå’Œconnectçš„å…³ç³»</strong></li></ul><p>æˆ‘ä»¬ä½¿ç”¨æœ€å¤šçš„æ˜¯QThreadäºconnectçš„å…³ç³»ï¼Œåœ¨ä½¿ç”¨connectå‡½æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šæŠŠæœ€åä¸€ä¸ªå‚æ•°å¿½ç•¥æ‰ã€‚è¿™æ—¶å€™æˆ‘ä»¬éœ€è¦çœ‹ä¸‹å‡½æ•°åŸå‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="type">static</span>] <span class="function">QMetaObject::Connection <span class="title">QObject::connect</span><span class="params">(<span class="type">const</span> QObject *sender, <span class="type">const</span> <span class="type">char</span> *signal, <span class="type">const</span> QObject *receiver, <span class="type">const</span> <span class="type">char</span> *method, Qt::ConnectionType type = Qt::AutoConnection)</span></span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæœ€åä¸€ä¸ªå‚æ•°ä»£è¡¨çš„æ˜¯è¿æ¥çš„æ–¹å¼ã€‚æˆ‘ä»¬ä¸€èˆ¬ä¼šç”¨åˆ°æ–¹å¼æ˜¯æœ‰ä¸‰ç§ï¼š</p><p><strong>è‡ªåŠ¨è¿æ¥(AutoConnection)</strong>ï¼šé»˜è®¤çš„è¿æ¥æ–¹å¼ã€‚å¦‚æœä¿¡å·ä¸æ§½ï¼Œä¹Ÿå°±æ˜¯å‘é€è€…ä¸æ¥å—è€…åœ¨åŒä¸€çº¿ç¨‹ï¼Œç­‰åŒäºç›´æ¥è¿æ¥ï¼›å¦‚æœå‘é€è€…ä¸æ¥å—è€…å¤„åœ¨ä¸åŒçº¿ç¨‹ï¼Œç­‰åŒäºé˜Ÿåˆ—è¿æ¥ã€‚</p><p><strong>ç›´æ¥è¿æ¥(Direct Connection)</strong>ï¼šå½“ä¿¡å·å‘å°„æ—¶ï¼Œæ§½å‡½æ•°å°†ç›´æ¥è¢«è°ƒç”¨ã€‚æ— è®ºæ§½å‡½æ•°æ‰€å±å¯¹è±¡åœ¨å“ªä¸ªçº¿ç¨‹ï¼Œæ§½å‡½æ•°éƒ½åœ¨å‘å°„è€…æ‰€åœ¨çº¿ç¨‹æ‰§è¡Œã€‚</p><p><strong>é˜Ÿåˆ—è¿æ¥(Queued Connection)</strong>ï¼šå½“æ§åˆ¶æƒå›åˆ°æ¥å—è€…æ‰€åœ¨çº¿ç¨‹çš„äº‹ä»¶å¾ªç¯å¼ï¼Œæ§½å‡½æ•°è¢«è°ƒç”¨ã€‚æ§½å‡½æ•°åœ¨æ¥æ”¶è€…æ‰€åœ¨çº¿ç¨‹æ‰§è¡Œã€‚</p><p><strong>å› æ­¤æˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</strong></p><ol><li>ä¸»çº¿ç¨‹å¯¹è±¡å‘å‡ºä¿¡å·è¿æ¥QThreadå­ç±»çš„æ§½å‡½æ•°ï¼ŒQThreadå­ç±»å¯¹è±¡åœ¨ä¸»çº¿ç¨‹åˆ›å»ºçš„ï¼Œæ— è®ºé‡‡ç”¨å“ªç§è¿æ¥æ–¹å¼ï¼Œæ§½å‡½æ•°éƒ½å±åœ¨ä¸»çº¿ç¨‹è°ƒç”¨ã€‚ï¼ˆå¦‚æœåœ¨é‡å†™çš„runå‡½æ•°ä¸­è°ƒç”¨äº†æ§½å‡½æ•°ï¼Œæ­¤æ—¶æ§½å‡½æ•°åœ¨æ¬¡çº¿ç¨‹æ‰§è¡Œï¼Œæ³¨æ„æ•°æ®å®‰å…¨ï¼‰ã€‚</li><li>æ¬¡çº¿ç¨‹runä¸­å‘å‡ºä¿¡å·ï¼Œæ§½å‡½æ•°å¯ä»¥æ˜¯å‘å‡ºä¿¡å·å¯¹è±¡è‡ªèº«çš„æ§½å‡½æ•°ï¼Œè‡ªå‘è‡ªæ”¶ï¼Œéƒ½æ˜¯æ¬¡çº¿ç¨‹ä¸­è¡Œã€‚æ§½å‡½æ•°æ˜¯QThreadå­ç±»çš„æ§½å‡½æ•°ï¼Œæˆ–è€…ä¸»çº¿ç¨‹ä¸­å¯¹è±¡çš„æ§½å‡½æ•°ï¼Œè¿™é‡Œçš„ç§æƒ…å†µéœ€è¦ä½ æŒ‡æ˜runä¸­connectä¸­çš„è¿æ¥æ–¹å¼ï¼Œç›´è¿åˆ™è¯¥æ§½å‡½æ•°åœ¨æ¬¡çº¿ç¨‹ä¸­æ‰§è¡Œï¼ˆå¯èƒ½å‘ç”Ÿæ•°æ®å®‰å…¨é—®é¢˜ï¼‰ï¼Œåˆ—é˜Ÿåˆ™åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œã€‚</li></ol><p><strong>ğŸ§¡ğŸ§¡æ€»ç»“ä¸€ä¸‹ï¼š</strong></p><ul><li>ä¸€å®šè¦ç”¨ä¿¡å·æ§½æœºåˆ¶ï¼Œåˆ«æƒ³ç€ç›´æ¥è°ƒç”¨ï¼Œä½ ä¼šå‘ç°å¹¶æ²¡æœ‰åœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œã€‚</li><li>è‡ªå®šä¹‰çš„ç±»ä¸èƒ½æŒ‡å®šçˆ¶å¯¹è±¡ï¼Œå› ä¸ºmoveToThreadå‡½æ•°ä¼šå°†çº¿ç¨‹å¯¹è±¡æŒ‡å®šä¸ºè‡ªå®šä¹‰çš„ç±»çš„çˆ¶å¯¹è±¡ï¼Œå½“è‡ªå®šä¹‰çš„ç±»å¯¹è±¡å·²ç»æœ‰äº†çˆ¶å¯¹è±¡ï¼Œå°±ä¼šæŠ¥é”™ã€‚</li><li>å½“ä¸€ä¸ªå˜é‡éœ€è¦åœ¨å¤šä¸ªçº¿ç¨‹é—´è¿›è¡Œè®¿é—®æ—¶ï¼Œæœ€å¥½åŠ ä¸Švoliateå…³é”®å­—ï¼Œä»¥å…è¯»å–åˆ°çš„æ˜¯æ—§çš„å€¼ã€‚å½“ç„¶ï¼ŒQtä¸­æä¾›äº†çº¿ç¨‹åŒæ­¥çš„æ”¯æŒï¼Œæ¯”å¦‚äº’æ–¥é”ä¹‹ç±»çš„ç©æ„ï¼Œä½¿ç”¨è¿™äº›æ–¹å¼æ¥è®¿é—®å˜é‡ä¼šæ›´åŠ å®‰å…¨ã€‚</li><li>åˆ†æå‘å‡ºä¿¡å·çš„å¯¹è±¡å’Œæ¥å—ä¿¡å·å¯¹è±¡æ‰€åœ¨çš„çº¿ç¨‹ï¼Œå†é€šè¿‡è¿æ¥æ–¹å¼ï¼Œåˆ¤æ–­æ§½å‡½æ•°åœ¨å“ªé‡Œæ‰§è¡Œã€‚ï¼ˆå°ç™½åœ¨ä½¿ç”¨ä¸­å°±æœ‰åœ¨runä¸­åˆ›å»ºå¯¹è±¡-å› ä¸ºå¤šéæ§½å‡½æ•°éƒ½éœ€è¦åœ¨æ¬¡çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œé€šè¿‡æŒ‡é’ˆå¼•å‡ºæ¥ï¼Œå†connectä¸å…¶ä»–æ¨¡å—äº¤äº’ï¼ŒæŒ‡æ˜è¿æ¥æ–¹å¼ä¸ºåˆ—é˜Ÿå½¢å¼ï¼Œæ‰€ä»¥ç›¸å…³æ‰§è¡Œéƒ½åœ¨æ¬¡çº¿ç¨‹ä¸­æ‰§è¡Œï¼‰ã€‚è¿™é‡Œè®°ä½moveToThreadåªèƒ½å°†æ§½å‡½æ•°ç§»åˆ°æ¬¡çº¿ç¨‹ä¸­ã€‚</li></ul><p><strong><p align = "center">å¯åŠ¨å¤šçº¿ç¨‹çš„æ“ä½œæ€è·¯</p></strong></p><p>å¦‚æœæˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªæ’åºæ“ä½œï¼Œå³é¦–å…ˆè·å–1000ä¸ªéšæœºæ•°ï¼Œç„¶åç”¨å†’æ³¡æ’åºæ³•å¯¹å…¶è¿›è¡Œæ’åºã€‚</p><p><strong>æ–¹æ³•ä¸€ï¼šé‡å†™runå‡½æ•°</strong></p><p> <strong>æ€è·¯ï¼šï¼ˆæ„å»ºä¸¤ä¸ªå­çº¿ç¨‹ï¼Œä¸€ä¸ªç”¨äºç”Ÿæˆéšæœºæ•°ï¼Œä¸€ä¸ªç”¨äºå†’æ³¡æ’åºï¼Œä¸»çº¿ç¨‹è´Ÿè´£è°ƒç”¨ï¼‰</strong></p><ul><li>æ–°å»ºmyThreadç±»ï¼Œåœ¨è¯¥ç±»ä¸­é‡å†™runå‡½æ•°ï¼ˆå³ç”Ÿéšæœºæ•°ï¼‰ã€‚éœ€è¦å…ˆæ¥æ”¶ä¸»çº¿ç¨‹å‘é€çš„è¦ç”Ÿæˆéšæœºæ•°çš„ä¸ªæ•°ï¼ˆscvnumä¿¡å·ï¼‰åå†è¿›è¡Œç”Ÿæˆï¼Œç”Ÿæˆå®Œæˆä»¥åå‘é€ä¸€ä¸ªsendArrayä¿¡å·</li><li>æ–°å»ºBubbleSortç±»ï¼Œåœ¨è¯¥ç±»ä¸­é‡å†™runå‡½æ•°ï¼ˆå³å†’æ³¡æ’åºç®—æ³•ï¼‰ã€‚éœ€è¦å…ˆæ¥æ”¶å·²ç»ç”Ÿæˆçš„éšæœºæ•°ï¼ˆrcvArrayä¿¡å·ï¼‰åå†è¿›è¡Œæ’åºï¼Œæ’åºå®Œæˆåå‘é€ä¸€ä¸ªfinishä¿¡å·</li><li>ä¸»çº¿ç¨‹é€šè¿‡statingä¿¡å·å‘Šè¯‰myThreadçº¿ç¨‹è¦ç”Ÿæˆçš„ä¸ªæ•°ï¼Œç„¶åmyThreadçº¿ç¨‹é€šè¿‡scvnumä¿¡å·æ¥æ”¶ï¼Œè¿›è¡Œç”Ÿæˆéšæœºæ•°ï¼Œç„¶åå†å‘é€ä¸€ä¸ªsendArrayä¿¡å·ï¼ˆå³ç”Ÿæˆéšæœºæ•°é›†åˆï¼‰</li><li>BubbleSortå­çº¿ç¨‹é€šè¿‡rcvArrayä¿¡å·æ¥æ”¶sendArrayä¿¡å·ï¼ˆå³æ¥æ”¶éšæœºæ•°ï¼‰ç„¶åè¿›è¡Œå†’æ³¡æ’åºï¼Œå†å‘é€finishä¿¡å·</li><li>ä¸»çº¿ç¨‹æ¥æ”¶åˆ°finishä¿¡å·åï¼Œå°†æ’åºåçš„éšæœºæ•°æ˜¾ç¤ºåœ¨ç•Œé¢ä¸Š</li></ul><p><strong>å®ç°ä»£ç ï¼š</strong></p><ul><li><strong>å­çº¿ç¨‹.h</strong></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;qthread.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;qvector.h&quot;</span></span></span><br><span class="line"><span class="comment">//æ–°å»ºéšæœºæ•°ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">myThread</span> :</span><br><span class="line">    <span class="keyword">public</span> QThread</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">myThread</span>(QObject* parent = <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">scvnum</span><span class="params">(<span class="type">int</span> num)</span></span>;<span class="comment">//æ¥æ”¶æ•°å­—</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sendArray</span><span class="params">(QVector&lt;<span class="type">int</span>&gt;num)</span></span>;<span class="comment">//å‘é€</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> m_num;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ–°å»ºå†’æ³¡æ’åºç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BubbleSort</span> :</span><br><span class="line">    <span class="keyword">public</span> QThread</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">BubbleSort</span>(QObject* parent = <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">rcvArray</span><span class="params">(QVector&lt;<span class="type">int</span>&gt;list)</span></span>;<span class="comment">//è¦æ¥æ”¶çš„æ˜¯æ’åºçš„æ•°</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">finish</span><span class="params">(QVector&lt;<span class="type">int</span>&gt;list)</span></span>;<span class="comment">//æ’åºå®Œæˆåå‘é€ä¸€ä¸ªfinishä¿¡å·</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    QVector&lt;<span class="type">int</span>&gt;m_list;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><strong>å­çº¿ç¨‹.cpp</strong></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;myThread.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;qelapsedtimer.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;qdebug.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">myThread::<span class="built_in">myThread</span>(QObject* parent) :<span class="built_in">QThread</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">BubbleSort::<span class="built_in">BubbleSort</span>(QObject* parent) : <span class="built_in">QThread</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">myThread::scvnum</span><span class="params">(<span class="type">int</span> num)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_num = num;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">myThread::run</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;child thread id&quot;</span> &lt;&lt; QThread::<span class="built_in">currentThreadId</span>();</span><br><span class="line">    QVector&lt;<span class="type">int</span>&gt; list;</span><br><span class="line">    QElapsedTimer time;</span><br><span class="line">    time.<span class="built_in">start</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m_num; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        list.<span class="built_in">push_back</span>(<span class="built_in">qrand</span>() % <span class="number">100000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> milsec = time.<span class="built_in">elapsed</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;The number of&quot;</span> &lt;&lt; m_num &lt;&lt; <span class="string">&quot;generated&quot;</span>;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;shared&quot;</span> &lt;&lt; milsec &lt;&lt; <span class="string">&quot;second&quot;</span>;</span><br><span class="line">    <span class="function">emit <span class="title">sendArray</span><span class="params">(list)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BubbleSort::rcvArray</span><span class="params">(QVector&lt;<span class="type">int</span>&gt; list)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_list = list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BubbleSort::run</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;BubbleSort thread id:&quot;</span> &lt;&lt; QThread::<span class="built_in">currentThreadId</span>();</span><br><span class="line">    QElapsedTimer time;</span><br><span class="line">    time.<span class="built_in">start</span>();</span><br><span class="line">    <span class="type">int</span> temp;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m_list.<span class="built_in">size</span>(); ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; m_list.<span class="built_in">size</span>()-i<span class="number">-1</span>; ++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (m_list[j] &gt; m_list[j + <span class="number">1</span>])</span><br><span class="line">            &#123;</span><br><span class="line">                temp = m_list[j];</span><br><span class="line">                m_list[j] = m_list[j + <span class="number">1</span>];</span><br><span class="line">                m_list[j + <span class="number">1</span>] = temp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> milsec = time.<span class="built_in">elapsed</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;shared&quot;</span> &lt;&lt; milsec &lt;&lt; <span class="string">&quot;second&quot;</span>;</span><br><span class="line">    <span class="function">emit <span class="title">finish</span><span class="params">(m_list)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>ä¸»çº¿ç¨‹.h</strong></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QtWidgets/QWidget&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;ui_list.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">list</span> : <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">list</span>(QWidget *parent = Q_NULLPTR);</span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">stating</span><span class="params">(<span class="type">int</span> num)</span></span>;<span class="comment">//è®¾ç½®è¦ç”Ÿæˆéšæœºæ•°ä¸ªæ•°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::listClass ui;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><strong>ä¸»çº¿ç¨‹.cpp</strong></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;list.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;myThread.h&quot;</span></span></span><br><span class="line">list::<span class="built_in">list</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QWidget</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line">    ui.<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//1.åˆ›å»ºå­çº¿ç¨‹å¯¹è±¡</span></span><br><span class="line">    myThread* thread = <span class="keyword">new</span> <span class="built_in">myThread</span>();</span><br><span class="line">    BubbleSort* bub_thread = <span class="keyword">new</span> <span class="built_in">BubbleSort</span>();</span><br><span class="line">    <span class="comment">//å‘å­çº¿ç¨‹å‘é€è¦ç”Ÿæˆçš„éšæœºæ•°ä¸ªæ•°</span></span><br><span class="line">    <span class="built_in">connect</span>(<span class="keyword">this</span>,&amp;list::stating, thread, &amp;myThread::scvnum);</span><br><span class="line">    <span class="comment">//2å¯åŠ¨å­çº¿ç¨‹</span></span><br><span class="line">    <span class="built_in">connect</span>(ui.pushButton, &amp;QPushButton::clicked,  [=]() &#123;</span><br><span class="line">        emit <span class="built_in">stating</span>(<span class="number">1000</span>);<span class="comment">//ä¸»çº¿ç¨‹è®¾ç½®å­çº¿ç¨‹éšæœºæ•°çš„ä¸ªæ•°</span></span><br><span class="line">        thread-&gt;<span class="built_in">start</span>();</span><br><span class="line">    </span><br><span class="line">        </span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="built_in">connect</span>(thread, &amp;myThread::sendArray, bub_thread, &amp;BubbleSort::rcvArray);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3æ¥æ”¶å­çº¿ç¨‹å‘é€çš„æ•°æ®</span></span><br><span class="line">    <span class="built_in">connect</span>(thread, &amp;myThread::sendArray,  [=](QVector&lt;<span class="type">int</span>&gt;list) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; list.<span class="built_in">size</span>(); ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            ui.randlist-&gt;<span class="built_in">addItem</span>(QString::<span class="built_in">number</span>(list.<span class="built_in">at</span>(i)));</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="built_in">connect</span>(thread, &amp;myThread::sendArray, [=](QVector&lt;<span class="type">int</span>&gt;list)&#123;</span><br><span class="line">        bub_thread-&gt;<span class="built_in">start</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="built_in">connect</span>(bub_thread, &amp;BubbleSort::finish, [=](QVector&lt;<span class="type">int</span>&gt;list) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; list. <span class="built_in">size</span>(); ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            ui.bubblelist-&gt;<span class="built_in">addItem</span>(QString::<span class="built_in">number</span>(list.<span class="built_in">at</span>(i)));</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/03/13/67d299b1220c9.gif"></p><p><strong>æ–¹æ³•äºŒï¼šmoveToThread()</strong> </p><p><strong>æ€è·¯ï¼š</strong></p><ul><li>æ–°å»ºmyThreadç±»ï¼Œç”¨äºç”Ÿæˆéšæœºæ•°ï¼ˆworkingå‡½æ•°ï¼‰ï¼Œåœ¨æ¥å—åˆ°ä¸»çº¿ç¨‹çš„ä¿¡å·åå¼€å§‹ç”Ÿæˆéšæœºæ•°</li><li>æ–°å»ºBubbleSortç±»ï¼Œç”¨äºæ’åº(workingå‡½æ•°ï¼‰ï¼Œåœ¨æ¥å—åˆ°myThreadç±»ç”Ÿæˆçš„éšæœºæ•°åå¼€å§‹æ’åº</li><li>æœ€åæ˜¾ç¤ºåœ¨ç•Œé¢</li></ul><p><strong>ä»£ç å®ç°ï¼š</strong></p><ul><li><strong>å­çº¿ç¨‹.h</strong></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;qthread.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;qvector.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;qobject.h&quot;</span></span></span><br><span class="line"><span class="comment">//æ–°å»ºéšæœºæ•°ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">myThread</span> :</span><br><span class="line">    <span class="keyword">public</span> QObject</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">myThread</span>(QObject* parent = <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">working</span><span class="params">(<span class="type">int</span> num)</span></span>;<span class="comment">//ç”Ÿæˆéšæœºæ•°</span></span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sendArray</span><span class="params">(QVector&lt;<span class="type">int</span>&gt;num)</span></span>;<span class="comment">//å‘é€</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> m_num;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ–°å»ºå†’æ³¡æ’åºç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BubbleSort</span> :</span><br><span class="line">    <span class="keyword">public</span> QObject</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">BubbleSort</span>(QObject* parent = <span class="literal">nullptr</span>);</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">working</span><span class="params">(QVector&lt;<span class="type">int</span>&gt;list)</span></span>;<span class="comment">//è¦æ¥æ”¶çš„æ˜¯æ’åºçš„æ•°</span></span><br><span class="line"></span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">finish</span><span class="params">(QVector&lt;<span class="type">int</span>&gt;list)</span></span>;<span class="comment">//æ’åºå®Œæˆåå‘é€ä¸€ä¸ªfinishä¿¡å·</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><strong>å­çº¿ç¨‹.cpp</strong></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;myThread.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;qelapsedtimer.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;qdebug.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">myThread::<span class="built_in">myThread</span>(QObject* parent) :<span class="built_in">QObject</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">BubbleSort::<span class="built_in">BubbleSort</span>(QObject* parent) : <span class="built_in">QObject</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">myThread::working</span><span class="params">(<span class="type">int</span> num)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;child thread id&quot;</span> &lt;&lt; QThread::<span class="built_in">currentThreadId</span>();</span><br><span class="line">    QVector&lt;<span class="type">int</span>&gt; list;</span><br><span class="line">    QElapsedTimer time;</span><br><span class="line">    time.<span class="built_in">start</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; num; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        list.<span class="built_in">push_back</span>(<span class="built_in">qrand</span>() % <span class="number">100000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> milsec = time.<span class="built_in">elapsed</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;The number of&quot;</span> &lt;&lt; m_num &lt;&lt; <span class="string">&quot;generated&quot;</span>;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;shared&quot;</span> &lt;&lt; milsec &lt;&lt; <span class="string">&quot;second&quot;</span>;</span><br><span class="line">    <span class="function">emit <span class="title">sendArray</span><span class="params">(list)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BubbleSort::working</span><span class="params">(QVector&lt;<span class="type">int</span>&gt;list)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;BubbleSort thread id:&quot;</span> &lt;&lt; QThread::<span class="built_in">currentThreadId</span>();</span><br><span class="line">    QElapsedTimer time;</span><br><span class="line">    time.<span class="built_in">start</span>();</span><br><span class="line">    <span class="type">int</span> temp;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; list.<span class="built_in">size</span>(); ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; list.<span class="built_in">size</span>()-i<span class="number">-1</span>; ++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (list[j] &gt; list[j + <span class="number">1</span>])</span><br><span class="line">            &#123;</span><br><span class="line">                temp = list[j];</span><br><span class="line">                list[j] = list[j + <span class="number">1</span>];</span><br><span class="line">                list[j + <span class="number">1</span>] = temp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> milsec = time.<span class="built_in">elapsed</span>();</span><br><span class="line">    <span class="built_in">qDebug</span>() &lt;&lt; <span class="string">&quot;shared&quot;</span> &lt;&lt; milsec &lt;&lt; <span class="string">&quot;second&quot;</span>;</span><br><span class="line">    <span class="function">emit <span class="title">finish</span><span class="params">(list)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>ä¸»çº¿ç¨‹.h</strong></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QtWidgets/QWidget&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;ui_list.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">list</span> : <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">list</span>(QWidget *parent = Q_NULLPTR);</span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">stating</span><span class="params">(<span class="type">int</span> num)</span></span>;<span class="comment">//è®¾ç½®è¦ç”Ÿæˆéšæœºæ•°ä¸ªæ•°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::listClass ui;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ul><li><strong>ä¸»çº¿ç¨‹.cpp</strong></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;list.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;myThread.h&quot;</span></span></span><br><span class="line">list::<span class="built_in">list</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QWidget</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line">    ui.<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//1.åˆ›å»ºQThreadå¯¹è±¡</span></span><br><span class="line">    QThread* thread1 = <span class="keyword">new</span> QThread;</span><br><span class="line">    QThread* thread2 = <span class="keyword">new</span> QThread;</span><br><span class="line">    <span class="comment">//2.åˆ›å»ºå­çº¿ç¨‹ç±»å¯¹è±¡</span></span><br><span class="line">    myThread* myth = <span class="keyword">new</span> <span class="built_in">myThread</span>();</span><br><span class="line">    BubbleSort* bub = <span class="keyword">new</span> <span class="built_in">BubbleSort</span>();</span><br><span class="line">    <span class="comment">//3é€šè¿‡movetothreadå°†å­çº¿ç¨‹å¯¹è±¡ç§»åŠ¨åˆ°QThreadå¯¹è±¡ä¸­</span></span><br><span class="line">    myth-&gt;<span class="built_in">moveToThread</span>(thread1);</span><br><span class="line">    bub-&gt;<span class="built_in">moveToThread</span>(thread2);</span><br><span class="line">    <span class="comment">//4å¯åŠ¨å­çº¿ç¨‹</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å…ˆå‘å­çº¿ç¨‹å‘é€è¦ç”Ÿæˆçš„éšæœºæ•°ä¸ªæ•°</span></span><br><span class="line">    <span class="built_in">connect</span>(<span class="keyword">this</span>,&amp;list::stating, myth, &amp;myThread::working);</span><br><span class="line">    <span class="comment">//å†å¯åŠ¨å­çº¿ç¨‹</span></span><br><span class="line">    <span class="built_in">connect</span>(ui.pushButton, &amp;QPushButton::clicked,  [=]() &#123;</span><br><span class="line">        emit <span class="built_in">stating</span>(<span class="number">1000</span>);<span class="comment">//ä¸»çº¿ç¨‹è®¾ç½®å­çº¿ç¨‹éšæœºæ•°çš„ä¸ªæ•°</span></span><br><span class="line">        thread1-&gt;<span class="built_in">start</span>();        </span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="comment">//å°†ç”Ÿæˆå¥½çš„éšæœºæ•°å‘é€ç»™BubbleSortç±»</span></span><br><span class="line">    <span class="built_in">connect</span>(myth, &amp;myThread::sendArray, bub, &amp;BubbleSort::working);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å°†ç”Ÿæˆå¥½çš„éšæœºæ•°æ˜¾ç¤ºåœ¨ç•Œé¢</span></span><br><span class="line">    <span class="built_in">connect</span>(myth, &amp;myThread::sendArray,  [=](QVector&lt;<span class="type">int</span>&gt;list) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; list.<span class="built_in">size</span>(); ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            ui.randlist-&gt;<span class="built_in">addItem</span>(QString::<span class="built_in">number</span>(list.<span class="built_in">at</span>(i)));</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="comment">//å‘é€çš„åŒæ—¶å¯åŠ¨æ’åºç®—æ³•</span></span><br><span class="line">    <span class="built_in">connect</span>(myth, &amp;myThread::sendArray, [=](QVector&lt;<span class="type">int</span>&gt;list)&#123;</span><br><span class="line">        thread2-&gt;<span class="built_in">start</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="comment">//å°†æ’åºå¥½çš„æ•°æ˜¾ç¤ºåœ¨ç•Œé¢</span></span><br><span class="line">    <span class="built_in">connect</span>(bub, &amp;BubbleSort::finish, [=](QVector&lt;<span class="type">int</span>&gt;list) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; list. <span class="built_in">size</span>(); ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            ui.bubblelist-&gt;<span class="built_in">addItem</span>(QString::<span class="built_in">number</span>(list.<span class="built_in">at</span>(i)));</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç»“è®º</strong></p><p>é€šè¿‡å¯¹æ¯”ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼š</p><ul><li>ç”±äºç¬¬äºŒç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰å¸¦å‚çš„å­çº¿ç¨‹è¿è¡Œå‡½æ•°ï¼Œå› æ­¤ä»£ç æ›´åŠ ç®€æ´ã€‚</li><li>åœ¨ç¬¬äºŒç§æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥éšæ„ä¿®æ”¹éœ€è¦åœ¨å“ªä¸ªçº¿ç¨‹ä¸­è¿è¡Œï¼Œä»£ç ä¹Ÿæ›´åŠ çµæ´»ã€‚</li><li>ç¬¬ä¸€ç§æ–¹æ³•é€‚åˆåœ¨çº¿ç¨‹ä¸­å¤„ç†å•ä¸€äº‹ä»¶ï¼Œå…¶é€»è¾‘ç®€å•ï¼ˆåªéœ€è¦æ–°å»ºä¸€ä¸ªç»§æ‰¿è‡ªQThreadç±»çš„å¯¹è±¡ï¼Œé‡å†™runå‡½æ•°ï¼Œç„¶åå¯åŠ¨å³å¯ï¼‰ï¼Œå¯¹äºéœ€è¦åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å¤„ç†å¤šä¸ªäº‹ä»¶ï¼Œè¿˜æ˜¯ç”¨ç¬¬äºŒç§æ–¹æ³•æ¯”è¾ƒå¥½ã€‚</li><li>ä¸ºä»€ä¹ˆä¸èƒ½åœ¨ç¬¬äºŒç§æ–¹æ³•ä¸­ï¼Œç»™å®šä¹‰çš„å­çº¿ç¨‹å¯¹è±¡æ·»åŠ çˆ¶ç±»å‘¢ï¼Ÿ ï¼šç”±äºæ·»åŠ äº†çˆ¶ç±»ä»¥åå°±ä¸èƒ½å†ç§»åŠ¨åˆ°QThreadä¸­å»äº†</li></ul><p><strong>å¦‚ä½•è¿›è¡Œçº¿ç¨‹èµ„æºçš„é‡Šæ”¾ï¼Ÿ</strong></p><ol><li>åœ¨newå¯¹è±¡æ—¶å€™ï¼Œç›´æ¥ç”¨thisæŒ‡å®šå…¶çˆ¶ç±»ï¼ˆå³æ”¾å…¥å¯¹è±¡æ•°ä¸­ï¼‰</li><li>åœ¨ç¨‹åºæœ€åè‡ªè¡Œé‡Šæ”¾èµ„æº</li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">connect</span>(<span class="keyword">this</span>, &amp;list::destroyed, <span class="keyword">this</span>, [=]() &#123;</span><br><span class="line">    thread1-&gt;<span class="built_in">quit</span>();</span><br><span class="line">    thread1-&gt;<span class="built_in">wait</span>();</span><br><span class="line">    thread1-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line">    thread2-&gt;<span class="built_in">quit</span>();</span><br><span class="line">    thread2-&gt;<span class="built_in">wait</span>();</span><br><span class="line">    thread2-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line">    myth-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line">    bub-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><br><br><br><p><span style="color: red; font-size: 20px;">è½¬è½½è‡ªï¼š<a href="https://www.cnblogs.com/xyf327">å”¯æœ‰è‡ªå·±å¼ºå¤§</a>          å¦‚æœ‰ä¾µæƒï¼Œåœ¨ä¸‹æ–¹è¯„è®º  ç«‹åˆ»åˆ é™¤ã€‚</span></p>]]></content>
      
      
      <categories>
          
          <category> Qt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt03æ–‡ä»¶è¯»å†™</title>
      <link href="/2025/03/13/Qt03%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99/"/>
      <url>/2025/03/13/Qt03%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99/</url>
      
        <content type="html"><![CDATA[<p>Qt æä¾›äº†ä¸¤ç§è¯»å†™çº¯æ–‡æœ¬æ–‡ä»¶çš„åŸºæœ¬æ–¹æ³•ï¼š</p><ol><li>ç”¨ <strong>QFile ç±»</strong>çš„ IODevice è¯»å†™åŠŸèƒ½ç›´æ¥è¿›è¡Œè¯»å†™</li><li>åˆ©ç”¨ <strong>QFile</strong> å’Œ <strong>QTextStream</strong> ç»“åˆèµ·æ¥ï¼Œç”¨æµï¼ˆStream)çš„æ–¹æ³•è¿›è¡Œæ–‡ä»¶è¯»å†™ã€‚</li></ol><h3 id="ä¸€ã€æ–‡ä»¶è¯»æ“ä½œ"><a href="#ä¸€ã€æ–‡ä»¶è¯»æ“ä½œ" class="headerlink" title="ä¸€ã€æ–‡ä»¶è¯»æ“ä½œ"></a><font color="FF0000">ä¸€ã€æ–‡ä»¶è¯»æ“ä½œ</font></h3><p><strong>ï¼ˆ1ï¼‰ä½¿ç”¨QFileç±»</strong></p><p>Qtå°è£…äº†QFileç±»ï¼Œæ–¹ä¾¿æˆ‘ä»¬å¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œï¼Œå¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„æ­¥éª¤è¿›è¡Œï¼š</p><ul><li>ä½¿ç”¨QFileåŠ è½½æ–‡ä»¶å¯¹è±¡</li><li>æ‰“å¼€æ–‡ä»¶ file.open(æ‰“å¼€æ–¹å¼)</li><li>æ“ä½œæ–‡ä»¶</li><li>å…³é—­æ–‡ä»¶ file.close()</li></ul><p><strong>å®ä¾‹ï¼šç‚¹å‡»è¯»å†™æ–‡ä»¶æŒ‰é’®ï¼Œè¯»å–æ–‡ä»¶å†…å®¹åˆ°textEditä¸­</strong></p><p>1ï¸âƒ£è®¾ç½® ui ç•Œé¢</p><p><img src="https://bu.dusays.com/2025/03/13/67d284db41c18.png"></p><p>2ï¸âƒ£åœ¨widget.cppä¸­ç¼–è¾‘ä»£ç ï¼ˆQFileDialogç±»æ˜¯æ‰“å¼€æ–‡ä»¶ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç‚¹å‡»é€‰å–æ–‡ä»¶æŒ‰é’®ï¼Œå¼¹å‡ºæ–‡ä»¶å¯¹è¯æ¡†</span></span><br><span class="line"> <span class="built_in">connect</span>(ui-&gt;pushButton,&amp;QPushButton::clicked,[=]()&#123;</span><br><span class="line"> QString path = QFileDialog::<span class="built_in">getOpenFileName</span>(<span class="keyword">this</span>,<span class="string">&quot;æ‰“å¼€æ–‡ä»¶&quot;</span>,<span class="string">&quot;C:/Users/WFD/Desktop&quot;</span>);</span><br><span class="line"><span class="comment">//å°†è·¯å¾„æ˜¾ç¤ºåœ¨lineEditä¸­</span></span><br><span class="line">ui-&gt;lineEdit-&gt;<span class="built_in">setText</span>(path);</span><br><span class="line"></span><br><span class="line">   <span class="comment">//è¯»å–æ–‡ä»¶å†…å®¹ï¼Œæ”¾å…¥textEditä¸­</span></span><br><span class="line">   QFile <span class="built_in">file</span>(path);<span class="comment">//å‚æ•°å°±æ˜¯æ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line">   <span class="comment">//è®¾ç½®æ‰“å¼€æ–¹å¼</span></span><br><span class="line">   file.<span class="built_in">open</span>(QIODevice::ReadOnly);</span><br><span class="line">   <span class="comment">//ç”¨QByteArrayç±»å»æ¥æ”¶è¯»å–çš„ä¿¡æ¯</span></span><br><span class="line">   QByteArray array=file.<span class="built_in">readAll</span>();</span><br><span class="line">   <span class="comment">//å°†è¯»å–åˆ°çš„æ•°æ®æ”¾å…¥textEditä¸­</span></span><br><span class="line">   ui-&gt;textEdit-&gt;<span class="built_in">setText</span>(array);</span><br><span class="line">   <span class="comment">//å…³é—­æ–‡ä»¶å¯¹è±¡</span></span><br><span class="line">   file.<span class="built_in">close</span>();</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/03/13/67d2853788ad5.png"></p><p><strong>æ³¨æ„ï¼šåœ¨è®¾ç½®æ‰“å¼€æ–¹å¼çš„æ—¶å€™</strong></p><p>QFile::open() å‡½æ•°æ‰“å¼€æ–‡ä»¶æ—¶éœ€è¦ä¼ é€’ <code>QIODevice::OpenModeFlag</code> æšä¸¾ç±»å‹çš„å‚æ•°ï¼Œå†³å®šæ–‡ä»¶ä»¥ä»€ä¹ˆæ–¹å¼æ‰“å¼€ï¼ŒQIODevice::OpenModeFlag ç±»å‹çš„ä¸»è¦å–å€¼å¦‚ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">QIODevice::ReadOnly  <span class="comment">//ä»¥åªè¯»æ–¹å¼æ‰“å¼€æ–‡ä»¶ï¼Œç”¨äºè½½å…¥æ–‡ä»¶ã€‚</span></span><br><span class="line">QIODevice::WriteOnly  <span class="comment">//ä»¥åªå†™æ–¹å¼æ‰“å¼€æ–‡ä»¶ï¼Œç”¨äºä¿å­˜æ–‡ä»¶ã€‚</span></span><br><span class="line">QIODevice::ReadWrite <span class="comment">//ä»¥è¯»å†™æ–¹å¼æ‰“å¼€ã€‚</span></span><br><span class="line">QIODevice::Append  <span class="comment">//ä»¥æ·»åŠ æ¨¡å¼æ‰“å¼€ï¼Œæ–°å†™å…¥æ–‡ä»¶çš„æ•°æ®æ·»åŠ åˆ°æ–‡ä»¶å°¾éƒ¨ã€‚</span></span><br><span class="line">QIODevice::Truncate <span class="comment">//ä»¥æˆªå–æ–¹å¼æ‰“å¼€æ–‡ä»¶ï¼Œæ–‡ä»¶åŸæœ‰çš„å†…å®¹å…¨éƒ¨è¢«åˆ é™¤ã€‚</span></span><br><span class="line">QIODevice::Text       <span class="comment">//ä»¥æ–‡æœ¬æ–¹å¼æ‰“å¼€æ–‡ä»¶ï¼Œè¯»å–æ—¶â€œ\nâ€è¢«è‡ªåŠ¨ç¿»è¯‘ä¸ºæ¢è¡Œç¬¦ï¼Œå†™å…¥æ—¶å­—ç¬¦ä¸²ç»“æŸç¬¦ä¼šè‡ªåŠ¨ç¿»è¯‘ä¸ºç³»ç»Ÿå¹³å°çš„ç¼–ç ï¼Œå¦‚ Windows å¹³å°ä¸‹æ˜¯â€œ\r\nâ€ã€‚</span></span><br><span class="line"></span><br><span class="line">è¿™äº›å–å€¼å¯ä»¥ç»„åˆï¼Œä¾‹å¦‚ QIODevice::ReadOnly | QIODevice::Text è¡¨ç¤ºä»¥åªè¯»å’Œæ–‡æœ¬æ–¹å¼æ‰“å¼€æ–‡ä»¶ã€‚</span><br></pre></td></tr></table></figure><p> <strong>æ³¨æ„ï¼šåœ¨æ“ä½œæ–‡ä»¶æ—¶</strong></p><p>ç”¨åªè¯»æ–¹å¼æ‰“å¼€ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œç„¶åç”¨readAll()æ–¹æ³•å°†æ–‡ä»¶å†…å®¹ä¸€æ¬¡å…¨éƒ¨è¯»å–å‡ºæ¥ï¼Œè¿”å›å€¼æ˜¯å­—èŠ‚æ•°ç»„QByteArrayã€‚QByteArrayç”¨æ¥å­˜æ”¾äºŒè¿›åˆ¶æ•°æ®ï¼Œå¦‚æœæƒ³è¦çœ‹æ–‡å­—å†…å®¹éœ€è¦è½¬æ¢æˆQStringã€‚(æœ‰æ—¶å€™ç³»ç»Ÿä¼šè‡ªåŠ¨è½¬æ¢ï¼‰</p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨readLineæ–¹æ³•ä¸€æ¬¡è¯»å–ä¸€è¡Œï¼Œç„¶åæ¯æ¬¡å¯¹ä¸€è¡Œæ–‡å­—è¿›è¡Œæ“ä½œï¼šï¼ˆç”¨file.atEndåˆ¤æ–­æ˜¯å¦è¯»åˆ°æœ€åä¸€è¡Œï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">QByteArray array;</span><br><span class="line"> <span class="keyword">while</span>(!file.<span class="built_in">atEnd</span>())</span><br><span class="line"> &#123;</span><br><span class="line">      array+=file.<span class="built_in">readLine</span>();<span class="comment">//+=å åŠ è¯»è¿‡çš„è¡Œ</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><strong>ï¼ˆ2ï¼‰ä½¿ç”¨QTextStreamç±»</strong></p><p>å¦‚æœæ“ä½œçš„æ˜¯æ–‡æœ¬æ–‡ä»¶ï¼ŒQtè¿˜ä¸“é—¨å°è£…äº†ä¸€ä¸ªå¤„ç†æ–‡æœ¬æµçš„ç±»ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥è¯»å–æ–‡æœ¬å†…å®¹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç‚¹å‡»é€‰å–æ–‡ä»¶æŒ‰é’®ï¼Œå¼¹å‡ºæ–‡ä»¶å¯¹è¯æ¡†</span></span><br><span class="line"><span class="built_in">connect</span>(ui-&gt;pushButton,&amp;QPushButton::clicked,[=]()&#123;</span><br><span class="line">  QString path=  QFileDialog::<span class="built_in">getOpenFileName</span>(<span class="keyword">this</span>,<span class="string">&quot;æ‰“å¼€æ–‡ä»¶&quot;</span>,<span class="string">&quot;C:/Users/WFD/Desktop&quot;</span>);</span><br><span class="line">  <span class="comment">//å°†è·¯å¾„æ”¾åœ¨lineEditä¸­</span></span><br><span class="line">  ui-&gt;lineEdit-&gt;<span class="built_in">setText</span>(path);</span><br><span class="line">  <span class="comment">//è¯»å–æ–‡ä»¶å†…å®¹ï¼Œæ”¾å…¥textEditä¸­</span></span><br><span class="line">  QFile <span class="built_in">file</span>(path);<span class="comment">//å‚æ•°å°±æ˜¯æ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line">  <span class="comment">//è®¾ç½®æ‰“å¼€æ–¹å¼</span></span><br><span class="line">  file.<span class="built_in">open</span>(QIODevice::ReadOnly);</span><br><span class="line">  <span class="comment">//ç”¨QTextStreamç±»å»è¯»å–æ–‡æœ¬ä¿¡æ¯</span></span><br><span class="line"> QTextStream <span class="built_in">QS</span>(&amp;file);</span><br><span class="line"> <span class="comment">//ç”¨QStringç±»å»æ¥æ”¶è¯»å–çš„ä¿¡æ¯</span></span><br><span class="line"> QString array=QS.<span class="built_in">readAll</span>();</span><br><span class="line">  <span class="comment">//å°†è¯»å–åˆ°çš„æ•°æ®æ”¾å…¥textEditä¸­</span></span><br><span class="line">  ui-&gt;textEdit-&gt;<span class="built_in">setText</span>(array);</span><br><span class="line">  <span class="comment">//å…³é—­æ–‡ä»¶å¯¹è±¡</span></span><br><span class="line">  file.<span class="built_in">close</span>();</span><br></pre></td></tr></table></figure><h3 id="äºŒã€æ–‡ä»¶å†™æ“ä½œ"><a href="#äºŒã€æ–‡ä»¶å†™æ“ä½œ" class="headerlink" title="äºŒã€æ–‡ä»¶å†™æ“ä½œ"></a><font color="FF0000">äºŒã€æ–‡ä»¶å†™æ“ä½œ</font></h3><p><strong>ï¼ˆ1ï¼‰ä½¿ç”¨QFileç±»</strong></p><p>ä½¿ç”¨QFileåŒæ ·å¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œå†™æ“ä½œï¼š</p><p><img src="https://bu.dusays.com/2025/03/13/67d28680b7eb2.png"></p><p><strong>2ï¼‰ä½¿ç”¨QTextStreamç±»</strong></p><p> QTextStreamç±»å¯¹æ“ä½œç¬¦è¿›è¡Œäº†é‡è½½ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ &lt;&lt; æ“ä½œç¬¦å°†å­—ç¬¦ä¸²æµå…¥æ–‡æœ¬æ–‡ä»¶ï¼š</p><p><img src="https://bu.dusays.com/2025/03/13/67d2869e099cf.png"></p><h3 id="ä¸‰ã€æ–‡ä»¶ä¿¡æ¯è¯»å–"><a href="#ä¸‰ã€æ–‡ä»¶ä¿¡æ¯è¯»å–" class="headerlink" title="ä¸‰ã€æ–‡ä»¶ä¿¡æ¯è¯»å–"></a><font color="FF0000">ä¸‰ã€æ–‡ä»¶ä¿¡æ¯è¯»å–</font></h3><p>é™¤äº†å¯¹æ–‡ä»¶çš„è¯»å†™æ“ä½œï¼ŒQtè¿˜å°è£…äº†QFileInfoç±»å¸®åŠ©æˆ‘ä»¬è·å–æ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œæ¯”å¦‚æ–‡ä»¶å¤§å°ã€åç¼€åã€åˆ›å»ºæ—¶é—´ã€æœ€åä¿®æ”¹æ—¶é—´ç­‰ç­‰ï¼š</p><p><img src="https://bu.dusays.com/2025/03/13/67d286ffb59dc.png"></p><p><strong>æ‹“å±•ï¼š</strong></p><ul><li><strong>å„ç¼–ç è½¬æ¢</strong></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">QString -&gt; QByteArray      QString.<span class="built_in">toUtf8</span>();</span><br><span class="line"></span><br><span class="line">QByteArray -&gt; std::string  QByteArray.<span class="built_in">toStdString</span>();</span><br><span class="line"></span><br><span class="line">std::string -&gt; <span class="type">char</span> *        string.<span class="built_in">date</span>();</span><br></pre></td></tr></table></figure><ul><li><strong>å¸¸ç”¨é™æ€å‡½æ•°</strong></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">QFileDialog::<span class="built_in">getOpenFileName</span>()    <span class="comment">//è·å–æŒ‡å®šæ–‡ä»¶è·¯å¾„åè¿”å›QString</span></span><br><span class="line">QFileDialog::<span class="built_in">getExistingDirectory</span>()  <span class="comment">//è·å–æŒ‡å®šè·¯å¾„è¿”å›QString</span></span><br><span class="line">QFileDialog::<span class="built_in">getSaveFileName</span>()    <span class="comment">//è·å–æŒ‡å®šä¿å­˜è·¯å¾„åè¿”å›QString</span></span><br></pre></td></tr></table></figure><p><strong><p align = "center">QTé…ç½®iniæ–‡ä»¶çš„å»ºç«‹ï¼Œè¯»å–ï¼Œå†™å…¥æ“ä½œ</p></strong></p><p><strong>1 iniæ–‡ä»¶ä»‹ç»</strong></p><p>.ini æ–‡ä»¶æ˜¯Initialization Fileçš„ç¼©å†™ï¼Œå³åˆå§‹åŒ–æ–‡ä»¶ã€‚</p><p>é™¤äº†windowsç°åœ¨å¾ˆå¤šå…¶ä»–æ“ä½œç³»ç»Ÿä¸‹é¢çš„åº”ç”¨è½¯ä»¶ä¹Ÿæœ‰.iniæ–‡ä»¶ï¼Œç”¨æ¥é…ç½®åº”ç”¨è½¯ä»¶ä»¥å®ç°ä¸åŒç”¨æˆ·çš„è¦æ±‚ã€‚ä¸€èˆ¬ä¸ç”¨ç›´æ¥ç¼–è¾‘è¿™äº›.iniæ–‡ä»¶ï¼Œåº”ç”¨ç¨‹åºçš„å›¾å½¢ç•Œé¢å³å¯æ“ä½œä»¥å®ç°ç›¸åŒçš„åŠŸèƒ½ã€‚å®ƒå¯ä»¥ç”¨æ¥å­˜æ”¾è½¯ä»¶ä¿¡æ¯,æ³¨å†Œè¡¨ä¿¡æ¯ç­‰ã€‚</p><p><strong>2 iniæ–‡ä»¶æ ¼å¼</strong></p><p>INIæ–‡ä»¶ç”±èŠ‚ã€é”®ã€å€¼ç»„æˆã€‚ </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">èŠ‚</span><br><span class="line"></span><br><span class="line">ã€€ã€€[section] </span><br><span class="line"></span><br><span class="line">å‚æ•°ï¼ˆé”®=å€¼ï¼‰</span><br><span class="line"></span><br><span class="line">name=value</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯ä¸€ä¸ªiniæ–‡ä»¶çš„ä¾‹å­</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[Section1 Name] ã€€ã€€</span><br><span class="line"></span><br><span class="line">KeyName1=value1 ã€€ã€€</span><br><span class="line"></span><br><span class="line">KeyName2=value2 ã€€ã€€</span><br><span class="line"></span><br><span class="line">... ã€€ã€€</span><br><span class="line"></span><br><span class="line">[Section2 Name] ã€€ã€€</span><br><span class="line"></span><br><span class="line">KeyName21=value21 ã€€ã€€</span><br><span class="line"></span><br><span class="line">KeyName22=value22 ã€€ã€€</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼š[Section1 Name]ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªæ®µè½ã€‚å› ä¸ºINIæ–‡ä»¶å¯èƒ½æ˜¯é¡¹ç›®ä¸­å…±ç”¨çš„ï¼Œæ‰€ä»¥ä½¿ç”¨[Section Name]æ®µåæ¥åŒºåˆ†ä¸åŒç”¨é€”çš„å‚æ•°åŒºã€‚ä¾‹å¦‚ï¼š[Section1 Name]è¡¨ç¤ºä¼ æ„Ÿå™¨çµæ•åº¦å‚æ•°åŒºï¼›[Section2 Name]è¡¨ç¤ºæµ‹é‡é€šé“å‚æ•°åŒºç­‰ç­‰ã€‚</p><p>æ³¨è§£ï¼šä½¿ç”¨åˆ†å·è¡¨ç¤ºï¼ˆ;ï¼‰ã€‚åœ¨åˆ†å·åé¢çš„æ–‡å­—ï¼Œç›´åˆ°è¯¥è¡Œç»“å°¾éƒ½å…¨éƒ¨ä¸ºæ³¨è§£ã€‚</p><p><strong>3 Qtå†™iniæ–‡ä»¶</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QApplication&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QSettings&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line">    <span class="comment">//Qtä¸­ä½¿ç”¨QSettingsç±»è¯»å†™iniæ–‡ä»¶</span></span><br><span class="line">    <span class="comment">//QSettingsæ„é€ å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯iniæ–‡ä»¶çš„è·¯å¾„,ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºé’ˆå¯¹iniæ–‡ä»¶,ç¬¬ä¸‰ä¸ªå‚æ•°å¯ä»¥ç¼ºçœ</span></span><br><span class="line">    QSettings *configIniWrite = <span class="keyword">new</span> <span class="built_in">QSettings</span>(<span class="string">&quot;hahaya.ini&quot;</span>, QSettings::IniFormat);</span><br><span class="line">    <span class="comment">//å‘iniæ–‡ä»¶ä¸­å†™å…¥å†…å®¹,setValueå‡½æ•°çš„ä¸¤ä¸ªå‚æ•°æ˜¯é”®å€¼å¯¹</span></span><br><span class="line">    <span class="comment">//å‘iniæ–‡ä»¶çš„ç¬¬ä¸€ä¸ªèŠ‚å†™å…¥å†…å®¹,ipèŠ‚ä¸‹çš„ç¬¬ä¸€ä¸ªå‚æ•°</span></span><br><span class="line">    configIniWrite-&gt;<span class="built_in">setValue</span>(<span class="string">&quot;/ip/first&quot;</span>, <span class="string">&quot;192.168.0.1&quot;</span>);</span><br><span class="line">    <span class="comment">//å‘iniæ–‡ä»¶çš„ç¬¬ä¸€ä¸ªèŠ‚å†™å…¥å†…å®¹,ipèŠ‚ä¸‹çš„ç¬¬äºŒä¸ªå‚æ•°</span></span><br><span class="line">    configIniWrite-&gt;<span class="built_in">setValue</span>(<span class="string">&quot;ip/second&quot;</span>, <span class="string">&quot;127.0.0.1&quot;</span>);</span><br><span class="line">    <span class="comment">//å‘iniæ–‡ä»¶çš„ç¬¬äºŒä¸ªèŠ‚å†™å…¥å†…å®¹,portèŠ‚ä¸‹çš„ç¬¬ä¸€ä¸ªå‚æ•°</span></span><br><span class="line">    configIniWrite-&gt;<span class="built_in">setValue</span>(<span class="string">&quot;port/open&quot;</span>, <span class="string">&quot;2222&quot;</span>);</span><br><span class="line">    <span class="comment">//å†™å…¥å®Œæˆååˆ é™¤æŒ‡é’ˆ</span></span><br><span class="line">    <span class="keyword">delete</span> configIniWrite;</span><br><span class="line">    <span class="keyword">return</span> a.<span class="built_in">exec</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç¨‹åºåï¼Œæ‰“å¼€ç¨‹åºç›®å½•ä¸‹çš„hahaya.iniæ–‡ä»¶ï¼Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://bu.dusays.com/2025/03/13/67d287cd1be9a.png"></p><p> <strong>4 Qtè¯»iniæ–‡ä»¶</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QApplication&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QSettings&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;QDebug&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      <span class="function">QApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line">      QSettings *configIniRead = <span class="keyword">new</span> <span class="built_in">QSettings</span>(<span class="string">&quot;hahaya.ini&quot;</span>, QSettings::IniFormat);</span><br><span class="line">      <span class="comment">//å°†è¯»å–åˆ°çš„iniæ–‡ä»¶ä¿å­˜åœ¨QStringä¸­ï¼Œå…ˆå–å€¼ï¼Œç„¶åé€šè¿‡toString()å‡½æ•°è½¬æ¢æˆQStringç±»å‹</span></span><br><span class="line">      QString ipResult = configIniRead-&gt;<span class="built_in">value</span>(<span class="string">&quot;/ip/second&quot;</span>).<span class="built_in">toString</span>();</span><br><span class="line">      QString portResult = configIniRead-&gt;<span class="built_in">value</span>(<span class="string">&quot;/port/open&quot;</span>).<span class="built_in">toString</span>();</span><br><span class="line">      <span class="comment">//æ‰“å°å¾—åˆ°çš„ç»“æœ</span></span><br><span class="line">      <span class="built_in">qDebug</span>() &lt;&lt; ipResult;</span><br><span class="line">      <span class="built_in">qDebug</span>() &lt;&lt; portResult;</span><br><span class="line">      <span class="comment">//è¯»å…¥å…¥å®Œæˆååˆ é™¤æŒ‡é’ˆ</span></span><br><span class="line">      <span class="keyword">delete</span> configIniRead;</span><br><span class="line">      <span class="keyword">return</span> a.<span class="built_in">exec</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/03/13/67d287e4a3dc2.png"></p><br><br><br><p><span style="color: red; font-size: 20px;">è½¬è½½è‡ªï¼š<a href="https://www.cnblogs.com/xyf327">å”¯æœ‰è‡ªå·±å¼ºå¤§</a>          å¦‚æœ‰ä¾µæƒï¼Œåœ¨ä¸‹æ–¹è¯„è®º  ç«‹åˆ»åˆ é™¤ã€‚</span></p>]]></content>
      
      
      <categories>
          
          <category> Qt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qtå­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt02ä¿¡å·å’Œæ§½</title>
      <link href="/2025/03/13/Qt02%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD/"/>
      <url>/2025/03/13/Qt02%E4%BF%A1%E5%8F%B7%E5%92%8C%E6%A7%BD/</url>
      
        <content type="html"><![CDATA[<h3 id="ä¸€ã€ä¿¡å·å’Œæ§½æœºåˆ¶åˆ†æ"><a href="#ä¸€ã€ä¿¡å·å’Œæ§½æœºåˆ¶åˆ†æ" class="headerlink" title="ä¸€ã€ä¿¡å·å’Œæ§½æœºåˆ¶åˆ†æ"></a><font color="FF0000">ä¸€ã€ä¿¡å·å’Œæ§½æœºåˆ¶åˆ†æ</font></h3><p>â€‹<strong>ä¿¡å·</strong>ï¼ˆSignalï¼‰å°±æ˜¯åœ¨ç‰¹å®šæƒ…å†µä¸‹è¢«å‘å°„çš„äº‹ä»¶ï¼Œä¾‹å¦‚PushButton æœ€å¸¸è§çš„ä¿¡å·å°±æ˜¯é¼ æ ‡å•å‡»æ—¶å‘å°„çš„ clicked() ä¿¡å·ï¼Œä¸€ä¸ª ComboBox æœ€å¸¸è§çš„ä¿¡å·æ˜¯é€‰æ‹©çš„åˆ—è¡¨é¡¹å˜åŒ–æ—¶å‘å°„çš„ CurrentIndexChanged() ä¿¡å·ã€‚</p><p>â€‹GUI ç¨‹åºè®¾è®¡çš„ä¸»è¦å†…å®¹å°±æ˜¯å¯¹ç•Œé¢ä¸Šå„ç»„ä»¶çš„ä¿¡å·çš„å“åº”ï¼Œåªéœ€è¦çŸ¥é“ä»€ä¹ˆæƒ…å†µä¸‹å‘å°„å“ªäº›ä¿¡å·ï¼Œåˆç†åœ°å»å“åº”å’Œå¤„ç†è¿™äº›ä¿¡å·å°±å¯ä»¥äº†ã€‚</p><p>â€‹<strong>æ§½</strong>ï¼ˆSlotï¼‰å°±æ˜¯å¯¹ä¿¡å·å“åº”çš„å‡½æ•°ã€‚æ§½å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸ä¸€èˆ¬çš„C++å‡½æ•°æ˜¯ä¸€æ ·çš„ï¼Œå¯ä»¥å®šä¹‰åœ¨ç±»çš„ä»»ä½•éƒ¨åˆ†ï¼ˆpublicã€private æˆ– protectedï¼‰ï¼Œå¯ä»¥å…·æœ‰ä»»ä½•å‚æ•°ï¼Œä¹Ÿå¯ä»¥è¢«ç›´æ¥è°ƒç”¨ã€‚æ§½å‡½æ•°ä¸ä¸€èˆ¬çš„å‡½æ•°ä¸åŒçš„æ˜¯ï¼šæ§½å‡½æ•°å¯ä»¥ä¸ä¸€ä¸ªä¿¡å·å…³è”ï¼Œå½“ä¿¡å·è¢«å‘å°„æ—¶ï¼Œå…³è”çš„æ§½å‡½æ•°è¢«è‡ªåŠ¨æ‰§è¡Œã€‚</p><p>â€‹ä¿¡å·ä¸æ§½å…³è”æ˜¯ç”¨ QObject::connect() å‡½æ•°å®ç°çš„ï¼Œå…¶åŸºæœ¬æ ¼å¼æ˜¯ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">QObject::<span class="built_in">connect</span>(sender, <span class="built_in">SIGNAL</span>(<span class="built_in">signal</span>()), receiver, <span class="built_in">SLOT</span>(<span class="built_in">slot</span>()));</span><br><span class="line"><span class="built_in">connect</span>(å‘å‡ºä¿¡å·çš„å¯¹è±¡ï¼Œå‘å‡ºçš„ä¿¡å·ï¼Œæ¥æ”¶ä¿¡å·çš„å¯¹è±¡ï¼Œæ¥æ”¶åˆ°ä¿¡å·ä¹‹åéœ€è¦è°ƒç”¨çš„å‡½æ•°ï¼ˆæ§½å‡½æ•°ï¼‰ï¼‰</span><br></pre></td></tr></table></figure><p><strong>connect()å‡½æ•°æœ€å¸¸ç”¨çš„ä¸€èˆ¬å½¢å¼ï¼š</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">connect</span>(sender, <span class="built_in">signal</span>(ä¿¡å·ï¼‰, receiver, slotï¼ˆæ§½ï¼‰);</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2025/03/13/67d27c859f78b.png"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºç¬¬ä¸€ä¸ªæŒ‰é’®</span></span><br><span class="line">  QPushButton *btn=<span class="keyword">new</span> QPushButton;</span><br><span class="line">  <span class="comment">//ä¸èƒ½ç”¨btn-&gt;show();//showæ˜¯ä»¥é¡¶å±‚æ–¹å¼å¼¹å‡ºæ§ä»¶</span></span><br><span class="line">  <span class="comment">//è®©btnåœ¨widgetçª—å£æ˜¾ç¤º</span></span><br><span class="line">  btn-&gt;<span class="built_in">setParent</span>(<span class="keyword">this</span>);<span class="comment">//thisæŒ‡å‘å½“å‰å¯¹è±¡çš„æŒ‡é’ˆï¼ˆå³widgetçš„åœ°å€ï¼‰</span></span><br><span class="line">  <span class="comment">//æ˜¾ç¤ºæ–‡æœ¬</span></span><br><span class="line">  btn-&gt;<span class="built_in">setText</span>(<span class="string">&quot;å…³é—­çª—å£&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//ç”¨ä¿¡å·å’Œæ§½å»å®ç°ç‚¹å‡»æŒ‰é’®å…³é—­çª—å£</span></span><br><span class="line">  <span class="built_in">connect</span>(btn,&amp;QPushButton::clicked,<span class="keyword">this</span>,&amp;QWidget::close);</span><br></pre></td></tr></table></figure><h3 id="äºŒã€è‡ªå®šä¹‰ä¿¡å·æ§½"><a href="#äºŒã€è‡ªå®šä¹‰ä¿¡å·æ§½" class="headerlink" title="äºŒã€è‡ªå®šä¹‰ä¿¡å·æ§½"></a><font color="FF0000">äºŒã€è‡ªå®šä¹‰ä¿¡å·æ§½</font></h3><p>1ã€å®šä¹‰è‡ªå®šä¹‰ä¿¡å·</p><p>åœ¨è¿™ä¸ªçš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å…ˆè®¾å®šä¸€ä¸ªéœ€æ±‚ï¼šå±Œä¸ç”·å‘å‘ç™½å¯Œç¾è¡¨ç™½ï¼Œå‘é€è¡¨ç™½ä¿¡å·ï¼Œç™½å¯Œç¾æ¥æ”¶ä¿¡å·ï¼Œå¹¶å›åº”åŒæ„ã€‚</p><p>è¿™é‡Œé¢æœ‰ä¸¤ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªå±Œä¸ç”·ï¼Œä¸€ä¸ªç™½å¯Œç¾ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è‡ªå®šä¹‰çš„ä¿¡å·å’Œæ§½å°†ä»–ä»¬è”ç³»èµ·æ¥ã€‚</p><p><img src="https://bu.dusays.com/2025/03/13/67d27ebd77f3f.png"></p><p>ç±»åè‡ªå®šä¹‰ä¸ºboyï¼Œé€‰æ‹©QObjectä¸ºåŸºç±»æ˜¯ä¸ºäº†å°†æ­¤ç±»åŠ å…¥qt childrenä¸­ï¼Œè€Œ QObject æ˜¯æœ€åŸºæœ¬çš„ç±»ã€‚ä»¥åŒæ ·çš„æ–¹å¼åˆ›å»ºGirlç±»ã€‚</p><p>2ã€åœ¨boyç±»ä¸­åŠ å…¥è‡ªå®šä¹‰ä¿¡å·</p><p><img src="https://bu.dusays.com/2025/03/14/67d3e97f319ca.png"></p><p>3ã€ åœ¨Girlç±»å¤´æ–‡ä»¶å’Œæºæ–‡ä»¶æ·»åŠ è‡ªå®šä¹‰æ§½å‡½æ•°çš„å®šä¹‰å’Œå®ç°</p><p><img src="https://bu.dusays.com/2025/03/14/67d3ea0b48134.png"></p><p><img src="https://bu.dusays.com/2025/03/14/67d3ea110e236.png"></p><p>4ã€ åœ¨widget.hä¸­çš„widgetç±»ä¸­æ·»åŠ ä¸¤ä¸ªæˆå‘˜ï¼Œä¸€ä¸ªboyå¯¹è±¡xggï¼ˆå°å“¥å“¥ï¼‰ï¼Œgirlå¯¹è±¡xjjï¼ˆå°å§å§ï¼‰ä¸¤ä¸ªæŒ‡é’ˆã€‚</p><p><img src="https://bu.dusays.com/2025/03/14/67d3ea460c19f.png"></p><p>5ã€ åœ¨widget.cppä¸­newå‡ºå¯¹è±¡å¹¶æ·»åŠ è¿æ¥ã€‚</p><p><img src="https://bu.dusays.com/2025/03/07/67cad87144911.png"></p><p>6ã€ è¿è¡Œç¨‹åºï¼Œç¨‹åºåœ¨è¡¨ç™½å‡½æ•°ä¸­å‘é€ç¤ºçˆ±ä¿¡æ¯ï¼Œæ¥æ”¶è€…æ”¶åˆ°ä¿¡æ¯å¹¶æ‰§è¡Œç›¸åº”çš„æ§½å‡½æ•°ã€‚</p><p>è¿è¡Œç»“æœï¼šæ‰“å°å‡ºäº†æ§½å‡½æ•°ä¸­çš„ä¿¡æ¯ã€‚å®ç°äº†è‡ªå®šä¹‰çš„ä¿¡å·å’Œæ§½å‡½æ•°</p><p><img src="https://bu.dusays.com/2025/03/14/67d3ea8da7844.png"></p><p>7ã€ æ€»ç»“ï¼šè‡ªå®šä¹‰ä¿¡å·å’Œæ§½çš„åŒºåˆ«ï¼Œ<strong>ä¿¡å·å’Œæ§½éƒ½ä¸ºvoidç±»å‹</strong>ï¼Œä¿¡å·åªéœ€è¦å®šä¹‰ï¼Œ<strong>ä¸éœ€è¦å®ç°</strong>ï¼Œè€Œæ§½å‡½æ•°<strong>æ—¢éœ€è¦å®šä¹‰ï¼Œä¹Ÿéœ€è¦å®ç°</strong>ï¼Œ<strong>ä¿¡å·å’Œæ§½éƒ½å¯ä»¥æœ‰å‚æ•°ä¹Ÿéƒ½å¯ä»¥é‡è½½</strong>ã€‚emitæ˜¯å‡ºå‘ä¿¡å·çš„æ ‡å¿—ï¼Œå¯è¦å¯ä¸è¦ã€‚</p><h3 id="ä¸‰ã€è‡ªå®šä¹‰ä¿¡å·å’Œæ§½å‘ç”Ÿé‡è½½å¦‚ä½•è§£å†³ï¼Ÿ"><a href="#ä¸‰ã€è‡ªå®šä¹‰ä¿¡å·å’Œæ§½å‘ç”Ÿé‡è½½å¦‚ä½•è§£å†³ï¼Ÿ" class="headerlink" title="ä¸‰ã€è‡ªå®šä¹‰ä¿¡å·å’Œæ§½å‘ç”Ÿé‡è½½å¦‚ä½•è§£å†³ï¼Ÿ"></a><font color="FF0000">ä¸‰ã€è‡ªå®šä¹‰ä¿¡å·å’Œæ§½å‘ç”Ÿé‡è½½å¦‚ä½•è§£å†³ï¼Ÿ</font></h3><p>è‡ªå®šä¹‰çš„ä¿¡å·å’Œæ§½<strong>å¯ä»¥å¸¦å‚æ•°</strong>ï¼Œ<strong>å¯ä»¥é‡è½½</strong>ï¼Œä½†æ˜¯é‡è½½ï¼ˆæˆ–è€…å¸¦å‚æ•°ï¼‰åå¦‚ä½•å»ç”¨connectå…³è”å‘¢ï¼Ÿ</p><p>é¦–å…ˆçœ‹éœ€æ±‚ï¼Œé«˜å¯Œå¸…è¡¨ç™½æˆåŠŸåï¼Œä»–ä»¬å°±å¾ˆæœ‰é»˜å¥‘äº†ã€‚ä»–ä»¬å°±è¦çº¦ä¼šå¯¹ä¸ä¼šï¼Œç”·çš„æƒ³è¯´æˆ‘ä»¬å»çœ‹ç”µå½±å§ï¼Œå¥³å­©å°±å¾ˆå¬ç”·çš„è¯ï¼Œæ”¶åˆ°ä¿¡å·åï¼Œå°±åŒæ„ç”·å­©ï¼Œæˆ‘ä»¬å°±å»çœ‹ç”µå½±ï¼Œå°±æ˜¯ç”·å­©è¯´ä»€ä¹ˆï¼Œå¥³å­©å°±åŒæ„ç”·å­©ä¹Ÿè¯´ä»€ä¹ˆï¼Œè¿™ä¹‹é—´çš„è¯ï¼Œå°±é€šè¿‡ä¿¡å·çš„å‚æ•°æ¥ä¼ é€’ã€‚</p><p>å¥½ï¼Œè¿˜æ˜¯æ¥åˆ°æˆ‘ä»¬ä¸ŠèŠ‚è¯¾çš„é¡¹ç›®ã€‚</p><p>1ã€ åœ¨boy.hçš„signalsä¸‹é‡è½½loveå‡½æ•°ï¼Œå¸¦ä¸€ä¸ªQStringå‚æ•°ï¼Œå°±æ˜¯è¿™ä¸ªä¼ è¿‡å»ä¸€å¥è¯ï¼Œå¥³å­©ä¹Ÿè¯´è¿™å¥è¯ã€‚</p><p><img src="https://bu.dusays.com/2025/03/14/67d3eb6b3233b.png"></p><p>è®°ä½ï¼Œè¿™ä¸ªä¿¡å·åªéœ€è¦å®šä¹‰ï¼Œä¸éœ€è¦å®ç°ï¼Œåªè¦çŸ¥é“å®šä¹‰äº†è¿™ä¹ˆä¸€ä¸ªå¸¦ä¸€ä¸ªå‚æ•°çš„ä¿¡å·å°±è¡Œäº†ã€‚è§¦å‘è¿™ä¸ªä¿¡å·ï¼Œè¿˜éœ€è¦ä¸€ä¸ªQStringçš„å‚æ•°ã€‚</p><p>2ã€ åœ¨girl.cppä¹Ÿé‡è½½ä¸€ä¸ªå¸¦å‚æ•°çš„å›åº”çš„æ§½å‡½æ•°</p><p><img src="https://bu.dusays.com/2025/03/14/67d3eafc0227e.png"></p><p><img src="https://bu.dusays.com/2025/03/14/67d3eb4298513.png"></p><p>åœ¨å®ç°çš„å‡½æ•°ï¼Œå°†å‚æ•°è¾“å‡º</p><p>3ã€ å›åˆ°widget.cppä¸­ä¼šå‘ç°åŸæ¥å†™å¥½çš„æ²¡é—®é¢˜çš„connectå‡½æ•°æœ‰é”™è¯¯äº†ã€‚</p><p><img src="https://bu.dusays.com/2025/03/07/67cadb9162646.png"></p><p><img src="https://bu.dusays.com/2025/03/14/67d3ebb51a45e.png"></p><p>ç¼–è¯‘åå‘ç°é”™è¯¯ï¼Œé‡è½½å‡½æ•°æœ‰æ­§ä¹‰é”™è¯¯ã€‚ä»€ä¹ˆæ„æ€å‘¢ï¼Œä¿¡å·å’Œæ§½çš„è¿æ¥å‡½æ•°ä¸­ï¼Œå°±æ˜¯ä¸€ä¸ªå‡½æ•°åï¼Œä¹Ÿå°±æ˜¯å‡½æ•°åœ°å€ï¼Œæœ‰æ²¡æœ‰å‘ç°ï¼Œæˆ‘ä»¬åœ¨é‡è½½ä¹‹åï¼Œå°±æœ‰äº†ä¸¤ä¸ªloveä¿¡å·ï¼Œä¹Ÿæœ‰äº†ä¸¤ä¸ªlovetooæ§½ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œåˆ°åº•æŒ‡çš„æ˜¯å“ªä¸€ä¸ªå‘¢ï¼Ÿè¿™å°±è®©ç¼–è¯‘å™¨ä¸ºéš¾äº†ã€‚</p><p>4ã€ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¸¦å‚æ•°çš„å‡½æ•°æŒ‡é’ˆæ¥æŒ‡å‘æˆ‘ä»¬æ‰€è¦æŒ‡å‘çš„é‚£ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå°±å¯ä»¥æ¶ˆé™¤æ­§ä¹‰ã€‚</p><p><img src="https://bu.dusays.com/2025/03/14/67d3ec0d033cf.png"></p><p>è¿™æ ·å­å°±æ¶ˆé™¤é”™è¯¯äº†ã€‚å¯ä»¥ç¼–è¯‘é€šè¿‡ï¼Œå¹¶è¿è¡Œã€‚</p><p>5ã€ ä½†æ˜¯æˆ‘å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œè¿™æ ·èƒ½è¿è¡Œï¼Œä½†æ˜¯å°±ä»€ä¹ˆè¾“å‡ºéƒ½æ²¡äº†ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæˆ‘å·²ç»æŠŠå‰é¢çš„è¿æ¥å‡½æ•°æ³¨é‡Šäº†ï¼Œæˆ‘ä»¬è¿æ¥çš„å¸¦å‚æ•°çš„ä¿¡å·ï¼Œè€Œæˆ‘ä»¬åŸæ¥çš„å‡ºå‘ä¿¡å·çš„å‡½æ•°æ˜¯æ²¡æœ‰å¸¦å‚æ•°çš„ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºå‘è¿™ä¸ªå¸¦å‚æ•°çš„ä¿¡å·ï¼Œä¿¡å·æ˜¯å¯ä»¥å¤šæ¬¡å‡ºå‘çš„ï¼Œæˆ‘ä»¬åœ¨è¡¨ç™½çš„å‡½æ•°ä¸­å‡ºå‘ä¸€ä¸ªå¸¦å‚æ•°çš„ä¿¡å·</p><p><img src="https://bu.dusays.com/2025/03/14/67d3ec52acb19.png"></p><p>å†è¿è¡Œ</p><p><img src="https://bu.dusays.com/2025/03/14/67d3ec6b5ced4.png"></p><p>è¿™å°±èƒ½çœ‹åˆ°å¥³å­©é‚£è¾¹å›åº”çš„ä¹Ÿæ˜¯åŒæ ·çš„ä¸€å¥è¯ã€‚è¯´æ˜ä¿¡å·è·‘é€šäº†ã€‚</p><p>6ã€ æ€»ç»“ï¼šæ³¨æ„ä¿¡å·é‡è½½å‡½æ•°æŒ‡é’ˆæŒ‡å‘å“ªä¸€ä¸ªå‡½æ•°çš„é—®é¢˜ï¼Œå¯¹äºé‡è½½å‡½æ•°çš„ä¿¡å·è¿æ¥ï¼Œè¦æŒ‡æ˜åˆ°åº•è¿æ¥çš„æ˜¯å“ªä¸€ä¸ªï¼Ÿ</p><h3 id="å››ã€ä¿¡å·è¿æ¥ä¿¡å·"><a href="#å››ã€ä¿¡å·è¿æ¥ä¿¡å·" class="headerlink" title="å››ã€ä¿¡å·è¿æ¥ä¿¡å·"></a><font color="FF0000">å››ã€ä¿¡å·è¿æ¥ä¿¡å·</font></h3><p>è¿™éƒ¨åˆ†ä¸æ”¾ä»£ç äº†ï¼Œè‡ªå·±å°è¯•ç€å®è·µã€‚</p><ol><li>ä¿¡å·å¯ä»¥è¿æ¥ä¿¡å·</li><li>ä¸€ä¸ªä¿¡å·å¯ä»¥è¿æ¥å¤šä¸ªæ§½ï¼ˆç‚¹å‡»æŒ‰é’®ï¼Œè§¦å‘ä¿¡å·å¹¶å…³é—­çª—å£ï¼‰</li><li>å¤šä¸ªä¿¡å·å¯ä»¥è¿æ¥åŒä¸€ä¸ªæ§½ï¼ˆæ¯”å¦‚å¤šä¸ªæŒ‰é’®éƒ½å¯ä»¥å…³é—­çª—å£ï¼‰</li><li>è‡ªå®šä¹‰æ§½å‡½æ•°å¯ä»¥å†™æˆï¼š<ol><li>ç±»çš„ä»»æ„æˆå‘˜å‡½æ•°</li><li>é™æ€å‡½æ•°</li><li>å…¨å±€å‡½æ•°</li><li>lambdaè¡¨è¾¾å¼</li></ol></li></ol><p><strong>å½’æ ¹ç©¶åº•ï¼šè¿æ¥çš„åŸåˆ™å°±æ˜¯ä¿¡å·å’Œæ§½çš„å‚æ•°å¿…é¡»ä¸€ä¸€å¯¹åº”ï¼ï¼</strong></p><h3 id="äº”ã€lambadè¡¨è¾¾å¼"><a href="#äº”ã€lambadè¡¨è¾¾å¼" class="headerlink" title="äº”ã€lambadè¡¨è¾¾å¼"></a><font color="FF0000">äº”ã€lambadè¡¨è¾¾å¼</font></h3><p>è¡¨è¾¾å¼ç”¨äºå®šä¹‰å¹¶åˆ›å»ºåŒ¿åçš„å‡½æ•°å¯¹è±¡ï¼Œä»¥ç®€åŒ–ç¼–ç¨‹å·¥ä½œã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[å‡½æ•°å¯¹è±¡å‚æ•°](æ“ä½œç¬¦é‡è½½å‡½æ•°å‚æ•°)<span class="keyword">mutable</span>æˆ–exception-&gt;è¿”å›å€¼</span><br><span class="line">&#123;</span><br><span class="line">å‡½æ•°ä½“</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>1ï¸âƒ£å‡½æ•°å¯¹è±¡å‚æ•°</strong></p><p>[ ]ï¼Œæ ‡è¯†ä¸€ä¸ª Lambda çš„å¼€å§‹ï¼Œè¿™éƒ¨åˆ†å¿…é¡»å­˜åœ¨ï¼Œä¸èƒ½çœç•¥ã€‚å‡½æ•°å¯¹è±¡å‚æ•° æ˜¯ä¼ é€’ç»™ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„å‡½æ•°å¯¹è±¡ç±»çš„æ„é€ å‡½æ•°çš„ã€‚å‡½æ•°å¯¹è±¡å‚æ•°åªèƒ½ä½¿ ç”¨é‚£äº›åˆ°å®šä¹‰ Lambda ä¸ºæ­¢æ—¶ Lambda æ‰€åœ¨ä½œç”¨èŒƒå›´å†…å¯è§çš„å±€éƒ¨å˜é‡ï¼ˆåŒ…æ‹¬ Lambda æ‰€åœ¨ç±»çš„ thisï¼‰ã€‚å‡½æ•°å¯¹è±¡å‚æ•°æœ‰ä»¥ä¸‹å½¢å¼ï¼šï¼ˆå¸¸ç”¨çš„å°±æ˜¯&#x3D; &amp; this aï¼‰</p><ul><li><strong>ç©º</strong>ã€‚æ²¡æœ‰ä½¿ç”¨ä»»ä½•å‡½æ•°å¯¹è±¡å‚æ•°ã€‚</li><li><strong>&#x3D;</strong>ã€‚å‡½æ•°ä½“å†…å¯ä»¥ä½¿ç”¨ Lambda æ‰€åœ¨ä½œç”¨èŒƒå›´å†…æ‰€æœ‰å¯è§çš„å±€éƒ¨å˜é‡ï¼ˆåŒ… æ‹¬ Lambda æ‰€åœ¨ç±»çš„ thisï¼‰ï¼Œå¹¶ä¸”æ˜¯<strong>å€¼ä¼ é€’æ–¹å¼</strong>ï¼ˆç›¸å½“äºç¼–è¯‘å™¨è‡ªåŠ¨ä¸ºæˆ‘ ä»¬æŒ‰å€¼ä¼ é€’äº†æ‰€æœ‰å±€éƒ¨å˜é‡ï¼‰ã€‚</li><li><strong>&amp;</strong>ã€‚å‡½æ•°ä½“å†…å¯ä»¥ä½¿ç”¨ Lambda æ‰€åœ¨ä½œç”¨èŒƒå›´å†…æ‰€æœ‰å¯è§çš„å±€éƒ¨å˜é‡ï¼ˆåŒ… æ‹¬ Lambda æ‰€åœ¨ç±»çš„ thisï¼‰ï¼Œå¹¶ä¸”æ˜¯<strong>å¼•ç”¨ä¼ é€’æ–¹å¼</strong>ï¼ˆç›¸å½“äºç¼–è¯‘å™¨è‡ªåŠ¨ä¸º æˆ‘ä»¬æŒ‰å¼•ç”¨ä¼ é€’äº†æ‰€æœ‰å±€éƒ¨å˜é‡ï¼‰ã€‚</li><li><strong>this</strong>ã€‚å‡½æ•°ä½“å†…å¯ä»¥ä½¿ç”¨ Lambda æ‰€åœ¨ç±»ä¸­çš„æˆå‘˜å˜é‡ã€‚</li><li><strong>a</strong>ã€‚å°† a æŒ‰å€¼è¿›è¡Œä¼ é€’ã€‚æŒ‰å€¼è¿›è¡Œä¼ é€’æ—¶ï¼Œå‡½æ•°ä½“å†…ä¸èƒ½ä¿®æ”¹ä¼ é€’è¿›æ¥çš„ a çš„æ‹·è´ï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹å‡½æ•°æ˜¯ const çš„ã€‚è¦ä¿®æ”¹ä¼ é€’è¿›æ¥çš„ a çš„æ‹·è´ï¼Œå¯ä»¥æ·»åŠ  mutable ä¿®é¥°ç¬¦ã€‚</li><li><strong>&amp;a</strong>ã€‚å°† a æŒ‰å¼•ç”¨è¿›è¡Œä¼ é€’ã€‚</li><li><strong>a, &amp;b</strong>ã€‚å°† a æŒ‰å€¼è¿›è¡Œä¼ é€’ï¼Œb æŒ‰å¼•ç”¨è¿›è¡Œä¼ é€’ã€‚</li><li><strong>&#x3D;ï¼Œ&amp;a, &amp;b</strong>ã€‚é™¤ a å’Œ b æŒ‰å¼•ç”¨è¿›è¡Œä¼ é€’å¤–ï¼Œå…¶ä»–å‚æ•°éƒ½æŒ‰å€¼è¿›è¡Œä¼ é€’ã€‚</li><li><strong>&amp;, a, b</strong>ã€‚é™¤ a å’Œ b æŒ‰å€¼è¿›è¡Œä¼ é€’å¤–ï¼Œå…¶ä»–å‚æ•°éƒ½æŒ‰å¼•ç”¨è¿›è¡Œä¼ é€’ã€‚</li></ul><p><strong>å¦‚ä½•ç”¨lambdaè¡¨è¾¾å¼å»ä¿®æ”¹æŒ‰é’®çš„åç§°ï¼š</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‡½æ•°å¯¹è±¡å‚æ•°: =</span></span><br><span class="line">[=]()&#123;</span><br><span class="line">         btn-&gt;<span class="built_in">setText</span>(<span class="string">&quot;aaaa&quot;</span>);</span><br><span class="line">     &#125;();</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‡½æ•°å¯¹è±¡å‚æ•°:a</span></span><br><span class="line">     [btn]()&#123;</span><br><span class="line">          btn-&gt;<span class="built_in">setText</span>(<span class="string">&quot;aaaa&quot;</span>);</span><br><span class="line">   <span class="comment">//ç”±äºå‡½æ•°å¯¹è±¡å‚æ•°ä¸ºbtnï¼Œå› æ­¤åªèƒ½å¯¹btnæ“ä½œï¼Œå¼•å…¥btn1ä¼šæŠ¥é”™</span></span><br><span class="line">          <span class="comment">//btn1-&gt;setText(&quot;bbbb&quot;);</span></span><br><span class="line">      &#125;();</span><br></pre></td></tr></table></figure><p><font color="FF0000"><strong>æ³¨æ„ï¼š</strong></font>ä¸åŠ ( )åªæ˜¯å¯¹lambadè¡¨è¾¾å¼çš„å£°æ˜ï¼ŒåŠ ä¸Š( )æ‰æ˜¯å¯¹å®ƒçš„è°ƒç”¨ã€‚ï¼ˆç”±äºbtnåœ¨åˆ›å»ºçš„æ—¶å€™lambadä½œç”¨èŒƒå›´å†…æ˜¯ä¸å¯è§çš„ï¼Œå› æ­¤éœ€è¦ç”¨&#x3D;è®©lambadè¡¨è¾¾å¼è®¤è¯†btnè¿™ä¸ªå±€éƒ¨å˜é‡ï¼‰</p><p><strong>2ï¸âƒ£æ“ä½œç¬¦é‡è½½å‡½æ•°å‚æ•°</strong></p><p>æ ‡è¯†é‡è½½çš„()æ“ä½œç¬¦çš„å‚æ•°ï¼Œæ²¡æœ‰å‚æ•°æ—¶ï¼Œè¿™éƒ¨åˆ†å¯ä»¥çœç•¥ã€‚å‚æ•°å¯ä»¥é€šè¿‡ æŒ‰å€¼ï¼ˆå¦‚ï¼š(a,b)ï¼‰å’ŒæŒ‰å¼•ç”¨ï¼ˆå¦‚ï¼š(&amp;a,&amp;b)ï¼‰ä¸¤ç§æ–¹å¼è¿›è¡Œä¼ é€’</p><p><strong>3ï¸âƒ£å¯ä¿®æ”¹æ ‡ç¤ºç¬¦</strong></p><p>mutable å£°æ˜ï¼Œè¿™éƒ¨åˆ†å¯ä»¥çœç•¥ã€‚æŒ‰å€¼ä¼ é€’å‡½æ•°å¯¹è±¡å‚æ•°æ—¶ï¼ŒåŠ ä¸Š mutable ä¿®é¥°ç¬¦åï¼Œå¯ä»¥ä¿®æ”¹æŒ‰å€¼ä¼ é€’è¿›æ¥çš„æ‹·è´ï¼ˆæ³¨æ„æ˜¯èƒ½ä¿®æ”¹æ‹·è´ï¼Œè€Œä¸æ˜¯å€¼æœ¬èº«ï¼‰</p><p><strong>4ï¸âƒ£é”™è¯¯æŠ›å‡ºæ ‡ç¤ºç¬¦</strong></p><p>exception å£°æ˜ï¼Œè¿™éƒ¨åˆ†ä¹Ÿå¯ä»¥çœç•¥ã€‚exception å£°æ˜ç”¨äºæŒ‡å®šå‡½æ•°æŠ›å‡ºçš„å¼‚å¸¸ï¼Œå¦‚æŠ›å‡ºæ•´æ•°ç±»å‹çš„å¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨ throw(intï¼‰</p><p><strong>5ï¸âƒ£å‡½æ•°è¿”å›å€¼</strong></p><p>-&gt; è¿”å›å€¼ç±»å‹ï¼Œæ ‡è¯†å‡½æ•°è¿”å›å€¼çš„ç±»å‹ï¼Œå½“è¿”å›å€¼ä¸º voidï¼Œæˆ–è€…å‡½æ•°ä½“ä¸­åªæœ‰ä¸€å¤„ return çš„åœ°æ–¹ï¼ˆæ­¤æ—¶ç¼–è¯‘å™¨å¯ä»¥è‡ªåŠ¨æ¨æ–­å‡ºè¿”å›å€¼ç±»å‹ï¼‰æ—¶ï¼Œè¿™éƒ¨åˆ†å¯ä»¥çœç•¥ã€‚</p><p><strong>å¦‚</strong>ï¼šintä¸€ä¸ªretå»æ¥æ”¶lanbdaè¡¨è¾¾å¼è¿”å›çš„ç»“æœï¼ˆæ³¨æ„ï¼šè¦ç”¨-&gt;æ ‡è¯†è¿”å›å€¼çš„ç±»å‹ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> ret=[]()-&gt;<span class="type">int</span>&#123;<span class="keyword">return</span> <span class="number">1000</span>;&#125;();</span><br><span class="line"><span class="built_in">qDebug</span>()&lt;&lt;<span class="string">&quot;ret=:&quot;</span>&lt;&lt;ret;ã€€ã€€</span><br></pre></td></tr></table></figure><p><strong>6ï¸âƒ£å‡½æ•°ä½“</strong></p><p>{ }ï¼Œæ ‡è¯†å‡½æ•°çš„å®ç°ï¼Œè¿™éƒ¨åˆ†ä¸èƒ½çœç•¥ï¼Œä½†å‡½æ•°ä½“å¯ä»¥ä¸ºç©º</p><p><strong>ğŸ’›ğŸ’›ğŸ’›æ§½å‡½æ•°ä¹Ÿå¯ä»¥ä½¿ç”¨ Lambda è¡¨è¾¾å¼çš„æ–¹å¼è¿›è¡Œå¤„ç†ï¼š</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">//åˆ›å»ºä¸¤ä¸ªæŒ‰é’®</span></span><br><span class="line"> QPushButton *myBtn = <span class="keyword">new</span> <span class="built_in">QPushButton</span>(<span class="keyword">this</span>);</span><br><span class="line"> QPushButton *myBtn1 = <span class="keyword">new</span> <span class="built_in">QPushButton</span>(<span class="keyword">this</span>);</span><br><span class="line"> <span class="comment">//ç§»åŠ¨ç¬¬äºŒä¸ªæŒ‰é’®</span></span><br><span class="line"> myBtn1-&gt;<span class="built_in">move</span>(<span class="number">100</span>,<span class="number">100</span>);</span><br><span class="line"> <span class="type">int</span> m =<span class="number">10</span>;</span><br><span class="line"> <span class="comment">//ç”¨æ§½å‡½æ•°ï¼ˆlambdaè¡¨è¾¾å¼ï¼‰æ”¹å˜mçš„copyå€¼</span></span><br><span class="line"> <span class="built_in">connect</span>(myBtn,&amp;QPushButton::clicked,<span class="keyword">this</span>,[m]()<span class="keyword">mutable</span>&#123;m=<span class="number">100</span> + <span class="number">10</span>;<span class="built_in">qDebug</span>() &lt;&lt; m;&#125;);</span><br><span class="line"> <span class="built_in">connect</span>(myBtn1,&amp;QPushButton::clicked,<span class="keyword">this</span>,[=]() &#123;<span class="built_in">qDebug</span>() &lt;&lt; m;&#125;);</span><br><span class="line"> <span class="built_in">qDebug</span>() &lt;&lt; m;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºç¬¬ä¸€ä¸ªconnectå‡½æ•°æ¥è¯´ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">connect</span>(myBtn,&amp;QPushButton::clicked,<span class="keyword">this</span>,[m]()<span class="keyword">mutable</span>&#123;m=<span class="number">100</span><span class="number">+10</span>;<span class="built_in">qDebug</span>()&lt;&lt;m;&#125;);</span><br></pre></td></tr></table></figure><p>å½“å‡½æ•°å¯¹è±¡å‚æ•°ä¸ºmæ—¶å€™ï¼Œè‹¥è¦ä¿®æ”¹è¯¥å€¼ä¼ é€’è¿›æ¥çš„æ‹·è´ï¼Œéœ€è¦åŠ ä¸Šmutable å…³é”®å­—ã€‚ï¼ˆæ³¨æ„åªèƒ½ä¿®æ”¹æ‹·è´ï¼Œè€Œä¸æ˜¯å€¼æœ¬èº«ï¼‰</p><p><strong>ä¸€èˆ¬æ¥è¯´ï¼Œlambdaè¡¨è¾¾å¼ä¸­å¾ˆå°‘å»åŠ å…³é”®å­—çš„ï¼Œé™¤éä½ æœ‰ä»€ä¹ˆç‰¹æ®Šçš„éœ€æ±‚ã€‚</strong></p><p><strong>æ€»çš„æ¥è¯´ï¼š</strong></p><ul><li>ç”¨lambdaå†™æ§½å‡½æ•°å¯ä»¥åœ¨lambdaè¡¨è¾¾å¼çš„å‡½æ•°ä½“å†…å†™å¤šä¸ªå‡½æ•°ã€‚ï¼ˆå¦‚ä¸Šé¢m&#x3D;100+10;å’ŒqDebug()&lt;&lt;m;)</li><li>lambdaå¸¸ç”¨è¡¨è¾¾å¼ï¼š</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[=]()&#123;&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºåµŒå¥—çª—å£ï¼Œå…¶åæ ‡æ˜¯ç›¸å¯¹äºçˆ¶çª—å£æ¥è¯´çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Qt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qtå­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qt01å¯¹è±¡æ ‘å’Œçª—å£åæ ‡ä½“ç³»</title>
      <link href="/2025/03/13/Qt01%E5%AF%B9%E8%B1%A1%E6%A0%91%E5%92%8C%E7%AA%97%E5%8F%A3%E5%9D%90%E6%A0%87%E4%BD%93%E7%B3%BB/"/>
      <url>/2025/03/13/Qt01%E5%AF%B9%E8%B1%A1%E6%A0%91%E5%92%8C%E7%AA%97%E5%8F%A3%E5%9D%90%E6%A0%87%E4%BD%93%E7%B3%BB/</url>
      
        <content type="html"><![CDATA[<h3 id="ä¸€ã€QTåŸºæœ¬æ¡†æ¶"><a href="#ä¸€ã€QTåŸºæœ¬æ¡†æ¶" class="headerlink" title="ä¸€ã€QTåŸºæœ¬æ¡†æ¶"></a><font color = "FF0000">ä¸€ã€QTåŸºæœ¬æ¡†æ¶</font></h3><p>åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œå…ˆçœ‹ä¸‹main.cppè¿™ä¸ªæ–‡ä»¶</p><p><img src="https://bu.dusays.com/2025/03/13/67d2403c08fc9.png"></p><p><strong><font color = "FF0000">æ³¨æ„ï¼š</font></strong></p><ol><li>æ¯ä¸ªQtç¨‹åºæœ‰ä¸”åªèƒ½æœ‰ä¸€ä¸ªQApplicationå¯¹è±¡ï¼Œæ²¡æœ‰ä¼šæŠ¥é”™ã€‚</li><li>Qté‡Œé¢çš„å¤´æ–‡ä»¶å’Œç±»åæ˜¯ä¸€è‡´çš„ï¼ŒçŸ¥é“å¤´æ–‡ä»¶å°±çŸ¥é“ç±»åï¼Œåä¹‹äº¦ç„¶</li><li>Qtå¤´æ–‡ä»¶æ˜¯æ²¡æœ‰.hçš„ï¼ŒåŸºæœ¬éƒ½æ˜¯ä»¥å¤§å†™çš„Qå¼€å¤´</li></ol><p>æ ¹æ®ä»¥ä¸Šçš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºQtçš„ç¨‹åºæ¡†æ¶ä»£ç ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QApplication&gt;</span>      </span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;  </span><br><span class="line">     <span class="comment">/*</span></span><br><span class="line"><span class="comment">       åœ¨è¿™é‡Œå†™ä½ çš„ä»£ç </span></span><br><span class="line"><span class="comment">     */</span>     </span><br><span class="line">    <span class="keyword">return</span> a.<span class="built_in">exec</span>();      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>widget.hå’Œwidget.cppåˆ†æ</strong></li></ul><p>æ‰“å¼€å¤´æ–‡ä»¶é‡Œé¢çš„widget.h,å’Œsourcesé‡Œé¢çš„widget.appï¼Œå¯ä»¥çœ‹åˆ°ä»¥ä¸‹ä»£ç ï¼š</p><p><img src="https://bu.dusays.com/2025/03/13/67d242912f352.png"></p><p><img src="https://bu.dusays.com/2025/03/13/67d242a1e99ab.png"></p><p>æœ€ä¸Šé¢çš„<strong>MyfirstQt.pro</strong>,æ˜¯ç®¡ç†é¡¹ç›®çš„æ–‡ä»¶ï¼Œç”¨æ¥å­˜å‚¨é¡¹ç›®è®¾ç½®ã€‚</p><p>åç¼€ä¸ºâ€œ.proâ€çš„æ–‡ä»¶æ˜¯é¡¹ç›®çš„ç®¡ç†æ–‡ä»¶ï¼Œæ–‡ä»¶åå°±æ˜¯é¡¹ç›®çš„åç§°ï¼Œå¦‚æœ¬é¡¹ç›®ä¸­çš„ MyfirstQt.proã€‚ï¼ˆç±»ä¼¼ä¸VSå·¥ç¨‹çš„.slnæ–‡ä»¶ï¼‰</p><p><strong>ğŸ’›ğŸ’›å®ä¾‹ï¼ˆç”¨ä»£ç åˆ›å»ºä¸€ä¸ªbuttonï¼‰ï¼š</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;widget.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ui_widget.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;QPushButton&gt;</span><span class="comment">//æŒ‰é’®æ§ä»¶çš„å¤´æ–‡ä»¶</span></span></span><br><span class="line"></span><br><span class="line">Widget::<span class="built_in">Widget</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QWidget</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::Widget)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºç¬¬ä¸€ä¸ªæŒ‰é’®</span></span><br><span class="line">    QPushButton *btn=<span class="keyword">new</span> QPushButton;</span><br><span class="line">    <span class="comment">//ä¸èƒ½ç”¨btn-&gt;show();//showæ˜¯ä»¥é¡¶å±‚æ–¹å¼å¼¹å‡ºæ§ä»¶</span></span><br><span class="line">    <span class="comment">//è®©btnåœ¨widgetçª—å£æ˜¾ç¤º</span></span><br><span class="line">    btn-&gt;<span class="built_in">setParent</span>(<span class="keyword">this</span>);<span class="comment">//thisæŒ‡å‘å½“å‰å¯¹è±¡çš„æŒ‡é’ˆï¼ˆå³widgetçš„åœ°å€ï¼‰</span></span><br><span class="line">    <span class="comment">//æ˜¾ç¤ºæ–‡æœ¬</span></span><br><span class="line">    btn-&gt;<span class="built_in">setText</span>(<span class="string">&quot;ç¬¬ä¸€ä¸ªæŒ‰é’®&quot;</span>);</span><br><span class="line">    <span class="comment">//åˆ›å»ºç¬¬äºŒä¸ªæŒ‰é’®</span></span><br><span class="line">    <span class="comment">//æ³¨æ„ï¼šè¿™ç§æ–¹æ³•æ˜¯æŒ‰ç…§æŒ‰é’®çš„å¤§å°åˆ›å»ºçª—å£</span></span><br><span class="line">    QPushButton *btn2=<span class="keyword">new</span> <span class="built_in">QPushButton</span>(<span class="string">&quot;ç¬¬äºŒä¸ªæŒ‰é’®&quot;</span>,<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">//ç§»åŠ¨btn2çš„ä½ç½®ï¼ˆç”±äºåˆ›å»ºçš„ä¸¤ä¸ªæŒ‰é’®ä½ç½®é‡å äº†ï¼‰</span></span><br><span class="line">    btn2-&gt;<span class="built_in">move</span>(<span class="number">100</span>,<span class="number">100</span>);</span><br><span class="line">    <span class="comment">//å› æ­¤éœ€è¦é‡ç½®çª—å£å¤§å°</span></span><br><span class="line">    <span class="built_in">resize</span>(<span class="number">600</span>,<span class="number">400</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è®¾ç½®çª—å£æ ‡é¢˜</span></span><br><span class="line">    <span class="built_in">setWindowTitle</span>(<span class="string">&quot;å”¯æœ‰è‡ªå·±å¼ºå¤§&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="äºŒã€å¯¹è±¡æ ‘"><a href="#äºŒã€å¯¹è±¡æ ‘" class="headerlink" title="äºŒã€å¯¹è±¡æ ‘"></a><font color = "FF0000">äºŒã€å¯¹è±¡æ ‘</font></h3><p><strong>ğŸ’šğŸ’šä»€ä¹ˆæ˜¯å¯¹è±¡æ ‘ï¼Ÿ</strong></p><p>æˆ‘ä»¬å¸¸å¸¸å¬åˆ° QObject ä¼šç”¨å¯¹è±¡æ ‘æ¥ç»„ç»‡ç®¡ç†è‡ªå·±ï¼Œé‚£ä»€ä¹ˆæ˜¯å¯¹è±¡æ ‘ï¼Ÿ</p><p>è¿™ä¸ªæ¦‚å¿µéå¸¸å¥½ç†è§£ã€‚å› ä¸º QObject ç±»å°±æœ‰ä¸€ä¸ªç§æœ‰å˜é‡ QList&lt;QObject *&gt;ï¼Œä¸“é—¨å­˜å‚¨è¿™ä¸ªç±»çš„å­å­™åä»£ä»¬ã€‚æ¯”å¦‚åˆ›å»ºä¸€ä¸ª QObject å¯¹è±¡å¹¶æŒ‡å®šçˆ¶å¯¹è±¡æ—¶ï¼Œå°±ä¼šæŠŠè‡ªå·±åŠ å…¥åˆ°çˆ¶å¯¹è±¡çš„ childre() åˆ—è¡¨ä¸­ï¼Œä¹Ÿå°±æ˜¯ QList&lt;QObject *&gt; å˜é‡ä¸­ã€‚</p><p> çˆ¶å¯¹è±¡ææ„çš„æ—¶å€™ï¼Œè¿™ä¸ªåˆ—è¡¨ä¸­çš„æ‰€æœ‰å¯¹è±¡ä¹Ÿä¼šè¢«ææ„ã€‚<strong>ï¼ˆæ³¨æ„ï¼Œè¿™ é‡Œçš„çˆ¶å¯¹è±¡å¹¶ä¸æ˜¯ç»§æ‰¿æ„ä¹‰ä¸Šçš„çˆ¶ç±»ï¼ï¼‰</strong></p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæœ‰ä¸€ä¸ªçª—å£ Windowï¼Œé‡Œé¢æœ‰ Labelæ ‡ç­¾ã€TextEditæ–‡æœ¬è¾“å…¥æ¡†ã€ButtonæŒ‰é’®è¿™ä¸‰ä¸ªå…ƒç´ ï¼Œå¹¶ä¸”éƒ½è®¾ç½® Window ä¸ºå®ƒä»¬çš„çˆ¶å¯¹è±¡ã€‚è¿™æ—¶å€™æˆ‘åšäº†ä¸€ä¸ªå…³é—­çª—å£çš„æ“ä½œï¼Œä½œä¸ºç¨‹åºå‘˜çš„ä½ æ˜¯ä¸æ˜¯è‡ªç„¶æƒ³åˆ°å°†æ‰€æœ‰å’Œçª—å£ç›¸å…³çš„å¯¹è±¡ææ„å•Šï¼Ÿå¤è€çš„åŠæ³•å°±æ˜¯ä¸€ä¸ªä¸ªæ‰‹åŠ¨ delete å‘—ã€‚æ˜¯ä¸æ˜¯å¾ˆéº»çƒ¦ï¼ŸQt è¿ç”¨å¯¹è±¡æ ‘æ¨¡å¼ï¼Œå½“çˆ¶å¯¹è±¡è¢«ææ„æ—¶ï¼Œå­å¯¹è±¡è‡ªåŠ¨å°± delete æ‰äº†ï¼Œä¸ç”¨å†å†™ä¸€å¤§å †çš„ä»£ç äº†ã€‚</p><p><strong>QWidget æ˜¯èƒ½å¤Ÿåœ¨å±å¹•ä¸Šæ˜¾ç¤ºçš„ä¸€åˆ‡ç»„ä»¶çš„çˆ¶ç±»ï¼ˆQWidget ç»§æ‰¿è‡ª QObjectï¼Œå› æ­¤ä¹Ÿç»§æ‰¿äº†è¿™ç§å¯¹è±¡æ ‘å…³ç³»ã€‚ï¼‰</strong></p><p><strong>ğŸ’›ğŸ’›æ³¨æ„æ„å»º&#x2F;ææ„ QObject çš„é¡ºåºé—®é¢˜</strong></p><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œæœ€åè¢«åˆ›å»ºå‡ºæ¥çš„ä¼šå…ˆè¢«ææ„æ‰ã€‚å°±å¥½æ¯”æˆ‘æœ‰ä¸€ä¸ªå¤§æ¡Œå­ï¼Œä¸Šé¢å…ˆæ‘†æ”¾ä¸€ä¸ªç›˜å­ï¼Œå†æ‘†æ”¾ä¸€ä¸ªç¢—ã€‚å½“æˆ‘è¦æŠŠæ¡Œå­æ’¤æ‰çš„æ—¶å€™ï¼Œä¼šå…ˆæ’¤æ‰ç¢—ï¼Œå†æ’¤æ‰ç›˜å­ï¼Œæœ€åæ’¤æ‰æ¡Œå­ã€‚</p><p>ç”¨ä»£ç æ¼”ç¤ºä¸€ä¸‹ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     QWidget window;</span><br><span class="line">     <span class="function">QPushButton <span class="title">quit</span><span class="params">(<span class="string">&quot;Quit&quot;</span>, &amp;window)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ååˆ›å»ºçš„ quit å¯¹è±¡æŒ‡å®šäº† window ä¸ºå…¶çˆ¶å¯¹è±¡ã€‚é‚£ä¹ˆå…³é—­ç¨‹åºæ—¶ï¼Œä¼šå…ˆè°ƒç”¨å®ƒçš„ææ„å‡½æ•°ï¼Œç„¶åè°ƒç”¨ window çš„ææ„å‡½æ•°ã€‚</p><p><strong><font color="FF0000">è¿™å°±ç‰µæ‰¯åˆ°ä¸€ä¸ªç‰¹æ®Šæƒ…å†µï¼š</font></strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QPushButton <span class="title">quit</span><span class="params">(<span class="string">&quot;Quit&quot;</span>)</span></span>;</span><br><span class="line">    QWidget window;</span><br><span class="line"> </span><br><span class="line">    quit.<span class="built_in">setParent</span>(&amp;window);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœåè¿‡æ¥ï¼Œç”±äº window ååˆ›å»ºï¼Œç¨‹åºå…³é—­æ—¶å…ˆè°ƒç”¨ window çš„ææ„å‡½æ•°ï¼ˆæ­¤æ—¶ quit è¢«ç¬¬ä¸€æ¬¡ææ„ï¼‰ã€‚æ¥ç€è°ƒç”¨ quit çš„ææ„å‡½æ•°ï¼ˆæ­¤æ—¶ quit è¢«ç¬¬äºŒæ¬¡ææ„ï¼‰ï¼Œè¿™æ—¶ç”±äºè¢«ä¸¤æ¬¡ææ„ï¼Œæ‰€ä»¥å‡ºé—®é¢˜äº†ã€‚</p><p>è¿™ç§ç‰¹æ®Šæƒ…å†µåœ¨ç¼–ç¨‹ä¸­å¾ˆéšè”½ï¼Œä¸å®¹æ˜“å‘ç°ã€‚å› ä¸ºç¼–è¯‘çš„æ—¶å€™ä¸ä¼šæŠ¥é”™ï¼Œåªæœ‰è¿è¡Œæ—¶æ‰ä¼šäº§ç”Ÿé—®é¢˜ã€‚</p><p><strong>è§£å†³åŠæ³•å¦‚ä¸‹ï¼š</strong></p><ol><li><p><strong>æ ˆå¯¹è±¡çš„ææ„é¡ºåº</strong><br> ä¸¤ä¸ªæ ˆå¯¹è±¡ <code>window</code>ï¼ˆçˆ¶ï¼‰å’Œ <code>quit</code>ï¼ˆå­ï¼‰ä¼šåœ¨ <code>main</code> å‡½æ•°ç»“æŸæ—¶æŒ‰åˆ›å»º<strong>ç›¸åçš„é¡ºåº</strong>ææ„ï¼š</p><ul><li>å…ˆææ„ <code>window</code>ï¼ˆååˆ›å»ºï¼‰</li><li>å†ææ„ <code>quit</code>ï¼ˆå…ˆåˆ›å»ºï¼‰</li></ul></li><li><p><strong>Qt çš„çˆ¶å­å¯¹è±¡æœºåˆ¶</strong><br> å½“çˆ¶å¯¹è±¡ï¼ˆ<code>window</code>ï¼‰è¢«é”€æ¯æ—¶ï¼ŒQt ä¼šè‡ªåŠ¨é€’å½’é”€æ¯å…¶å­å¯¹è±¡ï¼ˆ<code>quit</code>ï¼‰ã€‚ç”±äº <code>window</code> æ˜¯æ ˆå¯¹è±¡ï¼Œå…¶ææ„è¿‡ç¨‹ä¼š<strong>è§¦å‘ <code>delete &amp;quit</code></strong>ï¼Œä½† <code>quit</code> åŒæ ·æ˜¯ä¸ªæ ˆå¯¹è±¡ï¼ˆæœªé€šè¿‡ <code>new</code> åœ¨å †ä¸Šåˆ†é…ï¼‰ã€‚</p></li><li><p><strong>åŒé‡é‡Šæ”¾é”™è¯¯</strong></p><ul><li>ç¬¬ä¸€æ¬¡ææ„ï¼ˆé”™è¯¯ï¼‰ï¼šé€šè¿‡ <code>window</code> é”€æ¯å­å¯¹è±¡æ—¶ï¼Œå¯¹æ ˆåœ°å€ <code>&amp;quit</code> è°ƒç”¨ <code>delete</code>ï¼Œæœ¬è´¨æ˜¯å¯¹éå †å†…å­˜è¿›è¡Œé‡Šæ”¾ã€‚</li><li>ç¬¬äºŒæ¬¡ææ„ï¼ˆæ­£å¸¸ï¼‰ï¼š<code>quit</code> ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œè§¦å‘æ ˆå¯¹è±¡çš„è‡ªç„¶ææ„ï¼Œå†æ¬¡è°ƒç”¨ææ„å‡½æ•°ã€‚</li></ul><p>âŒ è¿™å°†å¼•å‘<strong>åŒé‡é‡Šæ”¾ï¼ˆdouble freeï¼‰æˆ–å†…å­˜è®¿é—®å†²çª</strong>ï¼Œå¯¼è‡´ç¨‹åºå´©æºƒã€‚</p></li></ol><p>æˆ‘ä»¬æœ€å¥½ä»å¼€å§‹å°±å…»æˆè‰¯å¥½ä¹ æƒ¯ï¼Œåœ¨ Qt ä¸­ï¼Œå°½é‡åœ¨æ„é€ çš„æ—¶å€™å°±æŒ‡å®š parent å¯¹è±¡ï¼Œå¹¶ä¸”å¤§èƒ†åœ¨å †ä¸Šåˆ›å»ºã€‚</p><h3 id="ä¸‰ã€Qtçª—å£åæ ‡ä½“ç³»"><a href="#ä¸‰ã€Qtçª—å£åæ ‡ä½“ç³»" class="headerlink" title="ä¸‰ã€Qtçª—å£åæ ‡ä½“ç³»"></a><font color = "FF0000">ä¸‰ã€Qtçª—å£åæ ‡ä½“ç³»</font></h3><p>Qtçš„çª—å£åæ ‡ç³»ä»¥å·¦ä¸Šè§’ä¸ºåŸç‚¹ï¼ŒX å‘å³å¢åŠ ï¼ŒY å‘ä¸‹å¢åŠ ã€‚</p><p><img src="https://bu.dusays.com/2025/03/13/67d277561fcbf.png"></p><p>å¯¹äºåµŒå¥—çª—å£ï¼Œå…¶åæ ‡æ˜¯ç›¸å¯¹äºçˆ¶çª—å£æ¥è¯´çš„ã€‚</p><br><br><br><p><span style="color: red; font-size: 20px;">è½¬è½½è‡ªï¼š<a href="https://www.cnblogs.com/xyf327">å”¯æœ‰è‡ªå·±å¼ºå¤§</a>          å¦‚æœ‰ä¾µæƒï¼Œåœ¨ä¸‹æ–¹è¯„è®º  ç«‹åˆ»åˆ é™¤ã€‚</span></p>]]></content>
      
      
      <categories>
          
          <category> Qt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Qtå­¦ä¹  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Qtå‡ ä¸ªé¢è¯•é—®é¢˜</title>
      <link href="/2025/03/07/Qt%E5%87%A0%E4%B8%AA%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/"/>
      <url>/2025/03/07/Qt%E5%87%A0%E4%B8%AA%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h4 id="QTå¤šçº¿ç¨‹"><a href="#QTå¤šçº¿ç¨‹" class="headerlink" title="QTå¤šçº¿ç¨‹"></a>QTå¤šçº¿ç¨‹</h4><h4 id="QML"><a href="#QML" class="headerlink" title="QML"></a>QML</h4><p><strong>QMLï¼ˆQt Meta-Object Languageï¼‰</strong> æ˜¯ <strong>Qtæ¡†æ¶</strong> ä¸­ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢ï¼ˆUIï¼‰çš„å£°æ˜å¼ç¼–ç¨‹è¯­è¨€ã€‚å®ƒä¸“æ³¨äºç•Œé¢è®¾è®¡ä¸ç”¨æˆ·äº¤äº’ï¼Œä¸C++åç«¯é€»è¾‘ç»“åˆï¼Œé€‚ç”¨äºå¼€å‘è·¨å¹³å°ã€åŠ¨æ€ä¸”ç°ä»£åŒ–çš„åº”ç”¨ç¨‹åºï¼ˆå¦‚æ¡Œé¢ã€ç§»åŠ¨åŠåµŒå…¥å¼åº”ç”¨ï¼‰ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒç‰¹æ€§ä¸ä½œç”¨ï¼š</p><ul><li>ECMAScript</li><li>Qt å¯¹è±¡ç³»ç»Ÿ</li><li>Qt Quick æ ‡å‡†åº“</li></ul><p>ç”¨äºå®šä¹‰å’Œåˆ›å»ºåŠ¨æ€å¯è§†åŒ–ç•Œé¢</p><p>Qt Quick æ˜¯ä¸€ç§åŸºäº Qt çš„ç”¨æˆ·ç•Œé¢è®¾è®¡æŠ€æœ¯ã€‚å®ƒå…è®¸å¼€å‘äººå‘˜ä½¿ç”¨ QMLï¼ˆQt Meta-Object Languageï¼‰è¯­è¨€å’Œ JavaScript ä»¥å£°æ˜å¼çš„æ–¹å¼åˆ›å»ºåŠ¨æ€çš„ã€é«˜æ•ˆçš„ã€æµç•…çš„ç”¨æˆ·ç•Œé¢ã€‚Qt Quick æŠ€æœ¯ä¸åŒäºä¼ ç»Ÿçš„åŸºäºéƒ¨ä»¶ï¼ˆwidget-basedï¼‰çš„ç”¨æˆ·ç•Œé¢è®¾è®¡ï¼Œå…¶è®¾è®¡å“²å­¦æ˜¯å°†ç•Œé¢çš„å„ä¸ªå…ƒç´ æŠ½è±¡å‡ºæ¥ï¼Œç„¶åé€šè¿‡ç»„åˆè¿™äº›å…ƒç´ æ¥å®ç°å„ç§ä¸åŒçš„ç•Œé¢å’Œäº¤äº’æ•ˆæœã€‚</p><h4 id="å¤šçº¿ç¨‹çš„å®ç°ï¼šä¿¡å·å’Œæ§½"><a href="#å¤šçº¿ç¨‹çš„å®ç°ï¼šä¿¡å·å’Œæ§½" class="headerlink" title="å¤šçº¿ç¨‹çš„å®ç°ï¼šä¿¡å·å’Œæ§½"></a>å¤šçº¿ç¨‹çš„å®ç°ï¼šä¿¡å·å’Œæ§½</h4><p>apiå‡½æ•°   æˆå‘˜å‡½æ•°ã€<strong>2.2 ä¿¡å·æ§½</strong>  <strong>2.3é™æ€å‡½æ•°</strong></p><p><strong>æ´¾ç”ŸQThreadç±»å¯¹è±¡çš„æ–¹æ³•ï¼ˆé‡å†™Runå‡½æ•°ï¼‰</strong></p><p>å¯åŠ¨äº‹ä»¶å¾ªç¯ï¼šå½“ä¸€ä¸ªç¨‹åºè°ƒç”¨ exec()ï¼ˆ3456ä¾‹å¦‚ QApplication::exec()ï¼‰åï¼Œå½“å‰çº¿ç¨‹ä¼šè¿›å…¥ä¸€ä¸ªé˜»å¡çŠ¶æ€ï¼Œå¹¶å¼€å§‹æ— é™å¾ªç¯åœ°ç›‘å¬å’Œåˆ†å‘äº‹ä»¶ï¼ˆå¦‚é¼ æ ‡ç‚¹å‡»ã€é”®ç›˜è¾“å…¥ã€å®šæ—¶å™¨è§¦è¾¾ã€ç½‘ç»œå“åº”ç­‰ï¼‰ã€‚</p><p><strong>ä½¿ç”¨ä¿¡å·ä¸æ§½æ–¹å¼æ¥å®ç°å¤šçº¿ç¨‹</strong></p><p>ç§æ–¹æ³•å­˜åœ¨ä¸€ä¸ªå±€é™æ€§ï¼Œåªæœ‰ä¸€ä¸ªrun()å‡½æ•°èƒ½å¤Ÿåœ¨çº¿ç¨‹ä¸­å»è¿è¡Œï¼Œä½†æ˜¯å½“æœ‰å¤šä¸ªå‡½æ•°åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­è¿è¡Œæ—¶ï¼Œå°±æ²¡åŠæ³•äº†ï¼Œè‡³å°‘å®ç°èµ·æ¥å¾ˆéº»çƒ¦</p><p>ä» QObject æ´¾ç”Ÿï¼Œåœ¨è¿™ä¸ªç±»ä¸­æ·»åŠ ä¸€ä¸ªå…¬å…±çš„æˆå‘˜å‡½æ•°(working)ï¼Œå‡½æ•°ä½“å°±æ˜¯æˆ‘ä»¬è¦å­çº¿ç¨‹ä¸­æ‰§è¡Œçš„ä¸šåŠ¡é€»è¾‘</p><ul><li>åœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»ºä¸€ä¸ª QThread å¯¹è±¡ï¼Œè¿™å°±æ˜¯å­çº¿ç¨‹çš„å¯¹è±¡</li><li>åœ¨ä¸»çº¿ç¨‹ä¸­åˆ›å»ºå·¥ä½œçš„ç±»å¯¹è±¡ï¼ˆåƒä¸‡ä¸è¦æŒ‡å®šç»™åˆ›å»ºçš„å¯¹è±¡æŒ‡å®šçˆ¶å¯¹è±¡ï¼‰</li><li>å°† MyWork å¯¹è±¡ç§»åŠ¨åˆ°åˆ›å»ºçš„å­çº¿ç¨‹å¯¹è±¡ä¸­ï¼Œéœ€è¦è°ƒç”¨ QObject ç±»æä¾›çš„ moveToThread() æ–¹æ³•</li><li>å¯åŠ¨å­çº¿ç¨‹ï¼Œè°ƒç”¨ start(), è¿™æ—¶å€™çº¿ç¨‹å¯åŠ¨äº†ï¼Œä½†æ˜¯ç§»åŠ¨åˆ°çº¿ç¨‹ä¸­çš„å¯¹è±¡å¹¶æ²¡æœ‰å·¥ä½œ</li><li>è°ƒç”¨ MyWork ç±»å¯¹è±¡çš„å·¥ä½œå‡½æ•°ï¼Œè®©è¿™ä¸ªå‡½æ•°å¼€å§‹æ‰§è¡Œï¼Œè¿™æ—¶å€™æ˜¯åœ¨ç§»åŠ¨åˆ°çš„é‚£ä¸ªå­çº¿ç¨‹ä¸­è¿è¡Œçš„</li></ul><h3 id="å…±äº«å†…å­˜-é˜Ÿåˆ—"><a href="#å…±äº«å†…å­˜-é˜Ÿåˆ—" class="headerlink" title="å…±äº«å†…å­˜  é˜Ÿåˆ—"></a>å…±äº«å†…å­˜  é˜Ÿåˆ—</h3><p>åœ¨Qtä¸­ï¼Œ<strong>å…±äº«å†…å­˜ï¼ˆShared Memoryï¼‰</strong> æ˜¯ä¸€ç§å…è®¸ä¸åŒè¿›ç¨‹è®¿é—®åŒä¸€å—å†…å­˜åŒºåŸŸçš„æœºåˆ¶ã€‚è¿™æ˜¯å®ç°è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰çš„ä¸€ç§é«˜æ•ˆæ–¹å¼ï¼Œå°¤å…¶é€‚ç”¨äºéœ€è¦<strong>é«˜é¢‘æ•°æ®äº¤æ¢</strong>çš„åœºæ™¯ï¼ˆå¦‚å®æ—¶æ•°æ®ä¼ è¾“ï¼‰ã€‚Qtæä¾›äº† <strong><code>QSharedMemory</code></strong> ç±»æ¥ç®€åŒ–å…±äº«å†…å­˜çš„æ“ä½œã€‚Qtæä¾›äº† <strong><code>QSharedMemory</code></strong> ç±»æ¥ç®€åŒ–å…±äº«å†…å­˜çš„æ“ä½œ</p><h3 id="QT-äº‹ä»¶è¿‡æ»¤å™¨"><a href="#QT-äº‹ä»¶è¿‡æ»¤å™¨" class="headerlink" title="QT äº‹ä»¶è¿‡æ»¤å™¨"></a>QT äº‹ä»¶è¿‡æ»¤å™¨</h3><p>åœ¨Qtä¸­ï¼Œ<strong>äº‹ä»¶è¿‡æ»¤å™¨ï¼ˆEvent Filterï¼‰</strong> æ˜¯ä¸€ç§å¼ºå¤§çš„æœºåˆ¶ï¼Œå…è®¸ä¸€ä¸ªå¯¹è±¡ç›‘è§†æˆ–æ‹¦æˆªå¦ä¸€ä¸ªå¯¹è±¡çš„äº‹ä»¶å¤„ç†æµç¨‹ã€‚é€šè¿‡äº‹ä»¶è¿‡æ»¤å™¨ï¼Œå¯ä»¥åœ¨äº‹ä»¶åˆ°è¾¾ç›®æ ‡å¯¹è±¡å‰è¿›è¡Œé¢„å¤„ç†æˆ–å®Œå…¨æ‹¦æˆªï¼Œè¿™åœ¨éœ€è¦è‡ªå®šä¹‰äº‹ä»¶è¡Œä¸ºæˆ–è·¨ç»„ä»¶äº¤äº’æ—¶éå¸¸å®ç”¨ã€‚</p><p>ç»§æ‰¿ <code>QObject</code> å¹¶é‡å†™ <code>eventFilter()</code> æ–¹æ³•ã€‚è¯¥æ–¹æ³•åœ¨ç›®æ ‡å¯¹è±¡çš„äº‹ä»¶è¢«å¤„ç†å‰è°ƒç”¨ã€‚</p><h4 id="å®‰è£…è¿‡æ»¤å™¨åˆ°ç›®æ ‡å¯¹è±¡"><a href="#å®‰è£…è¿‡æ»¤å™¨åˆ°ç›®æ ‡å¯¹è±¡" class="headerlink" title="å®‰è£…è¿‡æ»¤å™¨åˆ°ç›®æ ‡å¯¹è±¡"></a><strong>å®‰è£…è¿‡æ»¤å™¨åˆ°ç›®æ ‡å¯¹è±¡</strong></h4><p>ç›®æ ‡å¯¹è±¡é€šè¿‡ <code>installEventFilter()</code> æ³¨å†Œè¿‡æ»¤å™¨ï¼Œä½¿å…¶äº‹ä»¶è¢«ç›‘æ§ã€‚</p><h3 id="QTå®šæ—¶å™¨"><a href="#QTå®šæ—¶å™¨" class="headerlink" title="QTå®šæ—¶å™¨"></a>QTå®šæ—¶å™¨</h3><p>Qtä¸­æœ‰ä¸¤ç§æ–¹æ³•æ¥ä½¿ç”¨å®šæ—¶å™¨ï¼Œä¸€ç§æ˜¯å®šæ—¶å™¨äº‹ä»¶ï¼Œå¦ä¸€ç§æ˜¯ä½¿ç”¨ä¿¡å·å’Œæ§½ã€‚</p><ul><li>åˆ©ç”¨å¯¹void timerEvent(QTimerEvent* e)äº‹ä»¶çš„é‡å†™ã€‚</li><li>å¯åŠ¨å®šæ—¶å™¨ int QObject::startTimer ( int interval ) ;</li></ul><p>å¼€å¯ä¸€ä¸ªå®šæ—¶å™¨ï¼Œè¿”å›å€¼ä¸ºintç±»å‹ã€‚ä»–çš„å‚æ•°intervalæ˜¯æ¯«ç§’çº§åˆ«ã€‚å½“å¼€å¯æˆåŠŸåä¼šè¿”å›è¿™ä¸ªå®šæ—¶å™¨çš„ID, å¹¶ä¸”æ¯éš”interval æ—¶é—´åä¼šè¿›å…¥timerEvent å‡½æ•°ã€‚ç›´åˆ°å®šæ—¶å™¨è¢«æ€æ­»ï¼ˆkillTimerï¼‰</p><ul><li>timerEventçš„è¿”å›å€¼æ˜¯å®šæ—¶å™¨çš„å”¯ä¸€æ ‡è¯†ã€‚å¯ä»¥å’Œe-&gt;timerIdæ¯”è¾ƒ</li><li>void killTimer(int id); &#x2F;&#x2F;åœæ­¢ ID ä¸º id çš„è®¡æ—¶å™¨ï¼ŒID ç”± startTimer()å‡½æ•°è¿”å›</li></ul><p><strong>æ–¹å¼ï¼š</strong></p><ol><li>åˆ©ç”¨å®šæ—¶å™¨ç±»QTimer</li><li>åˆ›å»ºå®šæ—¶å™¨å¯¹è±¡ QTimer *timer&#x3D;new QTimer(this)</li><li>å¯åŠ¨å®šæ—¶å™¨timer-&gt;start( 500ï¼‰ &#x2F;&#x2F;å‚æ•°ï¼šæ¯éš”næ¯«ç§’å‘é€ä¸€ä¸ªä¿¡å·ï¼ˆtimeoutï¼‰</li><li>ç”¨connectè¿æ¥ä¿¡å·å’Œæ§½å‡½æ•°ï¼ˆè‡ªå®šä¹‰æ§½ï¼‰</li><li>æš‚åœ timer-&gt;stop</li></ol><p>**å®ä¾‹ï¼š**å¯åŠ¨label æ¯éš”0.5ç§’è®¡æ—¶</p><h3 id="QTå’ŒMFCåº•å±‚æœºåˆ¶"><a href="#QTå’ŒMFCåº•å±‚æœºåˆ¶" class="headerlink" title="QTå’ŒMFCåº•å±‚æœºåˆ¶"></a>QTå’ŒMFCåº•å±‚æœºåˆ¶</h3><p>QT</p><p><strong>äº‹ä»¶é©±åŠ¨æ¨¡å‹</strong>ï¼š</p><ul><li><p><strong>äº‹ä»¶å¾ªç¯</strong>ï¼šæ¯ä¸ª Qt åº”ç”¨ç¨‹åºæœ‰ä¸€ä¸ªå…¨å±€äº‹ä»¶é˜Ÿåˆ—ï¼ˆ<code>QEventLoop</code>ï¼‰ï¼Œç®¡ç†ç”¨æˆ·è¾“å…¥ã€å®šæ—¶å™¨ã€ç½‘ç»œäº‹ä»¶ç­‰ã€‚</p></li><li><p>äº‹ä»¶åˆ†å‘</p><p>ï¼š</p><ul><li>Qt å°†æ“ä½œç³»ç»Ÿçš„åŸç”Ÿäº‹ä»¶ï¼ˆå¦‚é¼ æ ‡ç‚¹å‡»ã€æŒ‰é”®ï¼‰å°è£…ä¸º <code>QEvent</code> å¯¹è±¡ï¼ˆå¦‚ <code>QMouseEvent</code>ï¼‰ã€‚</li><li>é€šè¿‡ <code>QObject::event()</code> å’Œ <code>QWidget::eventFilter()</code> åˆ†å‘äº‹ä»¶ã€‚</li></ul></li><li><p>ä¿¡å·æ§½æœºåˆ¶</p><p>ï¼š</p><ul><li>é€šè¿‡å…ƒå¯¹è±¡ç³»ç»Ÿï¼ˆMeta-Object Systemï¼Œç”± <code>moc</code> ç”Ÿæˆï¼‰å®ç°æ¾è€¦åˆé€šä¿¡ã€‚</li><li>ç±»å‹å®‰å…¨ï¼Œæ”¯æŒè·¨çº¿ç¨‹é€šä¿¡ã€‚</li></ul></li></ul><p>MFC</p><p>æ ¸å¿ƒï¼šåŸºäº Win32 APIï¼Œä¾èµ– Windows çš„ HWNDï¼ˆçª—å£å¥æŸ„ï¼‰å’Œæ¶ˆæ¯é˜Ÿåˆ—ã€‚<br>æ¶ˆæ¯ä¼ é€’ï¼š<br>Windows æ¶ˆæ¯ï¼ˆå¦‚ WM_PAINTã€WM_CLOSEï¼‰é€šè¿‡ æ¶ˆæ¯å¾ªç¯ï¼ˆPeekMessage&#x2F;GetMessageï¼‰åˆ†å‘ç»™çª—å£è¿‡ç¨‹ï¼ˆWndProcï¼‰ã€‚<br>MFC å°è£…äº†æ¶ˆæ¯å¤„ç†æµç¨‹ï¼Œé€šè¿‡ æ¶ˆæ¯æ˜ å°„å®ï¼ˆå¦‚ ON_WM_PAINT()ï¼‰å°†æ¶ˆæ¯ä¸æˆå‘˜å‡½æ•°ç»‘å®šã€‚</p><p><strong>QJSON</strong></p><p>Json æ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ã€‚å®ƒä½¿å¾—äººä»¬å¾ˆå®¹æ˜“è¿›è¡Œé˜…è¯»å’Œç¼–å†™ã€‚</p><p>QJson æ˜¯ Jsonçš„ä¸€ç§æ‰©å±•ï¼Œä¹Ÿå°±æ˜¯ä¸€ç§ç®€å•çš„æ•°æ®ç»“æ„ã€‚</p><p>JSON åŸºäºä¸¤ç§ç»“æ„ï¼š1ï¸âƒ£åç§°ï¼šå€¼       2ï¸âƒ£å€¼çš„æœ‰åºåˆ—è¡¨</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QJsonDocument&gt;</span>  <span class="comment">// è¯»å–å’Œå†™å…¥Jsonç±»</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QJsonValue&gt;</span>   <span class="comment">// Jsonå€¼æœ‰ä¸‹é¢å‡ ç§å½¢å¼ï¼šç©ºã€å¸ƒå°”å€¼ã€æµ®ç‚¹æ•°ã€å­—ç¬¦ä¸²ã€æ•°ç»„ã€å¯¹è±¡ï¼ˆå¯ä»¥æ˜¯å¦ä¸€ä¸ªJsonï¼‰ã€æœªå®šä¹‰</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QJsonObject&gt;</span><span class="comment">// JSONå¯¹è±¡æ˜¯é”®å€¼å¯¹çš„åˆ—è¡¨ä¸­ï¼Œå…¶ä¸­é”®æ˜¯å”¯ä¸€çš„å­—ç¬¦ä¸²ï¼Œå€¼ç”±QJsonValueè¡¨ç¤ºã€‚</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QJsonArray&gt;</span>  <span class="comment">// JSON æ•°ç»„æ˜¯ä¸€ä¸ªå€¼åˆ—è¡¨ã€‚å¯é€šè¿‡ä»æ•°ç»„ä¸­æ’å…¥å’Œåˆ é™¤QJsonValue æ¥æ“ä½œåˆ—è¡¨ã€‚</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QJsonParseError&gt;</span> <span class="comment">// æŠ¥å‘ŠJsonè§£æè¿‡ç¨‹ä¸­çš„é”™è¯¯ã€‚</span></span></span><br></pre></td></tr></table></figure><h4 id="QTå›¾è¡¨åŠŸèƒ½"><a href="#QTå›¾è¡¨åŠŸèƒ½" class="headerlink" title="QTå›¾è¡¨åŠŸèƒ½"></a>QTå›¾è¡¨åŠŸèƒ½</h4><p>Qt Chartsæ˜¯åŸºäºQt Graphics Viewå®ç°çš„ä¸€ä¸ªå›¾è¡¨çš„ç»„ä»¶ï¼Œå¯ä»¥ç”¨æ¥åœ¨QT GUIç¨‹åºä¸­æ·»åŠ ç°åœ¨é£æ ¼çš„ã€å¯äº¤äº’çš„ã€ä»¥æ•°æ®ä¸ºä¸­å¿ƒçš„å›¾è¡¨ï¼Œå¯ä»¥ç”¨ä½œQWidgetæˆ–è€… QGraphicsWidgetï¼Œä¹Ÿå¯ç”¨åœ¨QMLä¸­ã€‚æ”¯æŒçš„å›¾æ ‡ç±»å‹æœ‰ï¼šæŠ˜çº¿å›¾è·Ÿæ›²çº¿å›¾ã€é¢ç§¯å›¾ã€é¥¼å›¾ã€æŸ±çŠ¶å›¾ç­‰ã€‚</p><h4 id="QT-QSS"><a href="#QT-QSS" class="headerlink" title="QT QSS"></a>QT QSS</h4><p>â€‹    QTæ ·å¼è¡¨ï¼Œç”¨æ¥å®ç°å¯¹æ§ä»¶å¤–è§‚çš„è‡ªå®šä¹‰ã€‚</p><h4 id="QT-ä¿¡å·åªå£°æ˜æ²¡æœ‰å®šä¹‰"><a href="#QT-ä¿¡å·åªå£°æ˜æ²¡æœ‰å®šä¹‰" class="headerlink" title="QT  ä¿¡å·åªå£°æ˜æ²¡æœ‰å®šä¹‰"></a>QT  ä¿¡å·åªå£°æ˜æ²¡æœ‰å®šä¹‰</h4><p>â€‹<strong>åœ¨ Qt ä¸­ï¼Œè‡ªå®šä¹‰ä¿¡å·ï¼ˆSignalï¼‰åªéœ€è¦åœ¨å¤´æ–‡ä»¶ä¸­å£°æ˜ï¼Œæ— éœ€æ‰‹åŠ¨åœ¨æºæ–‡ä»¶ä¸­å®ç°ï¼ˆå®šä¹‰ï¼‰ã€‚</strong> è¿™æ˜¯å› ä¸º Qt çš„å…ƒå¯¹è±¡ç³»ç»Ÿï¼ˆMeta-Object Systemï¼Œç”± <code>Q_OBJECT</code> å®å’Œå…ƒå¯¹è±¡ç¼–è¯‘å™¨ <code>moc</code> å®ç°ï¼‰<strong>ä¼šè‡ªåŠ¨ç”Ÿæˆä¿¡å·çš„åº•å±‚ä»£ç </strong>ï¼Œè´Ÿè´£ä¿¡å·çš„è§¦å‘ä¸æ§½çš„è¿æ¥æœºåˆ¶ã€‚</p><p><strong>Qtå…ƒå¯¹è±¡ç³»ç»ŸMOCçš„è´£ä»»</strong></p><p>ä¿¡å·çš„â€œå®ç°â€ç”± moc å®Œæˆ<br>ä¿¡å·æœ¬è´¨æ˜¯ä¸€ä¸ªâ€œæ ‡è®°â€ï¼Œå½“ä½ åœ¨ä»£ç ä¸­ä½¿ç”¨ <code>emit mySignal();</code> æ—¶ï¼š<code>emit</code> å…³é”®å­—å‘ moc ç”Ÿæˆçš„ä»£ç ä¸‹å‘è§¦å‘æŒ‡ä»¤ã€‚moc è´Ÿè´£ç®¡ç†ä¿¡å·ä¸æ§½çš„è¿æ¥å…³ç³»ï¼Œå¹¶å°†å‚æ•°ä¼ é€’ç»™æ§½å‡½æ•°ã€‚</p><p><strong>ä¿¡å·çš„æœ¬è´¨</strong>ï¼šä¿¡å·æ˜¯æ¥å£è€ŒéåŠŸèƒ½å‡½æ•°   ä¿¡å·çš„ç›®çš„æ˜¯è§¦å‘äº‹ä»¶é€šçŸ¥ï¼Œè€Œéå…·ä½“å®ç°é€»è¾‘ã€‚ç”¨æˆ·åªéœ€è¦å£°æ˜ä¿¡å·çš„æ ¼å¼ï¼ˆåç§°ã€å‚æ•°ç±»å‹ï¼‰ï¼Œå‘ŠçŸ¥å…ƒå¯¹è±¡ç³»ç»Ÿå¦‚ä½•ä¼ é€’æ•°æ®ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">signals:</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">healthChanged</span><span class="params">(<span class="type">int</span> newHealth)</span></span>;  <span class="comment">// å£°æ˜ä¿¡å·</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">positionUpdated</span><span class="params">(<span class="type">double</span> x, <span class="type">double</span> y)</span></span>; <span class="comment">// è¡€é‡</span></span><br></pre></td></tr></table></figure><p><strong>å‘å°„ä¿¡å·</strong> <code>emit</code>ï¼šåœ¨éœ€è¦çš„ä½ç½®è°ƒç”¨<code>emit</code>ï¼Œæ—¶é—´çš„é€»è¾‘å¤„ç†ç”±æ¥æ”¶è¯¥ä¿¡å·çš„æ§½å‡½æ•°å®ç°</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Aladdin::takeDamage</span><span class="params">(<span class="type">int</span> damage)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_health -= damage;</span><br><span class="line">    <span class="function">emit <span class="title">healthChanged</span><span class="params">(m_health)</span></span>; <span class="comment">// è§¦å‘ä¿¡å·ï¼Œé€šçŸ¥å¤–éƒ¨å½“å‰çš„è¡€é‡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹æ¯”æ§½å‡½æ•°ï¼ˆéœ€è¦æ‰‹åŠ¨å®ç°ï¼‰</p><h4 id="ä¿¡å·ä¸ºä½•å¿…é¡»æ˜¯-void-ç±»å‹ï¼Ÿ"><a href="#ä¿¡å·ä¸ºä½•å¿…é¡»æ˜¯-void-ç±»å‹ï¼Ÿ" class="headerlink" title="ä¿¡å·ä¸ºä½•å¿…é¡»æ˜¯ void ç±»å‹ï¼Ÿ"></a>ä¿¡å·ä¸ºä½•å¿…é¡»æ˜¯ <code>void</code> ç±»å‹ï¼Ÿ</h4><p>ä¿¡å·çš„ä½œç”¨æ˜¯è§¦å‘äº‹ä»¶é€šçŸ¥ï¼Œè€Œä¸æ˜¯è¿”å›å€¼ã€‚è‹¥æƒ³ä¼ é€’æ•°æ®ï¼Œåº”é€šè¿‡å‚æ•°ä¼ é€’ï¼Œè€Œéè¿”å›å€¼ã€‚</p><h4 id="ä¿¡å·æ˜¯å¦å¯é‡è½½ï¼Ÿ"><a href="#ä¿¡å·æ˜¯å¦å¯é‡è½½ï¼Ÿ" class="headerlink" title="ä¿¡å·æ˜¯å¦å¯é‡è½½ï¼Ÿ"></a><strong>ä¿¡å·æ˜¯å¦å¯é‡è½½ï¼Ÿ</strong></h4><p>æ˜¯çš„ï¼Œå…è®¸é€šè¿‡å‚æ•°ç±»å‹æˆ–æ•°é‡é‡è½½ä¿¡å·ã€‚è¿æ¥æ—¶éœ€ä½¿ç”¨ <code>QOverload</code> æˆ– <code>static_cast</code> æ˜ç¡®æŒ‡å®šé‡è½½ç‰ˆæœ¬ã€‚</p><h4 id="ä¸ºä½•æœ‰æ—¶æ— æ³•è§¦å‘ä¿¡å·ï¼Ÿ"><a href="#ä¸ºä½•æœ‰æ—¶æ— æ³•è§¦å‘ä¿¡å·ï¼Ÿ" class="headerlink" title="ä¸ºä½•æœ‰æ—¶æ— æ³•è§¦å‘ä¿¡å·ï¼Ÿ"></a><strong>ä¸ºä½•æœ‰æ—¶æ— æ³•è§¦å‘ä¿¡å·ï¼Ÿ</strong></h4><ul><li>æœªæ­£ç¡®è¿æ¥ä¿¡å·ä¸æ§½ï¼ˆ<code>connect</code> é”™è¯¯ï¼‰ã€‚</li><li>æœªæ·»åŠ  <code>Q_OBJECT</code> å®æˆ–æœªé‡æ–°ç”Ÿæˆ mocã€‚</li><li>å‘å°„ä¿¡å·çš„å¯¹è±¡è¢«æå‰é”€æ¯ã€‚</li></ul><h4 id="QTè‡ªå®šä¹‰æ§ä»¶çš„ä½¿ç”¨æµç¨‹"><a href="#QTè‡ªå®šä¹‰æ§ä»¶çš„ä½¿ç”¨æµç¨‹" class="headerlink" title="QTè‡ªå®šä¹‰æ§ä»¶çš„ä½¿ç”¨æµç¨‹"></a>QTè‡ªå®šä¹‰æ§ä»¶çš„ä½¿ç”¨æµç¨‹</h4><p>å¤‡æ³¨ä¸‹</p>]]></content>
      
      
      <categories>
          
          <category> Qt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯•é—®é¢˜ </tag>
            
            <tag> Qt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•ä½¿ç”¨æ»¡è¡€ç‰ˆdeepseek</title>
      <link href="/2025/02/18/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E6%BB%A1%E8%A1%80%E7%89%88deepseek/"/>
      <url>/2025/02/18/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E6%BB%A1%E8%A1%80%E7%89%88deepseek/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ•™ç¨‹æ˜¯åœ¨ç¡…åŸºæµåŠ¨è·å–APIï¼Œå¹¶åœ¨Cherry Studioä¸Šé¢ä½¿ç”¨</p><h3 id="ä¸€ã€æ³¨å†Œç¡…åŸºæµåŠ¨"><a href="#ä¸€ã€æ³¨å†Œç¡…åŸºæµåŠ¨" class="headerlink" title="ä¸€ã€æ³¨å†Œç¡…åŸºæµåŠ¨"></a>ä¸€ã€æ³¨å†Œç¡…åŸºæµåŠ¨</h3><p>SiliconCloud åŸºäºåä¸ºäº‘æ˜‡è…¾äº‘æœåŠ¡ï¼Œé¦–å‘æ¨å‡ºäº† DeepSeek R1 &amp; V3 æ¨¡å‹æ¨ç†æœåŠ¡ã€‚æ³¨å†Œå³èµ é€ 14 å…ƒä½™é¢ï¼Œé‚€è¯·æ³¨å†Œè¿˜å¯å†è·å¾— 14 å…ƒä½™é¢ï¼ˆ2000 ä¸‡ Tokensï¼‰ã€‚</p><ul><li><strong>é‚€è¯·é“¾æ¥ï¼š</strong> <a href="https://cloud.siliconflow.cn/i/ePZNK3HT">ç¡…åŸºæµåŠ¨ç»Ÿä¸€ç™»å½•</a></li><li><strong>é‚€è¯·ç ï¼š</strong> ePZNK3HT</li></ul><p>æ³¨å†Œå®Œæˆåï¼Œå¯åœ¨æ¨¡å‹å¹¿åœºä¸Šæ‰¾åˆ° deepseek-ai&#x2F;DeepSeek-R1 æ¨¡å‹ï¼Œæ˜¾ç¤º 671B çš„æ»¡è¡€ç‰ˆã€‚</p><p><img src="https://bu.dusays.com/2025/02/18/67b3659255843.png"></p><p>ä½†è¿™ä¸ªé¡µé¢ä¸å¿…ç†ä¼šï¼Œç‚¹å‡»å·¦ä¾§APIå¯†é’¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç‚¹å‡»æ–°å»ºAPIå¯†é’¥ï¼ˆæ³¨æ„ä¿æŠ¤éšç§ï¼‰ï¼Œå¯†é’¥æè¿°éšä¾¿å¡«ã€‚</p><p><img src="https://bu.dusays.com/2025/02/18/67b366658f7b3.png"></p><p>å»ºå®ŒAPIå¯†é’¥åå°±æ¥åˆ°ç¬¬äºŒæ­¥äº†ã€‚</p><h3 id="äºŒã€ä¸‹è½½Cherry-Studio"><a href="#äºŒã€ä¸‹è½½Cherry-Studio" class="headerlink" title="äºŒã€ä¸‹è½½Cherry Studio"></a>äºŒã€ä¸‹è½½Cherry Studio</h3><p>ç”¨æˆ·å¯ä»¥é€‰æ‹©éœ€è¦çš„è½¯ä»¶æ¥è°ƒç”¨æ¥å£ã€‚æ¨èä½¿ç”¨ã€ŒCherryStudioã€è½¯ä»¶ï¼Œæ”¯æŒ Windowsã€Mac å’Œ Linux å®¢æˆ·ç«¯ã€‚</p><p><strong>Cherry Studio å®˜ç½‘ä¸‹è½½é“¾æ¥ï¼š</strong> <a href="https://docs.cherry-ai.com/cherrystudio/download?login=from_csdn">https://docs.cherry-ai.com/cherrystudio/download?login=from_csdn</a></p><p>å®‰è£…å®Œæˆä¹‹åï¼Œè¿è¡Œã€ŒCherryStudioã€è½¯ä»¶ï¼Œç‚¹å‡»å·¦ä¸‹è§’çš„è®¾ç½®æŒ‰é’®ï¼Œé€‰æ‹© <strong>ç¡…åŸºæµåŠ¨</strong>ï¼Œå¤åˆ¶ç¬¬ä¸€æ­¥åˆ›å»ºçš„APIå¯†é’¥ï¼Œè¾“å…¥åˆšåˆšå¤åˆ¶çš„å¯†é’¥ç²˜è´´è¿›å»å³å¯ã€‚ç‚¹å‡»æ£€æŸ¥ï¼Œè½¯ä»¶å°†ä¼šè‡ªåŠ¨å¯¹å¯†é’¥è¿›è¡ŒéªŒè¯ï¼Œé€šè¿‡å³å¯è¿›è¡Œä½¿ç”¨ã€‚</p><p><img src="https://bu.dusays.com/2025/02/18/67b3677c3ff7b.png"></p><p>é€šè¿‡ä¸‹é¢çš„ç®¡ç†åŠŸèƒ½ï¼Œå¯ä»¥æ·»åŠ ç¡…åŸºæµåŠ¨å¹³å°æ‰€æœ‰çš„æ¨¡å‹ï¼Œéœ€è¦ä»€ä¹ˆç‚¹å‡»æ·»åŠ å³å¯ã€‚</p><p><img src="https://bu.dusays.com/2025/02/18/67b368c449509.png"></p><p>ç‚¹å‡»åŠ©æ‰‹å³å¯è¿›å…¥å¯¹è¯é¡µé¢ï¼Œä¸Šæ–¹ç‚¹å‡»å³å¯é€‰æ‹©å¯¹è¯çš„æ¨¡å‹</p><p><img src="https://bu.dusays.com/2025/02/18/67b3690603033.png"></p><p>ä»¥ä¸Šæ˜¯å®Œæ•´çš„ä½¿ç”¨æ•™ç¨‹ï¼ï¼ï¼å¦‚æœå¯ä»¥çš„è¯ï¼Œè¯·ä½¿ç”¨æˆ‘çš„é‚€è¯·ç ï¼šePZNK3HT</p>]]></content>
      
      
      <categories>
          
          <category> åˆ†äº« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•™ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxç³»ç»Ÿç¼–ç¨‹05I/Oå¤ç”¨</title>
      <link href="/2025/01/12/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B05I-O%E5%A4%8D%E7%94%A8/"/>
      <url>/2025/01/12/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B05I-O%E5%A4%8D%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="Linuxç³»ç»Ÿè°ƒç”¨acceptåŸç†"><a href="#Linuxç³»ç»Ÿè°ƒç”¨acceptåŸç†" class="headerlink" title="Linuxç³»ç»Ÿè°ƒç”¨acceptåŸç†"></a>Linuxç³»ç»Ÿè°ƒç”¨acceptåŸç†</h3><p>â€‹<code>accept</code> å‡½æ•°æ˜¯ç½‘ç»œç¼–ç¨‹ä¸­ç”¨äºæ¥å—å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚çš„å…³é”®ç³»ç»Ÿè°ƒç”¨ã€‚å½“ä¸€ä¸ª socket è¢«è®¾ç½®ä¸ºç›‘å¬æ¨¡å¼åï¼Œå®ƒä¼šåœ¨å…¶å¯¹åº”çš„é˜Ÿåˆ—ä¸­ç§¯ç´¯æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚<code>accept</code> å‡½æ•°çš„ä½œç”¨æ˜¯ä»è¿™ä¸ªé˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªå·²ç»å»ºç«‹çš„è¿æ¥ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„ socket æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æè¿°ç¬¦ä¸å®¢æˆ·ç«¯çš„è¿æ¥ç›¸å…³è”ã€‚</p><p>â€‹å½“æ²¡æœ‰è¿æ¥è¯·æ±‚æ—¶ï¼Œ<code>accept</code> ä¼šé˜»å¡è°ƒç”¨å®ƒçš„è¿›ç¨‹æˆ–çº¿ç¨‹ï¼Œç›´åˆ°æœ‰æ–°çš„è¿æ¥è¯·æ±‚åˆ°è¾¾ã€‚è¿™ä¸ªè¿‡ç¨‹æ¶‰åŠåˆ°æ“ä½œç³»ç»Ÿå†…æ ¸ä¸­çš„ç½‘ç»œåè®®æ ˆï¼Œå…·ä½“æ¥è¯´ï¼Œæ˜¯ TCP åè®®æ ˆçš„å¤„ç†æœºåˆ¶ã€‚å½“ <code>accept</code> è¢«è°ƒç”¨æ—¶ï¼Œå†…æ ¸ä¼šæ£€æŸ¥ç›‘å¬ socket çš„å®Œå…¨è¿æ¥é˜Ÿåˆ—ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¿›ç¨‹æˆ–çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼›å¦‚æœé˜Ÿåˆ—ä¸­æœ‰å¾…å¤„ç†çš„è¿æ¥ï¼Œåˆ™ <code>accept</code> è¿”å›ä¸€ä¸ªæ–°çš„ socketï¼Œè¿›ç¨‹æˆ–çº¿ç¨‹ç»§ç»­æ‰§è¡Œã€‚</p><h3 id="éé˜»å¡IOæ¨¡å¼"><a href="#éé˜»å¡IOæ¨¡å¼" class="headerlink" title="éé˜»å¡IOæ¨¡å¼"></a>éé˜»å¡IOæ¨¡å¼</h3><p>åœ¨éé˜»å¡ I&#x2F;O æ¨¡å¼ä¸‹ï¼Œå½“ <code>accept</code> å‡½æ•°æ²¡æœ‰å‡†å¤‡å¥½è¿”å›æ—¶ï¼ˆå³æ²¡æœ‰è¿æ¥è¯·æ±‚å¯ä»¥æ¥å—ï¼‰ï¼Œå®ƒä¸ä¼šé˜»å¡è°ƒç”¨å®ƒçš„è¿›ç¨‹æˆ–çº¿ç¨‹ï¼Œè€Œæ˜¯ç«‹å³è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚è¿™ç§æ¨¡å¼å…è®¸ç¨‹åºåœ¨ç­‰å¾…è¿æ¥æ—¶ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œä»è€Œæé«˜ç¨‹åºçš„å“åº”æ€§å’Œæ•ˆç‡ã€‚</p><h3 id="è®¾ç½®socketä¸ºéé˜»å¡æ¨¡å¼"><a href="#è®¾ç½®socketä¸ºéé˜»å¡æ¨¡å¼" class="headerlink" title="è®¾ç½®socketä¸ºéé˜»å¡æ¨¡å¼"></a>è®¾ç½®socketä¸ºéé˜»å¡æ¨¡å¼</h3><p>è¦å°† socket è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ï¼Œå¯ä»¥ä½¿ç”¨ <code>fcntl</code> å‡½æ•°æ¥ä¿®æ”¹ socket çš„å±æ€§ã€‚</p><h3 id="IOå¤ç”¨çš„æ¦‚å¿µ"><a href="#IOå¤ç”¨çš„æ¦‚å¿µ" class="headerlink" title="IOå¤ç”¨çš„æ¦‚å¿µ"></a>IOå¤ç”¨çš„æ¦‚å¿µ</h3><p>åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼ŒIO å¤ç”¨ï¼ˆI&#x2F;O Multiplexingï¼‰æ˜¯ä¸€ç§è®©ç¨‹åºå¯ä»¥åŒæ—¶ç›‘è§†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆåœ¨ç½‘ç»œç¼–ç¨‹é‡Œé€šå¸¸æ˜¯å¥—æ¥å­—æè¿°ç¬¦ï¼‰çš„æŠ€æœ¯ï¼Œä»¥æ­¤æ¥åˆ¤æ–­è¿™äº›æ–‡ä»¶æè¿°ç¬¦ä¸Šæ˜¯å¦æœ‰è¯»å†™ç­‰äº‹ä»¶å‘ç”Ÿï¼Œä»è€Œå®ç°é«˜æ•ˆçš„ I&#x2F;O æ“ä½œã€‚</p><p><strong>ä¸€ä¸ªåº”ç”¨åœºæ™¯</strong>ï¼šåœ¨ä¼ ç»Ÿçš„å•çº¿ç¨‹ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œå½“è°ƒç”¨ <code>accept</code> å‡½æ•°æ—¶ï¼Œå¦‚æœæ²¡æœ‰æ–°çš„è¿æ¥è¯·æ±‚åˆ°è¾¾ï¼Œç¨‹åºä¼šè¢«é˜»å¡ï¼Œè¿™æ„å‘³ç€åœ¨ç­‰å¾…æ–°è¿æ¥çš„è¿‡ç¨‹ä¸­ï¼Œç¨‹åºæ— æ³•å¤„ç†å…¶ä»–å·²ç»å»ºç«‹çš„è¿æ¥ä¸Šçš„è¯»å†™æ“ä½œã€‚</p><h3 id="ç†è§£selectå‡½æ•°å¹¶å®ç°æœåŠ¡ç«¯ï¼š"><a href="#ç†è§£selectå‡½æ•°å¹¶å®ç°æœåŠ¡ç«¯ï¼š" class="headerlink" title="ç†è§£selectå‡½æ•°å¹¶å®ç°æœåŠ¡ç«¯ï¼š"></a>ç†è§£selectå‡½æ•°å¹¶å®ç°æœåŠ¡ç«¯ï¼š</h3><p><strong>1ã€æ˜¯å¦å­˜åœ¨å¥—æ¥å­—æ¥æ”¶æ•°æ®ï¼Ÿ</strong></p><p>â€‹è¦åˆ¤æ–­æ˜¯å¦å­˜åœ¨å¥—æ¥å­—æ¥æ”¶æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ IO å¤ç”¨æŠ€æœ¯ï¼ˆå¦‚ <code>select</code>ã€<code>poll</code>ã€<code>epoll</code>ï¼‰ã€‚è¿™äº›æŠ€æœ¯å…è®¸ç¨‹åºåŒæ—¶ç›‘è§†å¤šä¸ªå¥—æ¥å­—çš„çŠ¶æ€ï¼Œå½“æŸä¸ªå¥—æ¥å­—æœ‰æ•°æ®å¯è¯»æ—¶ï¼Œå°±èƒ½å¾—çŸ¥è¯¥å¥—æ¥å­—æ­£åœ¨æ¥æ”¶æ•°æ®ã€‚</p><p><strong>2ã€æ— éœ€é˜»å¡ä¼ è¾“æ•°æ®çš„å¥—æ¥å­—æœ‰å“ªäº›ï¼Ÿ</strong></p><p>â€‹åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œå®ç°éé˜»å¡ä¼ è¾“æ•°æ®é€šå¸¸å¯ä»¥é€šè¿‡å°†å¥—æ¥å­—è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ï¼Œæˆ–è€…ä½¿ç”¨å¼‚æ­¥ I&#x2F;O æŠ€æœ¯ã€‚</p><p><strong>3ã€å“ªäº›å¥—æ¥å­—å‘ç”Ÿäº†å¼‚å¸¸ï¼Ÿ</strong></p><p>â€‹åŒæ ·å¯ä»¥ä½¿ç”¨ IO å¤ç”¨æŠ€æœ¯æ¥æ£€æµ‹å¥—æ¥å­—æ˜¯å¦å‘ç”Ÿå¼‚å¸¸ã€‚åœ¨ <code>select</code>ã€<code>poll</code>ã€<code>epoll</code> ç­‰å‡½æ•°ä¸­ï¼Œéƒ½æœ‰ç›¸åº”çš„æœºåˆ¶æ¥å¤„ç†å¼‚å¸¸äº‹ä»¶ã€‚</p><h3 id="selectæ¨¡å‹ä»¥åŠå®æˆ˜æ¡ˆä¾‹"><a href="#selectæ¨¡å‹ä»¥åŠå®æˆ˜æ¡ˆä¾‹" class="headerlink" title="selectæ¨¡å‹ä»¥åŠå®æˆ˜æ¡ˆä¾‹"></a>selectæ¨¡å‹ä»¥åŠå®æˆ˜æ¡ˆä¾‹</h3><p>æœ€æ—©å‡ºç°çš„IOå¤ç”¨ç³»ç»Ÿè°ƒç”¨ï¼Œå‡ ä¹æ‰€æœ‰çš„æ“ä½œç³»ç»Ÿéƒ½æ”¯æŒã€‚</p><p>ç¨‹åºåˆ›å»ºä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œå°†éœ€è¦ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦æ·»åŠ åˆ°è¯¥é›†åˆä¸­ï¼Œç„¶åè°ƒç”¨ <code>select</code> å‡½æ•°ã€‚<code>select</code> å‡½æ•°ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰æ–‡ä»¶æè¿°ç¬¦å‘ç”ŸæŒ‡å®šçš„äº‹ä»¶æˆ–è¶…æ—¶ã€‚è¿”å›æ—¶ï¼Œ<code>select</code> ä¼šä¿®æ”¹æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œåªä¿ç•™é‚£äº›å‘ç”Ÿäº†äº‹ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œç¨‹åºå¯ä»¥é€šè¿‡éå†é›†åˆæ¥å¤„ç†è¿™äº›äº‹ä»¶ã€‚</p><p><strong>å¤šè¿›ç¨‹æœåŠ¡å™¨çš„ç¼ºç‚¹å’Œè§£å†³åŠæ³•</strong></p><p>å¤šè¿›ç¨‹æœåŠ¡å™¨ï¼š1ã€éœ€è¦å¤§é‡çš„è¿ç®—        2ã€å¤§é‡çš„å†…å­˜ç©ºé—´</p><p><strong>ç†è§£selectå‡½æ•°å¹¶å®ç°æœåŠ¡ç«¯</strong></p><p>1ã€æ˜¯å¦å­˜åœ¨å¥—æ¥å­—æ¥æ”¶æ•°æ®ï¼Ÿ</p><p>2ã€æ— éœ€é˜»å¡ä¼ è¾“æ•°æ®çš„å¥—æ¥å­—æœ‰å“ªäº›ï¼Ÿ</p><p>3ã€å“ªäº›å¥—æ¥å­—å‘ç”Ÿäº†å¼‚å¸¸ï¼Ÿ</p><p><strong>Selectæ¨¡å‹å…·ä½“æ­¥éª¤</strong></p><p>1ã€è®¾ç½®æ–‡ä»¶æè¿°ç¬¦ï¼šselectå‡½æ•°ç›‘è§†å¤šä¸ªï¼ˆä¸è¶…è¿‡1024ä¸ªï¼‰æ–‡ä»¶æè¿°ç¬¦</p><p><img src="https://bu.dusays.com/2025/01/13/67847ba4af4fe.png"></p><h3 id="EPOLL-æ¨¡å‹"><a href="#EPOLL-æ¨¡å‹" class="headerlink" title="EPOLL æ¨¡å‹"></a><code>EPOLL</code> æ¨¡å‹</h3><p><code>eventpoll</code>æ˜¯ linux å†…æ ¸å®ç°IOå¤šè·¯è½¬æ¥&#x2F;å¤ç”¨ï¼ˆIO multiplexingï¼‰çš„ä¸€ä¸ªå®ç°ã€‚IOå¤šè·¯è½¬æ¥çš„æ„æ€æ˜¯åœ¨ä¸€ä¸ªæ“ä½œé‡ŒåŒæ—¶ç›‘å¬å¤šä¸ªè¾“å…¥è¾“å‡ºæºï¼Œåœ¨å…¶ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªè¾“å…¥è¾“å‡ºæºå¯ç”¨çš„æ—¶å€™è¿”å›ï¼Œç„¶åå¯¹å…¶çš„è¿›è¡Œè¯»å†™æ“ä½œã€‚epollæ˜¯selectå’Œpollçš„å‡çº§ç‰ˆï¼Œç›¸è¾ƒäºè¿™ä¸¤ä¸ªå‰è¾ˆï¼Œepollæ”¹è¿›äº†å·¥ä½œæ–¹å¼ï¼Œå› æ­¤å®ƒæ›´åŠ é«˜æ•ˆã€‚</p><p>Â·å¯¹äºå¾…æ£€æµ‹é›†åˆselectå’Œpollæ˜¯åŸºäºçº¿æ€§æ–¹å¼å¤„ç†çš„ï¼Œepollæ˜¯åŸºäºçº¢é»‘æ ‘æ¥ç®¡ç†å¾…æ£€æµ‹é›†åˆçš„ã€‚</p><p>selectå’Œpollæ¯æ¬¡éƒ½ä¼šçº¿æ€§æ‰«ææ•´ä¸ªå¾…æ£€æµ‹é›†åˆï¼Œé›†åˆè¶Šå¤§é€Ÿåº¦è¶Šæ…¢ï¼Œepollä½¿ç”¨çš„æ˜¯å›è°ƒæœºåˆ¶ï¼Œæ•ˆç‡é«˜ï¼Œå¤„ç†æ•ˆç‡ä¹Ÿä¸ä¼šéšç€æ£€æµ‹é›†åˆçš„å˜å¤§è€Œä¸‹é™<br>selectå’Œpollå·¥ä½œè¿‡ç¨‹ä¸­å­˜åœ¨å†…æ ¸&#x2F;ç”¨æˆ·ç©ºé—´æ•°æ®çš„é¢‘ç¹æ‹·è´é—®é¢˜ï¼Œåœ¨epollä¸­å†…æ ¸å’Œç”¨æˆ·åŒºä½¿ç”¨çš„æ˜¯å…±äº«å†…å­˜ï¼ˆåŸºäºmmapå†…å­˜æ˜ å°„åŒºå®ç°ï¼‰ï¼Œçœå»äº†ä¸å¿…è¦çš„å†…å­˜æ‹·è´ã€‚<br>ç¨‹åºçŒ¿éœ€è¦å¯¹selectå’Œpollè¿”å›çš„é›†åˆè¿›è¡Œåˆ¤æ–­æ‰èƒ½çŸ¥é“å“ªäº›æ–‡ä»¶æè¿°ç¬¦æ˜¯å°±ç»ªçš„ï¼Œé€šè¿‡epollå¯ä»¥ç›´æ¥å¾—åˆ°å·²å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œæ— éœ€å†æ¬¡æ£€æµ‹<br>ä½¿ç”¨epollæ²¡æœ‰æœ€å¤§æ–‡ä»¶æè¿°ç¬¦çš„é™åˆ¶ï¼Œä»…å—ç³»ç»Ÿä¸­è¿›ç¨‹èƒ½æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°ç›®é™åˆ¶<br>å½“å¤šè·¯å¤ç”¨çš„æ–‡ä»¶æ•°é‡åºå¤§ã€IOæµé‡é¢‘ç¹çš„æ—¶å€™ï¼Œä¸€èˆ¬ä¸å¤ªé€‚åˆä½¿ç”¨select()å’Œpoll()ï¼Œè¿™ç§æƒ…å†µä¸‹select()å’Œpoll()è¡¨ç°è¾ƒå·®ï¼Œæ¨èä½¿ç”¨epoll()ã€‚</p><p><code>**Epoll</code>çš„ä¸‰å¤§å‡½æ•°ï¼š<code>epoll_create</code>ï¼Œ<code>epoll_wait</code>ï¼Œ <code>epoll_ct</code>**</p><p><strong>int <code>epoll_create</code>(int size);</strong>    sizeå¿…é¡»è¦å¤§äº0      è¿™ä¸ªå‡½æ•°è¿”å›æ–‡ä»¶æè¿°ç¬¦</p><p> <strong><code>epoll_ctl</code></strong></p><h3 id="EPOOL-æ¨¡å‹å’Œ-select-æ¨¡å‹çš„å¯¹æ¯”"><a href="#EPOOL-æ¨¡å‹å’Œ-select-æ¨¡å‹çš„å¯¹æ¯”" class="headerlink" title="EPOOL æ¨¡å‹å’Œ select æ¨¡å‹çš„å¯¹æ¯”"></a><code>EPOOL</code> æ¨¡å‹å’Œ <code>select</code> æ¨¡å‹çš„å¯¹æ¯”</h3><ol><li><strong>æ€§èƒ½æ–¹é¢</strong><ul><li>ç³»ç»Ÿè°ƒç”¨å¼€é”€ï¼š<ul><li>åœ¨<code>select</code>æ¨¡å‹ä¸­ï¼Œæ¯æ¬¡è°ƒç”¨<code>select</code>å‡½æ•°æ—¶ï¼Œéƒ½éœ€è¦å°†ç”¨æˆ·ç©ºé—´çš„æ–‡ä»¶æè¿°ç¬¦é›†åˆæ‹·è´åˆ°å†…æ ¸ç©ºé—´ã€‚å½“æ–‡ä»¶æè¿°ç¬¦æ•°é‡è¾ƒå¤šæ—¶ï¼Œè¿™ç§æ‹·è´æ“ä½œä¼šå¸¦æ¥è¾ƒå¤§çš„å¼€é”€ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªæœ‰å¤§é‡å¹¶å‘è¿æ¥çš„æœåŠ¡å™¨åœºæ™¯ä¸­ï¼Œå¦‚æœæœ‰ 1000 ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œæ¯æ¬¡<code>select</code>è°ƒç”¨éƒ½è¦æ‹·è´è¿™ 1000 ä¸ªæ–‡ä»¶æè¿°ç¬¦ç›¸å…³çš„ä¿¡æ¯ã€‚</li><li>è€Œ<code>epoll</code>ä½¿ç”¨äº†å†…æ ¸ä¸ç”¨æˆ·ç©ºé—´å…±äº«çš„æ•°æ®ç»“æ„ã€‚<code>epoll_create</code>åˆ›å»º<code>epoll</code>å®ä¾‹åï¼Œ<code>epoll_ctl</code>å‡½æ•°ç”¨äºåœ¨å†…æ ¸ç»´æŠ¤çš„çº¢é»‘æ ‘ä¸­æ·»åŠ ã€åˆ é™¤æˆ–ä¿®æ”¹æ–‡ä»¶æè¿°ç¬¦åŠå…¶å¯¹åº”çš„äº‹ä»¶ã€‚åœ¨<code>epoll_wait</code>è°ƒç”¨æ—¶ï¼Œä¸éœ€è¦åƒ<code>select</code>é‚£æ ·é¢‘ç¹åœ°æ‹·è´å¤§é‡æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œå‡å°‘äº†ç³»ç»Ÿè°ƒç”¨çš„å¼€é”€ã€‚</li></ul></li><li>äº‹ä»¶è§¦å‘æ–¹å¼çš„æ•ˆç‡ï¼š<ul><li><code>select</code>æ¨¡å‹é‡‡ç”¨çš„æ˜¯æ°´å¹³è§¦å‘ï¼ˆLevel - Triggeredï¼‰æ–¹å¼ã€‚è¿™æ„å‘³ç€åªè¦æ–‡ä»¶æè¿°ç¬¦å¯¹åº”çš„ç¼“å†²åŒºä¸­æœ‰æ•°æ®å¯è¯»æˆ–è€…å¯å†™ï¼Œ<code>select</code>å°±ä¼šä¸€ç›´é€šçŸ¥åº”ç”¨ç¨‹åºè¯¥æ–‡ä»¶æè¿°ç¬¦å¯è¯»æˆ–å¯å†™ã€‚ä¾‹å¦‚ï¼Œåœ¨å¤„ç†ç½‘ç»œå¥—æ¥å­—æ—¶ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæ²¡æœ‰åŠæ—¶å¤„ç†å®Œç¼“å†²åŒºä¸­çš„æ•°æ®ï¼Œ<code>select</code>åœ¨ä¸‹ä¸€æ¬¡è°ƒç”¨æ—¶ä»ç„¶ä¼šé€šçŸ¥è¯¥å¥—æ¥å­—å¯è¯»ï¼Œè¿™å¯èƒ½å¯¼è‡´ä¸€äº›ä¸å¿…è¦çš„é‡å¤å¤„ç†ã€‚</li><li><code>epoll</code>å¯ä»¥é‡‡ç”¨è¾¹ç¼˜è§¦å‘ï¼ˆEdge - Triggeredï¼‰æ–¹å¼ï¼ˆå¦‚ä»£ç ä¸­è®¾ç½®<code>EPOLLET</code>ï¼‰ã€‚è¾¹ç¼˜è§¦å‘æ˜¯åœ¨æ–‡ä»¶æè¿°ç¬¦çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼ˆå¦‚ä»ä¸å¯è¯»åˆ°å¯è¯»ï¼Œæˆ–è€…ä»ä¸å¯å†™åˆ°å¯å†™ï¼‰çš„ç¬é—´è§¦å‘äº‹ä»¶é€šçŸ¥ã€‚è¿™æ ·ï¼Œåªæœ‰å½“æœ‰æ–°çš„æ•°æ®åˆ°æ¥æˆ–è€…è¿æ¥çŠ¶æ€çœŸæ­£æ”¹å˜æ—¶æ‰ä¼šè§¦å‘äº‹ä»¶ï¼Œé¿å…äº†åƒ<code>select</code>é‚£æ ·å› ä¸ºç¼“å†²åŒºæ•°æ®æœªå¤„ç†å®Œè€Œå¯¼è‡´çš„é‡å¤é€šçŸ¥ï¼Œä»è€Œæé«˜äº†å¤„ç†æ•ˆç‡ã€‚</li></ul></li></ul></li><li><strong>å¯æ‰©å±•æ€§æ–¹é¢</strong><ul><li>æ–‡ä»¶æè¿°ç¬¦æ•°é‡é™åˆ¶ï¼š<ul><li><code>select</code>æ¨¡å‹å¯¹æ–‡ä»¶æè¿°ç¬¦æ•°é‡æœ‰æ¯”è¾ƒä¸¥æ ¼çš„é™åˆ¶ã€‚åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸­ï¼Œè¿™ä¸ªé™åˆ¶å¯èƒ½ä¸åŒï¼Œä½†é€šå¸¸æ˜¯ä¸€ä¸ªè¾ƒå°çš„å›ºå®šå€¼ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€äº›æ—§ç‰ˆæœ¬çš„ Unix ç³»ç»Ÿä¸­ï¼Œ<code>select</code>æœ€å¤šèƒ½å¤„ç† 1024 ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚è¿™åœ¨å¤„ç†å¤§é‡å¹¶å‘è¿æ¥çš„ç°ä»£ç½‘ç»œåº”ç”¨åœºæ™¯ä¸­æ˜¯è¿œè¿œä¸å¤Ÿçš„ã€‚</li><li><code>epoll</code>æ²¡æœ‰è¿™ç§å›ºå®šçš„ã€è¾ƒå°çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡é™åˆ¶ã€‚å®ƒå¯ä»¥å¤„ç†çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡ä¸»è¦å–å†³äºç³»ç»Ÿçš„èµ„æºï¼ˆå¦‚å†…å­˜å¤§å°ç­‰ï¼‰ã€‚è¿™ä½¿å¾—<code>epoll</code>èƒ½å¤Ÿæ›´å¥½åœ°é€‚åº”é«˜å¹¶å‘åœºæ™¯ï¼Œå¦‚å¤§å‹çš„ Web æœåŠ¡å™¨æˆ–è€…æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨ï¼Œè¿™äº›æœåŠ¡å™¨å¯èƒ½éœ€è¦åŒæ—¶å¤„ç†æˆåƒä¸Šä¸‡ä¸ªå®¢æˆ·ç«¯è¿æ¥ã€‚</li></ul></li></ul></li><li><strong>ä»£ç å¤æ‚åº¦æ–¹é¢</strong><ul><li>äº‹ä»¶å¤„ç†çš„ä»£ç é€»è¾‘ï¼š<ul><li>åœ¨<code>select</code>æ¨¡å‹ä¸­ï¼Œåº”ç”¨ç¨‹åºéœ€è¦éå†æ‰€æœ‰çš„æ–‡ä»¶æè¿°ç¬¦æ¥æ£€æŸ¥å“ªäº›æ–‡ä»¶æè¿°ç¬¦äº§ç”Ÿäº†äº‹ä»¶ã€‚ä¾‹å¦‚ï¼Œæ¯æ¬¡<code>select</code>è¿”å›åï¼Œéœ€è¦åœ¨ä¸€ä¸ªå¾ªç¯ä¸­é€ä¸ªæ£€æŸ¥æ–‡ä»¶æè¿°ç¬¦é›†åˆä¸­çš„æ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦æ˜¯å¦åœ¨å¯è¯»æˆ–å¯å†™é›†åˆä¸­ã€‚å¦‚æœæ–‡ä»¶æè¿°ç¬¦æ•°é‡è¾ƒå¤šï¼Œè¿™ç§éå†æ£€æŸ¥çš„ä»£ç ä¼šæ¯”è¾ƒå¤æ‚ä¸”æ•ˆç‡ä½ä¸‹ã€‚</li><li><code>epoll</code>è¿”å›çš„æ˜¯å·²ç»å‘ç”Ÿäº‹ä»¶çš„æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œåº”ç”¨ç¨‹åºåªéœ€è¦ç›´æ¥å¤„ç†è¿™äº›å‘ç”Ÿäº‹ä»¶çš„æ–‡ä»¶æè¿°ç¬¦å³å¯ã€‚åœ¨ä»£ç é€»è¾‘ä¸Šï¼Œ<code>epoll</code>æ›´åŠ ç®€æ´æ˜äº†ï¼Œä¸éœ€è¦åƒ<code>select</code>é‚£æ ·è¿›è¡Œå¤§é‡çš„éå†å’Œåˆ¤æ–­æ“ä½œï¼Œé™ä½äº†ä»£ç çš„å¤æ‚åº¦å’Œå‡ºé”™çš„æ¦‚ç‡ã€‚</li></ul></li></ul></li></ol><h3 id="è¾¹ç¼˜è§¦å‘å’Œæ¡ä»¶è§¦å‘"><a href="#è¾¹ç¼˜è§¦å‘å’Œæ¡ä»¶è§¦å‘" class="headerlink" title="è¾¹ç¼˜è§¦å‘å’Œæ¡ä»¶è§¦å‘"></a>è¾¹ç¼˜è§¦å‘å’Œæ¡ä»¶è§¦å‘</h3><p><strong>æ¡ä»¶è§¦å‘(level-triggeredï¼Œä¹Ÿè¢«ç§°ä¸ºæ°´å¹³è§¦å‘)LT:</strong> </p><p>åªè¦æ»¡è¶³æ¡ä»¶ï¼Œå°±è§¦å‘ä¸€ä¸ªäº‹ä»¶(åªè¦æœ‰æ•°æ®æ²¡æœ‰è¢«è·å–ï¼Œå†…æ ¸å°±ä¸æ–­é€šçŸ¥ä½ )</p><p> <strong>è¾¹ç¼˜è§¦å‘(edge-triggered)ET:</strong> </p><p>æ¯å½“çŠ¶æ€å˜åŒ–æ—¶ï¼Œè§¦å‘ä¸€ä¸ªäº‹ä»¶<br> â€œä¸¾ä¸ªè¯»socketçš„ä¾‹å­ï¼Œå‡å®šç»è¿‡é•¿æ—¶é—´çš„æ²‰é»˜åï¼Œç°åœ¨æ¥äº†100ä¸ªå­—èŠ‚ï¼Œè¿™æ—¶æ— è®ºè¾¹ç¼˜è§¦å‘å’Œæ¡ä»¶è§¦å‘éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªé€šçŸ¥åº”ç”¨ç¨‹åºå¯è¯»ã€‚åº”ç”¨ç¨‹åºè¯»äº†50ä¸ªå­—èŠ‚ï¼Œç„¶åé‡æ–°è°ƒç”¨<code>api</code>ç­‰å¾…<code>io</code>äº‹ä»¶ã€‚</p><p>è¿™æ—¶æ°´å¹³è§¦å‘çš„<code>api</code>ä¼šå› ä¸ºè¿˜æœ‰50ä¸ªå­—èŠ‚å¯è¯»ä»è€Œç«‹å³è¿”å›ç”¨æˆ·ä¸€ä¸ªread ready notificationã€‚</p><p>è€Œè¾¹ç¼˜è§¦å‘çš„<code>api</code>ä¼šå› ä¸ºå¯è¯»è¿™ä¸ªçŠ¶æ€æ²¡æœ‰å‘ç”Ÿå˜åŒ–è€Œé™·å…¥é•¿æœŸç­‰å¾…ã€‚ å› æ­¤åœ¨ä½¿ç”¨è¾¹ç¼˜è§¦å‘çš„<code>api</code>æ—¶ï¼Œè¦æ³¨æ„æ¯æ¬¡éƒ½è¦è¯»åˆ°socketè¿”å›<code>EWOULDBLOCK</code>ä¸ºæ­¢ï¼Œå¦åˆ™è¿™ä¸ªsocketå°±ç®—åºŸäº†ã€‚è€Œä½¿ç”¨æ¡ä»¶è§¦å‘çš„<code>api</code> æ—¶ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä¸éœ€è¦å†™å°±ä¸è¦å…³æ³¨socketå¯å†™çš„äº‹ä»¶ï¼Œå¦åˆ™å°±ä¼šæ— é™æ¬¡çš„ç«‹å³è¿”å›ä¸€ä¸ªwrite ready notificationã€‚</p><p>selectå±äºå…¸å‹çš„æ¡ä»¶è§¦å‘ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxç³»ç»Ÿç¼–ç¨‹04çº¿ç¨‹ä¸å¤šçº¿ç¨‹</title>
      <link href="/2025/01/12/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B04%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
      <url>/2025/01/12/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B04%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%A4%9A%E7%BA%BF%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h3 id="çº¿ç¨‹çš„æ¦‚å¿µ"><a href="#çº¿ç¨‹çš„æ¦‚å¿µ" class="headerlink" title="çº¿ç¨‹çš„æ¦‚å¿µ"></a>çº¿ç¨‹çš„æ¦‚å¿µ</h3><p>çº¿ç¨‹æ˜¯åœ¨è¿›ç¨‹ä¸­äº§ç”Ÿçš„ä¸€ä¸ªæ‰§è¡Œå•å…ƒï¼Œæ˜¯CPUè°ƒåº¦å’Œåˆ†é…çš„æœ€å°å•å…ƒï¼Œå…¶åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ä¸å…¶ä»–çº¿ç¨‹å¹¶è¡Œè¿è¡Œï¼Œä»–ä»¬å¯ä»¥å…±äº«è¿›ç¨‹å†…çš„èµ„æºï¼Œæ¯”å¦‚å†…å­˜ã€åœ°å€ç©ºé—´ã€æ‰“å¼€çš„æ–‡ä»¶ç­‰ç­‰ã€‚</p><p>   <strong>çº¿ç¨‹</strong>æ˜¯CPUè°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½</p><p>   <strong>è¿›ç¨‹</strong>æ˜¯åˆ†é…èµ„æºçš„åŸºæœ¬å•ä½</p><p><img src="https://bu.dusays.com/2025/01/13/67841d43278bb.png"></p><p>è¿›ç¨‹ï¼šæ­£åœ¨è¿è¡Œçš„ç¨‹åºï¼ˆç‹­ä¹‰ï¼‰</p><p>æ˜¯å¤„äºæ‰§è¡ŒæœŸçš„ç¨‹åºä»¥åŠå®ƒæ‰€ç®¡ç†çš„èµ„æºï¼ˆå¦‚æ‰“å¼€çš„æ–‡ä»¶ã€æŒ‚èµ·çš„ä¿¡å·ã€è¿›ç¨‹çŠ¶æ€ã€åœ°å€ç©ºé—´ç­‰ç­‰ï¼‰çš„æ€»ç§°ï¼Œä»æ“ä½œç³»ç»Ÿæ ¸å¿ƒè§’åº¦æ¥è¯´ï¼Œè¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè°ƒåº¦é™¤CPUæ—¶é—´ç‰‡å¤–è¿›è¡Œçš„èµ„æºåˆ†é…å’Œä¿æŠ¤çš„åŸºæœ¬å•ä½ï¼Œå®ƒæœ‰ä¸€ä¸ªç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œç”¨æ¥å®¹çº³è¿›ç¨‹æ˜ åƒ(å¦‚ä¸è¿›ç¨‹å…³è”çš„ç¨‹åºä¸æ•°æ®)ï¼Œå¹¶ä»¥è¿›ç¨‹ä¸ºå•ä½å¯¹å„ç§èµ„æºå®æ–½ä¿æŠ¤ï¼Œå¦‚å—ä¿æŠ¤åœ°è®¿é—®å¤„ç†å™¨ã€æ–‡ä»¶ã€å¤–éƒ¨è®¾å¤‡åŠå…¶ä»–è¿›ç¨‹(è¿›ç¨‹é—´é€šä¿¡) </p><h4 id="ä¸ºä»€ä¹ˆä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ"></a>ä¸ºä»€ä¹ˆä½¿ç”¨å¤šçº¿ç¨‹ï¼Ÿ</h4><p>1ï¸âƒ£ <strong>é¿å…é˜»å¡</strong>ï¼šå•ä¸ªè¿›ç¨‹åªæœ‰ä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œå½“ä¸»çº¿ç¨‹é˜»å¡çš„æ—¶å€™ï¼Œæ•´ä¸ªè¿›ç¨‹ä¹Ÿå°±é˜»å¡äº†ï¼Œæ— æ³•å†å»åšå…¶å®ƒçš„ä¸€äº›åŠŸèƒ½äº†ã€‚</p><p>2ï¸âƒ£ <strong>é¿å…CPUç©ºè½¬</strong>ï¼šåº”ç”¨ç¨‹åºç»å¸¸ä¼šæ¶‰åŠåˆ° <code>RPC</code>ï¼Œæ•°æ®åº“è®¿é—®ï¼Œç£ç›˜IOç­‰æ“ä½œï¼Œè¿™äº›æ“ä½œçš„é€Ÿåº¦æ¯”CPUæ…¢å¾ˆå¤šï¼Œè€Œåœ¨ç­‰å¾…è¿™äº›å“åº”æ—¶ï¼ŒCPUå´ä¸èƒ½å»å¤„ç†æ–°çš„è¯·æ±‚ï¼Œå¯¼è‡´è¿™ç§å•çº¿ç¨‹çš„åº”ç”¨ç¨‹åºæ€§èƒ½å¾ˆå·®ã€‚</p><p>3ï¸âƒ£ <strong>æå‡æ•ˆç‡</strong>ï¼šä¸€ä¸ªè¿›ç¨‹è¦ç‹¬ç«‹æ‹¥æœ‰ 4 GBçš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œè€Œå¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«åŒä¸€åœ°å€ç©ºé—´ï¼Œçº¿ç¨‹çš„åˆ‡æ¢æ¯”è¿›ç¨‹çš„åˆ‡æ¢è¦å¿«å¾—å¤šã€‚</p><p><img src="https://bu.dusays.com/2025/01/13/67841d4328da3.png"></p><p>è¡¥å……ï¼šRPCï¼šåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œç”¨æˆ·è°ƒç”¨æ¥å£ + å…·ä½“ç½‘ç»œåè®®ã€‚åè€…ç”±æ¡†æ¶æ¥å®ç°ã€‚</p><p>å…·ä½“ç½‘ç»œåè®®æ˜¯æ¡†æ¶æ¥å®ç°çš„ï¼ŒæŠŠå¼€å‘è€…è¦å‘å‡ºå’Œæ¥æ”¶çš„å†…å®¹ä»¥æŸç§åº”ç”¨å±‚åè®®æ‰“åŒ…è¿›è¡Œç½‘ç»œæ”¶å‘ã€‚</p><p>Â·HTTPä¹Ÿæ˜¯ä¸€ç§ç½‘ç»œåè®®ï¼Œä½†åŒ…çš„å†…å®¹æ˜¯å›ºå®šçš„ï¼Œå¿…é¡»æ˜¯ï¼šè¯·æ±‚è¡Œ + è¯·æ±‚å¤´ + è¯·æ±‚ä½“</p><p>Â·RPCæ˜¯ä¸€ç§è‡ªå®šä¹‰ç½‘ç»œåè®®ï¼Œç”±å…·ä½“æ¡†æ¶æ¥å®šï¼Œæ¯”å¦‚SRPCé‡Œæ”¯æŒçš„RPCåè®®æœ‰ï¼šSRPC&#x2F;thrift&#x2F;BRPC&#x2F;tRPC</p><p>ç®€å•ä»‹ç»åˆ°è¿™é‡Œï¼Œåé¢å…·ä½“å­¦ä¹ äº†å†è°ˆï¼ï¼ï¼</p><h3 id="çº¿ç¨‹çš„åˆ›å»ºä¸è¿è¡Œ"><a href="#çº¿ç¨‹çš„åˆ›å»ºä¸è¿è¡Œ" class="headerlink" title="çº¿ç¨‹çš„åˆ›å»ºä¸è¿è¡Œ"></a>çº¿ç¨‹çš„åˆ›å»ºä¸è¿è¡Œ</h3><p><strong><code>pthread_create</code>å‡½æ•°</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="comment">// çº¿ç¨‹çš„åˆ›å»º</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">pthread_create</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="type">pthread_t</span>*restrict thread, </span></span></span><br><span class="line"><span class="params"><span class="function"><span class="type">const</span> <span class="type">pthread_attr_t</span> * restrict attr,</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="type">void</span> *(* start_routine)(<span class="type">void</span> *),</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="type">void</span>*restrict arg</span></span></span><br><span class="line"><span class="params"><span class="function">)</span></span>;</span><br><span class="line">thread</span><br><span class="line"><span class="comment">// ä¿å­˜æ–°åˆ›å»ºçº¿ç¨‹IDçš„å˜é‡åœ°å€å€¼ã€‚çº¿ç¨‹ä¸è¿›ç¨‹ç›¸åŒï¼Œä¹Ÿéœ€è¦ç”¨äºåŒºåˆ†ä¸åŒçº¿ç¨‹çš„IDã€‚</span></span><br><span class="line">attr</span><br><span class="line"><span class="comment">// ç”¨äºä¼ é€’çº¿ç¨‹å±æ€§çš„å‚æ•°ï¼Œä¼ é€’NULLæ—¶ï¼Œåˆ›å»ºé»˜è®¤å±æ€§çš„çº¿ç¨‹ã€‚</span></span><br><span class="line"></span><br><span class="line">start_routine</span><br><span class="line"><span class="comment">// ç›¸å½“äºçº¿ç¨‹mainå‡½æ•°çš„ã€åœ¨å•ç‹¬æ‰§è¡Œæµä¸­æ‰§è¡Œçš„å‡½æ•°åœ°å€å€¼ï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰ã€‚</span></span><br><span class="line"></span><br><span class="line">arg</span><br><span class="line"><span class="comment">// é€šè¿‡ç¬¬ä¸‰ä¸ªå‚æ•°ä¼ é€’è°ƒç”¨å‡½æ•°æ—¶åŒ…å«ä¼ é€’å‚æ•°ä¿¡æ¯çš„å˜é‡åœ°å€å€¼ã€‚</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>pthread_join</code>å‡½æ•°<br>è°ƒç”¨<code>pthread_join</code>å‡½æ•°çš„è¿›ç¨‹ï¼ˆæˆ–çº¿ç¨‹ï¼‰å°†è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºIDçš„çº¿ç¨‹ç»ˆæ­¢ä¸ºæ­¢ã€‚è€Œä¸”å¯ä»¥å¾—åˆ°çº¿ç¨‹çš„mainå‡½æ•°è¿”å›å€¼ï¼Œæ‰€ä»¥è¯¥å‡½æ•°æ¯”è¾ƒæœ‰ç”¨ã€‚ä¸‹é¢é€šè¿‡ç¤ºä¾‹äº†è§£è¯¥å‡½æ•°çš„åŠŸèƒ½ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="keyword">include</span><span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">pthread_join</span><span class="params">(<span class="type">pthread_t</span> thread, <span class="type">void</span> ** status)</span></span>;</span><br></pre></td></tr></table></figure><h4 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">threadEntry</span><span class="params">(<span class="type">void</span>* arg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* msg = <span class="string">&quot;i am from thread&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s thread begin: %s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__, arg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> (<span class="type">void</span>*)msg;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">lession94</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">pthread_t</span> tid;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* pInfo = <span class="string">&quot;hello world&quot;</span>; <span class="comment">// å…¨å±€çš„</span></span><br><span class="line"><span class="type">int</span> ret = <span class="built_in">pthread_create</span>(&amp;tid, <span class="literal">NULL</span>, threadEntry,(<span class="type">void</span>*)pInfo);</span><br><span class="line"><span class="keyword">if</span> (ret != <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">void</span>* result = <span class="literal">NULL</span>;</span><br><span class="line"><span class="built_in">pthread_join</span>(tid, &amp;result);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s from thread: %s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__, result);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸è¦ä½¿ç”¨å±€éƒ¨å˜é‡</p><h3 id="çº¿ç¨‹åŒæ­¥ï¼šäº’æ–¥é‡"><a href="#çº¿ç¨‹åŒæ­¥ï¼šäº’æ–¥é‡" class="headerlink" title="çº¿ç¨‹åŒæ­¥ï¼šäº’æ–¥é‡"></a>çº¿ç¨‹åŒæ­¥ï¼šäº’æ–¥é‡</h3><p>ä¸¤ä¸ªçº¿ç¨‹ç›´æ¥è®¿é—®ä¸€ä¸ªå…¨å±€å˜é‡å¹¶è¿›è¡Œå¯¹åº”çš„è¿ç®—ï¼Œç»“æœæ˜¯ä¸ç¡®å®šçš„</p><p><strong>çº¿ç¨‹åŒæ­¥</strong>ç”¨äºè§£å†³çº¿ç¨‹è®¿é—®é¡ºåºå¼•å‘çš„é—®é¢˜ã€‚éœ€è¦åŒæ­¥çš„æƒ…å†µå¯ä»¥ä»å¦‚ä¸‹ä¸¤æ–¹é¢è€ƒè™‘ã€‚</p><p><strong>1</strong>ã€åŒæ—¶è®¿é—®åŒä¸€å†…å­˜ç©ºé—´æ—¶å‘ç”Ÿçš„æƒ…å†µã€‚</p><p><strong>2</strong>ã€éœ€è¦æŒ‡å®šè®¿é—®åŒä¸€å†…å­˜ç©ºé—´çš„çº¿ç¨‹æ‰§è¡Œé¡ºåºçš„æƒ…å†µã€‚</p><h4 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> num = <span class="number">0</span>;</span><br><span class="line"><span class="type">pthread_mutex_t</span> mutex;</span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">thread_inc</span><span class="params">(<span class="type">void</span>* arg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å®æ—¶æ€§é«˜ï¼Œä½†æŠ¢å å·®</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">pthread_mutex_lock</span>(&amp;mutex);</span><br><span class="line">num++;</span><br><span class="line"><span class="built_in">pthread_mutex_unlock</span>(&amp;mutex);</span><br><span class="line"><span class="keyword">if</span> (i % <span class="number">10000</span>) <span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s num is: %d\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__, num);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">thread_dec</span><span class="params">(<span class="type">void</span>* arg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å®æ—¶æ€§å·®ï¼Œä½†æŠ¢å é«˜</span></span><br><span class="line"><span class="built_in">pthread_mutex_lock</span>(&amp;mutex);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">num--;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">pthread_mutex_unlock</span>(&amp;mutex);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//äº’æ–¥é‡</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">lession95</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">pthread_mutex_init</span>(&amp;mutex, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">pthread_t</span> thread_id[<span class="number">50</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (i % <span class="number">2</span>) <span class="built_in">pthread_create</span>(thread_id + i, <span class="literal">NULL</span>, thread_inc, <span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">else</span> <span class="built_in">pthread_create</span>(thread_id + i, <span class="literal">NULL</span>, thread_dec, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">pthread_join</span>(thread_id[i], <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s num is: %d\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__, num);</span><br><span class="line"><span class="built_in">pthread_mutex_destroy</span>(&amp;mutex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="çº¿ç¨‹åŒæ­¥ï¼šä¿¡å·é‡"><a href="#çº¿ç¨‹åŒæ­¥ï¼šä¿¡å·é‡" class="headerlink" title="çº¿ç¨‹åŒæ­¥ï¼šä¿¡å·é‡"></a>çº¿ç¨‹åŒæ­¥ï¼šä¿¡å·é‡</h3><p>ä¿¡å·é‡ä¸äº’æ–¥é‡æä¸ºç›¸ä¼¼ï¼Œåœ¨äº’æ–¥é‡çš„åŸºç¡€ä¸Šå¾ˆå®¹æ˜“ç†è§£ä¿¡å·é‡</p><p>åˆå§‹å€¼ä¸º 1 çš„ä¿¡å·é‡ï¼Œå¯ä»¥ç”¨ä½œäº’æ–¥é”ï¼ˆæŠŠä¿¡å·å€¼å§‹ç»ˆæ§åˆ¶ä¸º1ï¼‰</p><p>ä¿¡å·é‡åˆ›å»ºåŠé”€æ¯æ–¹æ³•å¦‚ä¸‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;semaphore.h&gt;</span></span></span><br><span class="line"><span class="comment">// å‚æ•°ä¸€  åˆ›å»ºä¿¡å·é‡æ—¶ä¼ é€’ä¿å­˜ä¿¡å·é‡çš„å˜é‡åœ°å€å€¼ï¼Œé”€æ¯æ—¶ä¼ é€’éœ€è¦é”€æ¯çš„ä¿¡å·é‡å˜é‡åœ°å€å€¼ã€‚</span></span><br><span class="line"><span class="comment">// å‚æ•°äºŒ  å†³å®šå‡ ä¸ªçº¿ç¨‹</span></span><br><span class="line"><span class="comment">// å‚æ•°ä¸‰  æŒ‡å®šåˆå§‹å€¼</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sem_init</span><span class="params">(<span class="type">sem_t</span>* sem, <span class="type">int</span> pshared, <span class="type">unsigned</span> <span class="type">int</span> value)</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sem_destroy</span><span class="params">(<span class="type">sem_t</span>* sem)</span></span>;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;semaphore.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sem_post</span><span class="params">(<span class="type">sem_t</span>*sem)</span></span>;  <span class="comment">// V æ“ä½œ</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">sem_wait</span><span class="params">(<span class="type">sem_t</span> * sem)</span></span>;  <span class="comment">// Pæ“ä½œ</span></span><br></pre></td></tr></table></figure><h3 id="çº¿ç¨‹çš„é”€æ¯"><a href="#çº¿ç¨‹çš„é”€æ¯" class="headerlink" title="çº¿ç¨‹çš„é”€æ¯"></a>çº¿ç¨‹çš„é”€æ¯</h3><p><strong>é”€æ¯çº¿ç¨‹çš„2ç§æ–¹æ³•</strong></p><p>Linuxçº¿ç¨‹å¹¶ä¸æ˜¯åœ¨é¦–æ¬¡è°ƒç”¨çš„çº¿ç¨‹mainå‡½æ•°è¿”å›æ—¶è‡ªåŠ¨é”€æ¯ï¼Œæ‰€ä»¥ç”¨å¦‚ä¸‹2ç§æ–¹æ³•ä¹‹ä¸€åŠ ä»¥æ˜ç¡®ã€‚å¦åˆ™ç”±çº¿ç¨‹åˆ›å»ºçš„å†…å­˜ç©ºé—´å°†ä¸€ç›´å­˜åœ¨ã€‚</p><p>1ã€è°ƒç”¨pthread_joinå‡½æ•°ã€‚</p><p>2ã€è°ƒç”¨pthread_detachå‡½æ•°ã€‚</p><p>ä¹‹å‰è°ƒç”¨è¿‡pthread_joinå‡½æ•°ã€‚è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œä¸ä»…ä¼šç­‰å¾…çº¿ç¨‹ç»ˆæ­¢ï¼Œè¿˜ä¼šå¼•å¯¼çº¿ç¨‹é”€æ¯ã€‚ä½†è¯¥å‡½æ•°çš„é—®é¢˜æ˜¯ï¼Œçº¿ç¨‹ç»ˆæ­¢å‰ï¼Œè°ƒç”¨è¯¥å‡½æ•°çš„çº¿ç¨‹å°†è¿›å…¥é˜»å¡çŠ¶æ€ã€‚å› æ­¤ï¼Œé€šå¸¸é€šè¿‡å¦‚ä¸‹å‡½æ•°è°ƒç”¨å¼•å¯¼çº¿ç¨‹é”€æ¯ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">pthread_detach</span><span class="params">(<span class="type">pthread_t</span> thread)</span></span>;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨ <strong>pthread_detach</strong>å‡½æ•°ä¸ä¼šå¼•èµ·çº¿ç¨‹ç»ˆæ­¢æˆ–è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå¯ä»¥é€šè¿‡è¯¥å‡½æ•°å¼•å¯¼é”€æ¯çº¿ç¨‹åˆ›å»ºçš„å†…å­˜ç©ºé—´ã€‚</p><p><code>pthread_detach(pthread_self());</code> </p><p><code>pthread_exit(0) ;</code></p><p>è°ƒç”¨ä»¥ä¸Šçº¿ç¨‹å‡½æ•°æ¥è¿›è¡Œè‡ªåŠ¨é”€æ¯æ— éœ€å¤–éƒ¨çš„æ“ä½œ</p><h3 id="å¤šçº¿ç¨‹å¹¶å‘æœåŠ¡å™¨çš„å®ç°"><a href="#å¤šçº¿ç¨‹å¹¶å‘æœåŠ¡å™¨çš„å®ç°" class="headerlink" title="å¤šçº¿ç¨‹å¹¶å‘æœåŠ¡å™¨çš„å®ç°"></a>å¤šçº¿ç¨‹å¹¶å‘æœåŠ¡å™¨çš„å®ç°</h3><p><strong>èŠå¤©å®¤é¡¹ç›®ï¼šç½‘ç»œç¼–ç¨‹ + å¤šçº¿ç¨‹ + çº¿ç¨‹åŒæ­¥å®ç°çš„ èŠå¤©æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯</strong></p><p>ä»¥å‰è¿›ç¨‹æ˜¯ï¼Œæ¯æœ‰å®¢æˆ·ç«¯è¿æ¥ï¼Œforkä¸€æ¬¡ï¼Œç°åœ¨æ˜¯å¼€ä¸€ä¸ªçº¿ç¨‹æ¥å’Œå®¢æˆ·ç«¯è¿›è¡Œæ²Ÿé€šï¼Œä¸»çš„åœ¨ç­‰å¾…</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> clnt_socks[<span class="number">100</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="type">int</span> clnt_cnt = <span class="number">0</span>;</span><br><span class="line"><span class="type">pthread_mutex_t</span> mutex1;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘æ‰€æœ‰å·²è¿æ¥çš„å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">send_msg</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* msg, <span class="type">ssize_t</span> str_len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">pthread_mutex_lock</span>(&amp;mutex1);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; clnt_cnt; i++) &#123;</span><br><span class="line"><span class="keyword">if</span> (clnt_socks[i] &gt;= <span class="number">0</span>)</span><br><span class="line"><span class="built_in">write</span>(clnt_socks[i], msg, str_len);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">pthread_mutex_unlock</span>(&amp;mutex1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">handle_clnt</span><span class="params">(<span class="type">void</span>* arg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">pthread_detach</span>(<span class="built_in">pthread_self</span>());</span><br><span class="line"><span class="type">int</span> clnt_sock = *(<span class="type">int</span>*)arg;</span><br><span class="line"><span class="type">char</span> msg[<span class="number">1024</span>] = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">ssize_t</span> str_len = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> ((str_len = <span class="built_in">read</span>(clnt_sock, msg, <span class="built_in">sizeof</span>(msg))) &gt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="comment">//<span class="doctag">TODO:</span>è¿‡æ»¤æ•æ„Ÿè¯</span></span><br><span class="line"><span class="built_in">send_msg</span>(msg, str_len);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">pthread_mutex_lock</span>(&amp;mutex1);</span><br><span class="line"><span class="comment">//for (int i = 0; i &lt; clnt_cnt; i++) &#123;//TDDO:ä¼˜åŒ–é€»è¾‘</span></span><br><span class="line"><span class="comment">//if (clnt_sock == clnt_socks[i]) &#123;</span></span><br><span class="line"><span class="comment">//clnt_socks[i] = -1;</span></span><br><span class="line"><span class="comment">//break;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line">*(<span class="type">int</span>*)arg = <span class="number">-1</span>;</span><br><span class="line"><span class="built_in">pthread_mutex_unlock</span>(&amp;mutex1);</span><br><span class="line"><span class="built_in">close</span>(clnt_sock);</span><br><span class="line"><span class="built_in">pthread_exit</span>(<span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">server98</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="type">int</span> serv_sock, clnt_sock;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> serv_adr, clnt_adr;</span><br><span class="line"><span class="type">socklen_t</span> clnt_adr_sz = <span class="built_in">sizeof</span>(clnt_adr);</span><br><span class="line">serv_sock = <span class="built_in">socket</span>(PF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">memset</span>(&amp;serv_adr, <span class="number">0</span>, <span class="built_in">sizeof</span>(serv_adr));</span><br><span class="line">serv_adr.sin_family = AF_INET;</span><br><span class="line">serv_adr.sin_addr.s_addr = <span class="built_in">htonl</span>(INADDR_ANY);</span><br><span class="line">serv_adr.sin_port = <span class="built_in">htons</span>(<span class="number">9527</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–ä¸€ä¸ªäº’æ–¥é”ï¼Œä¿æŠ¤å…±äº«èµ„æºã€‚NULLè¡¨ç¤ºé»˜è®¤å±æ€§</span></span><br><span class="line"><span class="built_in">pthread_mutex_init</span>(&amp;mutex1, <span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">bind</span>(serv_sock, (<span class="keyword">struct</span> sockaddr*)&amp;serv_adr, <span class="built_in">sizeof</span>(serv_adr)) == <span class="number">-1</span>) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;bind error %d %s&quot;</span>, errno, <span class="built_in">strerror</span>(errno));</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">listen</span>(serv_sock, <span class="number">5</span>) == <span class="number">-1</span>) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;listen error %d %s&quot;</span>, errno, <span class="built_in">strerror</span>(errno));</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (;;) &#123;<span class="comment">//while(1)ç­‰ä»·</span></span><br><span class="line">        <span class="comment">//acceptå‡½æ•°ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰å®¢æˆ·ç«¯è¿æ¥ã€‚å¦‚æœæˆåŠŸï¼Œè¿”å›ä¸€ä¸ªæ–°çš„å¥—æ¥å­—æè¿°ç¬¦clnt_sock</span></span><br><span class="line">clnt_sock = <span class="built_in">accept</span>(serv_sock, (<span class="keyword">struct</span> sockaddr*)&amp;clnt_adr, &amp;clnt_adr_sz);</span><br><span class="line"><span class="keyword">if</span> (clnt_sock == <span class="number">-1</span>) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;accept error %d %s&quot;</span>, errno, <span class="built_in">strerror</span>(errno));</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">        <span class="comment">// é”å®šäº’æ–¥é”mutex1ï¼Œä»¥é˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å…±äº«èµ„æºclnt_sockså’Œclnt_cntã€‚</span></span><br><span class="line"><span class="built_in">pthread_mutex_lock</span>(&amp;mutex1);</span><br><span class="line">clnt_socks[clnt_cnt++] = clnt_sock;</span><br><span class="line">        <span class="comment">// è§£é”äº’æ–¥é”mutex1ã€‚</span></span><br><span class="line"><span class="built_in">pthread_mutex_unlock</span>(&amp;mutex1);</span><br><span class="line"><span class="type">pthread_t</span> thread;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œæ‰§è¡Œhandle_clntå‡½æ•°</span></span><br><span class="line"><span class="comment">// å¹¶å°†æ–°æ¥å—çš„å®¢æˆ·ç«¯å¥—æ¥å­—æè¿°ç¬¦çš„åœ°å€ä½œä¸ºå‚æ•°ä¼ é€’ç»™handle_clntå‡½æ•°ã€‚NULLè¡¨ç¤ºä½¿ç”¨é»˜è®¤çš„çº¿ç¨‹å±æ€§ã€‚</span></span><br><span class="line"><span class="built_in">pthread_create</span>(&amp;thread, <span class="literal">NULL</span>, handle_clnt, &amp;clnt_socks[clnt_cnt - <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">close</span>(serv_sock);</span><br><span class="line">    <span class="comment">// é”€æ¯äº’æ–¥é”mutex1ã€‚</span></span><br><span class="line"><span class="built_in">pthread_mutex_destroy</span>(&amp;mutex1);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">sem_t</span> semid;</span><br><span class="line"><span class="type">char</span> name[<span class="number">64</span>] = <span class="string">&quot;[DEFAULT]&quot;</span>;</span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">client_send_msg</span><span class="params">(<span class="type">void</span>* arg)</span> </span>&#123;</span><br><span class="line"><span class="built_in">pthread_detach</span>(<span class="built_in">pthread_self</span>());</span><br><span class="line">    <span class="comment">// ä»ä¼ å…¥çš„å‚æ•°ä¸­è·å–å®¢æˆ·ç«¯å¥—æ¥å­—æè¿°ç¬¦</span></span><br><span class="line"><span class="type">int</span> sock = *(<span class="type">int</span>*)arg;</span><br><span class="line"><span class="type">char</span> msg[<span class="number">256</span>] = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="type">char</span> buffer[<span class="number">1024</span>];</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="built_in">memset</span>(buffer, <span class="number">0</span>, <span class="built_in">sizeof</span>(buffer));</span><br><span class="line"><span class="built_in">fgets</span>(msg, <span class="built_in">sizeof</span>(msg), stdin);</span><br><span class="line"><span class="keyword">if</span> ((<span class="built_in">strcmp</span>(msg, <span class="string">&quot;q\n&quot;</span>) == <span class="number">0</span>) || (<span class="built_in">strcmp</span>(msg, <span class="string">&quot;Q\n&quot;</span>) == <span class="number">0</span>)) &#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">snprintf</span>(buffer, <span class="built_in">sizeof</span>(msg), <span class="string">&quot;%s %s&quot;</span>, name, msg);</span><br><span class="line"><span class="built_in">write</span>(sock, buffer, <span class="built_in">strlen</span>(buffer));</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">sem_post</span>(&amp;semid);  <span class="comment">// Væ“ä½œ</span></span><br><span class="line"><span class="built_in">pthread_exit</span>(<span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">client_recv_msg</span><span class="params">(<span class="type">void</span>* arg)</span> </span>&#123;</span><br><span class="line"><span class="built_in">pthread_detach</span>(<span class="built_in">pthread_self</span>());</span><br><span class="line"><span class="type">int</span> sock = *(<span class="type">int</span>*)arg;</span><br><span class="line"><span class="type">char</span> msg[<span class="number">256</span>] = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="comment">// å¥—æ¥å­—sockè¯»å–æ•°æ®ï¼Œå­˜å‚¨åˆ°msgä¸­ï¼Œstr_lenä¸ºè¯»å–çš„å­—èŠ‚æ•°ã€‚</span></span><br><span class="line"><span class="type">ssize_t</span> str_len = <span class="built_in">read</span>(sock, msg, <span class="built_in">sizeof</span>(msg));</span><br><span class="line"><span class="keyword">if</span> (str_len &lt;= <span class="number">0</span>)<span class="keyword">break</span>;</span><br><span class="line"><span class="built_in">fputs</span>(msg, stdout);</span><br><span class="line"><span class="built_in">memset</span>(msg, <span class="number">0</span>, str_len);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">sem_post</span>(&amp;semid);  <span class="comment">// V æ“ä½œ</span></span><br><span class="line"><span class="built_in">pthread_exit</span>(<span class="literal">NULL</span>); <span class="comment">// çº¿ç¨‹ç»“æŸ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">client98</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="type">int</span> sock = <span class="built_in">socket</span>(PF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> serv_addr;</span><br><span class="line"><span class="built_in">memset</span>(&amp;serv_addr, <span class="number">0</span>, <span class="built_in">sizeof</span>(serv_addr));</span><br><span class="line">serv_addr.sin_family = AF_INET;</span><br><span class="line">serv_addr.sin_addr.s_addr = <span class="built_in">inet_addr</span>(<span class="string">&quot;127.0.0.1&quot;</span>);</span><br><span class="line">serv_addr.sin_port = <span class="built_in">htons</span>(<span class="number">9527</span>);</span><br><span class="line"><span class="built_in">fputs</span>(<span class="string">&quot;input your name:&quot;</span>, stdout);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, name);</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">connect</span>(sock, (<span class="keyword">struct</span> sockaddr*)&amp;serv_addr, <span class="built_in">sizeof</span>(serv_addr)) == <span class="number">-1</span>) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;connect error %d %s&quot;</span>, errno, <span class="built_in">strerror</span>(errno));</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸¤ä¸ªçº¿ç¨‹æ ‡è¯†ç¬¦thsendå’Œthrecvï¼Œåˆ†åˆ«ç”¨äºå‘é€å’Œæ¥æ”¶æ¶ˆæ¯çš„çº¿ç¨‹ã€‚</span></span><br><span class="line"><span class="type">pthread_t</span> thsend, threcv;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–ä¿¡å·é‡semidã€‚0è¡¨ç¤ºä¿¡å·é‡æ˜¯è¿›ç¨‹å†…å…±äº«çš„ï¼Œ-1æ˜¯ä¿¡å·é‡çš„åˆå§‹å€¼ã€‚</span></span><br><span class="line"><span class="built_in">sem_init</span>(&amp;semid, <span class="number">0</span>, <span class="number">-1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç»™çº¿ç¨‹ç»‘å®šä¸»å‡½æ•°</span></span><br><span class="line">    <span class="comment">// (void*)&amp;sock  å‚æ•°</span></span><br><span class="line"><span class="built_in">pthread_create</span>(&amp;thsend, <span class="literal">NULL</span>, client_send_msg, (<span class="type">void</span>*)&amp;sock);</span><br><span class="line"><span class="built_in">pthread_create</span>(&amp;threcv, <span class="literal">NULL</span>, client_recv_msg, (<span class="type">void</span>*)&amp;sock);</span><br><span class="line"><span class="built_in">sem_wait</span>(&amp;semid);  <span class="comment">// Pæ“ä½œ</span></span><br><span class="line"><span class="built_in">close</span>(sock);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">lession98</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* arg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">strcmp</span>(arg, <span class="string">&quot;s&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line"><span class="built_in">server98</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">client98</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxç³»ç»Ÿç¼–ç¨‹03è¿›ç¨‹é€šä¿¡</title>
      <link href="/2025/01/12/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B03%E8%BF%9B%E7%A8%8B%E9%80%9A%E4%BF%A1/"/>
      <url>/2025/01/12/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B03%E8%BF%9B%E7%A8%8B%E9%80%9A%E4%BF%A1/</url>
      
        <content type="html"><![CDATA[<h3 id="è¿›ç¨‹çš„æ¦‚å¿µä»¥åŠåº”ç”¨"><a href="#è¿›ç¨‹çš„æ¦‚å¿µä»¥åŠåº”ç”¨" class="headerlink" title="è¿›ç¨‹çš„æ¦‚å¿µä»¥åŠåº”ç”¨"></a>è¿›ç¨‹çš„æ¦‚å¿µä»¥åŠåº”ç”¨</h3><p>â€‹å ç”¨å†…å­˜ç©ºé—´çš„æ­£åœ¨è¿è¡Œçš„ç¨‹åºå³ä¸ºè¿›ç¨‹</p><p>â€‹ä»æ“ä½œç³»ç»Ÿçš„è§’åº¦çœ‹ï¼Œè¿›ç¨‹æ˜¯ç¨‹åºæµçš„åŸºæœ¬å•ä½ï¼Œè‹¥åˆ›å»ºå¤šä¸ªè¿›ç¨‹ï¼Œåˆ™æ“ä½œç³»ç»Ÿå°†åŒæ—¶è¿è¡Œã€‚æœ‰æ—¶ä¸€ä¸ªç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ä¹Ÿä¼šäº§ç”Ÿå¤šä¸ªè¿›ç¨‹ã€‚</p><p>CPUæ ¸çš„ä¸ªæ•°ä¸è¿›ç¨‹æ•°   ï¼šä¸€ä¸ªCPUä¸­å¯èƒ½åŒ…å«å¤šä¸ªè¿ç®—è®¾å¤‡ï¼ˆæ ¸ï¼‰ã€‚æ ¸çš„ä¸ªæ•°ä¸å¯åŒæ—¶è¿è¡Œçš„è¿›ç¨‹æ•°ç›¸åŒã€‚</p><p>è‹¥è¿›ç¨‹æ•°è¶…è¿‡äº†æ ¸æ•°ï¼Œè¿›ç¨‹å°†åˆ†æ—¶ä½¿ç”¨CPUèµ„æºã€‚</p><p>è¿›ç¨‹IDï¼š1 è¦åˆ†é…ç»™æ“ä½œç³»ç»Ÿå¯åŠ¨åçš„ï¼ˆç”¨äºååŠ©æ“ä½œç³»ç»Ÿï¼‰é¦–ä¸ªè¿›ç¨‹ï¼Œå› æ­¤ç”¨æˆ·è¿›ç¨‹æ— æ³•å¾—åˆ°IDå€¼1</p><p><strong>åˆ›å»ºè¿›ç¨‹</strong></p><p>é€šè¿‡è°ƒç”¨forkå‡½æ•°åˆ›å»ºè¿›ç¨‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">pid_t</span> pid = fork();</span><br></pre></td></tr></table></figure><p>forkå‡½æ•°å°†åˆ›å»ºè°ƒç”¨çš„è¿›ç¨‹å‰¯æœ¬ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ˜¯å¤åˆ¶æ­£åœ¨è¿è¡Œçš„ã€è°ƒç”¨forkå‡½æ•°çš„è¿›ç¨‹ã€‚å¦å¤–ä¸¤ä¸ªè¿›ç¨‹éƒ½å°†æ‰§è¡Œforkè°ƒç”¨åçš„è¯­å¥ï¼ˆforkå‡½æ•°è¿”å›åï¼‰ã€‚åŒä¸€ä¸ªè¿›ç¨‹ã€å¤åˆ¶ç›¸åŒçš„å†…å­˜ç©ºé—´ï¼Œä¹‹åçš„ç¨‹åºè¦æ ¹æ®forkå‡½æ•°çš„è¿”å›å€¼åŠ ä»¥åŒºåˆ†ã€‚å³åˆ©ç”¨forkå‡½æ•°çš„å¦‚ä¸‹ç‰¹ç‚¹åŒºåˆ†ç¨‹åºæ‰§è¡Œæµç¨‹ã€‚</p><p>â€‹çˆ¶è¿›ç¨‹ï¼šforkå‡½æ•°è¿”å›å­è¿›ç¨‹ID.</p><p>â€‹å­è¿›ç¨‹ï¼šforkå‡½æ•°è¿”å›0</p><p><strong>åƒµå°¸è¿›ç¨‹</strong></p><p>äº§ç”Ÿåƒµå°¸è¿›ç¨‹çš„åŸå› ï¼š</p><p>â€‹è°ƒç”¨forkå‡½æ•°äº§ç”Ÿå­è¿›ç¨‹çš„ç»ˆæ­¢æ–¹å¼ã€‚</p><ol><li><p>ä¼ é€’å‚æ•°å¹¶è°ƒç”¨exitå‡½æ•°ã€‚</p></li><li><p>mainå‡½æ•°ä¸­æ‰§è¡Œreturnè¯­å¥å¹¶è¿”å›å€¼ã€‚</p><p>å‘exitå‡½æ•°ä¼ é€’çš„å‚æ•°å€¼å’Œmainå‡½æ•°çš„returnè¯­å¥è¿”å›å€¼éƒ½æ˜¯ä¼šä¼ é€’ç»™æ“ä½œç³»ç»Ÿã€‚è€Œæ“ä½œç³»ç»Ÿä¸ä¼šé”€æ¯å­è¿›ç¨‹ï¼Œç›´åˆ°è¿™äº›å€¼ä¼ é€’ç»™äº§ç”Ÿæ”¹å­è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ã€‚å¤„åœ¨è¿™ç§çŠ¶æ€ä¸‹çš„è¿›ç¨‹å°±æ˜¯åƒµå°¸è¿›ç¨‹ã€‚å°†å­è¿›ç¨‹å˜æˆåƒµå°¸è¿›ç¨‹çš„æ­£æ˜¯æ“ä½œç³»ç»Ÿã€‚</p></li></ol><p>åƒµå°¸è¿›ç¨‹æ€ä¹ˆé”€æ¯å‘¢ï¼Ÿ     åº”è¯¥å‘åˆ›å»ºå­è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ä¼ é€’å­è¿›ç¨‹çš„exitå‚æ•°å€¼æˆ–returnè¯­å¥çš„è¿”å›å€¼ã€‚</p><p>â€‹æ“ä½œç³»ç»Ÿä¸ä¼šä¸»åŠ¨æŠŠè¿™äº›å€¼ä¼ é€’ç»™çˆ¶è¿›ç¨‹ã€‚åªæœ‰çˆ¶è¿›ç¨‹ä¸»åŠ¨å‘èµ·è¯·æ±‚ï¼ˆå‡½æ•°è°ƒç”¨ï¼‰æ—¶ï¼Œæ“ä½œç³»ç»Ÿæ‰ä¼šä¼ é€’è¯¥å€¼ã€‚å¦‚æœçˆ¶è¿›ç¨‹æœªä¸»åŠ¨è¦æ±‚è·å¾—å­è¿›ç¨‹çš„ç»“æŸçŠ¶æ€å€¼ï¼Œæ“ä½œç³»ç»Ÿå°†ä¸€ç›´ä¿å­˜ï¼Œå¹¶è®©å­è¿›ç¨‹é•¿æ—¶é—´å¤„äºåƒµå°¸è¿›ç¨‹çŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œçˆ¶æ¯è¦è´Ÿè´£æ”¶å›è‡ªå·±ç”Ÿçš„å­©å­ã€‚æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªåƒµå°¸è¿›ç¨‹ã€‚</p><h5 id="ä¿¡å·å¤„ç†"><a href="#ä¿¡å·å¤„ç†" class="headerlink" title="ä¿¡å·å¤„ç†"></a><strong>ä¿¡å·å¤„ç†</strong></h5><p>æˆ‘ä»¬å·²ç»çŸ¥é“äº†è¿›ç¨‹åˆ›å»ºåŠé”€æ¯æ–¹æ³•ï¼Œä½†è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ²¡è§£å†³ã€‚</p><p>â€œå­è¿›ç¨‹ç©¶ç«Ÿä½•æ—¶ç»ˆæ­¢?è°ƒç”¨waitpidå‡½æ•°åè¦æ— ä¼‘æ­¢åœ°ç­‰å¾…å—?â€</p><p>çˆ¶è¿›ç¨‹å¾€å¾€ä¸å­è¿›ç¨‹ä¸€æ ·ç¹å¿™ï¼Œå› æ­¤ä¸èƒ½åªè°ƒç”¨waitpidå‡½æ•°ä»¥ç­‰å¾…å­è¿›ç¨‹ç»ˆæ­¢ã€‚</p><p>æ–¹æ³•ï¼š</p><p><em><strong>*å‘æ“ä½œç³»ç»Ÿæ±‚åŠ©*</strong></em></p><p>å­è¿›ç¨‹ç»ˆæ­¢çš„è¯†åˆ«ä¸»ä½“æ˜¯æ“ä½œç³»ç»Ÿï¼Œå› æ­¤ï¼Œè‹¥æ“ä½œç³»ç»Ÿèƒ½æŠŠå¦‚ä¸‹ä¿¡æ¯å‘Šè¯‰æ­£å¿™äºå·¥ä½œçš„çˆ¶è¿›ç¨‹ï¼Œå°†æœ‰åŠ©äºæ„å»ºé«˜æ•ˆçš„ç¨‹åºã€‚</p><p>â€œå˜¿ï¼Œçˆ¶è¿›ç¨‹!ä½ åˆ›å»ºçš„å­è¿›ç¨‹ç»ˆæ­¢äº†!â€</p><p>æ­¤æ—¶çˆ¶è¿›ç¨‹å°†æš‚æ—¶æ”¾ä¸‹å·¥ä½œï¼Œå¤„ç†å­è¿›ç¨‹ç»ˆæ­¢ç›¸å…³äº‹å®œã€‚è¿™å°±æ˜¯ä¿¡å·å¤„ç†ï¼ˆSignal Handlingï¼‰æœºåˆ¶ã€‚æ­¤å¤„çš„â€ä¿¡å·â€æ˜¯åœ¨<strong>ç‰¹å®šäº‹ä»¶</strong>å‘ç”Ÿæ—¶ç”±<strong>æ“ä½œç³»ç»Ÿ</strong>å‘è¿›ç¨‹å‘é€çš„æ¶ˆæ¯ã€‚å¦å¤–ï¼Œä¸ºäº†å“åº”è¯¥æ¶ˆæ¯ï¼Œæ‰§è¡Œä¸æ¶ˆæ¯ç›¸å…³çš„è‡ªå®šä¹‰æ“ä½œçš„è¿‡ç¨‹ç§°ä¸ºâ€ä¿¡å·å¤„ç†â€ã€‚</p><p><img src="https://bu.dusays.com/2025/03/05/67c8037a2462e.png"></p><p>é˜²æ­¢åƒµå°¸è¿›ç¨‹çš„ä»£ç </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¤„ç†SIGCHLD ä¿¡å·å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">read_childproc</span><span class="params">(<span class="type">int</span> sig)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">pid_t</span> pid;</span><br><span class="line">    <span class="type">int</span> status;</span><br><span class="line">    <span class="comment">// å›æ”¶åƒµå°¸è¿›ç¨‹</span></span><br><span class="line">    pid = <span class="built_in">waitpid</span>(<span class="number">-1</span>,&amp;status,WNOHANG);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Removed proc id: %d \n&quot;</span>, pid);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// mainå‡½æ•°ä¸­é˜²æ­¢åƒµå°¸è¿›ç¨‹çš„ä»£ç </span></span><br><span class="line"><span class="type">pid_t</span> pid;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">sigaction</span> act;</span><br><span class="line"><span class="type">socklen_t</span> adr_sz;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‡½æ•°åå­—å°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œè¿™é‡Œå°±æ˜¯æŒ‡é’ˆçš„èµ‹å€¼</span></span><br><span class="line"><span class="comment">// act.sa_handleræ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">act.sa_handler = read_childproc;</span><br><span class="line"><span class="built_in">sigemptyset</span>(&amp;act.sa_mask);</span><br><span class="line">act.sa_flags = <span class="number">0</span>;</span><br><span class="line">state = <span class="built_in">sigaction</span>(SIGCHLD,&amp;act,<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (state == <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">error_handling</span>(<span class="string">&quot;sigaction() error&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>R SIGALRMâˆ¶å·²åˆ°é€šè¿‡è°ƒç”¨alarmå‡½æ•°æ³¨å†Œçš„æ—¶é—´ã€‚</p><p>R SIGINTâˆ¶è¾“å…¥CTRL+Cã€‚  </p><p>R SIGCHLDâˆ¶å­è¿›ç¨‹ç»ˆæ­¢ã€‚ï¼ˆè‹±æ–‡ä¸ºchildï¼‰</p><p>1ã€â€å­è¿›ç¨‹ç»ˆæ­¢åˆ™è°ƒç”¨mychildå‡½æ•°ã€‚â€</p><p>ä»£ç ï¼šsignal(SIGCHLD, mychild);</p><p>æ­¤æ—¶mychildå‡½æ•°çš„å‚æ•°åº”ä¸ºintï¼Œè¿”å›å€¼ç±»å‹åº”ä¸ºvoidã€‚å¯¹åº”signalå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚å¦å¤–ï¼Œå¸¸æ•°SIGCHLDè¡¨ç¤ºå­è¿›ç¨‹ç»ˆæ­¢çš„æƒ…å†µï¼Œåº”æˆä¸ºsignalå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚</p><p>2ã€â€å·²åˆ°é€šè¿‡alarmå‡½æ•°æ³¨å†Œçš„æ—¶é—´ï¼Œè¯·è°ƒç”¨timeoutå‡½æ•°ã€‚â€</p><p>3ã€â€è¾“å…¥CTRL+Cæ—¶è°ƒç”¨keycontrolå‡½æ•°ã€‚â€</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">lession82</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">pid_t</span> pid = fork();</span><br><span class="line"><span class="keyword">if</span> (pid &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">        <span class="comment">// çˆ¶è¿›ç¨‹ç¡çœ 30ç§’  ç»™å­è¿›ç¨‹è¶³å¤Ÿçš„æ—¶é—´æ¥æ‰§è¡Œã€‚</span></span><br><span class="line"><span class="built_in">sleep</span>(<span class="number">30</span>);</span><br><span class="line"><span class="type">int</span> status;</span><br><span class="line"><span class="built_in">waitpid</span>(pid, &amp;status, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__);</span><br><span class="line"><span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¿¡å·å¤„ç†å‡½æ•°</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">signal_func</span><span class="params">(<span class="type">int</span> sig)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (sig)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> SIGALRM:  <span class="comment">// é—¹é’Ÿä¿¡å·</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;tid %d pid %d\n&quot;</span>, <span class="built_in">pthread_self</span>(), <span class="built_in">getpid</span>());</span><br><span class="line">        <span class="built_in">alarm</span>(<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> SIGINT:   <span class="comment">// é€šå¸¸ç”±ç”¨æˆ·æŒ‰ä¸‹ Ctrl + C äº§ç”Ÿ</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Ctrl + C press...&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">lession83</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// æ‰“å°å½“å‰çš„çº¿ç¨‹idå’Œ  è¿›ç¨‹id</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;=====tid %d pid %d\n&quot;</span>, <span class="built_in">pthread_self</span>(), <span class="built_in">getpid</span>());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æŠŠsignal_funcå‡½æ•°åˆ†åˆ«æ³¨å†Œä¸ºSIGALRMä¿¡å·ã€SIGINTä¿¡å·çš„å¤„ç†å‡½æ•°</span></span><br><span class="line">    <span class="built_in">signal</span>(SIGALRM, signal_func);</span><br><span class="line">    <span class="built_in">signal</span>(SIGINT, signal_func);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨ alarm(1) è®¾ç½®ä¸€ä¸ª 1 ç§’çš„é—¹é’Ÿï¼Œ1 ç§’åä¼šè§¦å‘ SIGALRM ä¿¡å·ã€‚</span></span><br><span class="line">    <span class="built_in">alarm</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">3</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;=====tid %d pid %d\n&quot;</span>, <span class="built_in">pthread_self</span>(), <span class="built_in">getpid</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åˆ©ç”¨Sigactionå‡½æ•° è¿›è¡Œä¿¡å·å¤„ç†</strong></p><p>â€‹singnalåœ¨UNIXç³»åˆ—çš„ä¸åŒæ“ä½œç³»ç»Ÿä¸­å¯èƒ½å­˜åœ¨åŒºåˆ«ï¼Œä½†sigactionå®Œå…¨ç›¸åŒã€‚</p><p><strong>è¿›ç¨‹é€šä¿¡ï¼šä¸ºäº†æ–¹ä¾¿è¿›ç¨‹äº¤æ¢ä¿¡æ¯ï¼Œåœ¨å†…æ ¸æä¾›ç¼“å†²åŒºè¿›è¡Œæ•°æ®äº¤æ¢çš„æœºåˆ¶ã€‚</strong></p><p>æ“ä½œç³»ç»Ÿæä¾›äº†ä¸¤ä¸ªè¿›ç¨‹å¯ä»¥åŒæ—¶è®¿é—®çš„å†…å­˜ç©ºé—´ã€‚</p><p>äº¤æ¢æ•°æ®æ—¶åŸºäºå¼€å‘ &#x2F; æƒé™ çš„</p><p>ç¼“å†²åŒºä¸¤è¾¹åƒæ˜¯æœ‰ä¿©é½¿è½®ä¸€æ ·ï¼Œå¦‚æœæ˜¯æ¯”ä½œå•†åº—çš„è¯ï¼Œä¸€è¾¹æ˜¯æ”¾è¿›å»ä¸œè¥¿ï¼Œä¸€è¾¹æ˜¯æ‹¿å‡ºå»ä¸œè¥¿ï¼Œå½¢æˆäº†æ¶ˆæ¯å¤„ç†çš„æµæ°´çº¿ã€‚</p><h4 id="è¿›ç¨‹é—´é€šä¿¡ï¼šç®¡é“"><a href="#è¿›ç¨‹é—´é€šä¿¡ï¼šç®¡é“" class="headerlink" title="è¿›ç¨‹é—´é€šä¿¡ï¼šç®¡é“"></a>è¿›ç¨‹é—´é€šä¿¡ï¼šç®¡é“</h4><p><strong>å•ç®¡é“</strong></p><p><img src="https://bu.dusays.com/2025/01/12/6783c9daa4ad9.png"></p><p>ä¸ºäº†å®Œæˆè¿›ç¨‹é—´é€šä¿¡ï¼Œéœ€è¦åˆ›å»ºç®¡é“ã€‚ç®¡é“å¹¶éå±äºè¿›ç¨‹çš„èµ„æºï¼Œè€Œæ˜¯å’Œå¥—æ¥å­—ä¸€æ ·ï¼Œå±äºæ“ä½œç³»ç»Ÿï¼ˆä¹Ÿå°±ä¸æ˜¯forkå‡½æ•°çš„å¤åˆ¶å¯¹è±¡ï¼‰ã€‚æ‰€ä»¥ï¼Œä¸¤ä¸ªè¿›ç¨‹é€šè¿‡æ“ä½œç³»ç»Ÿæä¾›çš„å†…å­˜ç©ºé—´è¿›è¡Œé€šä¿¡ã€‚</p><p>çˆ¶è¿›ç¨‹è°ƒç”¨è¯¥å‡½æ•°æ—¶å°†<strong>åˆ›å»ºç®¡é“</strong>ï¼ŒåŒæ—¶è·å–å¯¹åº”äºå‡ºå…¥å£çš„æ–‡ä»¶æè¿°ç¬¦å·</p><p><code>Filedes[0]</code> é€šè¿‡ç®¡é“æ¥æ”¶æ•°æ®æ—¶ä½¿ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå³ç®¡é“å‡ºå£ã€‚</p><p><code>Filedes[1]</code> é€šè¿‡ç®¡é“ä¼ è¾“æ•°æ®æ—¶ä½¿ç”¨çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå³ç®¡é“å…¥å£ã€‚</p><p>çˆ¶è¿›ç¨‹åˆ›å»ºå­è¿›ç¨‹çš„æ—¶å€™ï¼Œè‡ªå·±çš„èµ„æºé•œåƒå¤åˆ¶åˆ°å­è¿›ç¨‹é‡Œé¢ï¼Œæ‰€ä»¥çˆ¶è¿›ç¨‹åˆ›å»ºäº†ç®¡é“å­è¿›ç¨‹æ˜¯æœ‰è¿™ä¸ªä¿¡æ¯çš„ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">singlePipe</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line"><span class="type">int</span> fds[<span class="number">2</span>] = &#123; <span class="number">-1</span>,<span class="number">-1</span> &#125;;</span><br><span class="line"><span class="type">char</span> str[<span class="number">128</span>] = <span class="string">&quot;send by sub process!!!\n&quot;</span>;</span><br><span class="line"><span class="type">char</span> buf[<span class="number">128</span>] = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="built_in">pipe</span>(fds);</span><br><span class="line"><span class="type">pid_t</span> pid = fork();</span><br><span class="line"><span class="keyword">if</span> (pid == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">write</span>(fds[<span class="number">1</span>], str, <span class="built_in">sizeof</span>(str));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">read</span>(fds[<span class="number">0</span>], buf, <span class="built_in">sizeof</span>(buf));</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d): %s server: %s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__, buf);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŒç®¡é“</strong></p><p>1ä¸ªç®¡é“æ— æ³•å®ŒæˆåŒå‘é€šä¿¡ä»»åŠ¡ï¼Œæœ‰æ—¶å€™éœ€è¦åˆ›å»º2ä¸ªç®¡é“ï¼Œå„è‡ªè´Ÿè´£ä¸åŒçš„æ•°æ®æµåŠ¨å³å¯ã€‚</p><p><img src="https://bu.dusays.com/2025/01/12/6783d16c0a2b6.png"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">doublePipe</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ä¸¤ä¸ªæ–¹å‘å„æœ‰ä¿©æ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line"><span class="type">int</span> s2c[<span class="number">2</span>], c2s[<span class="number">2</span>];</span><br><span class="line"><span class="built_in">pipe</span>(s2c);</span><br><span class="line"><span class="built_in">pipe</span>(c2s);</span><br><span class="line"><span class="type">pid_t</span> pid = fork();</span><br><span class="line"><span class="keyword">if</span> (pid == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">char</span> buffer[<span class="number">256</span>] = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="built_in">write</span>(c2s[<span class="number">1</span>], <span class="string">&quot;hello,i am subprocess!\n&quot;</span>, <span class="number">23</span>);</span><br><span class="line"><span class="built_in">read</span>(s2c[<span class="number">0</span>], buffer, <span class="built_in">sizeof</span>(buffer));</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d): %s server: %s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__, buffer);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="type">char</span> buffer[<span class="number">256</span>] = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">read</span>(c2s[<span class="number">0</span>], buffer, <span class="built_in">sizeof</span>(buffer));</span><br><span class="line"><span class="built_in">write</span>(s2c[<span class="number">1</span>], <span class="string">&quot;hello,i am mainprocess\n&quot;</span>, <span class="number">23</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d): %s server: %s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__, buffer);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d): %s server: %d\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__, <span class="built_in">getpid</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è¿›ç¨‹é—´é€šä¿¡ï¼šFIFO"><a href="#è¿›ç¨‹é—´é€šä¿¡ï¼šFIFO" class="headerlink" title="è¿›ç¨‹é—´é€šä¿¡ï¼šFIFO"></a>è¿›ç¨‹é—´é€šä¿¡ï¼šFIFO</h4><p>â€‹å¯¹æ¯”pipeç®¡é“ï¼Œä»–å·²ç»å¯ä»¥å®Œæˆåœ¨ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´é€šä¿¡çš„ä»»åŠ¡ï¼Œä¸è¿‡å®ƒä¼¼ä¹å®Œæˆçš„ä¸å¤Ÿå¥½ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯ä¸å¤Ÿå½»åº•ã€‚å®ƒåªèƒ½åœ¨ä¸¤ä¸ªæœ‰<strong>äº²æˆšå…³ç³»</strong>çš„è¿›ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡ï¼Œè¿™å°±å¤§å¤§é™åˆ¶äº†pipeç®¡é“çš„åº”ç”¨èŒƒå›´ã€‚</p><p>â€‹<code>fifo</code>ç®¡é“çš„æœ¬è´¨æ˜¯æ“ä½œç³»ç»Ÿä¸­çš„å‘½åæ–‡ä»¶ï¼Œå½“ç„¶Linuxçš„ç†å¿µå°±æ˜¯ä¸‡ç‰©çš†æ–‡ä»¶ï¼Œå®ƒåœ¨æ“ä½œç³»ç»Ÿä¸­ä»¥å‘½åæ–‡ä»¶çš„å½¢å¼å­˜åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ“ä½œç³»ç»Ÿä¸­çœ‹è§<code>fifo</code>ç®¡é“ï¼Œåœ¨ä½ æœ‰æƒé™çš„æƒ…å†µä¸‹ï¼Œç”šè‡³å¯ä»¥è¯»å†™ä»–ä»¬ã€‚</p><p>å†…æ ¸ä¼šé’ˆå¯¹<code>fifo</code>æ–‡ä»¶å¼€è¾Ÿä¸€ä¸ªç¼“å†²åŒºï¼Œæ“ä½œFIFOæ–‡ä»¶ï¼Œå¯ä»¥æ“ä½œç¼“å†²åŒºï¼Œå®ç°è¿›ç¨‹é€šä¿¡ã€‚ä¸€æ—¦ä½¿ç”¨<code>mkfifo</code>åˆ›å»ºäº†ä¸€ä¸ªFIFOï¼Œå°±å¯ä»¥ä½¿ç”¨openæ‰“å¼€å®ƒï¼Œå¸¸è§çš„æ–‡ä»¶IOå‡½æ•°éƒ½å¯ä»¥ç”¨äº<code>FIFO</code>ã€‚å¦‚ï¼š<code>close</code>ã€<code>read</code>ã€<code>write</code>ã€<code>unlink</code>ç­‰ .</p><p>è¿™æ ·çš„è¯  ä¸€ä¸ªè¿›ç¨‹å¯¹åº”ä¸€ä¸ªç®¡é“ï¼Œå¤§å¤§å‡å°‘äº†ç®¡é“çš„æ•°é‡ã€‚</p><p><strong>æ‰“å¼€FIFOæ–‡ä»¶çš„æ—¶å€™ï¼Œreadç«¯ä¼šé˜»å¡ç­‰å¾…writeç«¯æ‰“å¼€openï¼Œwriteç«¯åŒç†ï¼Œä¹Ÿä¼šé˜»å¡ç­‰å¾…å¦å¤–ä¸€ç«¯æ‰“å¼€ã€‚</strong></p><p>å¤§æ¦‚å°±æ˜¯ä¸‹å›¾æ‰€ç¤º</p><p><img src="https://bu.dusays.com/2025/03/05/67c85594c01ab.png"></p><h4 id="è¿›ç¨‹é—´é€šä¿¡ï¼šå…±äº«å†…å­˜"><a href="#è¿›ç¨‹é—´é€šä¿¡ï¼šå…±äº«å†…å­˜" class="headerlink" title="è¿›ç¨‹é—´é€šä¿¡ï¼šå…±äº«å†…å­˜"></a>è¿›ç¨‹é—´é€šä¿¡ï¼šå…±äº«å†…å­˜</h4><p>â€‹å…±äº«å†…å­˜å…è®¸ä¸åŒè¿›ç¨‹ä¹‹é—´<strong>å…±äº«åŒä¸€æ®µé€»è¾‘å†…å­˜</strong>ï¼Œå¯¹äºè¿™æ®µå†…å­˜ï¼Œå®ƒä»¬éƒ½èƒ½è®¿é—®ï¼Œæˆ–è€…ä¿®æ”¹å®ƒï¼Œæ²¡æœ‰ä»»ä½•é™åˆ¶ã€‚æ‰€ä»¥å®ƒæ˜¯<strong>è¿›ç¨‹é—´ä¼ é€’å¤§é‡æ•°æ®</strong>çš„ä¸€ç§éå¸¸æœ‰æ•ˆçš„æ–¹å¼ã€‚â€œå…±äº«å†…å­˜å…è®¸ä¸åŒè¿›ç¨‹ä¹‹é—´å…±äº«åŒä¸€æ®µé€»è¾‘å†…å­˜â€ï¼Œè¿™é‡Œæ˜¯é€»è¾‘å†…å­˜ã€‚ä¹Ÿå°±æ˜¯è¯´å…±äº«å†…å­˜çš„è¿›ç¨‹è®¿é—®çš„å¯ä»¥ä¸æ˜¯åŒä¸€æ®µç‰©ç†å†…å­˜ï¼Œè¿™ä¸ªæ²¡æœ‰æ˜ç¡®çš„è§„å®šï¼Œä½†æ˜¯å¤§å¤šæ•°çš„ç³»ç»Ÿå®ç°éƒ½å°†è¿›ç¨‹ä¹‹é—´çš„å…±äº«å†…å­˜å®‰æ’ä¸ºåŒä¸€æ®µç‰©ç†å†…å­˜ã€‚</p><p><strong>ä½¿ç”¨å…±äº«å†…å­˜çš„æ­¥éª¤é€šå¸¸æ˜¯ï¼š</strong></p><p>1ï¼‰åˆ›å»ºæˆ–è·å–ä¸€æ®µå…±äº«å†…å­˜ï¼›</p><p>2ï¼‰å°†ä¸Šä¸€æ­¥åˆ›å»ºçš„å…±äº«å†…å­˜æ˜ å°„åˆ°è¯¥è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼›</p><p>3ï¼‰è®¿é—®å…±äº«å†…å­˜ï¼›</p><p>4ï¼‰å°†å…±äº«å†…å­˜ä»å½“å‰çš„è¿›ç¨‹åœ°å€ç©ºé—´åˆ†ç¦»ï¼›</p><p>5ï¼‰åˆ é™¤è¿™æ®µå…±äº«å†…å­˜ï¼›</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">lession90</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">pid_t</span> pid = fork();</span><br><span class="line"><span class="keyword">if</span> (pid &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// . è¡¨æ˜å½“å‰çš„è·¯å¾„ </span></span><br><span class="line"><span class="comment">//  ftok(&quot;.&quot;,1)æ–‡ä»¶ç›®å½•ä¸ä¸€æ ·   åé¢çš„æ•°å­—ä¹Ÿä¸ä¸€æ · </span></span><br><span class="line">        <span class="comment">// ç”¨äºåˆ›å»ºæˆ–è·å–ä¸€ä¸ªå…±äº«å†…å­˜æ®µã€‚å¦‚æœIPC_CREATæ ‡å¿—è¢«è®¾ç½®ï¼Œä¸”æŒ‡å®šçš„å†…å­˜æ®µä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„å…±äº«å†…å­˜æ®µã€‚</span></span><br><span class="line"><span class="type">int</span> shm_id = <span class="built_in">shmget</span>(<span class="built_in">ftok</span>(<span class="string">&quot;.&quot;</span>,<span class="number">1</span>), <span class="built_in">sizeof</span>(STUDENT), IPC_CREAT | <span class="number">0666</span>);</span><br><span class="line"><span class="keyword">if</span> (shm_id == <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d): %s create share memeory failed!\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä½¿ç”¨å‡½æ•°shmat()æ¥æ˜ å°„å…±äº«å†…å­˜</span></span><br><span class="line">PSTUDENT pStu = (PSTUDENT)<span class="built_in">shmat</span>(shm_id, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">pStu-&gt;id = <span class="number">666666</span>;</span><br><span class="line"><span class="built_in">strcpy</span>(pStu-&gt;name, <span class="string">&quot;ä¹°ä¹°æ&quot;</span>);</span><br><span class="line">pStu-&gt;age = <span class="number">18</span>;</span><br><span class="line">pStu-&gt;sex = <span class="literal">true</span>;</span><br><span class="line">pStu-&gt;sig = <span class="number">99</span>;</span><br><span class="line"><span class="comment">// ä¸¤è¾¹éœ€è¦åŒæ­¥   ä¸åŒæ­¥ç›´æ¥åˆ é™¤æ˜ å°„å°±æ‹¿ä¸åˆ°æ•°æ®</span></span><br><span class="line"><span class="keyword">while</span> (pStu-&gt;sig == <span class="number">99</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">usleep</span>(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åˆ é™¤æ˜ å°„</span></span><br><span class="line"><span class="built_in">shmdt</span>(pStu);</span><br><span class="line"><span class="built_in">shmctl</span>(shm_id, IPC_RMID, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123; <span class="comment">// å­è¿›ç¨‹</span></span><br><span class="line"><span class="built_in">usleep</span>(<span class="number">500000</span>); <span class="comment">// ç­‰å¾…çˆ¶è¿›ç¨‹å†™å…¥</span></span><br><span class="line"><span class="type">int</span> shm_id = <span class="built_in">shmget</span>(<span class="built_in">ftok</span>(<span class="string">&quot;.&quot;</span>, <span class="number">1</span>), <span class="built_in">sizeof</span>(STUDENT), IPC_CREAT | <span class="number">0666</span>);</span><br><span class="line"><span class="keyword">if</span> (shm_id == <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d): %s create share memeory failed!\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä½¿ç”¨å‡½æ•°shmat()æ¥æ˜ å°„å…±äº«å†…å­˜</span></span><br><span class="line">PSTUDENT pStu = (PSTUDENT)<span class="built_in">shmat</span>(shm_id, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">while</span> (pStu-&gt;sig != <span class="number">99</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">usleep</span>(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d, %s,%d,%s\n&quot;</span>, pStu-&gt;id, pStu-&gt;name, pStu-&gt;age, pStu-&gt;sex ? <span class="string">&quot;ç”·&quot;</span> : <span class="string">&quot;å¥³&quot;</span>);</span><br><span class="line">pStu-&gt;sig = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">shmdt</span>(pStu);</span><br><span class="line"><span class="built_in">shmctl</span>(shm_id, IPC_RMID, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è¿›ç¨‹é—´é€šä¿¡ï¼šä¿¡å·é‡"><a href="#è¿›ç¨‹é—´é€šä¿¡ï¼šä¿¡å·é‡" class="headerlink" title="è¿›ç¨‹é—´é€šä¿¡ï¼šä¿¡å·é‡"></a>è¿›ç¨‹é—´é€šä¿¡ï¼šä¿¡å·é‡</h4><ul><li>å‡è®¾æ²¡æœ‰ä¿¡å·é‡ï¼Œçˆ¶å­è¿›ç¨‹å¯èƒ½ä¼šåŒæ—¶è®¿é—®å…±äº«å†…å­˜ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚ä¾‹å¦‚ï¼Œçˆ¶è¿›ç¨‹å¯èƒ½æ­£åœ¨å†™å…¥æ•°æ®ï¼Œè€Œå­è¿›ç¨‹åŒæ—¶å°è¯•è¯»å–å°šæœªå®Œå…¨å†™å…¥çš„æ•°æ®ã€‚é€šè¿‡ä¿¡å·é‡çš„ P æ“ä½œï¼ˆ<code>semop</code>å‡½æ•°ï¼Œ<code>sem_op</code>ä¸º - 1ï¼‰å’Œ V æ“ä½œï¼ˆ<code>semop</code>å‡½æ•°ï¼Œ<code>sem_op</code>ä¸º 1ï¼‰ï¼Œå¯ä»¥ç¡®ä¿åœ¨æŸä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªè¿›ç¨‹èƒ½å¤Ÿè®¿é—®å…±äº«å†…å­˜ä¸­çš„å…³é”®åŒºåŸŸã€‚æ¯”å¦‚ï¼Œå­è¿›ç¨‹åœ¨è¯»å–å…±äº«å†…å­˜ä¸­çš„å­¦ç”Ÿä¿¡æ¯ä¹‹å‰ï¼Œå…ˆå¯¹ä¿¡å·é‡è¿›è¡Œ P æ“ä½œï¼Œç­‰å¾…çˆ¶è¿›ç¨‹å®Œæˆå†™å…¥å¹¶æ‰§è¡Œ V æ“ä½œé‡Šæ”¾èµ„æºåï¼Œå­è¿›ç¨‹æ‰èƒ½è¯»å–ï¼Œä»è€Œé¿å…äº†æ•°æ®ç«äº‰å’Œä¸ä¸€è‡´æ€§ã€‚</li></ul><p>åŸæ¥å…±äº«å†…å­˜æœ‰å¾ˆä¸¥é‡çš„æ—¶é—´å·®ï¼Œé™ä½äº†æ•ˆç‡ã€‚</p><p>ä¸ºäº†é˜²æ­¢å‡ºç°å› å¤šä¸ªç¨‹åºåŒæ—¶è®¿é—®ä¸€ä¸ªå…±äº«èµ„æºè€Œå¼•å‘çš„ä¸€ç³»åˆ—é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•ï¼Œå®ƒå¯ä»¥é€šè¿‡ç”Ÿæˆå¹¶ä½¿ç”¨ä»¤ç‰Œæ¥æˆæƒï¼Œåœ¨ä»»ä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹è®¿é—®ä»£ç çš„ä¸´ç•ŒåŒºåŸŸã€‚ä¸´ç•ŒåŒºåŸŸæ˜¯æŒ‡æ‰§è¡Œæ•°æ®æ›´æ–°çš„ä»£ç éœ€è¦ç‹¬å å¼åœ°æ‰§è¡Œã€‚è€Œä¿¡å·é‡å°±å¯ä»¥æä¾›è¿™æ ·çš„ä¸€ç§è®¿é—®æœºåˆ¶ï¼Œè®©ä¸€ä¸ªä¸´ç•ŒåŒºåŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨è®¿é—®å®ƒï¼Œä¹Ÿå°±æ˜¯è¯´ä¿¡å·é‡æ˜¯ç”¨æ¥è°ƒåè¿›ç¨‹å¯¹å…±äº«èµ„æºçš„è®¿é—®çš„ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">lession91</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">pid_t</span> pid = fork();</span><br><span class="line"><span class="keyword">if</span> (pid &gt; <span class="number">0</span>) &#123;<span class="comment">//çˆ¶è¿›ç¨‹</span></span><br><span class="line"><span class="comment">// ä½¿ç”¨ftokå‡½æ•°ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„é”®å€¼keyï¼Œç”¨äºåˆ›å»ºä¿¡å·é‡ã€‚</span></span><br><span class="line"><span class="type">key_t</span> key = <span class="built_in">ftok</span>(<span class="string">&quot;.&quot;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// semgetå‡½æ•°åˆ›å»ºä¸€ä¸ªä¿¡å·é‡é›†ï¼ŒåŒ…å« 2 ä¸ªä¿¡å·é‡ï¼Œæƒé™ä¸º0666ã€‚</span></span><br><span class="line"><span class="type">int</span> sem_id = <span class="built_in">semget</span>(key, <span class="number">2</span>, IPC_CREAT | <span class="number">0666</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨semctlå‡½æ•°åˆå§‹åŒ–ä¸¤ä¸ªä¿¡å·é‡çš„å€¼ä¸º 0ã€‚</span></span><br><span class="line"><span class="built_in">semctl</span>(sem_id, <span class="number">0</span>, SETVAL, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">semctl</span>(sem_id, <span class="number">1</span>, SETVAL, <span class="number">0</span>);</span><br><span class="line"><span class="comment">//è°ƒç”¨shmgetå‡½æ•°åˆ›å»ºä¸€ä¸ªå…±äº«å†…å­˜æ®µï¼Œå¤§å°ä¸ºsizeof(STUDENT)ï¼Œæƒé™ä¸º0666ã€‚</span></span><br><span class="line"><span class="type">int</span> shm_id = <span class="built_in">shmget</span>(<span class="built_in">ftok</span>(<span class="string">&quot;.&quot;</span>, <span class="number">1</span>), <span class="built_in">sizeof</span>(STUDENT), IPC_CREAT | <span class="number">0666</span>);</span><br><span class="line"><span class="keyword">if</span> (shm_id == <span class="number">-1</span>) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s create share memeory failed!\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°†å…±äº«å†…å­˜æ®µé™„åŠ åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œè¿”å›ä¸€ä¸ªæŒ‡å‘å…±äº«å†…å­˜çš„æŒ‡é’ˆpStuã€‚</span></span><br><span class="line"><span class="comment">//æ˜ å°„</span></span><br><span class="line">PSTUDENT pStu = (PSTUDENT)<span class="built_in">shmat</span>(shm_id, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">pStu-&gt;id = <span class="number">666666</span>;</span><br><span class="line"><span class="built_in">strcpy</span>(pStu-&gt;name, <span class="string">&quot;abcdefghijklmn&quot;</span>);</span><br><span class="line">pStu-&gt;age = <span class="number">18</span>;</span><br><span class="line">pStu-&gt;sex = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">//ä¿¡å·é‡</span></span><br><span class="line">sembuf sop = &#123;</span><br><span class="line">.sem_num = <span class="number">0</span>,</span><br><span class="line">.sem_op = <span class="number">1</span>  <span class="comment">// ä¸ºæ­£æ•°ï¼Œsemopå°±æ˜¯Væ“ä½œ</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–ä¿¡å·é‡çš„å€¼ï¼Œ</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s %d\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__, <span class="built_in">semctl</span>(sem_id, <span class="number">0</span>, GETVAL));</span><br><span class="line"><span class="built_in">semop</span>(sem_id, &amp;sop, <span class="number">1</span>);<span class="comment">//Væ“ä½œ</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s %d\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__, <span class="built_in">semctl</span>(sem_id, <span class="number">0</span>, GETVAL));</span><br><span class="line">sop.sem_num = <span class="number">1</span>;</span><br><span class="line">sop.sem_op = <span class="number">-1</span>;  <span class="comment">// ä¸ºè´Ÿæ•°ï¼Œsemopä¸ºPæ“ä½œ</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s %d\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__, <span class="built_in">semctl</span>(sem_id, <span class="number">1</span>, GETVAL));</span><br><span class="line"><span class="built_in">semop</span>(sem_id, &amp;sop, <span class="number">1</span>);<span class="comment">//Pæ“ä½œ</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s %d\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__, <span class="built_in">semctl</span>(sem_id, <span class="number">1</span>, GETVAL));</span><br><span class="line"></span><br><span class="line"><span class="comment">//å°†å…±äº«å†…å­˜æ®µä»è¿›ç¨‹çš„åœ°å€ç©ºé—´åˆ†ç¦»</span></span><br><span class="line"><span class="built_in">shmdt</span>(pStu);</span><br><span class="line"><span class="comment">//åˆ é™¤å…±äº«å†…å­˜æ®µã€‚</span></span><br><span class="line"><span class="built_in">shmctl</span>(shm_id, IPC_RMID, <span class="literal">NULL</span>);</span><br><span class="line"><span class="comment">//åˆ é™¤ä¿¡å·é‡</span></span><br><span class="line"><span class="built_in">semctl</span>(sem_id, <span class="number">0</span>, IPC_RMID);</span><br><span class="line"><span class="built_in">semctl</span>(sem_id, <span class="number">1</span>, IPC_RMID);</span><br><span class="line"><span class="built_in">sleep</span>(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;<span class="comment">//å­è¿›ç¨‹</span></span><br><span class="line"><span class="type">key_t</span> key = <span class="built_in">ftok</span>(<span class="string">&quot;.&quot;</span>, <span class="number">2</span>);</span><br><span class="line"><span class="comment">//semgetå’Œshmgetå‡½æ•°è·å–å·²å­˜åœ¨çš„ä¿¡å·é‡å’Œå…±äº«å†…å­˜æ®µã€‚</span></span><br><span class="line"><span class="type">int</span> sem_id = <span class="built_in">semget</span>(key, <span class="number">2</span>, IPC_CREAT);</span><br><span class="line"><span class="type">int</span> shm_id = <span class="built_in">shmget</span>(<span class="built_in">ftok</span>(<span class="string">&quot;.&quot;</span>, <span class="number">1</span>), <span class="built_in">sizeof</span>(STUDENT), IPC_CREAT | <span class="number">0666</span>);</span><br><span class="line"><span class="keyword">if</span> (shm_id == <span class="number">-1</span>) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s create share memeory failed!\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sembuf sop = &#123;</span><br><span class="line">.sem_num = <span class="number">0</span>,</span><br><span class="line">.sem_op = <span class="number">-1</span><span class="comment">//Pæ“ä½œ</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s %d\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__, <span class="built_in">semctl</span>(sem_id, <span class="number">0</span>, GETVAL));</span><br><span class="line"><span class="built_in">semop</span>(sem_id, &amp;sop, <span class="number">1</span>);<span class="comment">//Pæ“ä½œ</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s %d\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__, <span class="built_in">semctl</span>(sem_id, <span class="number">0</span>, GETVAL));</span><br><span class="line">PSTUDENT pStu = (PSTUDENT)<span class="built_in">shmat</span>(shm_id, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">//ä¿¡å·é‡</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d ,%s,%d,%s\n&quot;</span>, pStu-&gt;id, pStu-&gt;name, pStu-&gt;age, pStu-&gt;sex ? <span class="string">&quot;male&quot;</span> : <span class="string">&quot;female&quot;</span>);</span><br><span class="line">sop.sem_num = <span class="number">1</span>;</span><br><span class="line">sop.sem_op = <span class="number">1</span>;<span class="comment">//Væ“ä½œ</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s %d\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__, <span class="built_in">semctl</span>(sem_id, <span class="number">1</span>, GETVAL));</span><br><span class="line"><span class="built_in">semop</span>(sem_id, &amp;sop, <span class="number">1</span>);<span class="comment">//Væ“ä½œ</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s %d\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__, <span class="built_in">semctl</span>(sem_id, <span class="number">1</span>, GETVAL));</span><br><span class="line"><span class="built_in">sleep</span>(<span class="number">10</span>);</span><br><span class="line"><span class="comment">//å…±äº«å†…å­˜æ®µåˆ†ç¦»</span></span><br><span class="line"><span class="built_in">shmdt</span>(pStu);</span><br><span class="line"><span class="built_in">shmctl</span>(shm_id, IPC_RMID, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è¿›ç¨‹é—´é€šä¿¡ï¼šæ¶ˆæ¯é˜Ÿåˆ—"><a href="#è¿›ç¨‹é—´é€šä¿¡ï¼šæ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="è¿›ç¨‹é—´é€šä¿¡ï¼šæ¶ˆæ¯é˜Ÿåˆ—"></a>è¿›ç¨‹é—´é€šä¿¡ï¼šæ¶ˆæ¯é˜Ÿåˆ—</h4><p><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>æä¾›äº†ä¸€ç§ä»ä¸€ä¸ªè¿›ç¨‹å‘å¦ä¸€ä¸ªè¿›ç¨‹å‘é€ä¸€ä¸ªæ•°æ®å—çš„æ–¹æ³•ã€‚ æ¯ä¸ªæ•°æ®å—éƒ½è¢«è®¤ä¸ºå«æœ‰ä¸€ä¸ªç±»å‹ï¼Œæ¥æ”¶è¿›ç¨‹å¯ä»¥ç‹¬ç«‹åœ°æ¥æ”¶å«æœ‰ä¸åŒç±»å‹çš„æ•°æ®ç»“æ„ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘é€æ¶ˆæ¯æ¥é¿å…å‘½åç®¡é“çš„åŒæ­¥å’Œé˜»å¡é—®é¢˜ã€‚ä½†æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ä¸å‘½åç®¡é“FIFOä¸€æ ·ï¼Œæ¯ä¸ªæ•°æ®å—éƒ½æœ‰ä¸€ä¸ªæœ€å¤§é•¿åº¦çš„é™åˆ¶ã€‚</p><p>1ï¸âƒ£ <code>msgget</code>å‡½æ•°  åˆ›å»ºå’Œè®¿é—®ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—   åœ¨ç¤ºä¾‹ä¸­ï¼Œå­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹éƒ½æœ‰</p><p>2ï¸âƒ£ <code>msgsnd</code>å‡½æ•°  ç”¨æ¥æŠŠæ¶ˆæ¯æ·»åŠ åˆ°é˜Ÿåˆ—ã€‚</p><p>3ï¸âƒ£ <code>msgrcv</code>å‡½æ•°  ç”¨æ¥ä»ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—è·å–æ¶ˆæ¯ã€‚</p><p>4ï¸âƒ£ <code>msgctl</code> å‡½æ•° ç”¨æ¥æ§åˆ¶æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ƒä¸å…±äº«å†…å­˜çš„<code>shmctl</code>å‡½æ•°ç±»ä¼¼ï¼Œåˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">lession92</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">pid_t</span> pid = fork();</span><br><span class="line"><span class="keyword">if</span> (pid &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// msg çš„æ¥å—</span></span><br><span class="line"><span class="comment">// æœ‰çš„linuxç³»ç»Ÿæ— æ³•å®ç°</span></span><br><span class="line"><span class="type">int</span> msg_id = <span class="built_in">msgget</span>(<span class="built_in">ftok</span>(<span class="string">&quot;.&quot;</span>, <span class="number">3</span>), IPC_CREAT | <span class="number">0666</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s %d %d\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__, msg_id, errno);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, <span class="built_in">strerror</span>(errno));</span><br><span class="line"><span class="keyword">if</span> (msg_id == <span class="number">-1</span>) <span class="keyword">return</span>;</span><br><span class="line">MSG msg;</span><br><span class="line"><span class="built_in">memset</span>(&amp;msg, <span class="number">0</span>, <span class="built_in">sizeof</span>(msg));</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//msgrcv å‡½æ•°çš„å‚æ•°ä¾æ¬¡ä¸ºï¼šæ¶ˆæ¯é˜Ÿåˆ— IDã€æ¥æ”¶æ¶ˆæ¯çš„ç¼“å†²åŒºã€æ¶ˆæ¯æ•°æ®éƒ¨åˆ†çš„å¤§å°ã€æœŸæœ›æ¥æ”¶çš„æ¶ˆæ¯ç±»å‹ï¼ˆè¿™é‡Œä¸º 1ï¼‰ã€æ¥æ”¶æ ‡å¿—ï¼ˆè¿™é‡Œä¸º 0ï¼‰ã€‚</span></span><br><span class="line"><span class="type">ssize_t</span> ret = <span class="built_in">msgrcv</span>(msg_id, &amp;msg, <span class="built_in">sizeof</span>(msg.data), <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (ret == <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">usleep</span>(<span class="number">1000</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d name: %s age: %d msg: %s\n&quot;</span>,</span><br><span class="line">msg.data.id, msg.data.name, msg.data.age, msg.data.message);</span><br><span class="line"><span class="built_in">getchar</span>();</span><br><span class="line"><span class="built_in">msgctl</span>(msg_id, IPC_RMID, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line"><span class="type">int</span> msg_id = <span class="built_in">msgget</span>(<span class="built_in">ftok</span>(<span class="string">&quot;.&quot;</span>, <span class="number">3</span>), IPC_CREAT | <span class="number">0666</span>);</span><br><span class="line">MSG msg;</span><br><span class="line"><span class="built_in">memset</span>(&amp;msg, <span class="number">0</span>, <span class="built_in">sizeof</span>(msg));</span><br><span class="line">msg.type = <span class="number">1</span>;</span><br><span class="line">msg.data.id = <span class="number">6666</span>;</span><br><span class="line"><span class="built_in">strcpy</span>(msg.data.name, <span class="string">&quot;Bingo&quot;</span>);</span><br><span class="line">msg.data.age = <span class="number">18</span>;</span><br><span class="line"><span class="built_in">strcpy</span>(msg.data.message, <span class="string">&quot;hello world!&quot;</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;***%d name: %s age: %d msg: %s\n&quot;</span>,</span><br><span class="line">msg.data.id, msg.data.name, msg.data.age, msg.data.message);</span><br><span class="line"><span class="comment">//msgsnd å‡½æ•°å°†æ¶ˆæ¯å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—</span></span><br><span class="line"><span class="built_in">msgsnd</span>(msg_id, &amp;msg, <span class="built_in">sizeof</span>(msg.data), <span class="number">0</span>);</span><br><span class="line"><span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line"><span class="comment">//ä½¿ç”¨ msgctl å‡½æ•°åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—ã€‚</span></span><br><span class="line"><span class="built_in">msgctl</span>(msg_id, IPC_RMID, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾…ç»­ã€‚ã€‚ã€‚ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxç³»ç»Ÿç¼–ç¨‹02å®¢æˆ·ç«¯æœåŠ¡å™¨ç«¯æ¨¡å‹</title>
      <link href="/2025/01/12/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B02%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%A8%A1%E5%9E%8B/"/>
      <url>/2025/01/12/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B02%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%A8%A1%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h3 id="ç®€å•çš„TCP-å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å‹"><a href="#ç®€å•çš„TCP-å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å‹" class="headerlink" title="ç®€å•çš„TCP å®¢æˆ·ç«¯ - æœåŠ¡å™¨æ¨¡å‹"></a>ç®€å•çš„TCP å®¢æˆ·ç«¯ - æœåŠ¡å™¨æ¨¡å‹</h3><h4 id="run-clientå‡½æ•°"><a href="#run-clientå‡½æ•°" class="headerlink" title="run_clientå‡½æ•°"></a><code>run_client</code>å‡½æ•°</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">run_client</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªTCPå¥—æ¥å­—</span></span><br><span class="line">    <span class="type">int</span> client = <span class="built_in">socket</span>(PF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    PF_INET æŒ‡å®šåè®®æ—ä¸º IPv4</span></span><br><span class="line"><span class="comment">    SOCK_STREAMï¼šæŒ‡å®šå¥—æ¥å­—ç±»å‹ä¸ºæµå¥—æ¥å­—</span></span><br><span class="line"><span class="comment">    0ï¼šæŒ‡å®šåè®®ç±»å‹ï¼Œè¿™é‡Œä½¿ç”¨é»˜è®¤åè®®</span></span><br><span class="line"><span class="comment">    å¦‚æœsocketå‡½æ•°æˆåŠŸåˆ›å»ºå¥—æ¥å­—ï¼Œä¼šè¿”å›ä¸€ä¸ªéè´Ÿæ•´æ•°ä½œä¸ºå¥—æ¥å­—æè¿°ç¬¦ï¼›å¦‚æœå¤±è´¥ï¼Œè¿”å›-1ã€‚</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªstruct sockaddr_inç±»å‹çš„å˜é‡addrï¼Œç”¨äºå­˜å‚¨åœ°å€ä¿¡æ¯ã€‚</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> servaddr;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–æœåŠ¡å™¨åœ°å€ç»“æ„ä½“</span></span><br><span class="line">    <span class="built_in">memset</span>(&amp;servaddr, <span class="number">0</span>, <span class="built_in">sizeof</span>(servaddr));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//æŒ‡å®šåœ°å€æ—ä¸º IPv4ï¼ŒAFä»£è¡¨ â€œAddress Familyâ€ï¼ŒAF_INETå’Œå‰é¢çš„PF_INETç›¸å¯¹åº”ã€‚</span></span><br><span class="line">    servaddr.sin_family = AF_INET;</span><br><span class="line">    <span class="comment">// è®¾ç½®æœåŠ¡å™¨IPåœ°å€ä¸ºæœ¬åœ°å›ç¯åœ°å€127.0.0.1</span></span><br><span class="line">    servaddr.sin_addr.s_addr = <span class="built_in">inet_addr</span>(<span class="string">&quot;127.0.0.1&quot;</span>);</span><br><span class="line">    <span class="comment">// è®¾ç½®æœåŠ¡å™¨ç«¯å£å·ä¸º9527</span></span><br><span class="line">    servaddr.sin_port = <span class="built_in">htons</span>(<span class="number">9527</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿æ¥åˆ°æœåŠ¡å™¨</span></span><br><span class="line">    <span class="comment">// å°†å®¢æˆ·ç«¯å¥—æ¥å­—ï¼ˆclientï¼‰è¿æ¥åˆ°æŒ‡å®šçš„æœåŠ¡å™¨åœ°å€ï¼ˆservaddrï¼‰ã€‚</span></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">connect</span>(client, (<span class="keyword">struct</span> sockaddr*)&amp;servaddr, <span class="built_in">sizeof</span>(servaddr));</span><br><span class="line">    <span class="comment">// è¿æ¥æˆåŠŸï¼Œretçš„å€¼ä¸º 0ï¼›å¦‚æœè¿æ¥å¤±è´¥ï¼Œretçš„å€¼ä¸º -1ï¼Œå¹¶ä¸”ä¼šè®¾ç½®ç›¸åº”çš„é”™è¯¯ç ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// è¾“å‡ºå½“å‰æ–‡ä»¶ã€è¡Œå·å’Œå‡½æ•°åï¼Œè¡¨ç¤ºè¿æ¥æˆåŠŸ</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__);</span><br><span class="line">        <span class="type">char</span> buffer[<span class="number">256</span>] = <span class="string">&quot;hello,hello\n&quot;</span>;</span><br><span class="line">        <span class="comment">// å‘æœåŠ¡å™¨å‘é€æ¶ˆæ¯</span></span><br><span class="line">        <span class="comment">// clientæ˜¯å¥—æ¥å­—æè¿°ç¬¦ï¼Œbufferæ˜¯è¦å‘é€çš„æ•°æ®ç¼“å†²åŒºï¼Œsizeof(buffer)è¡¨ç¤ºè¦å‘é€çš„æ•°æ®é•¿åº¦ã€‚</span></span><br><span class="line">        <span class="built_in">write</span>(client, buffer, <span class="built_in">sizeof</span>(buffer));</span><br><span class="line">        <span class="comment">// æ¸…ç©ºç¼“å†²åŒº</span></span><br><span class="line">        <span class="built_in">memset</span>(buffer, <span class="number">0</span>, <span class="built_in">sizeof</span>(buffer));</span><br><span class="line">        <span class="comment">// ä»æœåŠ¡å™¨è¯»å–å“åº”</span></span><br><span class="line">        <span class="built_in">read</span>(client, buffer, <span class="built_in">sizeof</span>(buffer));</span><br><span class="line">        <span class="comment">// è¾“å‡ºæœåŠ¡å™¨çš„å“åº”</span></span><br><span class="line">        std::cout &lt;&lt; buffer;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// è¾“å‡ºè¿æ¥å¤±è´¥çš„é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s %d\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__, ret);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å…³é—­å¥—æ¥å­—</span></span><br><span class="line">    <span class="built_in">close</span>(client);</span><br><span class="line">    <span class="comment">// è¾“å‡ºå®¢æˆ·ç«¯å®Œæˆä¿¡æ¯</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;client done!!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="run-server-å‡½æ•°"><a href="#run-server-å‡½æ•°" class="headerlink" title="run_server()å‡½æ•°"></a><code>run_server()</code>å‡½æ•°</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">lession63_</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> server, client;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> seraddr, clientaddr;</span><br><span class="line">    <span class="type">socklen_t</span> cliaddrlen;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªTCPå¥—æ¥å­—</span></span><br><span class="line">    server = <span class="built_in">socket</span>(PF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (server &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// è¾“å‡ºé”™è¯¯ä¿¡æ¯å¹¶è¿”å›</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;errorï¼ï¼\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–æœåŠ¡å™¨åœ°å€ç»“æ„ä½“</span></span><br><span class="line">    <span class="built_in">memset</span>(&amp;seraddr, <span class="number">0</span>, <span class="built_in">sizeof</span>(seraddr));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®åœ°å€æ—ä¸ºIPv4</span></span><br><span class="line">    seraddr.sin_family = AF_INET;</span><br><span class="line">    <span class="comment">// æœåŠ¡å™¨ç»‘å®šåˆ°æ‰€æœ‰ç½‘ç»œæ¥å£ä¸Š</span></span><br><span class="line">    seraddr.sin_addr.s_addr = <span class="built_in">inet_addr</span>(<span class="string">&quot;0.0.0.0&quot;</span>);</span><br><span class="line">    <span class="comment">// è®¾ç½®æœåŠ¡å™¨ç«¯å£å·ä¸º9527</span></span><br><span class="line">    seraddr.sin_port = <span class="built_in">htons</span>(<span class="number">9527</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†å¥—æ¥å­—ç»‘å®šåˆ°æŒ‡å®šåœ°å€å’Œç«¯å£</span></span><br><span class="line">    <span class="type">int</span> ret = <span class="built_in">bind</span>(server, (<span class="keyword">struct</span> sockaddr*)&amp;seraddr, <span class="built_in">sizeof</span>(seraddr));</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// è¾“å‡ºç»‘å®šå¤±è´¥ä¿¡æ¯å¹¶å…³é—­å¥—æ¥å­—</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;bind failed!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="built_in">close</span>(server);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼€å§‹ç›‘å¬è¿æ¥ï¼Œæœ€å¤§è¿æ¥æ•°ä¸º3</span></span><br><span class="line">    <span class="comment">// ä½¿ç”¨listenå‡½æ•°ä½¿æœåŠ¡å™¨å¥—æ¥å­—serverå¼€å§‹ç›‘å¬ä¼ å…¥çš„è¿æ¥è¯·æ±‚ï¼Œæœ€å¤§å…è®¸è¿æ¥æ•°ä¸º 3ã€‚</span></span><br><span class="line">    <span class="comment">// listenå‡½æ•°è¿”å› 0 è¡¨ç¤ºæˆåŠŸï¼Œè¿”å› -1 è¡¨ç¤ºå¤±è´¥ã€‚</span></span><br><span class="line">    ret = <span class="built_in">listen</span>(server, <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// è¾“å‡ºç›‘å¬å¤±è´¥ä¿¡æ¯å¹¶å…³é—­å¥—æ¥å­—</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;listen failed!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="built_in">close</span>(server);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> buffer[<span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// æ¸…ç©ºç¼“å†²åŒº</span></span><br><span class="line">        <span class="built_in">memset</span>(buffer, <span class="number">0</span>, <span class="built_in">sizeof</span>(buffer));</span><br><span class="line">        <span class="comment">// è¾“å‡ºå½“å‰æ–‡ä»¶ã€è¡Œå·å’Œå‡½æ•°å</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__);</span><br><span class="line">        <span class="comment">// æ¥å—å®¢æˆ·ç«¯è¿æ¥</span></span><br><span class="line">        client = <span class="built_in">accept</span>(server, (<span class="keyword">struct</span> sockaddr*)&amp;clientaddr, &amp;cliaddrlen);</span><br><span class="line">        <span class="keyword">if</span> (client == <span class="number">-1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// è¾“å‡ºæ¥å—å®¢æˆ·ç«¯è¿æ¥å¤±è´¥ä¿¡æ¯å¹¶å…³é—­æœåŠ¡å™¨</span></span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;client failed!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">            <span class="built_in">close</span>(server);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è¾“å‡ºå½“å‰æ–‡ä»¶ã€è¡Œå·å’Œå‡½æ•°å</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__);</span><br><span class="line">        <span class="comment">// ä»å®¢æˆ·ç«¯è¯»å–æ¶ˆæ¯</span></span><br><span class="line">        <span class="built_in">read</span>(client, buffer, <span class="built_in">sizeof</span>(buffer));</span><br><span class="line">        <span class="comment">// å°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯å›æ˜¾ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">        <span class="type">ssize_t</span> len = <span class="built_in">write</span>(client, buffer, <span class="built_in">strlen</span>(buffer));</span><br><span class="line">        <span class="keyword">if</span> (len!= (<span class="type">ssize_t</span>)<span class="built_in">strlen</span>(buffer))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// è¾“å‡ºå†™å›æ˜¾å¤±è´¥ä¿¡æ¯å¹¶å…³é—­æœåŠ¡å™¨</span></span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;write failed!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">            <span class="built_in">close</span>(server);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è¾“å‡ºå½“å‰æ–‡ä»¶ã€è¡Œå·å’Œå‡½æ•°å</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__);</span><br><span class="line">        <span class="comment">// å…³é—­ä¸å®¢æˆ·ç«¯çš„è¿æ¥</span></span><br><span class="line">        <span class="built_in">close</span>(client);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å…³é—­æœåŠ¡å™¨å¥—æ¥å­—</span></span><br><span class="line">    <span class="built_in">close</span>(server);</span><br><span class="line">    <span class="comment">// è¾“å‡ºå½“å‰æ–‡ä»¶ã€è¡Œå·å’Œå‡½æ•°å</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="lession63-å‡½æ•°"><a href="#lession63-å‡½æ•°" class="headerlink" title="lession63()å‡½æ•°"></a><code>lession63()</code>å‡½æ•°</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">lession63</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºå­è¿›ç¨‹</span></span><br><span class="line">    <span class="type">pid_t</span> pid = fork();</span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// å­è¿›ç¨‹ï¼Œä½œä¸ºå®¢æˆ·ç«¯è¿è¡Œ</span></span><br><span class="line">        <span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">// è¿è¡Œå®¢æˆ·ç«¯å‡½æ•°ä¸¤æ¬¡</span></span><br><span class="line">        <span class="built_in">run_client</span>();</span><br><span class="line">        <span class="built_in">run_client</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (pid &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// çˆ¶è¿›ç¨‹ï¼Œä½œä¸ºæœåŠ¡å™¨ç«¯è¿è¡Œ</span></span><br><span class="line">        <span class="built_in">lession63_</span>();</span><br><span class="line">        <span class="type">int</span> status = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// ç­‰å¾…å­è¿›ç¨‹ç»“æŸ</span></span><br><span class="line">        <span class="built_in">wait</span>(&amp;status);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// è¾“å‡ºforkå¤±è´¥ä¿¡æ¯</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;fork failed!&quot;</span> &lt;&lt; pid &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p><strong>TCPè¿æ¥å®¢æˆ·ç«¯çš„æµç¨‹</strong></p><p>1ï¸âƒ£åˆ›å»ºå¥—æ¥å­—</p><p>2ï¸âƒ£åˆå§‹åŒ–æœåŠ¡å™¨åœ°å€</p><p>3ï¸âƒ£è¿æ¥æœåŠ¡å™¨ã€‚connect æˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›-1</p><p>4ï¸âƒ£é€šä¿¡   write read</p><p>5ï¸âƒ£å…³é—­å¥—æ¥å­— ï¼ˆcloseå…³é—­ï¼‰</p><p><strong>TCPè¿æ¥æœåŠ¡å™¨çš„æµç¨‹</strong></p><p>1ï¸âƒ£åˆ›å»ºå¥—æ¥å­—</p><p>2ï¸âƒ£åˆå§‹åŒ–æœåŠ¡å™¨åœ°å€</p><p>3ï¸âƒ£ç»‘å®šå¥—æ¥å­—ï¼Œ<code>bind</code> å‡½æ•°å°†æœåŠ¡å™¨å¥—æ¥å­— <code>server</code> ç»‘å®šåˆ°æŒ‡å®šçš„åœ°å€å’Œç«¯å£ã€‚</p><p>4ï¸âƒ£ç›‘å¬è¿æ¥ï¼Œ<code>listen</code>å‡½æ•°ä½¿å¾—æœåŠ¡å™¨å¥—æ¥å­—å¼€å§‹ç›‘å¬ä¼ å…¥çš„è¿æ¥è¯·æ±‚</p><p>5ï¸âƒ£<code>accept</code>æ¥å—å¹¶å¤„ç†å®¢æˆ·ç«¯è¿æ¥ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„å¥—æ¥å­—æè¿°ç¬¦ç”¨äºä¸å®¢æˆ·ç«¯é€šä¿¡ã€‚   <code>read</code>ã€<code>write</code> è¿›è¡Œé€šä¿¡ã€‚</p><p>6ï¸âƒ£å…³é—­æœåŠ¡å™¨å¥—æ¥å­—ï¼Œ<code>close(server)</code></p><h4 id="å›å£°æœåŠ¡å™¨"><a href="#å›å£°æœåŠ¡å™¨" class="headerlink" title="å›å£°æœåŠ¡å™¨"></a>å›å£°æœåŠ¡å™¨</h4><p><strong>å›å£°æœåŠ¡å™¨</strong>ï¼šå°†ä»å®¢æˆ·ç«¯æ”¶åˆ°çš„æ•°æ®åŸæ ·è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå³â€œå›å£°â€ã€‚</p><p>å®¢æˆ·ç«¯éƒ¨åˆ† åˆ†ä¸º å‘é€  å’Œ æ¥å—ä¸¤éƒ¨åˆ†</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">run_client64</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªTCPå¥—æ¥å­—ï¼Œä½¿ç”¨IPV4åœ°å€æ—</span></span><br><span class="line"><span class="type">int</span> client = <span class="built_in">socket</span>(PF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªå­˜å‚¨æœåŠ¡å™¨åœ°å€ä¿¡æ¯çš„ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> servaddr;</span><br><span class="line"><span class="built_in">memset</span>(&amp;servaddr, <span class="number">0</span>, <span class="built_in">sizeof</span>(servaddr));</span><br><span class="line">    <span class="comment">// è®¾ç½®åœ°å€æ—ä¸ºIPV4</span></span><br><span class="line">servaddr.sin_family = AF_INET;</span><br><span class="line">    <span class="comment">// å°†ç‚¹åˆ†åè¿›åˆ¶çš„IPåœ°å€  è½¬æ¢ä¸ºäºŒè¿›åˆ¶å½¢å¼å¹¶å­˜å‚¨åˆ°ç»“æ„ä½“ä¸­</span></span><br><span class="line">servaddr.sin_addr.s_addr = <span class="built_in">inet_addr</span>(<span class="string">&quot;127.0.0.1&quot;</span>);</span><br><span class="line"><span class="comment">// å°†ç«¯å£å·ä»ä¸»æœºå­—èŠ‚åºè½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åº</span></span><br><span class="line">    servaddr.sin_port = <span class="built_in">htons</span>(<span class="number">9527</span>);</span><br><span class="line"><span class="type">int</span> ret = <span class="built_in">connect</span>(client, (<span class="keyword">struct</span> sockaddr*)&amp;servaddr, <span class="built_in">sizeof</span>(servaddr));</span><br><span class="line"><span class="keyword">while</span> (ret == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__);</span><br><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªç¼“å†²åŒºç”¨äºå­˜å‚¨ç”¨æˆ·è¾“å…¥çš„æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">char</span> buffer[<span class="number">256</span>] = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="built_in">fputs</span>(<span class="string">&quot;Input message(Q to quit):&quot;</span>, stdout);</span><br><span class="line">        <span class="comment">// ä»æ ‡å‡†è¾“å…¥è¯»å–ä¸€è¡Œæ¶ˆæ¯åˆ°ç¼“å†²åŒº</span></span><br><span class="line"><span class="built_in">fgets</span>(buffer, <span class="built_in">sizeof</span>(buffer), stdin);</span><br><span class="line"><span class="keyword">if</span> ((<span class="built_in">strcmp</span>(buffer, <span class="string">&quot;q\n&quot;</span>) == <span class="number">0</span> || <span class="built_in">strcmp</span>(buffer, <span class="string">&quot;Q\n&quot;</span>) == <span class="number">0</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">        <span class="comment">// è·å–ç”¨æˆ·è¾“å…¥æ¶ˆæ¯çš„é•¿åº¦</span></span><br><span class="line"><span class="type">size_t</span> len = <span class="built_in">strlen</span>(buffer);</span><br><span class="line">        <span class="comment">// è·å–ç”¨æˆ·è¾“å…¥æ¶ˆæ¯çš„é•¿åº¦</span></span><br><span class="line"><span class="type">size_t</span> send_len = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line"><span class="keyword">while</span> (send_len &lt; len)</span><br><span class="line">&#123;</span><br><span class="line">            <span class="comment">// å‘æœåŠ¡å™¨å‘é€æ¶ˆæ¯ï¼Œä»ç¼“å†²åŒºçš„æœªå‘é€éƒ¨åˆ†å¼€å§‹å‘é€</span></span><br><span class="line"><span class="type">ssize_t</span> ret = <span class="built_in">write</span>(client, buffer + send_len, len -send_len);</span><br><span class="line"><span class="comment">// å¦‚æœå‘é€å¤±è´¥</span></span><br><span class="line">            <span class="keyword">if</span> (ret &lt;= <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">fputs</span>(<span class="string">&quot;write failed!\n&quot;</span>, stdout);</span><br><span class="line"><span class="built_in">close</span>(client);</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;client done!!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">            <span class="comment">// æ›´æ–°å·²å‘é€çš„å­—èŠ‚æ•°</span></span><br><span class="line">send_len += (<span class="type">size_t</span>)ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">memset</span>(buffer, <span class="number">0</span>, <span class="built_in">sizeof</span>(buffer));</span><br><span class="line">        <span class="comment">// å·²æ¥æ”¶çš„å­—èŠ‚æ•°</span></span><br><span class="line"><span class="type">size_t</span> read_len = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// å¾ªç¯æ¥æ”¶æœåŠ¡å™¨çš„å“åº”ï¼Œç›´åˆ°æ¥æ”¶çš„å­—èŠ‚æ•°è¾¾åˆ°å‘é€çš„æ¶ˆæ¯é•¿åº¦</span></span><br><span class="line"><span class="keyword">while</span> (read_len &lt; len)</span><br><span class="line">&#123;</span><br><span class="line">            <span class="comment">// ä»æœåŠ¡å™¨è¯»å–å“åº”æ¶ˆæ¯</span></span><br><span class="line"><span class="type">ssize_t</span> ret = <span class="built_in">read</span>(client, buffer + read_len, len - read_len);</span><br><span class="line"><span class="comment">// è¯»å–å¤±è´¥</span></span><br><span class="line">            <span class="keyword">if</span> (ret &lt;= <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">fputs</span>(<span class="string">&quot;read failed!\n&quot;</span>, stdout);</span><br><span class="line"><span class="built_in">close</span>(client);</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;client done!!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">            <span class="comment">// æ›´æ–°å·²ç»æ¥æ”¶çš„å­—èŠ‚æ•°</span></span><br><span class="line">read_len += (<span class="type">size_t</span>)ret;</span><br><span class="line">&#125;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;from server &quot;</span> &lt;&lt; buffer;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">// å…³é—­å¥—æ¥å­—</span></span><br><span class="line"><span class="built_in">close</span>(client);</span><br><span class="line">    <span class="comment">// è¾“å‡ºå®¢æˆ·ç«¯ç»“æŸä¿¡æ¯</span></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;client done!!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœåŠ¡å™¨ç«¯</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">server64</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„å¥—æ¥å­—æè¿°ç¬¦</span></span><br><span class="line"><span class="type">int</span> server, client;</span><br><span class="line">    <span class="comment">// å®šä¹‰å­˜å‚¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯åœ°å€ä¿¡æ¯çš„ç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> seraddr, clientaddr;</span><br><span class="line">    <span class="comment">// å®šä¹‰å®¢æˆ·ç«¯åœ°å€ç»“æ„ä½“çš„é•¿åº¦</span></span><br><span class="line"><span class="type">socklen_t</span> cliaddrlen;</span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ª TCP å¥—æ¥å­—ï¼Œä½¿ç”¨ IPv4 åœ°å€æ—</span></span><br><span class="line">server = <span class="built_in">socket</span>(PF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (server &lt; <span class="number">0</span>) &#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;create socket failedï¼ï¼\n&quot;</span>;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">memset</span>(&amp;seraddr, <span class="number">0</span>, <span class="built_in">sizeof</span>(seraddr));</span><br><span class="line">seraddr.sin_family = AF_INET;</span><br><span class="line">seraddr.sin_addr.s_addr = <span class="built_in">inet_addr</span>(<span class="string">&quot;0.0.0.0&quot;</span>);</span><br><span class="line">seraddr.sin_port = <span class="built_in">htons</span>(<span class="number">9527</span>);</span><br><span class="line"><span class="type">int</span> ret = <span class="built_in">bind</span>(server, (<span class="keyword">struct</span> sockaddr*)&amp;seraddr, <span class="built_in">sizeof</span>(seraddr));</span><br><span class="line"><span class="comment">// å¦‚æœç»‘å®šå¤±è´¥</span></span><br><span class="line">    <span class="keyword">if</span> (ret == <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line">        <span class="comment">// è¾“å‡ºé”™è¯¯ä¿¡æ¯</span></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;bind failed!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="comment">// å…³é—­å¥—æ¥å­—</span></span><br><span class="line"><span class="built_in">close</span>(server);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">// å¼€å§‹ç›‘å¬å®¢æˆ·ç«¯è¿æ¥  åœ¨æœ€å¤§å…è®¸3ä¸ªè¿æ¥çš„è¯·æ±‚æ’é˜Ÿ</span></span><br><span class="line">ret = <span class="built_in">listen</span>(server, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">if</span> (ret == <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;listen failed!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="built_in">close</span>(server);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> buffer[<span class="number">1024</span>];</span><br><span class="line">    <span class="comment">// å¤„ç†2ä¸ªå®¢æˆ·ç«¯è¿æ¥</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i ++ )</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">memset</span>(buffer, <span class="number">0</span>, <span class="built_in">sizeof</span>(buffer));</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__);</span><br><span class="line">         <span class="comment">// æ¥å—å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„å¥—æ¥å­—æè¿°ç¬¦</span></span><br><span class="line">client = <span class="built_in">accept</span>(server, (<span class="keyword">struct</span> sockaddr*)&amp;clientaddr, &amp;cliaddrlen);</span><br><span class="line"><span class="keyword">if</span> (client == <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;client failed!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"><span class="built_in">close</span>(server);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__);</span><br><span class="line"><span class="comment">// å·²è¯»å–çš„å­—èŠ‚æ•°</span></span><br><span class="line">        <span class="type">ssize_t</span> len = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// å¾ªç¯è¯»å–å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="keyword">while</span> (( len = <span class="built_in">read</span>(client, buffer, <span class="built_in">sizeof</span>(buffer)) ) &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">            <span class="comment">// å°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯åŸæ ·è¿”å›ç»™å®¢æˆ·ç«¯</span></span><br><span class="line">len = <span class="built_in">write</span>(client, buffer, len);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (len != (<span class="type">ssize_t</span>)<span class="built_in">strlen</span>(buffer))</span><br><span class="line"><span class="comment">//if (len != write(client, buffer, len))</span></span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;write failed! len: &quot;</span> &lt;&lt;</span><br><span class="line">                    len &lt;&lt; <span class="string">&quot;buffer: &quot;</span> &lt;&lt; buffer &lt;&lt; std::endl;</span><br><span class="line"><span class="built_in">close</span>(server);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">memset</span>(buffer, <span class="number">0</span>, len);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (len &lt;= <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">            <span class="comment">// è¾“å‡ºé”™è¯¯ä¿¡æ¯</span></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;read failed!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">            <span class="comment">// å…³é—­æœåŠ¡å™¨å¥—æ¥å­—</span></span><br><span class="line"><span class="built_in">close</span>(server);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__);</span><br><span class="line"><span class="built_in">close</span>(client);  <span class="comment">// å¯ä»¥æ³¨é‡Š</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">close</span>(server);  <span class="comment">// æœåŠ¡å…³é—­çš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯è‡ªåŠ¨å…³é—­</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¸»å‡½æ•°ï¼šå¯åŠ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å›å£°æœåŠ¡å™¨</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">lession64</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹</span></span><br><span class="line"><span class="type">pid_t</span> pid = fork();</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯å­è¿›ç¨‹</span></span><br><span class="line"><span class="keyword">if</span> (pid == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">server64</span>();</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (pid &gt; <span class="number">0</span>) <span class="comment">// å¦‚æœæ˜¯çˆ¶è¿›ç¨‹</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="comment">// å¯åŠ¨ä¸¤æ¬¡å®¢æˆ·ç«¯ç¨‹åº</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i ++)</span><br><span class="line"><span class="comment">//sleep(1);</span></span><br><span class="line"><span class="built_in">run_client64</span>();</span><br><span class="line">        <span class="comment">// ç”¨äºå­˜å‚¨å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€</span></span><br><span class="line"><span class="type">int</span> status = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// ç­‰å¾…å­è¿›ç¨‹ç»“æŸ</span></span><br><span class="line"><span class="built_in">wait</span>(&amp;status);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;fork failed!&quot;</span> &lt;&lt; pid &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å›å£°æœåŠ¡å™¨å­˜åœ¨çš„é—®é¢˜</strong></p><p>ï¼ˆä¸Šè¿°ä»£ç å·²ç»æ›´æ­£äº†ï¼‰ä»£ç æœ‰ä¸ªé”™è¯¯çš„å‡è®¾ï¼Œæ¯æ¬¡è°ƒç”¨readã€writeå‡½æ•°æ—¶éƒ½ä¼šä»¥<font color="FF0000">å­—ç¬¦ä¸²ä¸ºå•ä½æ‰§è¡Œå®é™…çš„I&#x2F;Oæ“ä½œã€‚</font>æ¯æ¬¡è°ƒç”¨writeå‡½æ•°éƒ½ä¼šä¼ é€’ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™ç§å‡è®¾ä¹Ÿç®—åˆç†ã€‚ä½†æ˜¯ï¼Œå¤šæ¬¡è°ƒç”¨writeå‡½æ•°ä¼ é€’çš„å­—ç¬¦ä¸²æœ‰å¯èƒ½ä¸€æ¬¡æ€§ä¼ é€’åˆ°æœåŠ¡å™¨ç«¯ã€‚æ­¤æ—¶å®¢æˆ·ç«¯æœ‰å¯èƒ½ä»æœåŠ¡å™¨ç«¯æ”¶åˆ°å¤šä¸ªå­—ç¬¦ä¸²ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬å¸Œæœ›çœ‹åˆ°çš„ç»“æœã€‚</p><p>éœ€è¦è€ƒè™‘ä¸‹é¢çš„æƒ…å†µï¼š<font color="FF0000">å­—ç¬¦ä¸²å¤ªé•¿ï¼Œéœ€è¦åˆ†2ä¸ªæ•°æ®åŒ…å‘é€ï¼</font></p><h4 id="é—®é¢˜æ±‡æ€»"><a href="#é—®é¢˜æ±‡æ€»" class="headerlink" title="é—®é¢˜æ±‡æ€»"></a>é—®é¢˜æ±‡æ€»</h4><p><strong>å®¢æˆ·ç«¯è®¾ç½®æœåŠ¡å™¨åœ°å€</strong></p><p>å®¢æˆ·ç«¯è®¾ç½®æœåŠ¡å™¨åœ°å€æ˜¯ä¸ºäº†æ˜ç¡®è¦è¿æ¥çš„ç›®æ ‡æœåŠ¡å™¨ä½ç½®ã€‚å®ƒé€šè¿‡<code>struct sockaddr_in</code>ç»“æ„ä½“æ¥å­˜å‚¨æœåŠ¡å™¨çš„ç½‘ç»œåœ°å€ä¿¡æ¯ï¼ŒåŒ…æ‹¬ <code>IP</code> åœ°å€å’Œç«¯å£å·ã€‚</p><p><strong>æœåŠ¡å™¨ç«¯è®¾ç½®æœåŠ¡å™¨åœ°å€</strong></p><p>æœåŠ¡å™¨ç«¯è®¾ç½®è‡ªå·±çš„åœ°å€ä¸»è¦æ˜¯ä¸ºäº†å°†æœåŠ¡å™¨å¥—æ¥å­—ç»‘å®šåˆ°ä¸€ä¸ªç‰¹å®šçš„ç½‘ç»œæ¥å£å’Œç«¯å£ä¸Šï¼Œä»¥ä¾¿æ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚</p><p><strong><code>connect()</code>å‡½æ•°  å’Œ  <code>bind()</code>å‡½æ•°   çš„åŒºåˆ«</strong></p><ul><li><p><code>connect</code>å‡½æ•°ä¸»è¦ç”¨äºå®¢æˆ·ç«¯å¥—æ¥å­—ä¸æœåŠ¡å™¨ç«¯å¥—æ¥å­—å»ºç«‹è¿æ¥ã€‚å®ƒå°è¯•å°†å®¢æˆ·ç«¯çš„ç½‘ç»œç«¯ç‚¹ï¼ˆç”± IP åœ°å€å’Œç«¯å£å·æ ‡è¯†ï¼‰ä¸æœåŠ¡å™¨çš„ç½‘ç»œç«¯ç‚¹è¿›è¡Œå…³è”ï¼Œä»è€Œå»ºç«‹èµ·ä¸€æ¡é€šä¿¡é“¾è·¯ï¼Œä½¿å¾—å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥äº’ç›¸å‘é€å’Œæ¥æ”¶æ•°æ®ã€‚</p><p>è¿”å›0ï¼šå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥å·²ç»å»ºç«‹ï¼Œå¯ä»¥å¼€å§‹è¿›è¡Œæ•°æ®è¯»å†™æ“ä½œäº†ã€‚</p><p>è¿”å›-1ï¼šæ‰§è¡Œ å¤±è´¥çš„æ—¶å€™ä¼šè¿”å›-1ï¼Œerrnoå˜é‡æ¥æŒ‡ç¤ºå…·ä½“é”™è¯¯åŸå› ã€‚</p></li><li><p><code>bind</code>å‡½æ•°ä¸»è¦ç”¨äºæœåŠ¡å™¨ç«¯å°†å¥—æ¥å­—ç»‘å®šåˆ°ä¸€ä¸ªç‰¹å®šçš„æœ¬åœ°ç½‘ç»œç«¯ç‚¹ï¼ˆåŒ…æ‹¬ IP åœ°å€å’Œç«¯å£å·ï¼‰ã€‚å®ƒçš„ä½œç”¨æ˜¯è®©æœåŠ¡å™¨åœ¨ç‰¹å®šçš„ç½‘ç»œåœ°å€å’Œç«¯å£ä¸Šç›‘å¬å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼Œä½¿å¾—å®¢æˆ·ç«¯èƒ½å¤Ÿå‡†ç¡®åœ°æ‰¾åˆ°æœåŠ¡å™¨å¹¶ä¸ä¹‹å»ºç«‹è¿æ¥ã€‚</p></li></ul><p><strong><code>write</code>å‡½æ•°</strong></p><ul><li><code>fd</code>ï¼šæ–‡ä»¶æè¿°ç¬¦ï¼Œå®ƒå¯ä»¥ä»£è¡¨ä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶ã€å¥—æ¥å­—ç­‰ã€‚åœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œé€šå¸¸æ˜¯é€šè¿‡ <code>socket</code> å‡½æ•°åˆ›å»ºå¹¶è¿æ¥å¥½çš„å¥—æ¥å­—æè¿°ç¬¦ã€‚</li><li><code>buf</code>ï¼šæŒ‡å‘è¦å†™å…¥æ•°æ®çš„ç¼“å†²åŒºçš„æŒ‡é’ˆã€‚</li><li><code>count</code>ï¼šè¦å†™å…¥çš„å­—èŠ‚æ•°ã€‚</li></ul><p>è¿”å›å€¼å¤§äº0ï¼šå½“ <code>write</code> å‡½æ•°æˆåŠŸå†™å…¥éƒ¨åˆ†æˆ–å…¨éƒ¨æ•°æ®æ—¶ï¼Œå®ƒä¼šè¿”å›å®é™…å†™å…¥çš„å­—èŠ‚æ•°ã€‚è¿™ä¸ªè¿”å›å€¼å¯èƒ½å°äºã€ç­‰äº <code>count</code> å‚æ•°æŒ‡å®šçš„å­—èŠ‚æ•°ã€‚</p><ul><li><strong>ç­‰äº <code>count</code></strong>ï¼šè¡¨ç¤ºæˆåŠŸå†™å…¥äº†è¯·æ±‚çš„æ‰€æœ‰å­—èŠ‚ã€‚ä¾‹å¦‚ï¼Œä½ å¸Œæœ›å†™å…¥ 10 ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œ<code>write</code> å‡½æ•°è¿”å› 10ï¼Œè¯´æ˜è¿™ 10 ä¸ªå­—èŠ‚éƒ½æˆåŠŸå†™å…¥åˆ°äº†æ–‡ä»¶æè¿°ç¬¦æ‰€å…³è”çš„ç›®æ ‡ä¸­ã€‚</li><li><strong>å°äº <code>count</code></strong>ï¼šå¯èƒ½æ˜¯å› ä¸ºæŸäº›åŸå› ï¼ˆå¦‚ç£ç›˜ç©ºé—´ä¸è¶³ã€ç½‘ç»œç¼“å†²åŒºå·²æ»¡ç­‰ï¼‰ï¼Œæ— æ³•ä¸€æ¬¡æ€§å†™å…¥æ‰€æœ‰è¯·æ±‚çš„å­—èŠ‚ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦å†æ¬¡è°ƒç”¨ <code>write</code> å‡½æ•°ï¼Œä»ä¸Šæ¬¡å†™å…¥ç»“æŸçš„ä½ç½®ç»§ç»­å†™å…¥å‰©ä½™çš„æ•°æ®ã€‚</li></ul><p>è¿”å›å€¼ç­‰äº0ï¼šé€šå¸¸å‡ºç°äº†ä¸€äº›å¼‚å¸¸æƒ…å†µ</p><p>è¿”å›å€¼ä¸º-1 ï¼š<code>write</code>å‡½æ•°æ‰§è¡Œå¤±è´¥æ—¶ï¼Œå®ƒä¼šè¿”å›-1ï¼Œå¹¶ä¸”ä¼šè®¾ç½®<code>errno</code>å˜é‡æ¥æŒ‡ç¤ºå…·ä½“çš„é”™è¯¯åŸå› ã€‚</p><p><strong>è¿™ä¿©éƒ¨åˆ†è®¾ç½®æ˜¯å¦ä¸€æ ·ï¼Ÿ</strong></p><ul><li><strong>å®¢æˆ·ç«¯è§’åº¦</strong><ul><li>å®¢æˆ·ç«¯è®¾ç½®çš„æœåŠ¡å™¨ IP åœ°å€å¿…é¡»æ˜¯æœåŠ¡å™¨å®é™…ç»‘å®šå¹¶ç›‘å¬çš„ IP åœ°å€ä¹‹ä¸€ã€‚å¦‚æœæœåŠ¡å™¨ç»‘å®šäº†ç‰¹å®šçš„ IP åœ°å€ï¼ˆä¾‹å¦‚<code>192.168.1.100</code>ï¼‰ï¼Œå®¢æˆ·ç«¯å°±éœ€è¦ä½¿ç”¨è¿™ä¸ª IP åœ°å€æ¥è¿æ¥æœåŠ¡å™¨ã€‚ä¸è¿‡ï¼Œå¦‚æœæœåŠ¡å™¨ç»‘å®šçš„æ˜¯<code>0.0.0.0</code>ï¼ˆè¡¨ç¤ºç›‘å¬æ‰€æœ‰æœ¬åœ°ç½‘ç»œæ¥å£ï¼‰ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨æœåŠ¡å™¨æ‰€åœ¨ä¸»æœºçš„ä»»ä½•ä¸€ä¸ªæœ‰æ•ˆæœ¬åœ° IP åœ°å€æ¥è¿æ¥ã€‚</li></ul></li><li><strong>æœåŠ¡å™¨è§’åº¦</strong><ul><li>æœåŠ¡å™¨ç»‘å®šçš„ IP åœ°å€å†³å®šäº†å®ƒåœ¨å“ªäº›ç½‘ç»œæ¥å£ä¸Šç›‘å¬å®¢æˆ·ç«¯è¿æ¥ã€‚å¦‚æœæœåŠ¡å™¨æœ‰å¤šä¸ªç½‘ç»œæ¥å£ï¼ˆä¾‹å¦‚æœ‰å¤šä¸ªç½‘å¡ï¼Œæ¯ä¸ªç½‘å¡æœ‰ä¸åŒçš„ IP åœ°å€ï¼‰ï¼Œç»‘å®š<code>0.0.0.0</code>æ„å‘³ç€åœ¨æ‰€æœ‰æ¥å£ä¸Šç›‘å¬ï¼›è€Œç»‘å®šç‰¹å®šçš„ IP åœ°å€åˆ™åªåœ¨è¯¥æ¥å£ç›‘å¬ã€‚</li></ul></li></ul><p><strong>ä¸»æœºå­—èŠ‚åºå’Œç½‘ç»œå­—èŠ‚åº</strong></p><p>å¤§ç«¯å­—èŠ‚åºä¹Ÿæˆä¸ºç½‘ç»œå­—èŠ‚åºï¼Œæ•°æ®çš„é«˜ä½å­—èŠ‚å­˜äºä½åœ°å€ï¼Œä½ä½å­—èŠ‚å­˜äºé«˜åœ°å€ã€‚</p><p>å°ç«¯å­—èŠ‚åºï¼šæ•°æ®ä½ä½å­—èŠ‚å­˜äºä½åœ°å€ï¼Œé«˜ä½å­—èŠ‚å­˜äºé«˜åœ°å€ã€‚</p><h3 id="ç®€å•çš„-UDP-å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å‹"><a href="#ç®€å•çš„-UDP-å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å‹" class="headerlink" title="ç®€å•çš„ UDP å®¢æˆ·ç«¯ - æœåŠ¡å™¨æ¨¡å‹"></a>ç®€å•çš„ <code>UDP</code> å®¢æˆ·ç«¯ - æœåŠ¡å™¨æ¨¡å‹</h3><h4 id="server-å‡½æ•°"><a href="#server-å‡½æ•°" class="headerlink" title="server()å‡½æ•°"></a><code>server</code>()å‡½æ•°</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">server</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> ser_sock = <span class="number">-1</span>;</span><br><span class="line"><span class="type">char</span> message[<span class="number">512</span>];</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> servaddr, clientaddr;</span><br><span class="line"><span class="type">socklen_t</span> clientlen = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ£€æŸ¥å‘½ä»¤è¡Œå‚æ•°</span></span><br><span class="line"><span class="keyword">if</span> (argc != <span class="number">2</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;usage:%s  &lt;port&gt;\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line"><span class="built_in">handle_error</span>(<span class="string">&quot;argement is error!:&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºUDPå¥—æ¥å­—</span></span><br><span class="line">ser_sock = <span class="built_in">socket</span>(PF_INET, SOCK_DGRAM, <span class="number">0</span>); <span class="comment">// UDP</span></span><br><span class="line"><span class="keyword">if</span> (ser_sock == <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">handle_error</span>(<span class="string">&quot;create socket failed:&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">memset</span>(&amp;servaddr, <span class="number">0</span>, <span class="built_in">sizeof</span>(servaddr));</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–æœåŠ¡å™¨åœ°å€</span></span><br><span class="line">servaddr.sin_family = AF_INET;</span><br><span class="line">servaddr.sin_addr.s_addr = <span class="built_in">htonl</span>(INADDR_ANY); <span class="comment">// 0.0.0.0  å…¨ç½‘æ®µç›‘å¬</span></span><br><span class="line">    <span class="comment">// è®¾ç½®servaddrçš„ç«¯å£å·ä¸ºä»å‘½ä»¤è¡Œå‚æ•°argv[1]ä¸­è·å–çš„ç«¯å£å·</span></span><br><span class="line">    <span class="comment">// é€šè¿‡htonså‡½æ•°å°†å…¶è½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åºã€‚</span></span><br><span class="line">servaddr.sin_port = <span class="built_in">htons</span>((<span class="type">short</span>)<span class="built_in">atoi</span>(argv[<span class="number">1</span>]));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç»‘å®šå¥—æ¥å­—åˆ°åœ°å€</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">bind</span>(ser_sock, (<span class="keyword">struct</span> sockaddr*)&amp;servaddr, <span class="built_in">sizeof</span>(servaddr)) == <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">handle_error</span>(<span class="string">&quot;bind failed:&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">// æ¶ˆæ¯å¤„ç†å¾ªç¯</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">clientlen = <span class="built_in">sizeof</span>(clientaddr);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä½¿ç”¨recvfromå‡½æ•°ä»å®¢æˆ·ç«¯æ¥æ”¶æ•°æ®</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        ser_sockï¼šæœåŠ¡å™¨å¥—æ¥å­—æè¿°ç¬¦ã€‚</span></span><br><span class="line"><span class="comment">        0ï¼šè¡¨ç¤ºé»˜è®¤çš„æ ‡å¿—ä½ã€‚</span></span><br><span class="line"><span class="comment">        (struct sockaddr*)&amp;clientaddrï¼šç”¨äºå­˜å‚¨å®¢æˆ·ç«¯åœ°å€çš„ç»“æ„ä½“æŒ‡é’ˆã€‚</span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment">        recvfrom å‡½æ•°è¿”å›æ¥æ”¶åˆ°çš„æ•°æ®é•¿åº¦ã€‚</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"><span class="type">ssize_t</span> len = <span class="built_in">recvfrom</span>(ser_sock, message, <span class="built_in">sizeof</span>(message), <span class="number">0</span>, (<span class="keyword">struct</span> sockaddr*)&amp;clientaddr, &amp;clientlen);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä½¿ç”¨sendtoå‡½æ•°å°†æ¥æ”¶åˆ°çš„æ•°æ®å›æ˜¾ç»™å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="built_in">sendto</span>(ser_sock, message, len, <span class="number">0</span>, (<span class="keyword">struct</span> sockaddr*)&amp;clientaddr, clientlen);</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">// å…³é—­å¥—æ¥å­—</span></span><br><span class="line"><span class="built_in">close</span>(ser_sock);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="client-å‡½æ•°"><a href="#client-å‡½æ•°" class="headerlink" title="client()å‡½æ•°"></a><code>client()</code>å‡½æ•°</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">client</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// å˜é‡å£°æ˜</span></span><br><span class="line"><span class="type">int</span> client_sock;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> serv_addr;</span><br><span class="line"><span class="type">socklen_t</span> serv_len = <span class="built_in">sizeof</span>(serv_addr);</span><br><span class="line"><span class="type">char</span> message[<span class="number">512</span>] = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (argc != <span class="number">3</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;usage:%s is port\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line"><span class="built_in">handle_error</span>(<span class="string">&quot;argement error:&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">// åˆ›å»º UDP å¥—æ¥å­—</span></span><br><span class="line">    <span class="comment">// UDP å¥—æ¥å­—æ˜¯æ— è¿æ¥çš„ï¼Œé€šè¿‡SOCK_DGRAMå‚æ•°æ¥æŒ‡å®šåˆ›å»º UDP ç±»å‹çš„å¥—æ¥å­—ã€‚</span></span><br><span class="line">client_sock = <span class="built_in">socket</span>(PF_INET, SOCK_DGRAM, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (client_sock == <span class="number">-1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">handle_error</span>(<span class="string">&quot;socket create failedï¼&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">memset</span>(&amp;serv_addr, <span class="number">0</span>, <span class="built_in">sizeof</span>(serv_addr));</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–æœåŠ¡å™¨åœ°å€</span></span><br><span class="line">serv_addr.sin_family = AF_INET;</span><br><span class="line">serv_addr.sin_addr.s_addr = <span class="built_in">inet_addr</span>(argv[<span class="number">1</span>]);</span><br><span class="line">serv_addr.sin_port = <span class="built_in">htons</span>((<span class="type">short</span>)<span class="built_in">atoi</span>(argv[<span class="number">2</span>]));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¶ˆæ¯å¤„ç†å¾ªç¯</span></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Input message(q to quit):&quot;</span>);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, message);</span><br><span class="line"><span class="keyword">if</span> ((<span class="built_in">strcmp</span>(message, <span class="string">&quot;q&quot;</span>) == <span class="number">0</span>) || (<span class="built_in">strcmp</span>(message, <span class="string">&quot;Q&quot;</span>) == <span class="number">0</span>)) &#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åˆ†é…äº†åœ°å€</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s(%d):%s\n&quot;</span>, __FILE__, __LINE__, __FUNCTION__);</span><br><span class="line"><span class="type">ssize_t</span> len = <span class="built_in">sendto</span>(client_sock, message, <span class="built_in">strlen</span>(message), <span class="number">0</span>, (sockaddr*)&amp;serv_addr, serv_len);</span><br><span class="line"><span class="built_in">memset</span>(message, <span class="number">0</span>, len);</span><br><span class="line"><span class="built_in">recvfrom</span>(client_sock, message, <span class="built_in">sizeof</span>(message), <span class="number">0</span>, (sockaddr*)&amp;serv_addr, &amp;serv_len);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;recv:%s\n&quot;</span>, message);</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">// å…³é—­å¥—æ¥å­—å¹¶è¿”å›</span></span><br><span class="line"><span class="built_in">close</span>(client_sock);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p><strong><code>UDP</code>å®¢æˆ·ç«¯çš„æµç¨‹</strong></p><p>1ï¸âƒ£ åˆ›å»ºå¥—æ¥å­—</p><p>2ï¸âƒ£ è®¾ç½®æœåŠ¡å™¨åœ°å€ç«¯å£</p><p>3ï¸âƒ£ ä½¿ç”¨<code>sendto</code>å‡½æ•°å‘é€æ•°æ®ã€<code>recvfrom</code>å‡½æ•°æ¥æ¥æ”¶æ•°æ®ã€‚</p><p>4ï¸âƒ£ å…³é—­å¥—æ¥å­—</p><p><strong><code>UDP</code>æœåŠ¡å™¨ç«¯çš„æµç¨‹</strong></p><p>1ï¸âƒ£ åˆ›å»ºå¥—æ¥å­—</p><p>2ï¸âƒ£ ç»‘å®šåœ°å€å’Œç«¯å£</p><p>3ï¸âƒ£ æ¥å—ã€å¤„ç†æ•°æ®</p><p>4ï¸âƒ£ å…³é—­å¥—æ¥å­—</p><h4 id="é—®é¢˜æ±‡æ€»-1"><a href="#é—®é¢˜æ±‡æ€»-1" class="headerlink" title="é—®é¢˜æ±‡æ€»"></a>é—®é¢˜æ±‡æ€»</h4><p><code>UDP</code>æœåŠ¡å™¨ç«¯&#x2F;å®¢æˆ·ç«¯çš„å®ç°æ–¹æ³•ã€‚ä½†å¦‚æœä»”ç»†è§‚å¯Ÿ<code>UDP</code>å®¢æˆ·ç«¯ä¼šå‘ç°ï¼Œå®ƒç¼ºå°‘æŠŠ<code>IP</code>å’Œç«¯å£åˆ†é…ç»™å¥—æ¥å­—çš„è¿‡ç¨‹ã€‚</p><p><code>TCP</code>å®¢æˆ·ç«¯è°ƒç”¨connectå‡½æ•°è‡ªåŠ¨å®Œæˆæ­¤è¿‡ç¨‹ï¼Œ<code>UDP</code>è°ƒç”¨<code>sendto</code>å‡½æ•°æ—¶è‡ªåŠ¨åˆ†é…<code>IP</code>å’Œç«¯å£å·</p><p><strong>å¥—æ¥å­—ç±»å‹åªèƒ½åœ¨åˆ›å»ºæ—¶å†³å®šï¼Œä»¥åä¸èƒ½å†æ›´æ”¹ã€‚</strong></p><p><strong><code>SO_SNDBUF &amp;SO_RCVBUF</code></strong></p><p><code>SO_RCVBUF</code>æ˜¯è¾“å…¥ç¼“å†²å¤§å°ç›¸å…³å¯é€‰é¡¹ï¼Œ<code>SO_SNDBUF</code>æ˜¯è¾“å‡ºç¼“å†²å¤§å°ç›¸å…³å¯é€‰é¡¹ã€‚ç”¨è¿™2 ä¸ªå¯é€‰é¡¹æ—¢å¯ä»¥è¯»å–å½“å‰I&#x2F;Oç¼“å†²å¤§å°ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œæ›´æ”¹ã€‚é€šè¿‡ä¸‹åˆ—ç¤ºä¾‹è¯»å–åˆ›å»ºå¥—æ¥å­—æ—¶é»˜è®¤çš„I&#x2F;Oç¼“å†²å¤§å°ã€‚</p><p><strong>å¦‚ä½•ä½¿ç”¨<code>socket</code>ã€<code>getsockopt</code>å’Œ<code>setsockopt</code>å‡½æ•°æ¥è·å–å’Œè®¾ç½®å¥—æ¥å­—çš„å±æ€§</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">lession76</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å£°æ˜äº†ä¸¤ä¸ªæ•´æ•°å˜é‡ï¼Œåˆ†åˆ«ç”¨äºå­˜å‚¨ TCP å¥—æ¥å­—æè¿°ç¬¦å’Œ UDP å¥—æ¥å­—æè¿°ç¬¦ã€‚</span></span><br><span class="line"><span class="type">int</span> tcp_sock, udp_sock;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å£°æ˜å¹¶åˆå§‹åŒ–ä¸€ä¸ªæ•´æ•°å˜é‡optvalï¼Œç”¨äºå­˜å‚¨å¥—æ¥å­—é€‰é¡¹çš„å€¼ã€‚</span></span><br><span class="line"><span class="type">int</span> optval = <span class="number">0</span>;</span><br><span class="line"><span class="type">socklen_t</span> len = <span class="built_in">sizeof</span>(optval);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ†åˆ«åˆ›å»ºTCP/UDP å¥—æ¥å­—</span></span><br><span class="line">tcp_sock = <span class="built_in">socket</span>(PF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">udp_sock = <span class="built_in">socket</span>(PF_INET, SOCK_DGRAM, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;SOCK_STREAM:%d\n&quot;</span>, SOCK_STREAM);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;SOCK_DGRAM:%d\n&quot;</span>, SOCK_DGRAM);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å¥—æ¥å­—ç±»å‹</span></span><br><span class="line">    <span class="comment">// ä½¿ç”¨getsockoptå‡½æ•°è·å– TCP å¥—æ¥å­—çš„ç±»å‹ã€‚</span></span><br><span class="line">    <span class="comment">// SOL_SOCKETè¡¨ç¤ºé€šç”¨å¥—æ¥å­—é€‰é¡¹çº§åˆ«ï¼ŒSO_TYPEè¡¨ç¤ºè¦è·å–çš„é€‰é¡¹æ˜¯å¥—æ¥å­—ç±»å‹ã€‚</span></span><br><span class="line">    <span class="comment">// è·å–åˆ°çš„å€¼å­˜å‚¨åœ¨optvalä¸­ã€‚</span></span><br><span class="line"><span class="built_in">getsockopt</span>(tcp_sock, SOL_SOCKET, SO_TYPE, (<span class="type">void</span>*)&amp;optval, &amp;len);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;tcp_sock type is :%d\n&quot;</span>, optval);</span><br><span class="line">optval = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">getsockopt</span>(udp_sock, SOL_SOCKET, SO_TYPE, (<span class="type">void</span>*)&amp;optval, &amp;len);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;udp_sock type is :%d\n&quot;</span>, optval);</span><br><span class="line">optval = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// è·å–å’Œè®¾ç½® TCP å¥—æ¥å­—å‘é€ç¼“å†²åŒºå¤§å°</span></span><br><span class="line"><span class="built_in">getsockopt</span>(tcp_sock, SOL_SOCKET, SO_SNDBUF, (<span class="type">void</span>*)&amp;optval, &amp;len);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;tcp_sock send buffer size is :%d\n&quot;</span>, optval);</span><br><span class="line">optval = <span class="number">1024</span> * <span class="number">16</span>;</span><br><span class="line"><span class="built_in">setsockopt</span>(tcp_sock, SOL_SOCKET, SO_SNDBUF, (<span class="type">void</span>*)&amp;optval, len);</span><br><span class="line"><span class="built_in">getsockopt</span>(tcp_sock, SOL_SOCKET, SO_SNDBUF, (<span class="type">void</span>*)&amp;optval, &amp;len);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;*tcp_sock send buffer size is :%d\n&quot;</span>, optval);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­å¥—æ¥å­—</span></span><br><span class="line"><span class="built_in">close</span>(tcp_sock);</span><br><span class="line"><span class="built_in">close</span>(udp_sock);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¥—æ¥å­—çš„å¤šç§å¯é€‰é¡¹</strong></p><p>åœ¨å®¢æˆ·ç«¯æ§åˆ¶å°è¾“å…¥Qæ¶ˆæ¯ï¼Œæˆ–é€šè¿‡CTRL+Cç»ˆæ­¢ç¨‹åºã€‚</p><p>â€‹åœ¨å®¢æˆ·ç«¯è¾“å…¥Qæ¶ˆæ¯è°ƒç”¨closeå‡½æ•°ï¼Œå‘æœåŠ¡å™¨ç«¯å‘é€FINæ¶ˆæ¯å¹¶ç»è¿‡å››æ¬¡æŒ¥æ‰‹çš„è¿‡ç¨‹ã€‚</p><p><font color="#FF0000">æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯å·²å»ºç«‹è¿æ¥çš„çŠ¶æ€ä¸‹ï¼Œ</font>å‘æœåŠ¡å™¨ç«¯æ§åˆ¶å°è¾“å…¥CTRL+Cï¼Œå³å¼ºåˆ¶å…³é—­æœåŠ¡å™¨ç«¯ã€‚</p><p>â€‹å¦‚æœæ˜¯CTRL+Cï¼ŒæœåŠ¡å™¨ç«¯é‡æ–°è¿è¡Œçš„æ—¶å€™å°†äº§ç”Ÿé—®é¢˜ã€‚å¦‚æœç”¨åŒä¸€ç«¯å£å·é‡æ–°è¿è¡ŒæœåŠ¡å™¨ç«¯ï¼Œå°†è¾“å‡ºâ€œbind errorâ€ æ¶ˆæ¯ï¼Œå¹¶ä¸”æ— æ³•å†æ¬¡è¿è¡Œã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¤§çº¦ä¸‰åˆ†é’Ÿåå³å¯é‡æ–°è¿è¡ŒæœåŠ¡å™¨ç«¯ã€‚</p><p><img src="https://bu.dusays.com/2025/03/05/67c7e28519e2f.png"></p><p>ä¸Šè¿°ä¸¤ç§æ–¹æ³•å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯è°å…ˆä¼ è¾“FINæ¶ˆæ¯ã€‚</p><p><img src="https://bu.dusays.com/2025/03/05/67c7e2b6a33fb.png"></p><p>â€‹å‡è®¾ä¸Šå›¾ä¸­ä¸»æœºAæ˜¯æœåŠ¡å™¨ç«¯ï¼Œå› ä¸ºæ˜¯ä¸»æœºAå‘Bå‘é€FINæ¶ˆæ¯ï¼Œæ•…å¯ä»¥æƒ³è±¡æˆæœåŠ¡å™¨ç«¯1åœ¨æ§åˆ¶å°è¾“å…¥CTRL+Cã€‚ä½†é—®é¢˜æ˜¯ï¼Œå¥—æ¥å­—ç»è¿‡å››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹åå¹¶éç«‹å³æ¶ˆé™¤ï¼Œè€Œæ˜¯è¦ç»è¿‡ä¸€æ®µæ—¶é—´çš„Time-waitçŠ¶æ€ã€‚å½“ç„¶ï¼Œåªæœ‰å…ˆæ–­å¼€è¿æ¥çš„ï¼ˆå…ˆå‘é€FINæ¶ˆæ¯çš„ï¼‰ä¸»æœºæ‰ç»è¿‡Time-waitçŠ¶æ€ã€‚å› æ­¤ï¼Œè‹¥æœåŠ¡å™¨ç«¯å…ˆæ–­å¼€è¿æ¥ï¼Œåˆ™æ— æ³•ç«‹å³é‡æ–°è¿è¡Œã€‚å¥—æ¥å­—å¤„åœ¨Time-waitè¿‡ç¨‹æ—¶ï¼Œç›¸åº”ç«¯å£æ˜¯æ­£åœ¨ä½¿ç”¨çš„çŠ¶æ€ã€‚å› æ­¤ï¼Œå°±åƒä¹‹å‰éªŒè¯è¿‡çš„ï¼Œbindå‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­å½“ç„¶ä¼šå‘ç”Ÿé”™è¯¯ã€‚</p><p>â€‹ä¸è®ºæ˜¯æœåŠ¡å™¨ç«¯è¿˜æ˜¯å®¢æˆ·ç«¯éƒ½ä¼šæœ‰Time-waitè¿‡ç¨‹ã€‚å…ˆæ–­å¼€è¿æ¥çš„å¥—æ¥å­—å¿…ç„¶ä¼šç»è¿‡Time-waitè¿‡ç¨‹ã€‚ä½†æ˜¯æ— éœ€è€ƒè™‘å®¢æˆ·ç«¯Time-waitçŠ¶æ€ã€‚å› ä¸ºå®¢æˆ·ç«¯å¥—æ¥å­—çš„ç«¯å£å·æ˜¯ä»»æ„æŒ‡å®šçš„ã€‚</p><p><strong><font color="#FF0000">ä¸ºä»€ä¹ˆä¼šæœ‰Time-waitçŠ¶æ€ï¼Ÿ</font></strong></p><p>â€‹å¦‚ä¸Šå›¾ä¸­å‡è®¾ä¸»æœºAå‘ä¸»æœºBä¼ è¾“ACKæ¶ˆæ¯ï¼ˆSEQ5001ã€ACK7502ï¼‰åç«‹å³æ¶ˆé™¤å¥—æ¥å­—ã€‚ä½†æœ€åè¿™æ¡ACKæ¶ˆæ¯åœ¨ä¼ é€’é€”ä¸­ä¸¢å¤±ï¼Œæœªèƒ½ä¼ ç»™ä¸»æœºBã€‚è¿™æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ?ä¸»æœºBä¼šè®¤ä¸ºä¹‹å‰è‡ªå·±å‘é€çš„FINæ¶ˆæ¯ï¼ˆSEQ 7501ã€ACK 5001ï¼‰æœªèƒ½æŠµè¾¾ä¸»æœºAï¼Œç»§è€Œè¯•å›¾é‡ä¼ ã€‚ä½†æ­¤æ—¶ä¸»æœºAå·²æ˜¯å®Œå…¨ç»ˆæ­¢çš„çŠ¶æ€ï¼Œå› æ­¤ä¸»æœºBæ°¸è¿œæ— æ³•æ”¶åˆ°ä»ä¸»æœºAæœ€åä¼ æ¥çš„ACKæ¶ˆæ¯ã€‚ç›¸åï¼Œ<strong>è‹¥ä¸»æœºAçš„å¥—æ¥å­—å¤„åœ¨Time-waitçŠ¶æ€</strong>ï¼Œåˆ™ä¼šå‘ä¸»æœºBé‡ä¼ æœ€åçš„ACKæ¶ˆæ¯ï¼Œä¸»æœºBä¹Ÿå¯ä»¥æ­£å¸¸ç»ˆæ­¢ã€‚åŸºäºè¿™äº›è€ƒè™‘ï¼Œå…ˆä¼ è¾“FINæ¶ˆæ¯çš„ä¸»æœºåº”ç»è¿‡Time-waitè¿‡ç¨‹ã€‚</p><p><strong>åœ°å€å†åˆ†é…</strong></p><p><img src="https://bu.dusays.com/2025/03/05/67c7e5e01f1b4.png"></p><p>â€‹å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨ä¸»æœºAçš„å››æ¬¡æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ€åçš„æ•°æ®ä¸¢å¤±ï¼Œåˆ™ä¸»æœºBä¼šè®¤ä¸ºä¸»æœºAæœªèƒ½æ”¶åˆ°è‡ªå·±å‘é€çš„FINæ¶ˆæ¯ï¼Œå› æ­¤é‡ä¼ ã€‚è¿™æ—¶ï¼Œæ”¶åˆ°FINæ¶ˆæ¯çš„ä¸»æœºAå°†é‡å¯Time-waitè®¡æ—¶å™¨ã€‚å› æ­¤ï¼Œå¦‚æœç½‘ç»œçŠ¶å†µä¸ç†æƒ³ï¼ŒTime-waitçŠ¶æ€å°†æŒç»­ã€‚</p><p>â€‹è§£å†³æ–¹æ¡ˆå°±æ˜¯åœ¨å¥—æ¥å­—çš„å¯é€‰é¡¹ä¸­æ›´æ”¹SO_REUSEADDRçš„çŠ¶æ€ã€‚é€‚å½“è°ƒæ•´è¯¥å‚æ•°ï¼Œå¯å°†Time-waitçŠ¶æ€ä¸‹çš„å¥—æ¥å­—ç«¯å£å·é‡æ–°åˆ†é…ç»™æ–°çš„å¥—æ¥å­—ã€‚SO_REUSEADDRçš„é»˜è®¤å€¼ä¸º0ï¼ˆå‡ï¼‰ï¼Œè¿™å°±æ„å‘³ç€æ— æ³•åˆ†é…Time-waitçŠ¶æ€ä¸‹çš„å¥—æ¥å­—ç«¯å£å·ã€‚å› æ­¤éœ€è¦å°†è¿™ä¸ªå€¼æ”¹æˆ1ï¼ˆçœŸï¼‰ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxç³»ç»Ÿç¼–ç¨‹01-åŸºç¡€çŸ¥è¯†</title>
      <link href="/2025/01/09/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B01-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
      <url>/2025/01/09/Linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B01-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/</url>
      
        <content type="html"><![CDATA[<h3 id="ä¸€ã€å¥—æ¥å­—ç¼–ç¨‹"><a href="#ä¸€ã€å¥—æ¥å­—ç¼–ç¨‹" class="headerlink" title="ä¸€ã€å¥—æ¥å­—ç¼–ç¨‹"></a>ä¸€ã€å¥—æ¥å­—ç¼–ç¨‹</h3><p><strong>TCPæœåŠ¡ç«¯</strong></p><p>1ï¸âƒ£ åˆ›å»ºå¥—æ¥å­—socket()</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> sockfd = <span class="built_in">socket</span>(PF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// PF_INET æŒ‡å®šåè®®æ—ä¸º IPv4</span></span><br><span class="line"><span class="comment">// SOCK_STREAMï¼šæŒ‡å®šå¥—æ¥å­—ç±»å‹ä¸ºæµå¥—æ¥å­—</span></span><br><span class="line"><span class="comment">// 0ï¼šæŒ‡å®šåè®®ç±»å‹ï¼Œè¿™é‡Œä½¿ç”¨é»˜è®¤åè®®</span></span><br><span class="line"><span class="comment">// å¦‚æœsocketå‡½æ•°æˆåŠŸåˆ›å»ºå¥—æ¥å­—ï¼Œä¼šè¿”å›ä¸€ä¸ªéè´Ÿæ•´æ•°ä½œä¸ºå¥—æ¥å­—æè¿°ç¬¦ï¼›å¦‚æœå¤±è´¥ï¼Œè¿”å›-1ã€‚</span></span><br></pre></td></tr></table></figure><p>2ï¸âƒ£ å­˜å‚¨åœ°å€ä¿¡æ¯</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªstruct sockaddr_inç±»å‹çš„å˜é‡addrï¼Œç”¨äºå­˜å‚¨åœ°å€ä¿¡æ¯ã€‚</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> addr;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æŒ‡å®šåœ°å€æ—ä¸º IPv4ï¼ŒAFä»£è¡¨ â€œAddress Familyâ€ï¼ŒAF_INETå’Œå‰é¢çš„PF_INETç›¸å¯¹åº”ã€‚</span></span><br><span class="line">addr.sin_family = AF_INET; </span><br><span class="line"></span><br><span class="line"><span class="comment">// INADDR_ANYï¼Œè¡¨ç¤ºè¯¥å¥—æ¥å­—å°†ç»‘å®šåˆ°æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰ç½‘ç»œæ¥å£ã€‚</span></span><br><span class="line">addr.sin_addr.s_addr = INADDR_ANY;</span><br><span class="line"></span><br><span class="line"><span class="comment">// htonså‡½æ•°å°†ä¸»æœºå­—èŠ‚åºçš„ç«¯å£å· 9527 è½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åºï¼Œå¹¶å­˜å‚¨åœ¨sin_portå­—æ®µä¸­ã€‚</span></span><br><span class="line">addr.sin_port = <span class="built_in">htons</span>(<span class="number">9527</span>);</span><br></pre></td></tr></table></figure><p>â‘¡åˆ†é…å¥—æ¥å­—åœ°å€bind()</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è°ƒç”¨bindå‡½æ•°å°†åˆ›å»ºçš„å¥—æ¥å­—sockç»‘å®šåˆ°æŒ‡å®šçš„åœ°å€å’Œç«¯å£ã€‚</span></span><br><span class="line"><span class="built_in">bind</span>(sockfd, (<span class="keyword">struct</span> sockaddr*)&amp;addr, <span class="built_in">sizeof</span>(addr));</span><br><span class="line"><span class="comment">// å¦‚æœbindå‡½æ•°å¤±è´¥ï¼Œè¿”å›-1ã€‚</span></span><br></pre></td></tr></table></figure><p>â‘¢ç­‰å¾…è¿æ¥è¯·æ±‚çŠ¶æ€listen()</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">listen</span>(sockfd, <span class="number">5</span>);  <span class="comment">// 5 æ˜¯è¯·æ±‚é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦</span></span><br></pre></td></tr></table></figure><p>â‘£å…è®¸è¿æ¥accept()</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> client_sock = <span class="built_in">accept</span>(sockfd, (<span class="keyword">struct</span> sockaddr*)&amp;client_addr, &amp;client_len);</span><br></pre></td></tr></table></figure><p>â‘¤æ•°æ®äº¤æ¢read()&#x2F;write()</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> buffer[<span class="number">1024</span>];</span><br><span class="line"><span class="built_in">read</span>(client_sock, buffer, <span class="built_in">sizeof</span>(buffer));  <span class="comment">// æ¥æ”¶å®¢æˆ·ç«¯çš„æ•°æ®</span></span><br><span class="line"><span class="built_in">write</span>(client_sock, <span class="string">&quot;Hello, Client!&quot;</span>, <span class="number">15</span>);   <span class="comment">// å‘é€æ•°æ®åˆ°å®¢æˆ·ç«¯</span></span><br></pre></td></tr></table></figure><p>â‘¥æ–­å¼€è¿æ¥close()    å…³é—­æœåŠ¡å™¨å¥—æ¥å­—</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">close</span>(client_sock);</span><br><span class="line"><span class="built_in">close</span>(sockfd);</span><br></pre></td></tr></table></figure><p><strong>å®¢æˆ·ç«¯å¥—æ¥å­—ç¼–ç¨‹æµç¨‹</strong></p><p>â‘ åˆ›å»ºå¥—æ¥å­—socket()</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> sockfd = <span class="built_in">socket</span>(PF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>â‘¡è®¾ç½®æœåŠ¡å™¨åœ°å€</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">sockaddr_in</span> server_addr;</span><br><span class="line">server_addr.sin_family = AF_INET;</span><br><span class="line">server_addr.sin_port = <span class="built_in">htons</span>(<span class="number">9527</span>);  <span class="comment">// æœåŠ¡å™¨ç«¯çš„ç«¯å£å·</span></span><br><span class="line">server_addr.sin_addr.s_addr = <span class="built_in">inet_addr</span>(<span class="string">&quot;192.168.0.1&quot;</span>);  <span class="comment">// æœåŠ¡å™¨çš„ IP åœ°å€</span></span><br></pre></td></tr></table></figure><p>â‘¢è¿æ¥æœåŠ¡å™¨ï¼ˆconnectï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">connect</span>(sockfd, (<span class="keyword">struct</span> sockaddr*)&amp;server_addr, <span class="built_in">sizeof</span>(server_addr));</span><br></pre></td></tr></table></figure><p>â‘£æ•°æ®äº¤æ¢read()&#x2F;write()</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">write</span>(sockfd, <span class="string">&quot;Hello, Server!&quot;</span>, <span class="number">15</span>);  <span class="comment">// å‘æœåŠ¡å™¨å‘é€æ•°æ®</span></span><br><span class="line"><span class="built_in">read</span>(sockfd, buffer, <span class="built_in">sizeof</span>(buffer));  <span class="comment">// ä»æœåŠ¡å™¨è¯»å–æ•°æ®</span></span><br></pre></td></tr></table></figure><p>â‘¤æ–­å¼€è¿æ¥close()    å…³é—­æœåŠ¡å™¨å¥—æ¥å­—</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">close</span>(sockfd);</span><br></pre></td></tr></table></figure><p><strong>å®¢æˆ·ç«¯å¥—æ¥å­—åœ°å€ä¿¡æ¯åœ¨å“ªé‡Œ</strong>ï¼Ÿ</p><p>ç½‘ç»œæ•°æ®äº¤æ¢å¿…é¡»åˆ†é…IPå’Œç«¯å£ã€‚  è°ƒç”¨connectå‡½æ•°æ—¶ï¼Œåœ¨æ“ä½œç³»ç»Ÿå†…æ ¸ IPä½¿ç”¨è®¡ç®—æœºçš„IPï¼Œç«¯å£éšæœº</p><p>å³ å®¢æˆ·ç«¯IPåœ°å€å’Œç«¯å£åœ¨è°ƒç”¨connectå‡½æ•°æ—¶è‡ªåŠ¨åˆ†é…ï¼Œæ— éœ€è°ƒç”¨æ ‡è®°çš„bindå‡½æ•°è¿›è¡Œåˆ†é…ã€‚</p><p>å®¢æˆ·ç«¯åœ¨listenä¹‹å  closeä¹‹å‰connectæ‰æœ‰æ•ˆ</p><p><strong>è¿­ä»£æœåŠ¡å™¨</strong></p><p>æ™®é€šæœåŠ¡å™¨TCPçš„ç¼ºç‚¹ï¼šå¯åŠ¨ä¸€æ¬¡æœåŠ¡ç¨‹åºï¼Œåªèƒ½ç»™ä¸€ä¸ªå®¢æˆ·ç«¯æœåŠ¡ã€‚è¿­ä»£æœåŠ¡å™¨æ¯”è¾ƒåŸå§‹ï¼Œå®ƒçš„åŸå‹å¯ä»¥æè¿°æˆï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">    new_fd = æœåŠ¡å™¨ acceptå®¢æˆ·ç«¯çš„è¿æ¥(new_fd = <span class="built_in">accept</span>(listenfd,xx,xx));</span><br><span class="line">    <span class="comment">//é€»è¾‘å¤„ç†</span></span><br><span class="line">    <span class="comment">// åœ¨è¿™ä¸ªnew_fdä¸Šç»™å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span></span><br><span class="line">    <span class="comment">// å…³é—­new_fd</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åŸºæœ¬å·¥ä½œæµç¨‹</strong></p><ol><li><strong>ç­‰å¾…è¿æ¥</strong> ï¼šæœåŠ¡å™¨ä¼šä¸€ç›´ç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥ã€‚</li><li><strong>æ¥å—è¿æ¥</strong> ï¼šå½“å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæ¥å—è¿æ¥å¹¶å»ºç«‹ä¸€ä¸ªæ–°çš„å¥—æ¥å­—ä¸å®¢æˆ·ç«¯é€šä¿¡ã€‚</li><li><strong>å¤„ç†è¯·æ±‚</strong> ï¼šæœåŠ¡å™¨ä¼šå¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œæ‰§è¡Œä¸€äº›æ“ä½œï¼Œæˆ–è€…æä¾›ä¸€äº›æœåŠ¡ã€‚</li><li><strong>å…³é—­è¿æ¥</strong> ï¼šå¤„ç†å®Œä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚åï¼ŒæœåŠ¡å™¨å…³é—­ä¸è¯¥å®¢æˆ·ç«¯çš„è¿æ¥ã€‚</li><li><strong>ç»§ç»­ç­‰å¾…</strong> ï¼šæœåŠ¡å™¨å›åˆ°ç›‘å¬çŠ¶æ€ï¼Œç­‰å¾…ä¸‹ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚</li></ol><p><strong>writeå‡½æ•°å’Œreadå‡½æ•°</strong></p><p>â‘ writeå‡½æ•°   <code>ssize_t write(int fd, const void *buf, size_t count);</code></p><p><code>write</code>å‡½æ•°ç”¨äºå‘æ–‡ä»¶æè¿°ç¬¦<code>fd</code>æ‰€æŒ‡å‘çš„æ–‡ä»¶ã€å¥—æ¥å­—æˆ–å…¶ä»–I&#x2F;Oè®¾å¤‡ä¸­å†™å…¥æ•°æ®ã€‚</p><h3 id="TCPåº•å±‚åŸç†"><a href="#TCPåº•å±‚åŸç†" class="headerlink" title="TCPåº•å±‚åŸç†"></a>TCPåº•å±‚åŸç†</h3><p><code>write</code>å‡½æ•°è°ƒç”¨åå¹¶éç«‹å³ä¼ è¾“æ•°æ®ï¼Œreadå‡½æ•°è°ƒç”¨åä¹Ÿå¹¶éé©¬ä¸Šæ¥æ”¶æ•°æ®ã€‚<code>write</code>å‡½æ•°è°ƒç”¨ç¬é—´ï¼Œæ•°æ®å°†ç§»è‡³è¾“å‡ºç¼“å†²ï¼›<code>read</code>å‡½æ•°è°ƒç”¨ç¬é—´ï¼Œä»è¾“å…¥ç¼“å†²è¯»å–æ•°æ®ã€‚</p><p>Aï¼šI&#x2F;Oç¼“å†²åœ¨æ¯ä¸ªå¥—æ¥å­—ä¸­å•ç‹¬å­˜åœ¨ã€‚</p><p>Bï¼šI&#x2F;Oç¼“å†²åœ¨åˆ›å»ºå¥—æ¥å­—æ—¶è‡ªåŠ¨ç”Ÿæˆã€‚</p><p>Cï¼šå³ä½¿å…³é—­å¥—æ¥å­—ä¹Ÿä¼š<strong>ç»§ç»­ä¼ é€’è¾“å‡ºç¼“å†²ä¸­é—ç•™çš„æ•°æ®</strong>ã€‚</p><p>Dï¼šå…³é—­å¥—æ¥å­—å°†ä¸¢å¤±è¾“å…¥ç¼“å†²ä¸­çš„æ•°æ®ã€‚</p><p>â€œå®¢æˆ·ç«¯è¾“å…¥ç¼“å†²50å­—èŠ‚ï¼Œè€ŒæœåŠ¡å™¨ç«¯ä¼ è¾“äº†100å­—èŠ‚ã€‚â€</p><p>å¡«æ»¡è¾“å…¥ç¼“å†²å‰è¿…é€Ÿè°ƒç”¨readå‡½æ•°è¯»å–æ•°æ®ï¼Œå°±èƒ½è…¾å‡ºä¸€éƒ¨åˆ†ç©ºé—´ï¼Œé—®é¢˜å°±è§£å†³äº†ã€‚</p><p>å…¶å®ä¸ä¼šå‘ç”Ÿè¿™ç±»é—®é¢˜ï¼Œå› ä¸ºTCPä¼šæ§åˆ¶æ•°æ®æµã€‚TCPæœ‰æ»‘åŠ¨çª—å£åè®®ã€‚</p><p><strong>æ•°æ®æ”¶å‘ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå› æ­¤TCPä¸­ä¸ä¼šå› ä¸ºç¼“å†²æº¢å‡ºè€Œä¸¢å¤±æ•°æ®ã€‚</strong></p><p><strong>ä½†æ˜¯ä¼šå› ä¸ºç¼“å†²è€Œå½±å“ä¼ è¾“æ•ˆç‡ã€‚</strong></p><h4 id="TCPå†…éƒ¨åŸç†"><a href="#TCPå†…éƒ¨åŸç†" class="headerlink" title="TCPå†…éƒ¨åŸç†"></a>TCPå†…éƒ¨åŸç†</h4><p><strong>TCPé€šä¿¡çš„ä¸‰å¤§æ­¥éª¤</strong></p><ol><li>ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥ï¼›</li><li>å¼€å§‹é€šä¿¡ï¼Œè¿›è¡Œæ•°æ®äº¤æ¢ï¼›</li><li>å››æ¬¡æŒ¥æ‰‹æ–­å¼€è¿æ¥ï¼›</li></ol><p>åˆ©ç”¨TCPä¸‰æ¬¡æ¡æ‰‹è¿›è¡Œæ”»å‡»ã€‚</p><p>æ–­å¼€è¿æ¥æœ‰å¯èƒ½å¡åœ¨ä¸­é—´ä¸¤æ¬¡å‘æ•°æ®åŒ…çš„åœ°æ–¹ã€‚</p><h3 id="UDPç¼–ç¨‹"><a href="#UDPç¼–ç¨‹" class="headerlink" title="UDPç¼–ç¨‹"></a>UDPç¼–ç¨‹</h3><h4 id="UDPåŸºæœ¬åŸç†"><a href="#UDPåŸºæœ¬åŸç†" class="headerlink" title="UDPåŸºæœ¬åŸç†"></a>UDPåŸºæœ¬åŸç†</h4><p>4å±‚TCP&#x2F;IPæ¨¡å‹ä¸­ï¼Œç¬¬äºŒå±‚ä¼ è¾“å±‚åˆ†ä¸ºTCPå’ŒUDPã€‚</p><p>åªè€ƒè™‘å¯é æ€§ï¼ŒTCPæ¯”UDPæ›´å¥½ã€‚ä½†UDPåœ¨ç»“æ„ä¸Šæ¯”TCPæ›´ç®€æ´ã€‚UDPä¸ä¼šå‘é€ç±»ä¼¼ACKçš„åº”ç­”æ¶ˆæ¯ï¼Œä¹Ÿä¸ä¼šæƒ³SEQé‚£æ ·ç»™æ•°æ®åŒ…åˆ†é…åºå·ã€‚å› æ­¤UDPçš„æ€§èƒ½æœ‰æ—¶æ¯”TCPé«˜å‡ºå¾ˆå¤šã€‚</p><p>ä¸ºäº†æä¾›å¯é çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼ŒTCPåœ¨ä¸å¯é çš„IPå±‚è¿›è¡Œæµæ§åˆ¶ï¼Œè€ŒUDPå°±ç¼ºå°‘è¿™ç§æµæ§åˆ¶æœºåˆ¶ã€‚</p><p>TCPçš„é€Ÿåº¦æ— æ³•è¶…è¿‡UDPï¼Œä½†åœ¨æ”¶å‘æŸäº›ç±»å‹çš„æ•°æ®æ—¶æœ‰å¯èƒ½æ¥è¿‘UDPã€‚ä¾‹å¦‚ï¼Œæ¯æ¬¡äº¤æ¢çš„æ•°æ®é‡è¶Šå¤§ï¼ŒTCPçš„ä¼ è¾“é€Ÿç‡è¶Šæ¥è¿‘UDPçš„ä¼ è¾“é€Ÿç‡ã€‚</p><p><strong>TCPæ¯”UDPæ…¢çš„åŸå› </strong></p><p>â‘  æ”¶å‘æ•°æ®å‰åè¿›è¡Œçš„è¿æ¥è®¾ç½®åŠæ¸…é™¤è¿‡ç¨‹ã€‚</p><p>â‘¡ æ”¶å‘æ•°æ®è¿‡ç¨‹ä¸­ä¸ºä¿è¯å¯é æ€§è€Œæ·»åŠ çš„æµæ§åˆ¶ã€‚</p><p><strong>UDP æœåŠ¡ç«¯</strong></p><p>UDP   æœåŠ¡å™¨&#x2F;å®¢æˆ·ç«¯ä¸åƒTCPé‚£æ ·åœ¨è¿æ¥çŠ¶æ€ä¸‹äº¤æ¢æ•°æ®ï¼Œå› æ­¤ä¸TCPä¸åŒï¼Œæ— éœ€ç»è¿‡è¿æ¥è¿‡ç¨‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å¿…è°ƒç”¨TCPè¿æ¥è¿‡ç¨‹ä¸­è°ƒç”¨çš„listenå‡½æ•°å’Œacceptå‡½æ•°ã€‚UDPä¸­åªæœ‰<strong>åˆ›å»ºå¥—æ¥å­—çš„è¿‡ç¨‹å’Œæ•°æ®äº¤æ¢çš„è¿‡ç¨‹</strong>ã€‚</p><p>UDPçš„æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½åªéœ€è¦ä¸€ä¸ªå¥—æ¥å­—ï¼Œè€ŒTCPä¸­ï¼Œå¥—æ¥å­—ä¹‹é—´æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ã€‚è‹¥è¦å‘10ä¸ªå®¢æˆ·ç«¯æä¾›æœåŠ¡ï¼Œåˆ™é™¤äº†å®ˆé—¨çš„æœåŠ¡å™¨å¥—æ¥å­—å¤–ï¼Œè¿˜éœ€è¦10ä¸ªæœåŠ¡å™¨ç«¯å¥—æ¥å­—ã€‚</p><p>UDPå¥—æ¥å­—ç»‘å®šæœ¬åœ°çš„IPåœ°å€å’Œç«¯å£å·ï¼Œè¿™ä¸ªå¥—æ¥å­—å°±å¯ä»¥æ¥å—æ¥è‡ªä»»ä½•ä¸»æœºå‘é€åˆ°è¯¥ç«¯å£çš„æ•°æ®æŠ¥ã€‚</p><p>åˆ›å»ºå¥½TCPå¥—æ¥å­—åï¼Œä¼ è¾“æ•°æ®æ—¶æ— éœ€å†æ·»åŠ åœ°å€ä¿¡æ¯ã€‚ä½†æ˜¯UDPå¥—æ¥å­—ä¸ä¼šä¿æŒè¿æ¥çŠ¶æ€ï¼ˆUDPå¥—æ¥å­—åªæœ‰ç®€å•çš„é‚®ç­’åŠŸèƒ½ï¼‰ï¼Œå› æ­¤æ¯æ¬¡ä¼ è¾“æ•°æ®éƒ½è¦æ·»åŠ ç›®æ ‡åœ°å€ä¿¡æ¯ã€‚è¿™ç›¸å½“äºå¯„ä¿¡å‰åœ¨ä¿¡ä»¶ä¸­å¡«å†™åœ°å€ã€‚å¡«å†™åœ°å€å¹¶ä¼ è¾“æ•°æ®æ—¶è°ƒç”¨çš„UDPç›¸å…³å‡½æ•°ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">ssize_t</span> <span class="title">sendto</span><span class="params">(<span class="type">int</span> sock,<span class="type">void</span>*buff,<span class="type">size_t</span> nbytes,<span class="type">int</span> flags,<span class="keyword">struct</span> sockaddr *to, <span class="type">socklen_t</span> addrlen)</span></span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">sock     ç”¨äºä¼ è¾“æ•°æ®çš„UDPå¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦ã€‚</span></span><br><span class="line"><span class="comment">buff     ä¿å­˜å¾…ä¼ è¾“æ•°æ®çš„ç¼“å†²åœ°å€å€¼ã€‚</span></span><br><span class="line"><span class="comment">nbytes   å¾…ä¼ è¾“çš„æ•°æ®é•¿åº¦ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ã€‚</span></span><br><span class="line"><span class="comment">flags    å¯é€‰é¡¹å‚æ•°ï¼Œè‹¥æ²¡æœ‰åˆ™ä¼ é€’0ã€‚</span></span><br><span class="line"><span class="comment">to       å­˜æœ‰ç›®æ ‡åœ°å€ä¿¡æ¯çš„sockaddrç»“æ„ä½“å˜é‡çš„åœ°å€å€¼</span></span><br><span class="line"><span class="comment">addrlen  ä¼ é€’ç»™å‚æ•°toçš„åœ°å€å€¼ç»“æ„ä½“å˜é‡é•¿åº¦ã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">ä¸Šè¿°å‡½æ•°ä¸ä¹‹å‰çš„TCPè¾“å‡ºå‡½æ•°æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼Œæ­¤å‡½æ•°éœ€è¦å‘å®ƒä¼ é€’ç›®æ ‡åœ°å€ä¿¡æ¯ã€‚æ¥ä¸‹æ¥ä»‹ç»æ¥æ”¶UDPæ•°æ®çš„å‡½æ•°ã€‚UDPæ•°æ®çš„å‘é€ç«¯å¹¶ä¸å›ºå®šï¼Œå› æ­¤è¯¥å‡½æ•°å®šä¹‰ä¸ºå¯æ¥æ”¶å‘é€ç«¯ä¿¡æ¯çš„å½¢å¼ï¼Œä¹Ÿå°±æ˜¯å°†åŒæ—¶è¿”å›UDPæ•°æ®åŒ…ä¸­çš„å‘é€ç«¯ä¿¡æ¯ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">ssize_t</span> <span class="title">recvfrom</span><span class="params">(<span class="type">int</span> sock,  <span class="type">void</span> *buff,<span class="type">size_t</span> nbytes,  <span class="type">int</span> flags,</span></span></span><br><span class="line"><span class="params"><span class="function">                 <span class="keyword">struct</span> sockaddr*from,   <span class="type">socklen_t</span>*addrlen)</span></span>;</span><br><span class="line"><span class="comment">// â†’æˆåŠŸæ—¶è¿”å›æ¥æ”¶çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥æ—¶è¿”å›-1ã€‚</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">sockç”¨äºæ¥æ”¶æ•°æ®çš„UDPå¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦ã€‚</span></span><br><span class="line"><span class="comment">buffä¿å­˜æ¥æ”¶æ•°æ®çš„ç¼“å­˜åœ°å€å€¼</span></span><br><span class="line"><span class="comment">nbytes å¯æ¥æ”¶çš„æœ€å¤§å­—èŠ‚æ•°ï¼Œæ•…æ— æ³•è¶…è¿‡å‚æ•°bufæ‰€æŒ‡çš„ç¼“å†²å¤§å°ã€‚</span></span><br><span class="line"><span class="comment">flagså¯é€‰é¡¹å‚æ•°ï¼Œè‹¥æ²¡æœ‰åˆ™ä¼ å…¥0ã€‚</span></span><br><span class="line"><span class="comment">fromå­˜æœ‰å‘é€ç«¯åœ°å€ä¿¡æ¯çš„sockaddrç»“æ„ä½“å˜é‡çš„åœ°å€å€¼ã€‚</span></span><br><span class="line"><span class="comment">addrlen ä¿å­˜å‚æ•°fromçš„ç»“æ„ä½“å˜é‡é•¿åº¦çš„å˜é‡åœ°å€å€¼ã€‚</span></span><br><span class="line"><span class="comment">ç¼–å†™UDPç¨‹åºæ—¶æœ€æ ¸å¿ƒçš„éƒ¨åˆ†å°±åœ¨äºä¸Šè¿°ä¸¤ä¸ªå‡½æ•°ï¼Œè¿™ä¹Ÿè¯´æ˜äºŒè€…åœ¨UDPæ•°æ®ä¼ è¾“ä¸­çš„åœ°ä½ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>UDPç›¸å…³çš„å‡½æ•°</p><p>DDosæ”»å‡»å¤§å¤šåˆ©ç”¨UDP</p><p><strong>å‘ç”Ÿåœ°å€åˆ†é…é”™è¯¯</strong>ï¼ˆé‡ç‚¹ï¼‰</p><p>å®¢æˆ·ç«¯æ˜¯connectï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°bind  failedï¼Œå› ä¸ºæœ‰å‡ ä¸‡ä¸ªç«¯å£å¯ä»¥ç”¨ï¼Œæ‰€ä»¥connectå¤±è´¥å¾ˆéš¾</p><p><strong>I&#x2F;Oç¼“å†²åŒºå¤§å°</strong></p><p><strong>TCP_NODELAY</strong></p><p>ç›‘æ§é”®ç›˜çš„è¾“å…¥</p><h3 id="Linuxç³»ç»Ÿç¼–ç¨‹ï¼šè¿›ç¨‹"><a href="#Linuxç³»ç»Ÿç¼–ç¨‹ï¼šè¿›ç¨‹" class="headerlink" title="Linuxç³»ç»Ÿç¼–ç¨‹ï¼šè¿›ç¨‹"></a>Linuxç³»ç»Ÿç¼–ç¨‹ï¼šè¿›ç¨‹</h3><h4 id="å¹¶å‘æœåŠ¡å™¨çš„å®ç°æ–¹æ³•"><a href="#å¹¶å‘æœåŠ¡å™¨çš„å®ç°æ–¹æ³•" class="headerlink" title="å¹¶å‘æœåŠ¡å™¨çš„å®ç°æ–¹æ³•"></a>å¹¶å‘æœåŠ¡å™¨çš„å®ç°æ–¹æ³•</h4><p>ä½¿å…¶åŒæ—¶ç›¸æ‰€æœ‰å‘èµ·è¯·æ±‚çš„å®¢æˆ·ç«¯æä¾›æœåŠ¡ï¼Œä»¥æé«˜å¹³å‡æ»¡æ„åº¦ã€‚</p><p>è€Œä¸”ï¼Œ<strong>ç½‘ç»œç¨‹åºä¸­æ•°æ®é€šä¿¡æ—¶é—´æ¯”CPUè¿ç®—æ—¶é—´å æ¯”æ›´å¤§ï¼Œå› æ­¤ï¼Œå‘å¤šä¸ªå®¢æˆ·ç«¯æä¾›æœåŠ¡æ˜¯ä¸€ç§æœ‰æ•ˆåˆ©ç”¨CPUçš„æ–¹å¼ã€‚</strong></p><ol><li>å¤šè¿›ç¨‹æœåŠ¡å™¨ï¼šé€šè¿‡åˆ›å»ºå¤šä¸ªè¿›ç¨‹æä¾›æœåŠ¡ã€‚</li><li>å¤šè·¯å¤ç”¨æœåŠ¡å™¨ï¼šé€šè¿‡æ†ç»‘å¹¶ç»Ÿä¸€ç®¡ç†I&#x2F;Oå¯¹è±¡æä¾›æœåŠ¡ã€‚</li><li>å¤šçº¿ç¨‹æœåŠ¡å™¨ï¼šé€šè¿‡ç”Ÿæˆä¸å®¢æˆ·ç«¯ç­‰é‡çš„çº¿ç¨‹æä¾›æœåŠ¡ã€‚</li></ol><p><strong>è¿›ç¨‹</strong>ï¼šå ç”¨å†…å­˜ç©ºé—´æ­£åœ¨è¿è¡Œçš„ç¨‹åº å°±æ˜¯è¿›ç¨‹</p><p>ä»æ“ä½œç³»ç»Ÿçš„è§’åº¦æ¥çœ‹ï¼Œ<strong>è¿›ç¨‹æ˜¯ç¨‹åºæµçš„åŸºæœ¬å•ä½</strong>ï¼Œè‹¥åˆ›å»ºå¤šä¸ªè¿›ç¨‹ï¼Œåˆ™æ“ä½œç³»ç»Ÿå°†åŒæ—¶è¿è¡Œã€‚æœ‰æ—¶å€™ä¸€ä¸ªç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ä¹Ÿä¼šäº§ç”Ÿå¤šä¸ªè¿›ç¨‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cpp13å¸¸è§é—®é¢˜</title>
      <link href="/2024/12/11/cpp13%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/"/>
      <url>/2024/12/11/cpp13%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h4 id="ä¸€ã€æŒ‡é’ˆå’Œå¼•ç”¨çš„åŒºåˆ«"><a href="#ä¸€ã€æŒ‡é’ˆå’Œå¼•ç”¨çš„åŒºåˆ«" class="headerlink" title="ä¸€ã€æŒ‡é’ˆå’Œå¼•ç”¨çš„åŒºåˆ«"></a><strong>ä¸€ã€æŒ‡é’ˆå’Œå¼•ç”¨çš„åŒºåˆ«</strong></h4><p><strong>â‘    å®šä¹‰å’Œæ¦‚å¿µ</strong></p><p>æŒ‡é’ˆï¼šæŒ‡é’ˆæ˜¯ä¸€ä¸ªå˜é‡ï¼Œå…¶å€¼ä¸ºå¦ä¸€ä¸ªå˜é‡çš„åœ°å€ã€‚æŒ‡é’ˆæœ¬è´¨ä¸Šæ˜¯å­˜å‚¨å†…å­˜åœ°å€çš„å˜é‡</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span>* p = &amp;a;  <span class="comment">// p æ˜¯æŒ‡é’ˆï¼Œå­˜å‚¨açš„åœ°å€</span></span><br></pre></td></tr></table></figure><p>å¼•ç”¨ï¼šå¼•ç”¨æ˜¯ä¸€ä¸ªåˆ«åï¼Œå®ƒä¸ºå·²æœ‰çš„å˜é‡åˆ›å»ºä¸€ä¸ªæ–°çš„åå­—ã€‚å¼•ç”¨åˆå§‹åŒ–å¿…é¡»ä¸æŸä¸ªå˜é‡ç»‘å®šï¼Œå¹¶ä¸”ä¸€æ—¦ç»‘å®šä¹‹åä¸èƒ½å†ç»‘å®šåˆ°å…¶ä»–å˜é‡ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a  = <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span>&amp; ref = a;  <span class="comment">// refæ˜¯ açš„å¼•ç”¨ï¼Œç›¸å½“äºaçš„åˆ«åã€‚</span></span><br></pre></td></tr></table></figure><p><strong>â‘¡   è¯­æ³•å·®å¼‚</strong> </p><p>æŒ‡é’ˆè¯­æ³•ï¼šå£°æ˜æŒ‡é’ˆæ—¶å€™ä½¿ç”¨<code>*</code>ç¬¦å·ã€è·å–æŒ‡é’ˆæŒ‡å‘çš„å˜é‡çš„å€¼éœ€è¦ä½¿ç”¨è§£å¼•ç”¨æ“ä½œç¬¦<code>*</code>ã€éœ€è¦æ˜¾å¼åœ°è¿›è¡Œåœ°å€èµ‹å€¼ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span>* p = &amp;a;  <span class="comment">// &amp;a è¡¨ç¤ºè·å–açš„åœ°å€</span></span><br><span class="line"><span class="type">int</span> value = *p; <span class="comment">// *pè¡¨ç¤ºè§£å¼•ç”¨ï¼Œå¾—åˆ°açš„å€¼</span></span><br></pre></td></tr></table></figure><p>å¼•ç”¨çš„è¯­æ³•ï¼šå£°æ˜å¼•ç”¨ä½¿ç”¨<code>&amp;</code>ç¬¦å·ã€å¼•ç”¨åƒæ™®é€šå˜é‡ä¸€æ ·ä½¿ç”¨ï¼Œä¸éœ€è¦ä½¿ç”¨è§£å¼•ç”¨æ“ä½œç¬¦ã€å¼•ç”¨å¿…é¡»åœ¨å£°æ˜æ—¶è¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶ä¸”æ— æ³•æ›´æ”¹å¼•ç”¨çš„å¯¹è±¡ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span>&amp; ref = a;   <span class="comment">// ref æ˜¯ a çš„å¼•ç”¨</span></span><br><span class="line">ref = <span class="number">20</span>;<span class="comment">// æ”¹å˜açš„å€¼ä¸º20</span></span><br></pre></td></tr></table></figure><p><strong>â‘¢  æ˜¯å¦å…è®¸ä¸ºç©ºå€¼</strong></p><p>æŒ‡é’ˆå¯ä»¥ä¸º<code>nullptr</code>ï¼Œè¿™æ„å‘³ç€æŒ‡é’ˆä¸æŒ‡å‘ä»»ä½•æœ‰æ•ˆçš„å†…å­˜åœ°å€ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>* p = <span class="literal">nullptr</span>;</span><br></pre></td></tr></table></figure><p>å¼•ç”¨å¿…é¡»å§‹ç»ˆç»‘å®šåˆ°ä¸€ä¸ªæœ‰æ•ˆçš„å˜é‡ã€‚å¼•ç”¨ä¸èƒ½æ˜¯ç©ºçš„ï¼Œå› æ­¤åœ¨åˆ›å»ºå¼•ç”¨æ—¶å¿…é¡»ç¡®ä¿å®ƒç»‘å®šåˆ°ä¸€ä¸ªæœ‰æ•ˆçš„å˜é‡ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span>&amp; ref = a;  <span class="comment">// refå¿…é¡»å¼•ç”¨ä¸€ä¸ªå·²åˆå§‹åŒ–çš„å˜é‡</span></span><br></pre></td></tr></table></figure><p><strong>â‘£  æ˜¯å¦å¯ä»¥é‡æ–°ç»‘å®š</strong></p><p>â€‹æŒ‡é’ˆå¯ä»¥åœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­é‡æ–°æŒ‡å‘ä¸åŒçš„å˜é‡ã€‚æŒ‡é’ˆæ˜¯åŠ¨æ€å¯å˜çš„ã€‚</p><p>â€‹å¼•ç”¨ä¸€æ—¦ç»‘å®šäº†æŸä¸ªå˜é‡ï¼Œå°±ä¸èƒ½å†æ”¹å˜å¼•ç”¨çš„å¯¹è±¡ï¼Œå¼•ç”¨çš„ç»‘å®šæ˜¯å›ºå®šçš„ã€‚</p><p><strong>â‘¤  å†…å­˜åˆ†é…</strong></p><p>æŒ‡é’ˆæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å˜é‡ï¼Œå®ƒéœ€è¦å ç”¨å†…å­˜å­˜å‚¨åœ°å€ã€‚å› æ­¤ï¼ŒæŒ‡é’ˆæœ¬èº«éœ€è¦å†…å­˜ç©ºé—´ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span>* p = &amp;a;  <span class="comment">// pæ˜¯æŒ‡é’ˆï¼Œéœ€è¦ä¸ºpåˆ†é…å†…å­˜ç©ºé—´</span></span><br></pre></td></tr></table></figure><p>å¼•ç”¨æœ¬èº«ä¸å ç”¨é¢å¤–çš„å†…å­˜ç©ºé—´ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å˜é‡çš„åˆ«åã€‚å¼•ç”¨çš„å®ç°é€šå¸¸æ˜¯é€šè¿‡æŒ‡é’ˆæ¥å®ç°çš„ï¼Œä½†ä»è¯­æ³•ä¸Šå®ƒæ²¡æœ‰æŒ‡é’ˆçš„è¡¨ç°ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span>&amp; ref = a;  <span class="comment">// refåªæ˜¯açš„åˆ«åï¼Œä¸éœ€è¦é¢å¤–çš„å†…å­˜</span></span><br></pre></td></tr></table></figure><p><strong>â‘¥  ä½¿ç”¨åœºæ™¯</strong></p><p>æŒ‡é’ˆä½¿ç”¨äºéœ€è¦åŠ¨æ€ç®¡ç†å†…å­˜ã€åœ¨å‡½æ•°é—´ä¼ é€’å¤§é‡æ•°æ®æ—¶ï¼Œç‰¹åˆ«æ˜¯åœ¨å¯¹è±¡åŠ¨æ€åˆ†é…ã€é“¾è¡¨ã€æ ‘ç­‰æ•°æ®ç»“æ„çš„å®ç°</p><p>æŒ‡é’ˆå¯ä»¥è¿›è¡ŒæŒ‡é’ˆè¿ç®—ï¼Œä¾‹å¦‚åŠ å‡æ“ä½œï¼Œè®¿é—®æ•°ç»„å…ƒç´ ç­‰ã€‚</p><p>å¼•ç”¨ é€šå¸¸ç”¨äºå‡½æ•°å‚æ•°ä¼ é€’ï¼ˆå°¤å…¶æ˜¯ä¼ é€’å¤§å¯¹è±¡æˆ–è€…éœ€è¦ä¿®æ”¹å‚æ•°çš„æƒ…å†µä¸‹ï¼‰ï¼Œå¼•ç”¨ä½¿å¾—å‡½æ•°è°ƒç”¨æ›´åŠ ç®€ä»‹å¹¶ä¸”é¿å…äº†æ‹·è´ çš„å¼€é”€ã€‚</p><p>å¼•ç”¨å¸¸ç”¨äºè¿”å›å¯¹è±¡çš„å¼•ç”¨ï¼Œæˆ–è€…ä½œä¸ºè¾“å‡ºå‚æ•°çš„æ›¿ä»£ã€‚</p><p><strong>â‘¦  å®‰å…¨æ€§</strong></p><p>æŒ‡é’ˆçš„å®‰å…¨æ€§è¾ƒå·®ï¼Œå®¹æ˜“å‘ç”Ÿç©ºæŒ‡é’ˆå¼•ç”¨ã€æ‚¬æŒ‚æŒ‡é’ˆç­‰é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæŒ‡é’ˆåœ¨ä½¿ç”¨åæ²¡æœ‰åŠæ—¶åˆå§‹åŒ–ä¸º<code>nullptr</code>ï¼Œå¯èƒ½ä¼šè®¿é—®éæ³•å†…å­˜ã€‚</p><p>å¼•ç”¨çš„å®‰å…¨æ€§è¾ƒé«˜ï¼Œå› ä¸ºå¼•ç”¨å§‹ç»ˆå¿…é¡»ç»‘å®šåˆ°ä¸€ä¸ªæœ‰æ•ˆå¯¹è±¡ï¼Œä¸”ä¸èƒ½ä¸º<code>nullptr</code> ï¼Œ è¿™å‡å°‘äº†è®¿é—®æ— æ•ˆå†…å­˜çš„é£é™©ã€‚</p><p><strong>â‘§  æ˜¯å¦å¯ä»¥è¢«å¸¸é‡ä¿®é¥°</strong></p><p>æŒ‡é’ˆå¯ä»¥è¢«<code>const</code>ä¿®é¥°ï¼ŒæŒ‡é’ˆæœ¬èº«ã€æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹éƒ½å¯ä»¥æ˜¯å¸¸é‡ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//const å˜é‡ç±»å‹*  åªèƒ½æŒ‡å‘ä¸€ä¸ªå¸¸é‡</span></span><br><span class="line"><span class="comment">// ç‰¹ç‚¹ï¼ŒæŒ‡é’ˆçš„æŒ‡å‘å¯ä»¥ä¿®æ”¹ï¼Œä½†æ˜¯æŒ‡é’ˆæŒ‡å‘çš„å€¼ä¸å¯ä»¥ä¿®æ”¹</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> a&#123; <span class="number">100</span> &#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> b&#123; <span class="number">200</span> &#125;;</span><br><span class="line"><span class="type">int</span> c&#123; <span class="number">300</span> &#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span>* p&#123; &amp;a &#125;;</span><br><span class="line"><span class="comment">// *p = 500;  ä¸å¯ä»¥ä¿®æ”¹å€¼</span></span><br><span class="line">std::cout &lt;&lt; *p &lt;&lt; std::endl;</span><br><span class="line">p = &amp;b;  <span class="comment">// å¯ä»¥ä¿®æ”¹æŒ‡å‘</span></span><br><span class="line">p = &amp;c;  <span class="comment">// å¸¸é‡æŒ‡é’ˆä¹Ÿå¯ä»¥æŒ‡å‘éå¸¸é‡å˜é‡</span></span><br><span class="line"><span class="comment">// *p = 2000;  å¸¸é‡æŒ‡é’ˆå°±æ˜¯ä¸è®©æ”¹</span></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç‰¹ç‚¹ï¼šæŒ‡é’ˆçš„æŒ‡å‘ä¸å¯ä»¥æ”¹ï¼ŒæŒ‡é’ˆæŒ‡å‘çš„å€¼å¯ä»¥æ”¹ï¼ˆå†…å­˜ä¸­çš„æ•°æ®å¯ä»¥æ›´æ”¹ï¼‰</span></span><br><span class="line"><span class="type">int</span> a&#123; <span class="number">100</span> &#125;;</span><br><span class="line"><span class="type">int</span> b&#123; <span class="number">200</span> &#125;;</span><br><span class="line"><span class="type">int</span>* <span class="type">const</span> p&#123; &amp;a &#125;;</span><br><span class="line"><span class="comment">//p = &amp;b;   ä¸èƒ½ä¿®æ”¹æŒ‡å‘</span></span><br><span class="line">*p = <span class="number">999</span>;  <span class="comment">//å¯ä»¥ä¿®æ”¹æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜ç©ºé—´</span></span><br><span class="line">std::cout &lt;&lt; a &lt;&lt; std::endl; <span class="comment">//  è¿™æ—¶å€™aè¾“å‡º 999ï¼›</span></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//const å˜é‡ç±»å‹* const</span></span><br><span class="line"><span class="comment">//ç‰¹ç‚¹ï¼šæŒ‡é’ˆçš„æŒ‡å‘å’ŒæŒ‡é’ˆæŒ‡å‘çš„å€¼éƒ½ä¸å¯ä»¥ä¿®æ”¹ </span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> a&#123; <span class="number">100</span> &#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> b&#123; <span class="number">200</span> &#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span>* <span class="type">const</span> p&#123; &amp;a &#125;;</span><br><span class="line"><span class="comment">//p = &amp;b;  ä¸èƒ½ä¿®æ”¹æŒ‡å‘</span></span><br><span class="line"><span class="comment">//*p = 999;  ä¸èƒ½ä¿®æ”¹å†…å­˜ç©ºé—´é‡Œé¢çš„å€¼</span></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> a&#123; <span class="number">100</span> &#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> b&#123; <span class="number">200</span> &#125;;</span><br><span class="line"><span class="comment">//int* pa&#123; &amp;a &#125;;   å¸¸é‡</span></span><br><span class="line"><span class="type">int</span>* pa&#123; (<span class="type">int</span>*)&amp;a &#125;;   <span class="comment">//é€šè¿‡è½¬æ¢æ˜¯å¯ä»¥çš„</span></span><br><span class="line">*p = <span class="number">9500</span>;<span class="comment">//è¿™ç§æ“ä½œæ˜¯å…è®¸çš„ï¼Œä½†æ˜¯açš„å€¼ä¸å˜</span></span><br><span class="line">std::cout &lt;&lt; *pa &lt;&lt; std::endl;</span><br></pre></td></tr></table></figure><p>å¼•ç”¨å¯ä»¥æ˜¯å¸¸é‡å¼•ç”¨ï¼Œè¡¨ç¤ºä¸èƒ½ä¿®æ”¹å¼•ç”¨çš„å¯¹è±¡ï¼Œä½†å¼•ç”¨æœ¬èº«æ— æ³•ä¿®æ”¹ä¸ºæŒ‡å‘å…¶ä»–å¯¹è±¡ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span>&amp; ref = a;  <span class="comment">// refæ˜¯å¸¸é‡å¼•ç”¨ï¼Œä¸èƒ½ä¿®æ”¹açš„å€¼</span></span><br></pre></td></tr></table></figure><p><strong>æ€»ç»“</strong></p><p>æŒ‡é’ˆ</p><p>â€‹ç”¨äºåŠ¨æ€å†…å­˜åˆ†é…ã€æ•°ç»„ã€é“¾è¡¨ç­‰æ•°æ®ç»“æ„ã€‚</p><p>â€‹åœ¨å‡½æ•°ä¹‹é—´ä¼ é€’å¤šä¸ªå€¼ï¼Œæˆ–è€…éœ€è¦ä¿®æ”¹å‡½æ•°å¤–éƒ¨çš„å¯¹è±¡æ—¶ä½¿ç”¨ã€‚</p><p>â€‹å¯ä»¥æŒ‡å‘<code>nullptr</code>ï¼Œé€‚ç”¨äºéœ€è¦è¿›è¡Œç©ºæŒ‡é’ˆæ£€æŸ¥çš„åœºæ™¯ã€‚</p><p>â€‹å¯ä»¥è¿›è¡ŒæŒ‡é’ˆè¿ç®—ã€‚</p><p>å¼•ç”¨</p><p>â€‹ç”¨äºå‡½æ•°å‚æ•°ä¼ é€’ï¼Œé¿å…ä¸å¿…è¦çš„å¤åˆ¶ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†å¤§å‹å¯¹è±¡æ—¶ã€‚</p><p>â€‹ç”¨äºè¿”å›å¯¹è±¡çš„å¼•ç”¨ï¼Œä»¥ä¾¿å‡½æ•°å¤–éƒ¨èƒ½ä¿®æ”¹å¯¹è±¡ã€‚</p><p>â€‹æ¯”æŒ‡é’ˆæ›´åŠ ç®€æ´ã€ç›´è§‚ã€‚</p><p>â€‹ä¸æ”¯æŒç©ºå¼•ç”¨ï¼Œç¡®ä¿å¼•ç”¨æœ‰æ•ˆã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cpp12è·¨è¯­è¨€ç¼–ç¨‹</title>
      <link href="/2024/12/11/cpp12%E8%B7%A8%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A8%8B/"/>
      <url>/2024/12/11/cpp12%E8%B7%A8%E8%AF%AD%E8%A8%80%E7%BC%96%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h3 id="C-è°ƒç”¨æ±‡ç¼–ä»£ç "><a href="#C-è°ƒç”¨æ±‡ç¼–ä»£ç " class="headerlink" title="C++ è°ƒç”¨æ±‡ç¼–ä»£ç "></a>C++ è°ƒç”¨æ±‡ç¼–ä»£ç </h3><p><strong>ä½¿ç”¨æ±‡ç¼–ä»£ç çš„æ—¶æœºå’Œæ„ä¹‰</strong></p><p><img src="https://bu.dusays.com/2024/12/09/675697d600c3a.png"></p><p><strong>Microsoft c++ x86 å†…è”æ±‡ç¼–</strong></p><p><img src="https://bu.dusays.com/2024/12/09/675697d600c3a.png"></p><p><img src="https://bu.dusays.com/2024/12/09/67569ae9428a8.png"></p><p><img src="https://bu.dusays.com/2024/12/09/67569ae99537e.png"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">250</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸éœ€è¦åŠ åˆ†å·   ä½¿ç”¨__asmæ¥åˆ†å‰²</span></span><br><span class="line">    __asm mov eax,a</span><br><span class="line">    __asm add eax,<span class="number">1</span></span><br><span class="line">    __asm mov a,eax</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; a;  <span class="comment">// 251</span></span><br><span class="line">    <span class="comment">// è¿™æ ·çœç•¥äº†å¾ˆå¤š__asm</span></span><br><span class="line">    __asm</span><br><span class="line">    &#123;</span><br><span class="line">        mov eax, a</span><br><span class="line">        add eax, <span class="number">1</span></span><br><span class="line">        mov a, eax</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; a;  <span class="comment">// 252</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>__asm ä¸­æ±‡ç¼–ä½¿ç”¨è§„èŒƒ</strong></p><p>_asmæ”¯æŒ</p><p>Pentium 4 å’Œ AMD Athlon æ‰€æœ‰æ“ä½œç </p><p>æ”¯æŒMMXæŒ‡ä»¤é›†</p><p>å¯ä»¥åˆ©ç”¨_emitåˆ›å»ºç›®æ ‡å¤„ç†å™¨æ”¯æŒçš„å…¶ä»–æŒ‡ä»¤</p><p>å¦‚æœ_emitç”Ÿæˆä¿®æ”¹å¯„å­˜å™¨çš„å€¼ï¼Œç¼–è¯‘å™¨æ— æ³•ç¡®å®šå“ªäº›å¯„å­˜å™¨å—åˆ°å½±å“ï¼Œè¿™ä¸ªæ—¶å€™ç¼–è¯‘å™¨å®¹æ˜“åšå‡ºé”™è¯¯çš„åˆ¤æ–­ï¼Œç¨‹åºå¯èƒ½äº§ç”Ÿä¸å¯é¢„æµ‹çš„è¡Œä¸ºã€‚</p><p>asm ä¸  æ®µå¼•ç”¨  __asmä¸­å¿…é¡»é€šè¿‡å¯„å­˜å™¨æ¥å¼•ç”¨æ®µ  ä¸èƒ½é€šè¿‡æ®µåç§°æ¥è®¿é—®</p><p><img src="https://bu.dusays.com/2024/12/09/6756a0231248e.png"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a[<span class="number">1000</span>];</span><br><span class="line"><span class="type">int</span> count;</span><br><span class="line"><span class="type">int</span> arySize;</span><br><span class="line"><span class="type">int</span> typeAry;</span><br><span class="line">_asm </span><br><span class="line">&#123;</span><br><span class="line">    mov count,LENGTH a</span><br><span class="line">    mov arySize,SIZE a</span><br><span class="line">    mov typeAry,TYPE a</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;å…ƒç´ ä¸ªæ•°ä¸ºï¼š &quot;</span> &lt;&lt; count &lt;&lt; std::endl;  <span class="comment">// 1000</span></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;å…ƒç´ å¤§å°ä¸ºï¼š &quot;</span> &lt;&lt; arySize &lt;&lt; std::endl; <span class="comment">// 4000</span></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;å…ƒç´ å¤§å°ä¸ºï¼š &quot;</span> &lt;&lt; typeAry &lt;&lt; std::endl;  <span class="comment">// 4</span></span><br></pre></td></tr></table></figure><p><strong>__asmçš„è°ƒè¯•</strong></p><p>&#x2F;Zi ç¼–è¯‘é€‰é¡¹ å¯ä»¥ä½¿ç”¨æºä»£ç è°ƒè¯•å†…è”æ±‡ç¼–ç¨‹åºï¼Œå¯ä»¥åœ¨C&#x2F;C++&#x2F;æ±‡ç¼–ä»£ç ä¸Šè®¾ç½®æ–­ç‚¹</p><p>æŠŠå¤šæ¡æ±‡ç¼–è¯­è¨€æ”¾åœ¨åŒä¸€è¡Œå¯èƒ½ä¼šå¦¨ç¢è°ƒè¯•</p><p><strong>__asmä¸­ C&#x2F;C++ä½¿ç”¨è§„èŒƒ</strong></p><p><img src="https://bu.dusays.com/2024/12/09/6756a02410305.png"></p><p><strong>__asmä»£ç ä¼˜åŒ–å’Œå¯„å­˜å™¨çš„æ³¨æ„äº‹é¡¹</strong></p><p>_fastcall ä¸å»ºè®®åŒ…å«_asmä»£ç </p><p>espã€ebpè·Ÿæ ˆæœ‰å…³ç³»ï¼Œä¸èƒ½éšä¾¿æ”¹</p><p><strong>_declspec(naked)</strong></p>]]></content>
      
      
      <categories>
          
          <category> Cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cpp11å¤šæ€</title>
      <link href="/2024/12/11/cpp11%E5%A4%9A%E6%80%81/"/>
      <url>/2024/12/11/cpp11%E5%A4%9A%E6%80%81/</url>
      
        <content type="html"><![CDATA[<p><strong>å¤šæ€æ¦‚å¿µ</strong></p><p>å¤šæ€æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œå®ƒå…è®¸åœ¨åŸºç±»çš„æŒ‡é’ˆæˆ–å¼•ç”¨æŒ‡å‘æ´¾ç”Ÿç±»å¯¹è±¡æ—¶ï¼Œè°ƒç”¨ä¸åŒçš„å‡½æ•°å®ç°ã€‚æ¢å¥è¯è¯´ï¼Œå¤šæ€æ˜¯æŒ‡åŒä¸€æ¥å£åœ¨ä¸åŒå¯¹è±¡ä¸­æœ‰ä¸åŒçš„å®ç°æ–¹å¼ã€‚</p><p>å¤šæ€çš„åŸºæœ¬åˆ†ç±»ï¼š</p><p>â‘   ç¼–è¯‘æ—¶å¤šæ€ï¼ˆé™æ€å¤šæ€ï¼‰ï¼šé€šè¿‡å‡½æ•°é‡è½½å’Œè¿ç®—ç¬¦é‡è½½æ¥å®ç°ã€‚</p><p>â‘¡ è¿è¡Œæ—¶å¤šæ€ ï¼ˆåŠ¨æ€å¤šæ€ï¼‰ï¼šé€šè¿‡ç»§æ‰¿å’Œè™šå‡½æ•°æ¥å®ç°ã€‚</p><p>å¯¹è±¡å¤šæ€</p><p>â‘  å‘ä¸Šè½¬å‹   çˆ¶ç±»&#x3D;&#x3D;&gt;å­ç±»  äººæ˜¯åŠ¨ç‰© </p><p>â‘¡ å‘ä¸‹è½¬å‹   å­ç±»&#x3D;&#x3D;&gt;çˆ¶ç±»  åŠ¨ç‰©æ˜¯äºº  ç›¸å½“äºç”¨å­ç±»ä»£æ›¿çˆ¶ç±»  ï¼ˆå¤§ç¥å’Œæ²™é›•ä¹‹é—´äºŒè±¡æ€§ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 30å¤šæ€æ¦‚å¿µ.cpp : æ­¤æ–‡ä»¶åŒ…å« &quot;main&quot; å‡½æ•°ã€‚ç¨‹åºæ‰§è¡Œå°†åœ¨æ­¤å¤„å¼€å§‹å¹¶ç»“æŸã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span>  age;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Human</span> :<span class="keyword">public</span> Animal</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> Money;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">doit</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Do it~!!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Human laow&#123;&#125;;</span><br><span class="line">    laow.age = <span class="number">50</span>;</span><br><span class="line">    laow.Money = <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘ä¸Šè½¬å‹</span></span><br><span class="line">    <span class="comment">//Animal anm = laow;  // å¯èƒ½å‘ç”Ÿå†…å­˜åˆ‡ç‰‡çš„é—®é¢˜</span></span><br><span class="line">    <span class="comment">//std::cout &lt;&lt; anm.age &lt;&lt; std::endl;</span></span><br><span class="line">    <span class="comment">// ä½¿ç”¨æŒ‡é’ˆ,æ²¡æœ‰å†…å­˜æˆªæ–­é—®é¢˜</span></span><br><span class="line">   </span><br><span class="line">    <span class="comment">//Human* human = anm1;  // humançš„æˆå‘˜å˜é‡è¦æ¯”anm1å¤š</span></span><br><span class="line">    Animal* anm1 = &amp;laow;</span><br><span class="line">    <span class="comment">// å‘ä¸‹è½¬å‹   æ›´å¤§çš„ç›®çš„æ˜¯è°ƒç”¨é‡Œé¢çš„å‡½æ•°</span></span><br><span class="line">    Human* human = (Human*)anm1;</span><br><span class="line"></span><br><span class="line">    human-&gt;<span class="built_in">doit</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•å¤šæ€</strong></p><p>â‘   é™æ€å¤šæ€ï¼š å‡½æ•°é‡è½½ã€å‡½æ•°æ¨¡æ¿</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span>  age;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Human</span> :<span class="keyword">public</span> Animal</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> Money;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">doit</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Do it~!!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BeAct</span><span class="params">(Human* R)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BeAct</span><span class="params">(Animal* anm)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Human laow;</span><br><span class="line">    Animal dog;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">BeAct</span>(&amp;laow);</span><br><span class="line">    <span class="built_in">BeAct</span>(&amp;dog);  <span class="comment">// é™æ€å¤šæ€   ç¼–è¯‘çš„æ—¶å€™å†³å®šä½¿ç”¨å“ªä¸ªå‡½æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â‘¡  åŠ¨æ€å¤šæ€</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 30å¤šæ€æ¦‚å¿µ.cpp : æ­¤æ–‡ä»¶åŒ…å« &quot;main&quot; å‡½æ•°ã€‚ç¨‹åºæ‰§è¡Œå°†åœ¨æ­¤å¤„å¼€å§‹å¹¶ç»“æŸã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span>  age;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">BeAct</span><span class="params">(Animal* anm)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;åŠ¨ç‰©è¢«æ”»å‡»ï¼ï¼&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Human</span> :<span class="keyword">public</span> Animal</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> Money;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">doit</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Do it~!!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">BeAct</span><span class="params">(Animal* anm)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;äººç‰©è¢«æ”»å‡»ï¼ï¼&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Human laow;</span><br><span class="line">    Animal dog;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    Animal* bA;</span><br><span class="line">    std::cin &gt;&gt; id;</span><br><span class="line">    <span class="keyword">if</span> (id)</span><br><span class="line">    &#123;</span><br><span class="line">        bA = &amp;dog;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> bA = &amp;laow;</span><br><span class="line">    bA-&gt;<span class="built_in">BeAct</span>(&amp;dog);  <span class="comment">// ç¼–è¯‘çš„æ—¶å€™ä¸ç¡®å®šï¼Œå°±å«åšåŠ¨æ€å¤šæ€ ï¼ï¼ï¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><code>virtualå…³é”®å­—</code></strong></p><p>å®ƒæ˜¯ä¸€ä¸ªåœ¨åŸºç±»ä¸­å£°æ˜ï¼Œå¹¶ä¸”å¸Œæœ›åœ¨æ´¾ç”Ÿç±»ä¸­é‡å†™ï¼ˆæˆ–è¦†ç›–ï¼‰çš„æ–¹æ³•ã€‚é€šè¿‡è™šå‡½æ•°ï¼Œå¯ä»¥å®ç°å¤šæ€æ€§ï¼Œä½¿å¾—ç¨‹åºèƒ½å¤Ÿåœ¨è¿è¡Œæ—¶æ ¹æ®å¯¹è±¡çš„å®é™…ç±»å‹æ¥è°ƒç”¨é€‚å½“çš„å‡½æ•°ï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶å°±å†³å®šè°ƒç”¨å“ªä¸ªå‡½æ•°ã€‚</p><p><img src="https://bu.dusays.com/2024/12/08/67550c89eea41.png"></p><p>override åç¼€å¯ä»¥å¼ºåˆ¶è¦æ±‚æ£€æŸ¥å‡½æ•°æ˜¯é‡è½½</p><p>final åç¼€å¯ä»¥ç»ˆæ­¢å‡½æ•°çš„é‡è½½</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 31å¤šæ€è™šå‡½æ•°.cpp : æ­¤æ–‡ä»¶åŒ…å« &quot;main&quot; å‡½æ•°ã€‚ç¨‹åºæ‰§è¡Œå°†åœ¨æ­¤å¤„å¼€å§‹å¹¶ç»“æŸã€‚</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MoveObject</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    <span class="type">int</span> y;</span><br><span class="line">    <span class="comment">// virtualåªèƒ½æ”¾åœ¨ç±»å†…éƒ¨å£°æ˜</span></span><br><span class="line">    <span class="comment">// ä¸åŠ ä¸Švirtual å°±æ˜¯é™æ€ç»‘å®š</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="keyword">virtual</span> <span class="title">Move</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// å¦‚æœè¿™é‡Œè®¾ç½®æˆprivateï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°åœ¨æ´¾ç”Ÿç±»é‡Œé¢ç”¨ä¸äº†</span></span><br><span class="line"><span class="comment">// private:</span></span><br><span class="line">    <span class="comment">// è™šå‡½æ•°åœ¨æ´¾ç”Ÿç±»å’ŒåŸºç±»ä¸­çš„è¿”å›å€¼è¦æ±‚åŸºæœ¬ä¸€è‡´ï¼Œä½†æ˜¯å½“è¿”å›ç±»å‹ä¸ºç±»ç±»å‹çš„æŒ‡é’ˆå’Œå¼•ç”¨æ—¶é™¤å¤–</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> MoveObject* <span class="title">Move1</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        x++;</span><br><span class="line">        y++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MoveObject::Move</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    x++;</span><br><span class="line">    y++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NPCObject</span>:<span class="keyword">public</span> MoveObject</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// è¿™ç§ä¸æ˜¯è¦†ç›–   è€Œæ˜¯åŠ¨æ€ç»‘å®š</span></span><br><span class="line">    <span class="comment">// ä¸é‡å†™ ä¹Ÿèƒ½è¿è¡Œï¼Œå› ä¸ºç»§æ‰¿äº†åŸºç±»çš„Moveå‡½æ•°ï¼Œè°ƒç”¨åŸºç±»ä¸­çš„Moveå‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Move</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        x++;</span><br><span class="line">        y++;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;æˆ‘æ˜¯NPC\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//void Move(int a);  // å¦‚æœå‚æ•°ä¸ä¸€æ ·ï¼Œé‚£å°±æ˜¯ä¸€ä¸ªæ­£å¸¸çš„å‡½æ•°</span></span><br><span class="line">    <span class="comment">// å¦‚æœè¿™ä¹ˆå†™çš„è¯ï¼Œé‚£ä¹ˆè°ƒç”¨çš„å°±æ˜¯MoveObjectä¸­çš„Moveå‡½æ•°</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è™šå‡½æ•°åœ¨æ´¾ç”Ÿç±»å’ŒåŸºç±»ä¸­çš„è¿”å›å€¼è¦æ±‚åŸºæœ¬ä¸€è‡´ï¼Œä½†æ˜¯å½“è¿”å›ç±»å‹ä¸ºç±»ç±»å‹çš„æŒ‡é’ˆå’Œå¼•ç”¨æ—¶é™¤å¤–</span></span><br><span class="line">    <span class="comment">// MoveObjectæ´¾ç”Ÿé™¤äº†NPCObjectï¼Œé‚£ä¹ˆè¿™é‡Œå¯ä»¥ç”¨MoveObjectæˆ–è€…NPCObject</span></span><br><span class="line">    <span class="comment">// å¦‚æœNPCObjectç±»ä¸å†æ´¾ç”Ÿçš„è¯ï¼Œåé¢åŠ ä¸Šfinalå¯ä»¥</span></span><br><span class="line">    <span class="function">NPCObject* <span class="title">Move1</span><span class="params">()</span>   <span class="comment">// åå˜</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        x++;</span><br><span class="line">        y++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*åªè¦æ˜¯æ´¾ç”Ÿç±»çš„è™šå‡½æ•°éƒ½è¦åŠ ä¸Šoverrideå…³é”®å­—*/</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MonsterObject</span> :<span class="keyword">public</span> MoveObject</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Move</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        x++;</span><br><span class="line">        y++;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;æˆ‘æ˜¯æ€ªç‰©\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">MonsterObject* <span class="title">Move1</span><span class="params">()</span>   <span class="comment">// åå˜</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        x++;</span><br><span class="line">        y++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™æ˜¯ä»¥å‰çš„å†™æ³•</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">void Move(MonsterObject* obj)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    obj-&gt;Move();</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">void Move(NPCObject* obj)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    obj-&gt;Move();</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç°åœ¨å¤šæ€çš„å†™æ³•ï¼Œ åªå†™ä¸€ä¸ªåŸºç±»å³å¯</span></span><br><span class="line"><span class="comment">// è°ƒç”¨ç±»çš„å¯¹è±¡æ—¶æ— æ³•ä½¿ç”¨è™šå‡½æ•°çš„ï¼Œå¿…é¡»ä½¿ç”¨åŸºç±»æŒ‡é’ˆæ¥å®ç°è™šå‡½æ•°çš„è°ƒç”¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™æ ·å†™è°ƒç”¨çš„æ˜¯MoveObjectä¸­çš„Move</span></span><br><span class="line"><span class="comment">/*void Move(MoveObject obj)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    obj.Move();</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"><span class="comment">// å¼•ç”¨çš„æœ¬è´¨ä¹Ÿæ˜¯ä¸ªæŒ‡é’ˆ</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Move</span><span class="params">(MoveObject&amp; obj)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    obj.<span class="built_in">Move</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    MonsterObject snake;</span><br><span class="line">    NPCObject zsf;</span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰virtualï¼Œé‚£ä¹ˆå°±æ˜¯é™æ€ç»‘å®šï¼Œä»€ä¹ˆéƒ½ä¸ä¼šè¾“å‡º</span></span><br><span class="line">    <span class="comment">// è°ƒç”¨çš„æ˜¯MoveObject ä¸­çš„ Moveå‡½æ•°</span></span><br><span class="line">    <span class="built_in">Move</span>(snake);</span><br><span class="line">    <span class="built_in">Move</span>(zsf);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å»ºè®®è™šå‡½æ•°åšæˆç§æœ‰çš„ï¼Œä¸ç ´åå°è£…ï¼Œå¯ä»¥é€šè¿‡åŸºç±»æŒ‡é’ˆè®¿é—®</span></span><br></pre></td></tr></table></figure><p><strong>è™šå‡½æ•°è¯¦è§£</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è™šå‡½æ•°è¯¦è§£.cpp : æ­¤æ–‡ä»¶åŒ…å« &quot;main&quot; å‡½æ•°ã€‚ç¨‹åºæ‰§è¡Œå°†åœ¨æ­¤å¤„å¼€å§‹å¹¶ç»“æŸã€‚</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MoveObject</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    <span class="type">int</span> y;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">MoveObject</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// æ„é€ å‡½æ•°ï¼Œå…ˆæ„é€ åŸºç±»å†æ„é€ æ´¾ç”Ÿç±»</span></span><br><span class="line">        <span class="comment">//  æ´¾ç”Ÿç±»è¿˜æ²¡æœ‰æ„é€ ï¼Œæ‰€ä»¥è°ƒç”¨çš„å°±æ˜¯MoveObjectä¸­çš„Move</span></span><br><span class="line">        std::cout &lt;&lt; <span class="keyword">this</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">this</span>-&gt;<span class="built_in">Move</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Move</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;MoveObject Moving~\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ç›¸å½“äºthis-&gt;Move()</span></span><br><span class="line">        <span class="comment">// Moveåˆæ˜¯ä¸€ä¸ªè™šå‡½æ•°ï¼Œæ‰€ä»¥è°ƒç”¨çš„å°±æ˜¯ä¸‹é¢MonsterObjectä¸­çš„Moveå‡½æ•°</span></span><br><span class="line">        <span class="built_in">Move</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">MoveObject</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// åªèƒ½åšé™æ€ç»‘å®šï¼Œè°ƒç”¨åŸºç±»ä¸­çš„Moveå‡½æ•°</span></span><br><span class="line">        <span class="built_in">Move</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MonsterObject</span> :<span class="keyword">public</span> MoveObject</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Move</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Monster Moving\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">MonsterObject</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="keyword">this</span> &lt;&lt; std::endl;</span><br><span class="line">        MoveObject::<span class="built_in">test</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">MonsterObject</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// å…ˆææ„æ´¾ç”Ÿç±»  å†ææ„åŸºç±»  </span></span><br><span class="line">        <span class="built_in">Move</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// é¢è¯•é‡ç‚¹</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    MonsterObject snake;</span><br><span class="line">    <span class="comment">// è°ƒç”¨çš„æ˜¯Monsterä¸­çš„Move</span></span><br><span class="line">    snake.<span class="built_in">test</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è°ƒç”¨è™šå‡½æ•°åŸºç±»ç‰ˆæœ¬</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MoveObject::<span class="built_in">Move</span>();  <span class="comment">// è¿™æ ·å°±èƒ½è°ƒç”¨åŸºç±»ç‰ˆæœ¬çš„Moveå‡½æ•°äº†</span></span><br></pre></td></tr></table></figure><p><strong>é»˜è®¤å®å‚åœ¨è™šå‡½æ•°é‡ç‚¹é”™è¯¯</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŸºç±»</span></span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">AutoMove</span><span class="params">(<span class="type">int</span> step = <span class="number">2</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;auto move&quot;</span> &lt;&lt; step &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ´¾ç”Ÿç±»</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AutoMove</span><span class="params">(<span class="type">int</span> step = <span class="number">3</span>)</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ç¼–è¯‘çš„æ—¶å€™å·²ç»å†³å®šäº†stepçš„å€¼,åœ¨è¿™é‡Œæ”¹æ²¡ä»€ä¹ˆç”¨</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;~~~~~~auto move&quot;</span> &lt;&lt; step &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main()</span></span><br><span class="line">MonsterObject snake;</span><br><span class="line"></span><br><span class="line">MoveObject* p = &amp;snake;</span><br><span class="line">p-&gt;<span class="built_in">AutoMove</span>();</span><br><span class="line"><span class="comment">// è°ƒç”¨çš„æ˜¯æ´¾ç”Ÿç±»çš„AutoMove  ä½†æ˜¯stepçš„å€¼åœ¨ç¼–è¯‘çš„æ—¶å€™å°±å·²ç»ç¡®å®šäº†ï¼Œåœ¨æ´¾ç”Ÿç±»é‡Œé¢æ”¹æ˜¯æ²¡æœ‰ç”¨çš„</span></span><br></pre></td></tr></table></figure><p><strong>é‡Šæ”¾å«æœ‰è™šå‡½æ•°çš„æ´¾ç”Ÿå¯¹è±¡</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è™šå‡½æ•°è¯¦è§£.cpp : æ­¤æ–‡ä»¶åŒ…å« &quot;main&quot; å‡½æ•°ã€‚ç¨‹åºæ‰§è¡Œå°†åœ¨æ­¤å¤„å¼€å§‹å¹¶ç»“æŸã€‚</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MoveObject</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    <span class="type">int</span> y;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">MoveObject</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="keyword">this</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">this</span>-&gt;<span class="built_in">Move</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Move</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;MoveObject Moving~\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">AutoMove</span><span class="params">(<span class="type">int</span> step = <span class="number">2</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;auto move&quot;</span> &lt;&lt; step &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">Move</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">MoveObject</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot; Moveobjææ„å‡½æ•°ï¼ï¼&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="built_in">Move</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ææ„å‡½æ•°ä¸­æ²¡æœ‰å†…å®¹çš„è¯å¯ä»¥æ¢ç§å†™æ³•</span></span><br><span class="line">    <span class="comment">// virtual ~MoveObject() = default;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MonsterObject</span> :<span class="keyword">public</span> MoveObject</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Move</span><span class="params">()</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Monster Moving\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">MonsterObject</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="keyword">this</span> &lt;&lt; std::endl;</span><br><span class="line">        MoveObject::<span class="built_in">Move</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">AutoMove</span><span class="params">(<span class="type">int</span> step = <span class="number">3</span>)</span> <span class="keyword">override</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ç¼–è¯‘çš„æ—¶å€™å·²ç»å†³å®šäº†stepçš„å€¼,åœ¨è¿™é‡Œæ”¹æ²¡ä»€ä¹ˆç”¨</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;~~~~~~auto move&quot;</span> &lt;&lt; step &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">MonsterObject</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot; Monsterobjææ„å‡½æ•°ï¼ï¼&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="built_in">Move</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// é¢è¯•é‡ç‚¹</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// MonsterObject snake;</span></span><br><span class="line"></span><br><span class="line">    MoveObject* p = <span class="keyword">new</span> <span class="built_in">MonsterObject</span>();</span><br><span class="line">    p-&gt;<span class="built_in">AutoMove</span>();</span><br><span class="line">    <span class="keyword">delete</span> p; <span class="comment">// è§¦å‘ææ„å‡½æ•°ï¼Œå…ˆææ„æ´¾ç”Ÿç±»å†ææ„åŸºç±»</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ææ„å‡½æ•°ä¸æ˜¯è™šå‡½æ•°ï¼Œæ‰€ä»¥è°ƒç”¨MoveObjectä¸­çš„ææ„å‡½æ•°</span></span><br><span class="line">    <span class="comment">//p-&gt;~MoveObject()</span></span><br><span class="line">    <span class="comment">// ä½†æ˜¯æ²¡æœ‰é‡Šæ”¾å†…å­˜ï¼Œé€ æˆå†…å­˜æ³„éœ²ï¼Œæ‰€ä»¥åšä¸€ä¸ªè™šææ„å‡½æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç±»é‡Œé¢ï¼Œææ„å‡½æ•°å’Œæ„é€ å‡½æ•°æ˜¯é™æ€ç»‘å®šï¼Œå…¶ä½™éƒ½æ˜¯åŠ¨æ€ç»‘å®šçš„ã€‚</p><p><strong>å¯¹è±¡å¤šæ€è¯¦è§£</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 33å¯¹è±¡å¤šæ€è¯¦è§£.cpp : æ­¤æ–‡ä»¶åŒ…å« &quot;main&quot; å‡½æ•°ã€‚ç¨‹åºæ‰§è¡Œå°†åœ¨æ­¤å¤„å¼€å§‹å¹¶ç»“æŸã€‚</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MoveObject</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*virtual*/</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MonsterObject</span> :<span class="keyword">public</span> MoveObject</span><br><span class="line">&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NPCObject</span> :<span class="keyword">public</span> MoveObject</span><br><span class="line">&#123;&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Wolf</span> :<span class="keyword">public</span> MonsterObject</span><br><span class="line">&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Man</span> :<span class="keyword">public</span> MonsterObject</span><br><span class="line">&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WolfMan</span> :<span class="keyword">public</span> Wolf,<span class="keyword">public</span> MoveObject,<span class="keyword">public</span> Man</span><br><span class="line">&#123;&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    MonsterObject monster;</span><br><span class="line">    MoveObject* _move = &amp;monster;  <span class="comment">// éšå¼ç±»å‹è½¬æ¢ï¼Œå‘ä¸Šè½¬å‹</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// _move = new MoveObject();</span></span><br><span class="line">    <span class="comment">// ç¼–è¯‘å™¨ä¸ç¡®å®š_pmonsteræŒ‡å‘çš„æ˜¯ä»€ä¹ˆ</span></span><br><span class="line">    <span class="comment">// MonsterObject* _pmonster = _move; // éšå¼ç±»å‹è½¬æ¢ä¸è¢«å…è®¸  å‘ä¸‹è½¬å‹ä¸å…è®¸</span></span><br><span class="line">    <span class="comment">//å¯ä»¥å¼ºåˆ¶ï¼Œä½†æ˜¯åŸºç±»å¾—æ˜¯å¯ä»¥è®¿é—®çš„æ‰è¡Œ</span></span><br><span class="line">    MonsterObject* _pmonster = (MonsterObject*)_move; <span class="comment">// å¼ºåˆ¶ç±»å‹è½¬æ¢  å‘ä¸‹è½¬æ¢</span></span><br><span class="line">    MonsterObject* _pmonsterA = <span class="built_in">static_cast</span>&lt;MonsterObject*&gt;(_move); <span class="comment">// é™æ€å¼ºåˆ¶ç±»å‹è½¬æ¢</span></span><br><span class="line">    <span class="comment">// è™šåŸºç±»ä¸èƒ½å¼ºåˆ¶è½¬æ¢ï¼Œç±»æ˜¯è™šæ‹Ÿçš„</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*------------------------------------------------------------*/</span></span><br><span class="line"></span><br><span class="line">    WolfMan wolfman;</span><br><span class="line"></span><br><span class="line">    <span class="type">void</span>* ptr = &amp;wolfman;</span><br><span class="line">    Wolf* pwlf = &amp;wolfman;</span><br><span class="line">    <span class="comment">// Man* pman = &amp;wolfman;</span></span><br><span class="line">    <span class="comment">// å­˜åœ¨ç±»å‹è½¬æ¢</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;ptr: &quot;</span> &lt;&lt; ptr &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;pwlf: &quot;</span> &lt;&lt; pwlf &lt;&lt; std::endl;</span><br><span class="line">    <span class="comment">//std::cout &lt;&lt; &quot;pman: &quot; &lt;&lt; pman &lt;&lt; std::endl;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;----------------------&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="type">void</span>* ptr1 = &amp;wolfman;</span><br><span class="line">    Wolf* pwlf1 = (Wolf*)ptr1;  <span class="comment">// void* =&gt; Wolf*</span></span><br><span class="line">    <span class="comment">//Man* pman1 = (Man*)ptr1;  // æŒ‡é’ˆ   ç±»å‹ å’Œå†…å­˜åœ°å€</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;ptr1: &quot;</span> &lt;&lt; ptr1 &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;pwlf1: &quot;</span> &lt;&lt; pwlf1 &lt;&lt; std::endl;</span><br><span class="line">    <span class="comment">//std::cout &lt;&lt; &quot;pman1: &quot; &lt;&lt; pman1 &lt;&lt; std::endl;</span></span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;----------------------&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    <span class="type">void</span>* ptr2 = &amp;wolfman;</span><br><span class="line">    Wolf* pwlf2 = (Wolf*)&amp;wolfman;  <span class="comment">// void* =&gt; Wolf*  Wolfman*=&gt;Wolf</span></span><br><span class="line">    <span class="comment">//Man* pman2 = (Man*)&amp;wolfman;    // ç±»å‹</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;ptr2: &quot;</span> &lt;&lt; ptr2 &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;pwlf2: &quot;</span> &lt;&lt; pwlf2 &lt;&lt; std::endl;</span><br><span class="line">    <span class="comment">//std::cout &lt;&lt; &quot;pman2: &quot; &lt;&lt; pman2 &lt;&lt; std::endl;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//_move = &amp;wolfman; // å¤šé‡ç»§æ‰¿  ç¼–è¯‘å™¨ä¸çŸ¥é“æ€ä¹ˆè½¬ï¼Œå°½é‡é¿å…å¤šé‡ç»§æ‰¿</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;----------------------&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    WolfMan wolfman1;</span><br><span class="line">    wolfman<span class="number">1.</span>::Wolf::MonsterObject::MoveObject::x = <span class="number">2500</span>;</span><br><span class="line">    wolfman<span class="number">1.</span>::MoveObject::x = <span class="number">3500</span>;</span><br><span class="line">    MoveObject* _move1 = <span class="built_in">static_cast</span>&lt;MoveObject*&gt;(&amp;wolfman1);</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; _move1-&gt;x &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¼ºåˆ¶ç±»å‹è½¬æ¢éƒ½æ˜¯æœ‰é£é™©çš„ï¼ï¼ï¼</p><p><strong>åŠ¨æ€å¼ºåˆ¶è½¬æ¢</strong></p><p><img src="https://bu.dusays.com/2024/12/08/67555d8e3fb89.png"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 33å¯¹è±¡å¤šæ€è¯¦è§£.cpp : æ­¤æ–‡ä»¶åŒ…å« &quot;main&quot; å‡½æ•°ã€‚ç¨‹åºæ‰§è¡Œå°†åœ¨æ­¤å¤„å¼€å§‹å¹¶ç»“æŸã€‚</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MoveObject</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Move</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//if (dynamic_cast&lt;MonsterObject*&gt;(this))</span></span><br><span class="line">        <span class="comment">// ä¸æ¨èå†™æ³•ï¼Œéå¸¸ä¾èµ–æ´¾ç”Ÿç±»</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*virtual*/</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MonsterObject</span> :<span class="keyword">public</span> MoveObject</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Move</span><span class="params">()</span> </span>&#123;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NPCObject</span> :<span class="keyword">public</span> MoveObject</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Move</span><span class="params">()</span> </span>&#123;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Wolf</span> :<span class="keyword">public</span> MonsterObject</span><br><span class="line">&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Man</span> :<span class="keyword">public</span> MonsterObject</span><br><span class="line">&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">boss</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WolfMan</span> : <span class="keyword">public</span> Man<span class="comment">//,public boss</span></span><br><span class="line">&#123;&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ— è®º å‘ä¸Šè½¬è¿˜æ˜¯å‘ä¸‹è½¬ï¼Œæ¨èæ— æŸè½¬ï¼Œä½¿ç”¨æŒ‡é’ˆæˆ–è€…å¼•ç”¨æ¥è½¬</span></span><br><span class="line">    MonsterObject monster;</span><br><span class="line">    MoveObject* _move =(MoveObject*)&amp;monster;</span><br><span class="line">    MoveObject&amp; lMove = monster;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//_move = new MoveObject();</span></span><br><span class="line">    <span class="comment">//MonsterObject* _pmonsterA = dynamic_cast&lt;MonsterObject*&gt;(_move);</span></span><br><span class="line">    <span class="comment">//auto _pmonsterA = dynamic_cast&lt;MonsterObject*&gt;(_move);</span></span><br><span class="line">    <span class="comment">//MonsterObjectå’ŒNPCObjectä¹‹é—´æ²¡æœ‰ç»§æ‰¿å…³ç³»ï¼Œ_moveä¸èƒ½è¢«è½¬æ¢ä¸ºNPCObject*ã€‚</span></span><br><span class="line">    <span class="comment">//auto _pmonsterB = dynamic_cast&lt;NPCObject*&gt;(_move);</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//if (_pmonsterA != nullptr) _pmonsterA-&gt;MonsterMove();</span></span><br><span class="line">    <span class="comment">//if (_pmonsterB != nullptr) _pmonsterB-&gt;NPCMove();</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç›´æ¥è¿™æ ·ä½¿ç”¨å°±å¯ä»¥äº†ï¼Œé¿å…è¿‡åº¦ä½¿ç”¨ dynamic_cast</span></span><br><span class="line">    <span class="comment">//_move-&gt;Move();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸åº”è¯¥è½¬æ¢  æ²¡æœ‰ç©ºå¼•ç”¨ </span></span><br><span class="line">    <span class="comment">//NPCObject&amp; lNPC = dynamic_cast&lt;NPCObject&amp;&gt;(monster);</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//æ²¡æœ‰å…³ç³»çš„ç±»è½¬æ¢   è·¨ç±»è½¬æ¢</span></span><br><span class="line">    WolfMan wlfman;</span><br><span class="line">    MoveObject* pMove = &amp;wlfman;</span><br><span class="line">    <span class="keyword">auto</span> p = <span class="built_in">dynamic_cast</span>&lt;WolfMan*&gt;(pMove);</span><br><span class="line">    <span class="keyword">auto</span> p1 = <span class="built_in">dynamic_cast</span>&lt;boss*&gt;(pMove);</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;p: &quot;</span> &lt;&lt; p &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;p1: &quot;</span> &lt;&lt; p1 &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æŠ½è±¡ç±»</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‹¥æœ‰çº¯è™šå‡½æ•°çš„ç±»ç§°ä¸ºæŠ½è±¡ç±»ï¼Œå› ä¸ºè¯¥ç±»çš„å‡½æ•°æ²¡æœ‰å®ç°ï¼Œå› æ­¤ä¸èƒ½åˆ›å»ºæŠ½è±¡ç±»çš„å®ä¾‹</span></span><br><span class="line"><span class="comment">// ä½†æ˜¯å¯ä»¥ä½¿ç”¨æŠ½è±¡ç±»çš„æŒ‡é’ˆå’Œå¼•ç”¨ä½œä¸ºè¿”å›æˆ–å‚æ•°ï¼ï¼</span></span><br><span class="line"><span class="comment">// æŠ½è±¡ç±»çš„æ„é€ å‡½æ•°å› ä¸ºä¸èƒ½å®é™…ä½¿ç”¨ï¼Œæ‰€ä»¥ä¸€èˆ¬æ¨èæŠŠæŠ½è±¡ç±»çš„æ„é€ å‡½æ•°å®šä¹‰ä¸ºprotected</span></span><br><span class="line"><span class="comment">// æŠ½è±¡ç±»çš„æ´¾ç”Ÿç±»å¦‚æœæ²¡æœ‰å®šä¹‰çº¯è™šå‡½æ•°ï¼Œåˆ™è¯¥æ´¾ç”Ÿç±»ä¾ç„¶æ˜¯æŠ½è±¡ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="keyword">virtual</span> <span class="title">Move</span><span class="params">()</span> </span>= <span class="number">0</span>;  <span class="comment">// è¿™ä¸ªè™šå‡½æ•°æ²¡ä»€ä¹ˆå®é™…å†…å®¹ï¼Œå°±è®¾è®¡æˆçº¯è™šå‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="keyword">virtual</span> <span class="title">fly</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="keyword">virtual</span> <span class="title">Notice</span><span class="params">()</span> </span>= <span class="number">0</span>;  <span class="comment">// å‘é€é€šçŸ¥</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="keyword">virtual</span> <span class="title">Eat</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸€ä¸ªç±»é‡Œé¢éƒ½æ˜¯çº¯è™šå‡½æ•°ï¼Œæ²¡æœ‰æä¾›å…·ä½“å†…å®¹ï¼Œè¿™å°±æ˜¯æ¥å£ç±»</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="built_in">Animal</span>() &#123;&#125;  <span class="comment">// æŠ½è±¡ç±»çš„æ„é€ å‡½æ•°å› ä¸ºä¸èƒ½å®é™…ä½¿ç”¨ï¼Œæ‰€ä»¥ä¸€èˆ¬æ¨èæŠŠæŠ½è±¡ç±»çš„æ„é€ å‡½æ•°å®šä¹‰ä¸ºprotected</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> :<span class="keyword">public</span> Animal</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="keyword">virtual</span> <span class="title">Move</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¿™é‡Œæ²¡æœ‰flyå‡½æ•°çš„ï¼Œæ‰€ä»¥è¿™ä¸ªç±»ä¹Ÿæ˜¯æŠ½è±¡ç±»</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span> :<span class="keyword">public</span> Animal</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="keyword">virtual</span> <span class="title">Move</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//Animal GetAnm() &#123; &#125;  ä¸èƒ½åˆ›å»ºå®ä½“</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// æ‹¥æœ‰çº¯è™šå‡½æ•°çš„ç±»ç§°ä¸ºæŠ½è±¡ç±»ï¼Œå› ä¸ºè¯¥ç±»çš„å‡½æ•°æ²¡æœ‰å®ç°ï¼Œå› æ­¤ä¸èƒ½åˆ›å»ºæŠ½è±¡ç±»çš„å®ä¾‹</span></span><br><span class="line">    <span class="comment">//Animal anm;</span></span><br><span class="line">    <span class="comment">//Animal* anm1 = new Cat(); // æŒ‡é’ˆå¯ä»¥ï¼Œå®ä½“ä¸è¡Œ</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç±»çš„æˆå‘˜å‡½æ•°çš„æŒ‡é’ˆ</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç±»çš„æˆå‘˜å‡½æ•°çš„å‡½æ•°æŒ‡é’ˆ.cpp : æ­¤æ–‡ä»¶åŒ…å« &quot;main&quot; å‡½æ•°ã€‚ç¨‹åºæ‰§è¡Œå°†åœ¨æ­¤å¤„å¼€å§‹å¹¶ç»“æŸã€‚</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™é‡Œé™å®šäº†ç±»Wolf</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Wolf</span>;</span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(Wolf::* PGROUP)</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Wolf</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">Count</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Wolf</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        pGroup = &amp;Wolf::Group0;</span><br><span class="line">        (<span class="keyword">this</span>-&gt;*pGroup)();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Group0</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;ä¸€é˜¶æ®µï¼ï¼ï¼&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Group1</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;äºŒé˜¶æ®µï¼ï¼ï¼&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Group2</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;ä¸‰é˜¶æ®µï¼ï¼ï¼&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PGROUP pGroup;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span><span class="params">(*COUNT)</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    PGROUP pFunction = &amp;Wolf::Group2;</span><br><span class="line">    Wolf* pWolf = <span class="keyword">new</span> <span class="built_in">Wolf</span>();</span><br><span class="line">    (pWolf-&gt;*pFunction)();  <span class="comment">// æˆå‘˜å‡½æ•°çš„å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line"></span><br><span class="line">    COUNT _count = &amp;Wolf::Count;</span><br><span class="line">    _count();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Wolf</span>; <span class="comment">// ç±»çš„å‰ç½®å£°æ˜</span></span><br><span class="line"><span class="comment">// å®šä¹‰äº†ä¸€ä¸ªæ–°ç±»å‹PGROUPï¼Œå®ƒæ˜¯æŒ‡å‘Wolfç±»çš„æˆå‘˜å‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘çš„æˆå‘˜å‡½æ•°æ²¡æœ‰å‚æ•°ä¸”è¿”å›ç±»å‹ä¸ºvoid</span></span><br><span class="line"><span class="comment">// PGROUP æ˜¯ä¸€ä¸ªç±»å‹åˆ«åï¼Œç”¨äºæŒ‡å‘Wolfç±»ä¸­æ²¡æœ‰å‚æ•°ä¸”è¿”å›ç±»å‹ä¸ºvoidçš„æˆå‘˜å‡½æ•°ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(Wolf::* PGROUP)</span><span class="params">()</span></span>;  </span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Wolf</span>()</span><br><span class="line">&#123;</span><br><span class="line">    pGroup = &amp;Wolf::Group0;  <span class="comment">// æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–pGroup</span></span><br><span class="line">    (<span class="keyword">this</span>-&gt;*pGroup)();        <span class="comment">// è°ƒç”¨pGroupæŒ‡å‘çš„æˆå‘˜å‡½æ•°</span></span><br><span class="line">    PGROUP pGroup;  <span class="comment">// æˆå‘˜å‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘Wolfç±»çš„æˆå‘˜å‡½æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// COUNTæ˜¯ä¸€ä¸ªç±»å‹åˆ«åï¼Œç”¨äºå®šä¹‰æŒ‡å‘æ²¡æœ‰å‚æ•°ä¸”è¿”å›ç±»å‹ä¸ºvoid æ™®é€šå‡½æ•°çš„æŒ‡é’ˆ</span></span><br><span class="line"><span class="comment">// COUNT æ˜¯ä¸€ä¸ªæŒ‡å‘æ— å‚æ•°æ— è¿”å›å€¼å‡½æ•°çš„æŒ‡é’ˆã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span><span class="params">(*COUNT)</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mainå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    PGROUP pFunction = &amp;Wolf::Group2;  <span class="comment">// å®šä¹‰ä¸€ä¸ªæˆå‘˜å‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘Group2</span></span><br><span class="line">    Wolf* pWolf = <span class="keyword">new</span> <span class="built_in">Wolf</span>();  <span class="comment">// åˆ›å»ºä¸€ä¸ªWolfå¯¹è±¡ï¼ˆä¼šè°ƒç”¨æ„é€ å‡½æ•°ï¼‰</span></span><br><span class="line">    (pWolf-&gt;*pFunction)();  <span class="comment">// é€šè¿‡æˆå‘˜å‡½æ•°æŒ‡é’ˆè°ƒç”¨Group2</span></span><br><span class="line"></span><br><span class="line">    COUNT _count = &amp;Wolf::Count;  <span class="comment">// å®šä¹‰ä¸€ä¸ªæ™®é€šå‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘é™æ€æˆå‘˜å‡½æ•°Count</span></span><br><span class="line">    _count();  <span class="comment">// è°ƒç”¨é™æ€æˆå‘˜å‡½æ•°Count</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆå‘˜å‡½æ•°æŒ‡é’ˆï¼šæŒ‡å‘ç±»æˆå‘˜å‡½æ•°æ—¶ï¼Œéœ€è¦ä½¿ç”¨::*è¯­æ³•å¹¶åˆ¶å®šç±»åã€‚åœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œå¿…é¡»é€šè¿‡ç±»å®ä¾‹ï¼ˆthisæŒ‡é’ˆï¼‰æ¥è°ƒç”¨ã€‚</p><p>é™æ€æˆå‘˜å‡½æ•°ï¼šé™æ€æˆå‘˜å‡½æ•°ä¸ä¾èµ–äºå¯¹è±¡å®ä¾‹ï¼Œå¯ä»¥åƒæ™®é€šå‡½æ•°ä¸€æ ·ç›´æ¥é€šè¿‡ç±»åæˆ–å‡½æ•°æŒ‡é’ˆè°ƒç”¨ã€‚</p><p>æˆå‘˜å‡½æ•°ä¸æ™®é€šå‡½æ•°æŒ‡é’ˆçš„ä¸åŒï¼šæˆå‘˜å‡½æ•°æŒ‡é’ˆéœ€è¦å¯¹è±¡å®ä¾‹æ¥è°ƒç”¨ï¼Œè€Œæ™®é€šå‡½æ•°æŒ‡é’ˆåˆ™ä¸éœ€è¦ã€‚</p><p><strong>å¤šæ€ï¼šè™šå‡½æ•°çš„å®ç°</strong></p><p>ï¼ˆé¢è¯•å¯èƒ½é—®åˆ°ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ConsoleApplication1.cpp : æ­¤æ–‡ä»¶åŒ…å« &quot;main&quot; å‡½æ•°ã€‚ç¨‹åºæ‰§è¡Œå°†åœ¨æ­¤å¤„å¼€å§‹å¹¶ç»“æŸã€‚</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Hack</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;åŠ«æŒäº†ï¼ï¼ï¼1&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AIM</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> HP;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Eat</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;AIM&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Die</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;AIM_die&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Wolf</span> :<span class="keyword">public</span> AIM</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Eat</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Wolf&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Die</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;WOLF-DIE&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Sound</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;aoaoaoaoa~~~~&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    AIM* wolf = <span class="keyword">new</span> <span class="built_in">Wolf</span>();</span><br><span class="line">    wolf-&gt;<span class="built_in">Die</span>(); <span class="comment">// è°ƒç”¨çš„æ˜¯Wolfç±»ä¸­çš„å‡½æ•°</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¾“å‡º8   å¤šäº†4ä¸ªå­—èŠ‚</span></span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">sizeof</span>(AIM) &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æµ‹è¯•ä¸‹å¤šå‡ºçš„å››ä¸ªå­—èŠ‚æ˜¯å¤´éƒ¨è¿˜æ˜¯å°¾éƒ¨</span></span><br><span class="line">    std::cout &lt;&lt; wolf &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; &amp;wolf-&gt;HP &lt;&lt; std::endl; <span class="comment">// åŠ åœ¨å¤´éƒ¨äº†</span></span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span>* vtable = (<span class="type">unsigned</span>*)wolf;</span><br><span class="line">    std::cout &lt;&lt; std::hex &lt;&lt; <span class="string">&quot;Vtable:  &quot;</span> &lt;&lt; vtable[<span class="number">0</span>] &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span>* func = (<span class="type">unsigned</span>*)vtable[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; std::hex &lt;&lt; <span class="string">&quot;eat: &quot;</span> &lt;&lt; func[<span class="number">0</span>] &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; std::hex &lt;&lt; <span class="string">&quot;die: &quot;</span> &lt;&lt; func[<span class="number">1</span>] &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é€šè¿‡ä¿®æ”¹è™šå‡½æ•°è¡¨çš„æ•°æ®å¯ä»¥å®ç°åŠ«æŒ</span></span><br><span class="line">    DWORD old;</span><br><span class="line">    <span class="built_in">VirtualProtect</span>(func, <span class="number">8</span>, PAGE_EXECUTE_READWRITE, &amp;old);</span><br><span class="line">    func[<span class="number">0</span>] = (<span class="type">unsigned</span>)Hack;</span><br><span class="line">    func[<span class="number">1</span>] = (<span class="type">unsigned</span>)Hack;</span><br><span class="line">    wolf-&gt;<span class="built_in">Eat</span>();</span><br><span class="line">    <span class="comment">// ä»¥ä¸Šåªæ˜¯å½±å“çš„Wolfç±»  </span></span><br><span class="line"></span><br><span class="line">    AIM* _aim = <span class="keyword">new</span> <span class="built_in">AIM</span>();</span><br><span class="line">    _aim-&gt;<span class="built_in">Eat</span>();</span><br><span class="line"></span><br><span class="line">    AIM* _aim1 = <span class="keyword">new</span> <span class="built_in">Wolf</span>();</span><br><span class="line">    _aim1-&gt;<span class="built_in">Eat</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// åªæœ‰é€šè¿‡æŒ‡é’ˆè®¿é—®å‡½æ•°æ‰ä¼šè°ƒç”¨è™šå‡½æ•°è¡¨</span></span><br><span class="line">    Wolf wl;</span><br><span class="line">    wl.<span class="built_in">Sound</span>();  <span class="comment">// è¿™ä¸ªä¸æ¶‰åŠæŒ‡é’ˆï¼Œèƒ½å¤Ÿè°ƒç”¨æˆ‘ä»¬æƒ³è¦çš„å‡½æ•°</span></span><br><span class="line">    wl.<span class="built_in">Eat</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/12/09/67568e837d723.png"></p><p> è™šè¡¨çš„æ€§è´¨</p><p>1ï¸âƒ£ åŒä¸€ä¸ªç±»çš„å¤šä¸ªå®ä¾‹éƒ½æŒ‡å‘åŒä¸€ä¸ªè™šå‡½æ•°è¡¨</p><p>2ï¸âƒ£ é€šè¿‡ä¿®æ”¹è™šå‡½æ•°è¡¨çš„æ•°æ®å¯ä»¥å®ç°åŠ«æŒ</p><p>3ï¸âƒ£ åªæœ‰é€šè¿‡æŒ‡é’ˆè®¿é—®å‡½æ•°æ‰ä¼šè°ƒç”¨è™šå‡½æ•°è¡¨</p>]]></content>
      
      
      <categories>
          
          <category> Cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cpp10ç»§æ‰¿</title>
      <link href="/2024/12/11/cpp10%E7%BB%A7%E6%89%BF/"/>
      <url>/2024/12/11/cpp10%E7%BB%A7%E6%89%BF/</url>
      
        <content type="html"><![CDATA[<p><strong>ç»§æ‰¿çš„æ¦‚å¿µ</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span></span><br><span class="line">&#123;&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derive</span>:<span class="keyword">public</span> Base<span class="comment">//å…¬æœ‰ç»§æ‰¿</span></span><br><span class="line">&#123;&#125;ï¼›</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derive2</span>:<span class="keyword">protected</span> Base <span class="comment">//ä¿æŠ¤ç»§æ‰¿</span></span><br><span class="line">&#123;&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derive3</span>:<span class="keyword">private</span> Base<span class="comment">//ç§æœ‰ç»§æ‰¿</span></span><br><span class="line">&#123;&#125;;</span><br><span class="line"><span class="comment">//ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒDeriveï¼ŒDerive2ï¼ŒDerive3éƒ½ç»§æ‰¿è‡ªBaseåŸºç±»</span></span><br><span class="line"><span class="comment">//åŒºåˆ«å°±æ˜¯ç»§æ‰¿æ–¹å¼ä¸åŒ</span></span><br></pre></td></tr></table></figure><p><strong>å¤šç»§æ‰¿</strong></p><p>å¦‚æœçœç•¥ç»§æ‰¿æ–¹å¼ï¼Œé»˜è®¤ä¸º<code>private</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> &lt;æ´¾ç”Ÿç±»å&gt;:&lt;ç»§æ‰¿æ–¹å¼<span class="number">1</span>&gt;&lt;åŸºç±»å<span class="number">1</span>&gt;,&lt;ç»§æ‰¿æ–¹å¼<span class="number">2</span>&gt;&lt;åŸºç±»å<span class="number">2</span>&gt;,....</span><br><span class="line">&#123;  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/12/07/6753b6c38f762.png"></p><p>private å’Œ protected åŒºåˆ«ï¼šç±»ç»§æ‰¿ï¼Œprivateæ— æ³•è¢«è®¿é—®  protectedå¯ä»¥è¢«è®¿é—®ã€‚</p><p>ç»§æ‰¿çš„æ—¶å€™ï¼Œç§æœ‰å˜é‡æ˜¯å å†…å­˜ç©ºé—´çš„ï¼Œä½†æ˜¯æ²¡åŠæ³•è®¿é—®ã€‚ã€‚ã€‚</p><p><strong>ç»§æ‰¿ä¸­çš„è®¿é—®æ§åˆ¶</strong></p><p><img src="https://bu.dusays.com/2024/12/07/6753c254715ca.png"></p><p><img src="https://bu.dusays.com/2024/12/07/6753c2ca2a6ed.png"></p><p><img src="https://bu.dusays.com/2024/12/07/6753c3c88b103.png"></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œå°½é‡è®¾è®¡ç±»çš„æˆå‘˜å˜é‡ä¸ºprivateï¼Œå¦‚æœéœ€è¦è®¿é—®è¿™äº›æˆå‘˜å˜é‡ï¼Œåº”è¯¥æä¾›setterä»¥åŠgetterå‡½æ•°ã€‚</p><p><strong>ç»§æ‰¿ä¸­çš„æ„é€ å‡½æ•°</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">object</span></span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">mapObject</span> :<span class="keyword">public</span> object</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">actObject</span> :<span class="keyword">public</span> mapObject</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// æ„é€ é¡ºåºä¸ºobject-&gt;mapObject-&gt;actObject</span></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">object</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">int</span> x;</span><br><span class="line"><span class="type">int</span> y;</span><br><span class="line"><span class="built_in">object</span>()</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;object was created\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">object</span>(<span class="type">const</span> object&amp; obj)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;object was created by copy\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">mapObject</span> :<span class="keyword">public</span> object</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">int</span> mapId;</span><br><span class="line"><span class="built_in">mapObject</span>()</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot; mapObject was created\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">mapObject</span>(<span class="type">const</span> mapObject&amp; obj)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot; mapObject was created by copy\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">mapObject</span>(<span class="type">int</span> id) :mapId&#123; id &#125;</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">actObject</span> :<span class="keyword">public</span> mapObject</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">int</span> damage;</span><br><span class="line"><span class="comment">// ä¸èƒ½åŠ ä¸ŠmapId  å› ä¸ºç°åœ¨è¿˜æ²¡æœ‰æ„é€ ï¼Œä¸è®¤ä¸ºmapIdæ˜¯actObjectçš„æˆå‘˜</span></span><br><span class="line"><span class="built_in">actObject</span>():mapObject&#123;<span class="number">100</span>&#125;,damage&#123;<span class="number">100</span>&#125;</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// å¯ä»¥åœ¨é‡Œé¢å†™</span></span><br><span class="line">mapId = <span class="number">3939</span>;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot; actObject was created\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// mapObject&#123;obj&#125;æ²¡æœ‰åšç±»å‹è½¬æ¢å°±ä¼ è¿›å»äº†</span></span><br><span class="line"><span class="built_in">actObject</span>(<span class="type">const</span> actObject&amp; obj):mapObject&#123;obj&#125;</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;actObject&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">actObject obj&#123;&#125;;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;------------&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">actObject obj2 = obj;  <span class="comment">// å‰¯æœ¬æ„é€ å‡½æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç»§æ‰¿æ„é€ å‡½æ•°</strong></p><p>å…è®¸æ´¾ç”Ÿç±»ä»åŸºç±»ç»§æ‰¿æ„é€ å‡½æ•°ã€‚è¿™æ„å‘³ç€æ´¾ç”Ÿç±»å¯ä»¥ä½¿ç”¨åŸºç±»çš„æ„é€ å‡½æ•°æ¥åˆå§‹åŒ–ä»åŸºç±»ç»§æ‰¿æ¥çš„æ•°æ®æˆå‘˜ï¼Œè€Œä¸éœ€è¦åœ¨æ´¾ç”Ÿç±»ä¸­é‡æ–°å®šä¹‰ç±»ä¼¼çš„æ„é€ å‡½æ•°ï¼ˆé»˜è®¤æ„é€ å‡½æ•°å’Œå‰¯æœ¬æ„é€ å‡½æ•°æ— æ³•ç»§æ‰¿ï¼‰</p><p>è¯­æ³•ï¼š<code>using &lt;åŸºç±»åç§°&gt;::&lt;åŸºç±»åç§°&gt;;</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">object</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">int</span> x;</span><br><span class="line"><span class="type">int</span> y;</span><br><span class="line"><span class="built_in">object</span>()</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;object was created\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">object</span>(<span class="type">const</span> object&amp; obj)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;object was created by copy\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">mapObject</span> :<span class="keyword">public</span> object</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">int</span> mapId;</span><br><span class="line"><span class="built_in">mapObject</span>()</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot; mapObject was created\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">mapObject</span>(<span class="type">const</span> mapObject&amp; obj)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot; mapObject was created by copy\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">mapObject</span>(<span class="type">int</span> id) :mapId&#123; id &#125;</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">mapObject</span>(<span class="type">int</span> id, <span class="type">int</span> id2) :mapId&#123; id &#125;</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; id;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">actObject</span> :<span class="keyword">public</span> mapObject</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="comment">// è¿™æ ·å°±ç»§æ‰¿äº†mapObjectä¸­çš„æ„é€ å‡½æ•°   ä½†æ˜¯é»˜è®¤æ„é€ å‡½æ•°ã€å‰¯æœ¬æ„é€ å‡½æ•°æ²¡åŠæ³•ç»§æ‰¿</span></span><br><span class="line"><span class="keyword">using</span> mapObject::mapObject;</span><br><span class="line"><span class="type">int</span> damage;</span><br><span class="line"><span class="comment">// ä¸èƒ½åŠ ä¸ŠmapId  å› ä¸ºç°åœ¨è¿˜æ²¡æœ‰æ„é€ ï¼Œä¸è®¤ä¸ºmapIdæ˜¯actObjectçš„æˆå‘˜</span></span><br><span class="line"><span class="built_in">actObject</span>():mapObject&#123;<span class="number">100</span>&#125;,damage&#123;<span class="number">100</span>&#125;</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// å¯ä»¥åœ¨é‡Œé¢å†™</span></span><br><span class="line">mapId = <span class="number">3939</span>;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot; actObject was created\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// mapObject&#123;obj&#125;æ²¡æœ‰åšç±»å‹è½¬æ¢å°±ä¼ è¿›å»äº†</span></span><br><span class="line"><span class="built_in">actObject</span>(<span class="type">const</span> actObject&amp; obj):mapObject&#123;obj&#125;</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;actObject&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">actObject obj&#123;<span class="number">200</span>&#125;;</span><br><span class="line">actObject objx&#123; <span class="number">200</span>,<span class="number">300</span> &#125;;</span><br><span class="line"></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;------------&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">actObject obj2 = obj;  <span class="comment">// å‰¯æœ¬æ„é€ å‡½æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç»§æ‰¿ä¸­çš„ææ„å‡½æ•°ä¸é‡åé—®é¢˜</strong></p><p>æ„é€ çš„æ—¶å€™ç”±åŸºç±»å¼€å§‹æ„é€ çš„ï¼Œææ„çš„æ—¶å€™æ°æ°ç›¸åï¼Œå…ˆææ„æ´¾ç”Ÿç±»çš„</p><p>ç»§æ‰¿ä¸­çš„æˆå‘˜å˜é‡åç§°é‡å¤çš„é—®é¢˜</p><p>1ï¸âƒ£ å‡½æ•°åç›¸åŒï¼Œå‚æ•°ä¸åŒ</p><p>â€‹using åŸºç±»::å‡½æ•°å</p><p>ä¸ä¼šå‡ºé”™ï¼Œæœ‰ä¸ªä½œç”¨åŸŸçš„é—®é¢˜ï¼Œä¸å­˜åœ¨å˜é‡åé‡å¤çš„é—®é¢˜ï¼Œè®¿é—®çš„æ—¶å€™ ä½¿ç”¨ä½œç”¨åŸŸçš„ç¬¦å· <code>object::x</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mapObject MAP;</span><br><span class="line">MAP.x = <span class="number">2500</span>;</span><br><span class="line">MAP.object::x = <span class="number">3500</span>; <span class="comment">// ä½¿ç”¨ä½œç”¨åŸŸæ¥è§£å†³è¿™ä¸ªé—®é¢˜</span></span><br></pre></td></tr></table></figure><p>2ï¸âƒ£ å‡½æ•°åç›¸åŒï¼Œå‚æ•°ç›¸åŒ</p><p>â€‹åŸºç±»::å‡½æ•°å</p><p>å‡½æ•°å­˜åœ¨ä¸€ä¸ªé‡è½½çš„é—®é¢˜ï¼Œ</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‚æ•°ä¸åŒåå­—ç›¸åŒ   ç›´æ¥ åœ¨æ´¾ç”Ÿç±»é‡Œé¢å¼•å…¥å‡½æ•°</span></span><br><span class="line"><span class="keyword">using</span> object::showX;</span><br><span class="line"><span class="comment">// ä¸å¼•å…¥çš„è¯ä¼šè¢«è¦†ç›–æ‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦‚æœåŸºç±»å’Œæ´¾ç”Ÿç±»çš„å‡½æ•°åå‚æ•°ä»¥åŠè¿”å›ç±»å‹éƒ½ä¸€æ ·ï¼Œ usingå·²ç»åŒºåˆ†ä¸å‡ºæ¥äº†ï¼Œåªèƒ½é€šè¿‡ä½œç”¨åŸŸæ¥åŒºåˆ«</span></span><br><span class="line"><span class="comment">// objectç±»</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ShowX</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// mapObject ç±»</span></span><br><span class="line"><span class="keyword">using</span> object::showX;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ShowX</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// actObject ç±»</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ShowX</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// mainå‡½æ•°</span></span><br><span class="line">mapObject MAP:</span><br><span class="line">MAP.<span class="built_in">ShowX</span>(<span class="number">1500</span>);  <span class="comment">// è°ƒç”¨æ´¾ç”Ÿç±»ä¸­çš„å‡½æ•°</span></span><br><span class="line">MAP.object::<span class="built_in">ShowX</span>(<span class="number">2500</span>);  <span class="comment">// è°ƒç”¨åŸºç±»ä¸­çš„å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">actObject obj;</span><br><span class="line">obj.<span class="built_in">ShowX</span>(<span class="string">&quot;222&quot;</span>);</span><br><span class="line">obj.mapObject::<span class="built_in">ShowX</span>(<span class="number">33</span>);</span><br><span class="line">obj.mapObject::object::<span class="built_in">ShowX</span>(<span class="number">44</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¹Ÿå¯ä»¥ç›´æ¥è°ƒç”¨,æ²¡ä»€ä¹ˆå±‚æ¬¡æ„Ÿ</span></span><br><span class="line">obj.object::<span class="built_in">ShowX</span>(<span class="number">55</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›´æ¥è¿™ä¹ˆæ“ä½œå³å¯</span></span><br></pre></td></tr></table></figure><p><strong>å¤šé‡ç»§æ‰¿é—®é¢˜</strong></p><p>å¤šé‡ç»§æ‰¿å¸¦æ¥çš„é‡å¤ç»§æ‰¿çš„é—®é¢˜</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Wolf</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bite</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;Wolf Bite!\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">eat</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;Wolf eat!\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Man</span> </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">eat</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;Man eat!\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WolfMan</span> :<span class="keyword">public</span> Wolf, <span class="keyword">public</span> Man</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Change</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">IsWolf = !IsWolf;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">eat</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (IsWolf) Wolf::<span class="built_in">eat</span>();</span><br><span class="line"><span class="keyword">else</span> Man::<span class="built_in">eat</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">bool</span> IsWolf = <span class="literal">false</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">WolfMan Jack;</span><br><span class="line">Jack.<span class="built_in">bite</span>();</span><br><span class="line">Jack.<span class="built_in">eat</span>();</span><br><span class="line">Jack.<span class="built_in">Change</span>();  <span class="comment">// å˜èº«</span></span><br><span class="line">Jack.<span class="built_in">eat</span>();   <span class="comment">//  </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ´¾ç”Ÿç±»ä¹‹é—´çš„å†…å­˜å¹¶ä¸æ˜¯é‡å çš„</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// class MoveObject</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MoveObject</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">int</span> x;</span><br><span class="line"><span class="type">int</span> y;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">WolfMan Jack;</span><br><span class="line">Jack.<span class="built_in">bite</span>();</span><br><span class="line">Jack.Wolf::x = <span class="number">250</span>;</span><br><span class="line">Jack.Wolf::y = <span class="number">250</span>;</span><br><span class="line"></span><br><span class="line">std::cout &lt;&lt; Jack.Wolf::x &lt;&lt; std::endl;  <span class="comment">// 250</span></span><br><span class="line">std::cout &lt;&lt; Jack.Man::x &lt;&lt; std::endl;  <span class="comment">// -858993460</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è™šåŸºç±»</strong>ï¼Œå¦‚æœå‘ç°å·²ç»ç»§æ‰¿ä¸€æ¬¡äº†ï¼Œä¸‹æ¬¡å°±ä¸ä¼šå†ç»§æ‰¿çš„</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// class Man :public virtual MoveObject   è¿™æ ·å°±æ˜¯è™šåŸºç±»</span></span><br><span class="line"><span class="comment">// class Wolf:public virtual MoveObject</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// main</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">WolfMan Jack;</span><br><span class="line">Jack.<span class="built_in">bite</span>();</span><br><span class="line">Jack.Wolf::x = <span class="number">250</span>;</span><br><span class="line"></span><br><span class="line">std::cout &lt;&lt; Jack.Wolf::x &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; Jack.x &lt;&lt; std::endl;    <span class="comment">// è¿™ä¸‰ä¸ªéƒ½æ˜¯æŒ‡å‘çš„ä¸€ä¸ªx</span></span><br><span class="line">std::cout &lt;&lt; Jack.Man::x &lt;&lt; std::endl;  <span class="comment">// è™šåŸºç±»ï¼Œè¿™æ ·éƒ½æ˜¯250ï¼Œå®ƒä¿©xæŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªåœ°æ–¹ï¼Œæ²¡æœ‰æ­§ä¹‰äº†</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä»å†…å­˜çš„è§’åº¦æ¥ç†è§£ç»§æ‰¿</strong></p><p>æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cpp09è¿ç®—ç¬¦é‡è½½</title>
      <link href="/2024/12/11/cpp09%E8%BF%90%E7%AE%97%E7%AC%A6%E9%87%8D%E8%BD%BD/"/>
      <url>/2024/12/11/cpp09%E8%BF%90%E7%AE%97%E7%AC%A6%E9%87%8D%E8%BD%BD/</url>
      
        <content type="html"><![CDATA[<p>è¿ç®—ç¬¦é‡è½½çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è®©ç›®æ ‡ä»£ç æ›´æ–¹ä¾¿ä½¿ç”¨å’Œç»´æŠ¤ï¼Œè€Œä¸æ˜¯æå‡å¼€å‘æ•ˆç‡ï¼Œé‡è½½è¿ç®—ç¬¦æœªå¿…èƒ½æå‡å¼€å‘æ•ˆç‡ã€‚</p><p>â‘  è®©ç±»ä¹Ÿæ”¯æŒåŸç”Ÿçš„è¿ç®—  æ¯”å¦‚ + -  * &#x2F; </p><p>â‘¡ æå‡å¯¹ç¨‹åºçš„æ§åˆ¶æƒ  æ¯”å¦‚é‡è½½new  delete new[]   delete[]</p><p>å®ƒå…è®¸ä½ ä¸ºè‡ªå®šä¹‰ç±»å‹ï¼ˆå¦‚ç±»æˆ–ç»“æ„ä½“ï¼‰å®šä¹‰æ“ä½œç¬¦çš„è¡Œä¸ºï¼Œä½¿å¾—è¿™äº›æ“ä½œç¬¦å¯ä»¥åƒå†…å»ºç±»å‹ä¸€æ ·å·¥ä½œã€‚é€šè¿‡é‡è½½è¿ç®—ç¬¦ï¼Œå¯ä»¥ä½¿è‡ªå®šä¹‰å¯¹è±¡ä¹‹é—´çš„è¿ç®—æ›´åŠ ç›´è§‚å’Œç®€æ´ã€‚è¿ç®—ç¬¦é‡è½½æ˜¯é€šè¿‡å®šä¹‰ç‰¹æ®Šçš„æˆå‘˜å‡½æ•°æˆ–å‹å…ƒå‡½æ•°æ¥å®ç°çš„</p><p><strong>åˆæ¢è¿ç®—ç¬¦é‡è½½</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">friend</span> <span class="type">bool</span> <span class="keyword">operator</span>&lt;(Person&amp; psa, Person&amp; psb);</span><br><span class="line"><span class="keyword">friend</span> <span class="type">bool</span> <span class="built_in">operator</span>&lt;(Person&amp; psa, <span class="type">unsigned</span> <span class="type">short</span> _Age);</span><br><span class="line"><span class="type">unsigned</span> <span class="type">short</span> Age;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Person</span>(<span class="type">unsigned</span> <span class="type">short</span> _Age) :Age&#123; _Age &#125;&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å¾—ç§æœ‰å˜é‡</span></span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="type">short</span> <span class="title">GetAge</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> Age; &#125;</span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span>&gt;(Person&amp; person);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç±»çš„æˆå‘˜å‡½æ•°æ¥å®ç°è¿ç®—ç¬¦é‡è½½</span></span><br><span class="line"><span class="type">bool</span> Person::<span class="keyword">operator</span>&gt;(Person &amp; person)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> Age &gt; person.Age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éç±»çš„æˆå‘˜å‡½æ•°å®ç°è¿ç®—ç¬¦é‡è½½</span></span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span>&lt;(Person&amp; psa, Person&amp; psb)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> psa.<span class="built_in">GetAge</span>() &lt; psb.Age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·Ÿæ•°å­—æ¯”</span></span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span>&lt;(Person&amp; psa, <span class="type">unsigned</span> <span class="type">short</span> _Age)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> psa.Age &lt; _Age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">Person <span class="title">Man</span><span class="params">(<span class="number">20</span>)</span></span>;</span><br><span class="line"><span class="function">Person <span class="title">Woman</span><span class="params">(<span class="number">50</span>)</span></span>;</span><br><span class="line"><span class="comment">// è°ƒç”¨çš„æ˜¯ Person::operator&gt;(Person &amp; person)</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="keyword">if</span> (Man&gt;Woman) std::cout &lt;&lt; <span class="string">&quot; ä½ æ‰¾åˆ°å¯Œå©†äº†ï¼ï¼&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨operator&lt;(Person&amp; psa, unsigned short _Age)</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="keyword">if</span> (Man &lt; <span class="number">10</span>) std::cout &lt;&lt; <span class="string">&quot; ä½ æ‰¾åˆ°å¯Œå©†äº†ï¼ï¼&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç±»çš„éæˆå‘˜å‡½æ•°å®ç°è¿ç®—ç¬¦é‡è½½  å£°æ˜ä¸ºå‹å…ƒå‡½æ•°äº†</span></span><br><span class="line"><span class="comment">// Man &lt; Woman &lt;=&gt; operator&lt;(Man,Woman)</span></span><br><span class="line"><span class="keyword">if</span> (Man&lt;Woman) std::cout &lt;&lt; <span class="string">&quot; ä½ æ‰¾åˆ°å¯Œå©†äº†ï¼ï¼&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ï¼ï¼ï¼è®°ä½ç†è§£é‚£äº›ç­‰ä»·å…³ç³»</p><p><strong>è¿ç®—ç¬¦é‡è½½çš„åŸåˆ™å’Œæ—¶æœº</strong></p><p><img src="https://bu.dusays.com/2024/12/03/674e63385333d.png"></p><p>ä¸èƒ½æŠŠåŠ æ³•é‡è½½ä¸ºå‡æ³•ï¼ï¼ï¼</p><p><img src="https://bu.dusays.com/2024/12/03/674e65fd43456.png"></p><p><img src="https://bu.dusays.com/2024/12/03/674e65fd5013e.png"></p><p><img src="https://bu.dusays.com/2024/12/03/674e65fd5ca10.png"></p><p>ä¼ é€’å€¼æˆ–è€…ä¼ é€’å¼•ç”¨  å»ºè®®ä¼ é€’å¼•ç”¨  å°¤å…¶æ˜¯å³å€¼å¼•ç”¨ï¼Œä¸ä¿®æ”¹åœ¨å‰é¢åŠ ä¸Š<code>const</code> å°±å¯ä»¥äº†</p><p><strong>é‡è½½èµ‹å€¼è¿ç®—ç¬¦</strong></p><p>é»˜è®¤èµ‹å€¼è¿ç®—ç¬¦é‡è½½</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Role x, y;</span></span><br><span class="line"><span class="comment">....</span></span><br><span class="line"><span class="comment">y = x;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Role</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> hp;</span><br><span class="line">    <span class="type">int</span> mp;</span><br><span class="line">    Role&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Role&amp; role);</span><br><span class="line">    &#123;</span><br><span class="line">        hp = role.hp;</span><br><span class="line">        mp = role.mp;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Role&amp; operator=(const Role&amp; role) = delete;   é‚£ä¹ˆç¼–è¯‘å™¨å°±ä¸å†é‡è½½äº†</span></span><br><span class="line">    <span class="comment">// main.cppä¸­  y = xä¸å†æ­£ç¡®äº†</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>å®ç°èµ‹å€¼è¿ç®—ç¬¦çš„é‡è½½</strong></p><p>ï¼ï¼ï¼operator&#x3D;åªèƒ½ç”¨ç±»çš„æˆå‘˜å‡½æ•°æ¥å®ç°</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Role</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> hp;</span><br><span class="line">    <span class="type">int</span> mp;</span><br><span class="line">    Role&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Role&amp; role);</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br><span class="line">Role&amp; Role::<span class="keyword">operator</span>=(<span class="type">const</span> Role&amp; role)</span><br><span class="line">&#123;</span><br><span class="line">        hp = role.hp;</span><br><span class="line">        mp = role.mp;</span><br><span class="line">    <span class="comment">// è€Œä¸”è¿”å›å€¼æ˜¯ç©ºçš„æ—¶å€™void Role::operator=(const Role&amp; role)</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ³¨é‡Šæ‰ return *this;  </span></span><br><span class="line">    <span class="comment">// é‚£ä¹ˆå°±ä¸èƒ½ z = y = x;</span></span><br><span class="line">    <span class="comment">// z.operator=(y.operator=(x));   å› ä¸ºè¿”å›å€¼ä¸ºç©ºï¼Œæ‰€ä»¥è¿™ä¸ªæ“ä½œä¸èƒ½æ‰§è¡Œäº†</span></span><br><span class="line">    <span class="comment">// è¿”å›å€¼ç¼–ç¨‹Role ç±»å‹ä¹Ÿæ²¡é—®é¢˜ï¼Œä½†æ˜¯å¼•ç”¨èŠ‚çœå¼€é”€</span></span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Role x, y;</span><br><span class="line">    x.hp = <span class="number">100</span>;</span><br><span class="line">    y.mp = <span class="number">200</span>;</span><br><span class="line">    y = x;</span><br><span class="line">    <span class="comment">// z = y = x;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ç±»é‡Œé¢æœ‰æŒ‡é’ˆçš„æ—¶å€™ï¼Œå¾€å¾€ä¸èƒ½é‡‡ç”¨é»˜è®¤è¿ç®—ç¬¦ï¼Œå¿…é¡»é‡è½½ï¼ˆä¾‹å­å¦‚ä¸‹ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Role x, y, z;</span><br><span class="line">    x.hp = <span class="number">100</span>;</span><br><span class="line">    y.mp = <span class="number">200</span>;</span><br><span class="line">    </span><br><span class="line">    z = y =x;</span><br><span class="line">    std::cout &lt;&lt; y.hp &lt;&lt; <span class="string">&quot;//////&quot;</span> &lt;&lt; y.mp;</span><br><span class="line">    <span class="type">char</span> strA[]&#123; <span class="string">&quot;aaaaabbbccccc&quot;</span> &#125;;</span><br><span class="line">    hstring str&#123; strA &#125;;</span><br><span class="line">    <span class="comment">// å¦‚æœstrAçš„å†…å­˜ç©ºé—´æ”¹å˜äº†ï¼Œé‚£ä¹ˆstræ²¡æœ‰å€¼äº†ï¼Œå› ä¸ºå†…å­˜ç©ºé—´ä¸å±äºstr</span></span><br><span class="line">    strA[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    std::cout &lt;&lt; str.<span class="built_in">c_str</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é‡è½½èµ‹å€¼è¿ç®—ç¬¦çš„ä»£ç å¦‚ä¸‹</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;hstring.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="type">short</span> <span class="title">hstring::GetStrLen</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">short</span> len = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (str[len] != <span class="string">&#x27;\0&#x27;</span>) &#123;  <span class="comment">// éå†å­—ç¬¦ä¸²ç›´åˆ°é‡åˆ° &#x27;\0&#x27;</span></span><br><span class="line">len++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> len;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‹·è´  å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">hstring::CopyStrs</span><span class="params">(<span class="type">char</span>* dest, <span class="type">const</span> <span class="type">char</span>* source)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">short</span> len = <span class="built_in">GetStrLen</span>(source);</span><br><span class="line"><span class="keyword">if</span> (len &gt; usmlen)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">delete</span>[] cstr;  <span class="comment">// é‡Šæ”¾ä¹‹å‰åˆ†é…çš„å†…å­˜</span></span><br><span class="line">cstr = <span class="keyword">new</span> <span class="type">char</span>[len];  <span class="comment">// é‡æ–°åˆ†é…å†…å­˜</span></span><br><span class="line">usmlen = len; <span class="comment">// ä¿®æ­£å†…å­˜é•¿åº¦ </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">memcpy</span>(cstr, source, len);</span><br><span class="line">cstr[len] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">uslen = len;  <span class="comment">// å­—ç¬¦ä¸²é•¿åº¦ä¿®æ­£</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼“å†²åŒº</span></span><br><span class="line"><span class="comment">// é»˜è®¤æ„é€ å‡½æ•° </span></span><br><span class="line">hstring::<span class="built_in">hstring</span>()</span><br><span class="line">&#123;</span><br><span class="line">usmlen = <span class="number">0x32</span>;  <span class="comment">// å†…å­˜ç©ºé—´ç­‰äº32å­—èŠ‚</span></span><br><span class="line">uslen = <span class="number">0</span>;</span><br><span class="line">cstr = <span class="keyword">new</span> <span class="type">char</span>[usmlen];</span><br><span class="line">cstr[<span class="number">0</span>] = <span class="string">&#x27;\0&#x27;</span>;  <span class="comment">// åˆå§‹åŒ–ä¸ºç©ºå­—ç¬¦ä¸²</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–hstringç±»å¯¹è±¡çš„æ„é€ å‡½æ•°ã€‚</span></span><br><span class="line"><span class="comment">// å¸¦å‚æ•°çš„æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="comment">// å¯ä»¥æ¥å—ä¸€ä¸ªæˆ–è€…å¤šä¸ªå‚æ•°ï¼Œåœ¨åˆ›å»ºå¯¹è±¡æ—¶ï¼Œé€šè¿‡è¿™äº›å‚æ•°æ¥åˆå§‹åŒ–å¯¹è±¡çš„æ•°æ®æˆå‘˜ã€‚è¿™ä½¿å¾—å¯¹è±¡åœ¨åˆ›å»ºä¹‹åˆå°±èƒ½è¢«èµ‹äºˆç‰¹å®šçš„å€¼ã€‚</span></span><br><span class="line">hstring::<span class="built_in">hstring</span>(<span class="type">const</span> <span class="type">char</span>* str) :<span class="built_in">hstring</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">CopyStrs</span>(cstr, str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‹·è´æ„é€ å‡½æ•°  ä½¿ç”¨ä¸€ä¸ªå·²ç»å­˜åœ¨çš„åŒç±»å‹å¯¹è±¡åˆå§‹åŒ–æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚å®ƒçš„å‚æ•°æ˜¯ä¸€ä¸ªå¸¸é‡å¼•ç”¨ï¼ŒæŒ‡å‘åŒç±»å‹çš„å¯¹è±¡ã€‚</span></span><br><span class="line">hstring::<span class="built_in">hstring</span>(<span class="type">const</span> hstring&amp; str):<span class="built_in">hstring</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">CopyStrs</span>(cstr, str.cstr);</span><br><span class="line">&#125;</span><br><span class="line">hstring&amp; hstring::<span class="keyword">operator</span>=(<span class="type">const</span> hstring&amp; str)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span> != &amp;str)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">CopyStrs</span>(cstr, str.cstr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hstring&amp; hstring::<span class="keyword">operator</span>=(<span class="type">const</span> <span class="type">long</span> <span class="type">long</span>&amp; value)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (cstr != <span class="literal">nullptr</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span>[] cstr;</span><br><span class="line">        cstr = <span class="literal">nullptr</span>;</span><br><span class="line">        usmlen = <span class="number">0</span>;</span><br><span class="line">        uslen = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> tempValue = value;</span><br><span class="line">    <span class="type">bool</span> isNegative = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// è®¡ç®—æ•°å­—çš„ä½æ•°</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">short</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ¤æ–­è´Ÿå·</span></span><br><span class="line">    <span class="keyword">if</span> (tempValue &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        count++;  <span class="comment">// è´Ÿæ•°çš„è¯  å…ˆæŠŠç¬¦å·ç®—è¿›å»</span></span><br><span class="line">        isNegative = <span class="literal">true</span>;</span><br><span class="line">        tempValue = -tempValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> temp = tempValue;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        count++;</span><br><span class="line">        temp = temp / <span class="number">10</span>;</span><br><span class="line">    &#125; <span class="keyword">while</span> (temp &gt; <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…ˆåˆ¤æ–­æ˜¯å¦ä¸ºè´Ÿæ•°å†åˆ¤æ–­æ˜¯å¦ä¸º0  å¦‚æœä¸º0 æ•°å€¼ä½æ•°å°±æ˜¯1</span></span><br><span class="line">    <span class="keyword">if</span> (tempValue == <span class="number">0</span>) count = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    uslen = count;       </span><br><span class="line">    usmlen = uslen + <span class="number">1</span>;       </span><br><span class="line">    cstr = <span class="keyword">new</span> <span class="type">char</span>[usmlen];</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> index = usmlen - <span class="number">2</span>; <span class="comment">// usmlen-1æ˜¯\0</span></span><br><span class="line">    cstr[usmlen - <span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isNegative)</span><br><span class="line">    &#123;</span><br><span class="line">        cstr[<span class="number">0</span>] = <span class="string">&#x27;-&#x27;</span>;  </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¿™é‡ŒtempValueå·²ç»æ˜¯ä¸ªéè´Ÿæ•°äº†</span></span><br><span class="line">    <span class="keyword">while</span> (tempValue &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">char</span> charValue = (<span class="type">char</span>)(tempValue % <span class="number">10</span> + <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        cstr[index--] = charValue;</span><br><span class="line">        tempValue = tempValue / <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>é‡è½½&lt;&lt; å’Œ&gt;&gt;</strong></p><p><img src="https://bu.dusays.com/2024/12/07/67545d0215102.png"></p><p>Â·</p><p><strong>é‡è½½æ‹¬å·()</strong></p><p><img src="https://bu.dusays.com/2024/12/03/674eb16dbd58f.png"></p><p><strong>é‡è½½äºŒå…ƒè¿ç®—ç¬¦</strong></p><p><img src="https://bu.dusays.com/2024/12/03/674eb16d9fbeb.png"></p>]]></content>
      
      
      <categories>
          
          <category> Cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cpp08ç±»</title>
      <link href="/2024/12/11/cpp08%E7%B1%BB/"/>
      <url>/2024/12/11/cpp08%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<p><strong>é™æ€æˆå‘˜å˜é‡</strong></p><p>static  å…³é”®å­—å£°æ˜ä¸€ä¸ªç±»çš„é™æ€æˆå‘˜å˜é‡ï¼Œç±»çš„é™æ€æˆå‘˜å˜é‡çš„ç‰¹ç‚¹ï¼š</p><p>1ï¸âƒ£ æ‰€æœ‰ç±»çš„å®ä¾‹ä¸­ï¼Œå…±äº«ç±»ä¸­çš„é™æ€æˆå‘˜å˜é‡</p><p>2ï¸âƒ£ ç±»çš„é™æ€æˆå‘˜å˜é‡åœ¨æ²¡æœ‰ç±»çš„å®ä¾‹çš„æƒ…å†µä¸‹ï¼Œä¾ç„¶å¯ä»¥è®¿é—®</p><p>3ï¸âƒ£ ç±»çš„é™æ€æˆå‘˜å˜é‡å¹¶ä¸å®Œå…¨å±äºç±»</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">T</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> count;   <span class="comment">// å†…å­˜ç©ºé—´ä¸å±äºç±»</span></span><br><span class="line">    <span class="type">int</span> hp;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> T::count = <span class="number">100</span>;  <span class="comment">//å®šä¹‰ å¿…é¡»åŠ ä¸ŠT::</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    T::cout &lt;&lt; <span class="number">350</span>;</span><br><span class="line">    T t1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™æ€æˆå‘˜å˜é‡çš„åˆå§‹åŒ–</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">T</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">inline</span> <span class="type">static</span> <span class="type">int</span> count&#123;&#125;;  <span class="comment">// åˆ©ç”¨inline  åœ¨ç±»é‡Œé¢å®šä¹‰count</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> hp;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">T</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">inline</span> <span class="type">static</span> <span class="type">int</span> count&#123;&#125;;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> hp;</span><br><span class="line">    <span class="built_in">T</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        count ++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">GetCount</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">T t4;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    T t1, t2, t3;</span><br><span class="line">    T t5;</span><br><span class="line">    std::cout &lt;&lt; t<span class="number">1.</span><span class="built_in">GetCount</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">inline</span> <span class="type">static</span> <span class="type">int</span> count&#123;&#125;;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> hp;</span><br><span class="line">    <span class="built_in">T</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        count ++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">GetCount</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">T</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        count--;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">T t4;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    T t1, t2, t3;</span><br><span class="line">    T t5;</span><br><span class="line">    std::cout &lt;&lt; t<span class="number">1.</span><span class="built_in">GetCount</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é™æ€æˆå‘˜å¸¸é‡</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">T</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">const</span> <span class="type">static</span> <span class="type">int</span> count&#123;<span class="number">250</span>&#125;;  <span class="comment">// æœ‰æ—¶å€™å¯ä»¥åœ¨è¿™é‡Œå®šä¹‰ï¼Œæœ‰æ—¶å€™ä¸å¯ä»¥ï¼Œæˆ‘ä¸ªäººè§‰å¾—åœ¨å¤–é¢å®šä¹‰</span></span><br><span class="line">    <span class="type">int</span> hp;</span><br><span class="line">    <span class="built_in">T</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        count ++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">GetCount</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">T</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        count--;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>é™æ€æˆå‘˜å‡½æ•°</strong></p><p><img src="https://bu.dusays.com/2024/12/02/674da3de88eb6.png"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬ä¸€æ¡</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T</span></span><br><span class="line">&#123;</span><br><span class="line">     <span class="keyword">inline</span> <span class="type">static</span> <span class="type">int</span> count&#123;&#125;;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> hp;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">Test</span><span class="params">()</span> <span class="comment">// const ç¬¬ä¸‰æ¡ï¼Œä¸éœ€è¦constæ¥é™å®š</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// hp++;  ç¬¬äºŒæ¡  æ²¡æœ‰ç±»çš„å®ä¾‹ä¸èƒ½è®¿é—®è¿™ä¸ª   ä¸€ äºŒ  æ¡å†²çª</span></span><br><span class="line">        <span class="comment">// this-&gt;hp++;  é¿å…è®¿é—®éé™æ€æˆå‘˜å˜é‡</span></span><br><span class="line">        count ++ ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    T::<span class="built_in">Test</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å‹å…ƒç±»</strong></p><p>å‹å…ƒç±»æ˜¯ä¸€ä¸ªå¯ä»¥è®¿é—®å¦ä¸€ä¸ªç±»çš„ç§æœ‰æˆå‘˜ï¼ˆ<code>private</code>ï¼‰å’Œä¿æŠ¤æˆå‘˜ï¼ˆ<code>protected</code>ï¼‰çš„ç±»ã€‚å³ä½¿æ˜¯ç§æœ‰æˆ–ä¿æŠ¤æˆå‘˜ï¼Œå‹å…ƒç±»ä¹Ÿå¯ä»¥ç›´æ¥è®¿é—®å®ƒä»¬ï¼Œæ‰“ç ´äº†ç±»çš„å°è£…æ€§ï¼ˆencapsulationï¼‰çš„ä¸€éƒ¨åˆ†ã€‚å‹å…ƒç±»çš„æœºåˆ¶ä¸ºç±»æä¾›äº†ä¸€ç§çµæ´»çš„æ–¹å¼æ¥æ§åˆ¶å“ªäº›å¤–éƒ¨ç±»å¯ä»¥è®¿é—®å…¶ç§æœ‰æˆå‘˜ã€‚</p><p>å‹å…ƒä¼šç ´åç±»çš„å°è£…æ€§ï¼Œæ²¡æœ‰æ›´å¥½é€‰æ‹©çš„æƒ…å†µä¸‹å†ä½¿ç”¨å‹å…ƒï¼Œå‹å…ƒå’§ä¸æ˜¯ä¸€ç§å¹³ç­‰çš„å…³ç³»ï¼Œä½ èƒ½è®¿é—®å®ƒçš„ç§æœ‰å˜é‡ï¼Œå®ƒä¸ä¸€æ ·èƒ½è®¿é—®ä½ çš„ç§æœ‰å˜é‡</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">T</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> hp;  <span class="comment">// é»˜è®¤ä¸ºç§æœ‰çš„</span></span><br><span class="line">    <span class="type">int</span> mp;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">GetMP</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; mp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">friend</span> <span class="type">void</span> <span class="title">SetHP</span><span class="params">(T&amp; t1)</span></span>;  <span class="comment">// å¯ä»¥æœ‰å¤šä¸ªå‹å…ƒ</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">SetHP</span><span class="params">(T&amp; t1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    t<span class="number">1.</span>hp = <span class="number">100</span>;</span><br><span class="line">    t<span class="number">1.</span><span class="built_in">GetMP</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T1</span>;  <span class="comment">// ä¸åœ¨è¿™é‡Œå£°æ˜ï¼Œé‚£Tä¸­çš„T1ç¼–è¯‘å™¨è¯†åˆ«ä¸å‡ºæ¥</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> hp;  <span class="comment">// é»˜è®¤ä¸ºç§æœ‰çš„</span></span><br><span class="line">    <span class="type">int</span> mp;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">GetMP</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; mp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">friend</span> <span class="type">void</span> <span class="title">SetHP</span><span class="params">(T&amp; t1, T1&amp; t2)</span></span>;  <span class="comment">// å¯ä»¥æœ‰å¤šä¸ªå‹å…ƒ</span></span><br><span class="line">    <span class="function"><span class="keyword">friend</span> <span class="type">void</span> <span class="title">SetMP</span><span class="params">(T&amp; t1, T1&amp; t2)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T1</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> hp;  <span class="comment">// é»˜è®¤ä¸ºç§æœ‰çš„</span></span><br><span class="line">    <span class="type">int</span> mp;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">GetMP</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; mp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">friend</span> <span class="type">void</span> <span class="title">SetHP</span><span class="params">(T&amp; t1, T1&amp; t2)</span></span>;  <span class="comment">// å¯ä»¥æœ‰å¤šä¸ªå‹å…ƒ</span></span><br><span class="line">    <span class="function"><span class="keyword">friend</span> <span class="type">void</span> <span class="title">SetMP</span><span class="params">(T&amp; t1, T1&amp; t2)</span></span>; <span class="comment">// æ”¾åœ¨public æˆ–è€… private éƒ½å¯ä»¥</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">SetMP</span><span class="params">(T&amp; t1, T1&amp; t2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    t<span class="number">1.</span>hp = <span class="number">100</span>;</span><br><span class="line">    t<span class="number">1.</span><span class="built_in">GetMP</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">SetHP</span><span class="params">(T&amp; t1, T1 t2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    t<span class="number">1.</span>hp = <span class="number">100</span>;</span><br><span class="line">    t<span class="number">1.</span><span class="built_in">GetMP</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åµŒå¥—ç±»</strong></p><p>1ï¸âƒ£ ç”¨æ³•</p><p>2ï¸âƒ£ ä½œç”¨åŸŸ</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Role</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> hp;</span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">testx</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">WeaponLv</span></span><br><span class="line">&#123;</span><br><span class="line">normal = <span class="number">0</span>,</span><br><span class="line">high,</span><br><span class="line">rare,</span><br><span class="line">myth</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Role</span>()</span><br><span class="line">&#123;</span><br><span class="line">Weapon::<span class="built_in">test1</span>();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Weapon</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> tt1;</span><br><span class="line"><span class="function">Weapon* <span class="title">ReturnW</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">        <span class="built_in">Weapon</span>()</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">testx</span>();  <span class="comment">// å¯ä»¥è®¿é—®Roleé™æ€æˆå‘˜å‡½æ•°</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Weapon</span>()</span><br><span class="line">&#123;</span><br><span class="line">Role role;</span><br><span class="line">role.hp++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">short</span> lv;</span><br><span class="line">WeaponLv wlv;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> mp;</span><br><span class="line">Weapon leftHands;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Role::Weapon* Role::Weapon::<span class="built_in">ReturnW</span>()  <span class="comment">// æ³¨æ„ä½œç”¨åŸŸ</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> a1;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> x=<span class="number">250</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> hp;</span><br><span class="line"><span class="type">int</span> mp;</span><br><span class="line"><span class="type">int</span> count;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GetHP</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">a1++;</span><br><span class="line"><span class="comment">//x++;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">GetCount</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">T t1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—®æƒé™é—®é¢˜ï¼šåµŒå¥—ç±»å¯ä»¥è®¿é—®å¤–å±‚ç±»çš„æ‰€æœ‰æˆå‘˜ ï¼Œå¤–å±‚ç±»ä»…èƒ½è®¿é—®åµŒå¥—ç±»çš„å…±æœ‰æˆå‘˜</p><p>æšä¸¾ç±»å‹ä¹Ÿå¯ä»¥æ”¾è¿›å»ï¼Œä½†æœ‰ä¸ªä½œç”¨åŸŸçš„é—®é¢˜</p><p><strong>å±€éƒ¨ç±»</strong></p><p><strong>å®šä¹‰åœ¨å‡½æ•°å†…çš„ç±»ç§°ä¸ºå±€éƒ¨ç±»</strong>ï¼šå±€éƒ¨ç±»çš„å®šä¹‰å¿…é¡»å†™åœ¨ç±»å†…ã€ å±€éƒ¨ç±»ä¸­ä¸å…è®¸ä½¿ç”¨é™æ€æˆå‘˜å˜é‡ã€å±€éƒ¨ç±»å¯ä»¥è®¿é—®å…¨å±€å˜é‡ã€‚</p><p>é™æ€æˆå‘˜å˜é‡ä¸èƒ½å®šä¹‰åœ¨ç±»é‡Œé¢ï¼Œå®šä¹‰åœ¨å¤–é¢åˆå—ä½œç”¨åŸŸçš„é—®é¢˜ï¼ŒçŸ›ç›¾</p><p>è™½ç„¶æœ‰<code>inline</code>å…³é”®å­—ï¼Œ ä½†é¿å…é‚£ä¹ˆå†™    å±€éƒ¨ç±»éƒ½å°‘ç”¨</p><p><strong>åµŒå¥—ç±»æ¨¡å—åŒ–é—®é¢˜</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Role.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="comment">// è¿™é‡Œä¸è¦Skill.hçš„</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Role</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Skill</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Skill.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Role.h&quot;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Role</span>::Skill</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> hp;</span><br><span class="line">    <span class="type">int</span> mp;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Role.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Skill.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>malloc å’Œ new çš„æœ¬è´¨åŒºåˆ«ï¼šmallocä»…ä»…åˆ†é…å†…å­˜ï¼Œnewé™¤äº†åˆ†é…å†…å­˜ä»¥å¤–è¿˜ä¼šè°ƒç”¨æ„é€ å‡½æ•°</p><p>free() æ²¡æœ‰è°ƒç”¨ææ„å‡½æ•°ï¼Œdeleteä¸è¿›é‡Šæ”¾å†…å­˜ç©ºé—´ï¼Œä¼šè°ƒç”¨ç±»çš„ææ„å‡½æ•°</p><p><img src="https://bu.dusays.com/2024/12/02/674dba5f2954b.png"></p><p><img src="https://bu.dusays.com/2024/12/02/674dba5f505ef.png"></p><p><img src="https://bu.dusays.com/2024/12/02/674dba5f2e452.png"></p><p><strong>ä»åº•å±‚ç†è§£ç±»</strong></p><p><img src="https://bu.dusays.com/2024/12/02/674dbde4a10b1.png"></p><p><img src="https://bu.dusays.com/2024/12/02/674dbe7601fb6.png"></p><p><img src="https://bu.dusays.com/2024/12/02/674dbfcc11236.png"></p><p><strong>ç±»çš„è‡ªå®šä¹‰å‡½æ•°è°ƒç”¨</strong></p><p><strong>é¡¹ç›®</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HPMed</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> Recover&#123; <span class="number">100</span> &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Role</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> hp;</span><br><span class="line">    <span class="type">int</span> maxHp;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Role</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        hp = <span class="number">1000</span>;</span><br><span class="line">        maxHp = <span class="number">3500</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">GetHP</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;HP:&quot;</span> &lt;&lt; hp &lt;&lt; <span class="string">&quot;\\&quot;</span> &lt;&lt; maxHp&lt;&lt;<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">EatMed</span><span class="params">(HPMed&amp; hpMed)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        hp += hpMed.Recover;</span><br><span class="line">        hp = hp &gt; maxHp ? maxHp : hp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Role user;</span><br><span class="line">    HPMed med;</span><br><span class="line">    <span class="comment">//user = user + med;</span></span><br><span class="line">    user.<span class="built_in">GetHP</span>();</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> a;</span><br><span class="line">        std::cin &gt;&gt; a;</span><br><span class="line">        user.<span class="built_in">EatMed</span>(med);</span><br><span class="line">        <span class="built_in">system</span>(<span class="string">&quot;cls&quot;</span>);</span><br><span class="line">        user.<span class="built_in">GetHP</span>();</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cpp07ç¼–è¯‘å™¨ã€é¢å‘å¯¹è±¡</title>
      <link href="/2024/12/11/cpp07%E7%BC%96%E8%AF%91%E5%99%A8%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/"/>
      <url>/2024/12/11/cpp07%E7%BC%96%E8%AF%91%E5%99%A8%E3%80%81%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/</url>
      
        <content type="html"><![CDATA[<p><code>#define A B</code>   å°†æ ‡è¯†Aå®šä¹‰ä¸ºBçš„åˆ«å    <code>#define æ•´æ•°  int</code>       <code>æ•´æ•°  a&#123;&#125;;</code></p><p><code>#define H</code>      å®šä¹‰ä¸€ä¸ªæ ‡è¯†ç¬¦Hï¼Œ ä»£ç ä¸­çš„Hå°†ä¼šè¢«åˆ é™¤æ‰   ï¼Œ<code>int H a =&gt;  int a;</code>         æé«˜ä»£ç å¯é˜…è¯»æ€§çš„</p><p><code>#undef H</code>      åˆ é™¤è¿™ä¸ªæ ‡è¯†ç¬¦çš„å®šä¹‰ï¼Œä»¥åç”¨ä¸äº†äº†ï¼Œ  åˆ é™¤çš„é¡ºåºæ˜¯æ ¹æ®ä»£ç ç¼–è¯‘çš„é¡ºåºè¿›è¡Œçš„ã€‚</p><p><strong>å®šä¹‰å¤æ‚è¡¨è¾¾å¼çš„å®</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _out_</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SUM(X, Y) X+Y*3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RELEASE(x) delete[] x, x = nullptr;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// #define BIGGER(X, Y) (X&gt;Y?X:Y)   // (X&gt;Y?X:Y)å¿…é¡»åŠ æ‹¬å·ï¼Œä¸ç„¶å¤„ç†ä¸äº†</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BIGGER(X, Y) ((X)&gt;(Y)?(X):(Y))  <span class="comment">// æ›´ä¿é™©çš„æ–¹å¼ï¼Œå…¨éƒ½åŠ ä¸Šæ‹¬å·</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SHOW(X) std::cout&lt;&lt;X</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SHOW1(X) std::cout&lt;&lt;#X   <span class="comment">// å¤„ç†æˆå­—ç¬¦ä¸²</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SHOW2(X,Y) void X##Y() &#123;std::cout&lt;&lt;#X;&#125;</span></span><br><span class="line"><span class="built_in">SHOW2</span>(test,<span class="number">22</span>)  <span class="comment">// å‡½æ•°åå­—å°±å«test22</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">SUM</span>(<span class="number">100</span>,<span class="number">200</span>);   <span class="comment">// 100 + 200 * 3</span></span><br><span class="line">    <span class="type">int</span>* a = <span class="keyword">new</span> <span class="type">int</span>[<span class="number">50</span>];</span><br><span class="line">    <span class="built_in">RELEASE</span>(a);</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">BIGGER</span>(<span class="number">100</span>, <span class="number">200</span>);</span><br><span class="line">    <span class="built_in">SHOW</span>(<span class="number">2333</span>);   <span class="comment">//  è¾“å‡º</span></span><br><span class="line">    <span class="built_in">SHOW1</span>(<span class="number">233</span>sdjfkldsjf);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">test22</span>();   <span class="comment">// å°±å¯ä»¥è°ƒç”¨è¿™ä¸ªå‡½æ•°äº†</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>const int width&#123;100&#125;;</code></p><p><code>#define width 1000</code></p><p><code>#define</code> çš„æ–¹å¼æ¥å®šä¹‰å¸¸é‡å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå®šä¹‰çš„å¸¸é‡å¹¶ä¸å…·å¤‡ç±»å‹ï¼Œæœ‰æ—¶å€™å¹¶ä¸å®‰å…¨</p><p><strong><code>namespace</code> å‘½åç©ºé—´</strong></p><p>æŠŠç›¸å…³çš„å‡½æ•°ï¼Œå˜é‡ï¼Œç»“æ„ä½“æ”¾è¿›ä¸€ä¸ªå‘½åç©ºé—´é‡Œé¢</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// code.cpp</span></span><br><span class="line"><span class="keyword">namespace</span> t</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> v;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> p&#123;&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    t::v = <span class="number">100</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> p = <span class="number">200</span>;</span><br><span class="line">    std::cout &lt;&lt; p &lt;&lt; std::endl;  <span class="comment">// è¾“å‡º200ï¼Œ å±€éƒ¨çš„</span></span><br><span class="line">    std::cout &lt;&lt; ::p &lt;&lt; std::endl;  <span class="comment">// è®¿é—®å…¨å±€å‘½åç©ºé—´ä¸­çš„p  å€¼ä¸º0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// t.cpp</span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">int</span> x;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ::x;  <span class="comment">// å°±èƒ½è®¿é—®åˆ°code.cpp ä¸­çš„ x</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¨å±€å‘½åç©ºé—´ï¼Œæ‰€æœ‰å…·æœ‰é“¾æ¥å±æ€§çš„å¯¹è±¡ï¼Œåªè¦æ²¡æœ‰å®šä¹‰å‘½åç©ºé—´ï¼Œå°±é»˜è®¤å®šä¹‰åœ¨å…¨å±€å‘½åç©ºé—´ä¸­ï¼Œå…¨å±€å‘½åç©ºé—´ä¸­çš„æˆå‘˜çš„è®¿é—®ä¸ç”¨æ˜¾ç¤ºçš„æŒ‡å®šï¼Œå½“å±€éƒ¨åç§°è¦†ç›–äº†å…¨å±€åç§°æ—¶æ‰éœ€è¦æ˜¾å¼çš„æŒ‡å®šå…¨å±€å‘½åç©ºé—´ã€‚</p><p>å‘½åç©ºé—´æ˜¯å¯ä»¥æ‰©å±•çš„,å‘½åç©ºé—´å¯ä»¥æ”¾åœ¨å¤šä¸ªå¤´æ–‡ä»¶é‡Œé¢ ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> t</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> v;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> t</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="comment">// t::// è¿™é‡Œä¼šå‡ºæ¥ä¿©å˜é‡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘½åç©ºé—´çš„å£°æ˜</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// htc.h   å¤´æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">namespace</span> t</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">extern</span> <span class="type">int</span> v;  <span class="comment">// è¿™å°±æ˜¯å£°æ˜</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//code.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;cc.h&quot;</span></span></span><br><span class="line"><span class="comment">// int t::v&#123; 20 &#125;;  è¿™æ ·ä¹Ÿæ˜¯å¯ä»¥çš„ </span></span><br><span class="line"><span class="keyword">namespace</span> t</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> v&#123;<span class="number">200</span>&#125;;  <span class="comment">// å£°æ˜å’Œå®šä¹‰åˆ†å¼€å†™äº†</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; t::v;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘½åç©ºé—´çš„åµŒå¥—</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cc.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="keyword">namespace</span> t</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">extern</span> <span class="type">int</span> v;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">namespace</span> hack</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">hack</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// code.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;cc.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> t</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> v&#123; <span class="number">200</span> &#125;;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; t::v &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> t::hack::<span class="built_in">hack</span>()</span><br><span class="line">&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;hack!!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    t::<span class="built_in">test</span>();</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>æœªå‘½åçš„å‘½åç©ºé—´  åªé’ˆå¯¹æœ¬è½¬æ¢å•å…ƒæœ‰æ•ˆï¼ˆå¾…æŸ¥è¯¢èµ„æ–™æ•´ç†ï¼‰</p><p>å‘½åç©ºé—´çš„åˆ«å</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> a = t::hack;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    a::<span class="built_in">hack</span>();  <span class="comment">// é¢å¯¹æ·±åº¦åµŒå¥—çš„å‘½åç©ºé—´ï¼Œä½¿ç”¨åˆ«å</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> htd</span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sendSms</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="keyword">namespace</span> hack</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">hackServer</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> hServer = htd::hack;</span><br><span class="line">hServer::<span class="built_in">hackServer</span>();</span><br></pre></td></tr></table></figure><p><strong>æœªå®šä¹‰çš„å‘½åç©ºé—´å’Œstatic</strong></p><p>æœªå‘½åçš„å‘½åç©ºé—´æ˜¯ç”¨<code>namespace &#123;&#125;</code>å®šä¹‰çš„ï¼Œæ²¡æœ‰åå­—ã€‚</p><ul><li>ä»»ä½•å®šä¹‰åœ¨æœªå‘½åå‘½åç©ºé—´ä¸­çš„å˜é‡ã€å‡½æ•°æˆ–ç±»å‹ä»…åœ¨å½“å‰ç¼–è¯‘å•å…ƒï¼ˆæ–‡ä»¶ï¼‰ä¸­å¯è§ã€‚</li><li>å®é™…ä¸Šï¼Œæœªå‘½åå‘½åç©ºé—´çš„å†…å®¹è¢«ç¼–è¯‘å™¨è§†ä¸ºå…·æœ‰<strong>å†…éƒ¨é“¾æ¥</strong> ï¼ˆç±»ä¼¼äº<code>static</code>ï¼‰ã€‚</li></ul><p>ä¼˜ç‚¹ï¼šæä¾›äº†ä½œç”¨åŸŸéš”ç¦»ï¼Œé˜²æ­¢åç§°å†²çªã€‚ç›¸æ¯”staticï¼Œ å®ƒå¯ä»¥åŒ…å«å¤šä¸ªå£°æ˜(å˜é‡ã€å‡½æ•°ã€ç±»å‹ç­‰)å¹¶å½¢æˆä¸€ä¸ªé€»è¾‘åˆ†ç»„ã€‚   å»ºè®®ä½¿ç”¨æœªå‘½åçš„å‘½åç©ºé—´ä»£æ›¿<code>static</code>ï¼Œå› ä¸ºå®ƒæ”¯æŒæ›´å¤æ‚çš„ç»“æ„å’Œé€»è¾‘ã€‚</p><p>static ä¿®é¥°çš„ å˜é‡æˆ–å‡½æ•°åœ¨å½“å‰æ–‡ä»¶ä¸­å¯è§ã€‚</p><ul><li><code>static</code>å˜é‡å’Œå‡½æ•°å…·æœ‰<strong>å†…éƒ¨é“¾æ¥</strong> ï¼Œå³å®ƒä»¬åªèƒ½åœ¨å®šä¹‰å®ƒä»¬çš„æ–‡ä»¶ä¸­è®¿é—®ã€‚</li><li>ä¸»è¦ç”¨äºæ ‡è®°å•ä¸ªå®ä½“çš„ä½œç”¨åŸŸï¼Œä¸æ”¯æŒé€»è¾‘åˆ†ç»„ã€‚</li></ul><p><img src="https://bu.dusays.com/2024/11/30/674ab5bf6fd98.png"></p><p><strong>é¢„å¤„ç†æŒ‡ä»¤é€»è¾‘</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> VERSION 103</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SENDSMS 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> VERSION==100&amp;&amp;SENDSMS   <span class="comment">// è¿™é‡Œå¯ä»¥åšä¸€äº›è®¡ç®—çš„  #if VERSION==(100 + 1)</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sendSms</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> VERSION==101||SENDSMS</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sendSms</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> VERSION==102</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sendSms</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> VERSION==103</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sendSms</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> VERSION==104</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sendSms</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="comment">// #if å’Œ #endif æ˜¯æˆå¥—å‡ºç°çš„</span></span><br></pre></td></tr></table></figure><p><strong>é¢„å®šä¹‰å®</strong></p><p>æ ‡å‡†é¢„å®šä¹‰æ ‡è¯†ç¬¦  <code>__func__</code>   è¿”å›å‡½æ•°åå­—</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">ave</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">std::cout &lt;&lt; __func__ &lt;&lt; std::endl;  <span class="comment">// è¾“å‡ºave</span></span><br><span class="line"><span class="keyword">return</span> (a + b) / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">ave</span>(<span class="number">100</span>, <span class="number">1200</span>);</span><br><span class="line">std::cout &lt;&lt; __func__;  <span class="comment">//  è¾“å‡ºmain</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">std::cout &lt;&lt; __DATE__ &lt;&lt; std::endl;  <span class="comment">// æ—¥æœŸ</span></span><br><span class="line">std::cout &lt;&lt; __TIME__ &lt;&lt; std::endl;  <span class="comment">// æ—¶é—´</span></span><br><span class="line">std::cout &lt;&lt; __func__ &lt;&lt; std::endl;  <span class="comment">// å‡½æ•°å</span></span><br><span class="line">std::cout &lt;&lt; __FILE__ &lt;&lt; std::endl;  <span class="comment">// æºæ–‡ä»¶åç§°</span></span><br><span class="line">std::cout &lt;&lt; __LINE__ &lt;&lt; std::endl;  <span class="comment">// å½“å‰çš„è¡Œå·</span></span><br><span class="line">std::cout &lt;&lt; __cplusplus &lt;&lt; std::endl;  <span class="comment">// å½“ç¿»è¯‘å•å…ƒä¸ºC++æ—¶ï¼Œ__cplusplusä¸ºä¸€ä¸ªæ•´æ•°æ–‡æœ¬å¦åˆ™ä¸ºæœªå®šä¹‰</span></span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/11/30/674a850dab4fb.png"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _CHAR_UNSIGNED</span></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;char unsigned&quot;</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">  </span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; __FUNCDNAME__ &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; __FUNCSIG__ &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; __TIMESTAMP__ &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; _WIN64 &lt;&lt; std::</span><br><span class="line">    <span class="comment">//  _WIN64 ä»…åœ¨64ä½ä¸‹æ‰æ˜¾ç¤º</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _WIN32</span></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;win32\n&quot;</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>_DEBUG</code>  åœ¨debugæ¨¡å¼ä¸‹å¯ä»¥ä½¿ç”¨ï¼Œå‘å¸ƒæ¨¡å¼ä¸‹æ²¡æœ‰äº†</p><p><strong>è°ƒè¯•</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _DBG_FOR    <span class="comment">// é€šè¿‡æ³¨é‡Šè¿™é‡Œå°±å¯ä»¥ä¸è°ƒè¯• </span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> _DBG_FOR</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> </span></span><br></pre></td></tr></table></figure><p><strong>assertæ–­è¨€</strong></p><p><img src="https://bu.dusays.com/2024/11/30/674aafc634452.png"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> NDEBUG</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;è¯·è¾“å…¥ä¸€ä¸ªæ•´æ•°\n&quot;</span>;</span><br><span class="line">    <span class="type">int</span> c;</span><br><span class="line">    std::cin &gt;&gt; c;</span><br><span class="line">    <span class="built_in">assert</span>(c);   <span class="comment">// åªè¦æ˜¯0å°±ä¼šå¼¹å‡ºæ¥</span></span><br><span class="line">    std::cout &lt;&lt; <span class="number">1000</span> / c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>static_assert</strong></p><p>ç”¨äºç¼–è¯‘æ—¶æ£€æŸ¥æ¡ä»¶</p><p><code>static_assert(bool è¡¨è¾¾å¼,&quot;é”™è¯¯ä¿¡æ¯&quot;);</code></p><p><code>static_assert(boolè¡¨è¾¾å¼);</code></p><p>ä¸assertä¸åŒï¼Œstatic_assertä¸»è¦æ˜¯ç”¨æ¥åœ¨ç¼–è¯‘æ—¶æ£€æŸ¥é‡è¦çš„æ¡ä»¶ã€‚  å› æ­¤æ£€æŸ¥çš„boolè¡¨è¾¾å¼ä¸­ï¼Œåªèƒ½ç”¨äºå¸¸é‡</p><p><strong>é¢å‘å¯¹è±¡çš„ç¼–ç¨‹</strong></p><p><img src="https://bu.dusays.com/2024/11/30/674b125faff00.png" alt="https:&#x2F;&#x2F;bu.dusays.com&#x2F;2024&#x2F;11&#x2F;30&#x2F;674b125faff00.png"></p><p>ç±»      å®šä¹‰äº†å¯¹è±¡çš„å±æ€§ï¼ˆæˆå‘˜å˜é‡ï¼‰å’Œè¡Œä¸ºï¼ˆæˆå‘˜å‡½æ•°ï¼‰</p><p>å¯¹è±¡   æ˜¯ç±»çš„å®ä¾‹åŒ–ï¼Œå¯ä»¥ç”¨æ¥å­˜å‚¨æ•°æ®å’Œè°ƒç”¨å‡½æ•°ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">NPC</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> hp;</span><br><span class="line"><span class="type">int</span> mp;</span><br><span class="line"><span class="type">int</span> damage;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MONSTER</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> hp;</span><br><span class="line"><span class="type">int</span> mp;</span><br><span class="line"><span class="type">int</span> damage;</span><br><span class="line"><span class="type">int</span> price;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ROLE</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> hp;</span><br><span class="line"><span class="type">int</span> mp;</span><br><span class="line"><span class="type">int</span> damage;</span><br><span class="line"><span class="type">int</span> diamond;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Act</span><span class="params">(NPC* acter, NPC* beacter)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">beacter-&gt;hp -= acter-&gt;damage;</span><br><span class="line"><span class="keyword">return</span> beacter-&gt;hp &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">MONSTER atm&#123; <span class="number">1000</span>,<span class="number">500</span>,<span class="number">100</span>,<span class="number">6000</span> &#125;;</span><br><span class="line">ROLE zs&#123; <span class="number">1000</span>,<span class="number">1000</span>,<span class="number">50</span>,<span class="number">1000</span> &#125;;</span><br><span class="line">ROLE ls&#123; <span class="number">1000</span>,<span class="number">500</span>,<span class="number">100</span>,<span class="number">600</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Act</span>((NPC*)&amp;atm, (NPC*)&amp;ls);  <span class="comment">// åªè¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢å°±å¯ä»¥äº†ï¼Œæ²¡å¿…è¦å†™å¾ˆå¤šå‡½æ•°äº†</span></span><br><span class="line">std::cout &lt;&lt; ls.hp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¸€ä¸ªä¾‹å­</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Role.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Role.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Role::Act</span><span class="params">(Role&amp; role)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    role.hp -= damage;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Role::Init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    hpRecover = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">Role* <span class="title">Role::bigger</span><span class="params">(Role* role)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   <span class="keyword">return</span> role-&gt;lv &gt; lv ? role : <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Role&amp; <span class="title">Role::SetLv</span><span class="params">(<span class="type">int</span> newLv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    lv = newLv;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Role&amp; <span class="title">Role::SetHp</span><span class="params">(<span class="type">int</span> newHp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    hp = newHp;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">Role&amp; <span class="title">Role::SetDamage</span><span class="params">(<span class="type">int</span> newDamage)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    damage = newDamage;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Role.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">200</span>;</span><br><span class="line">    <span class="type">int</span>* p = &amp;a;</span><br><span class="line">    <span class="type">int</span>&amp; c = *p;</span><br><span class="line"></span><br><span class="line">    Role user;</span><br><span class="line">    Role monster;</span><br><span class="line">    user.<span class="built_in">SetLv</span>(<span class="number">100</span>).<span class="built_in">SetDamage</span>(<span class="number">50</span>).<span class="built_in">SetHp</span>(<span class="number">500</span>).<span class="built_in">bigger</span>(&amp;monster)-&gt;<span class="built_in">bigger</span>(&amp;user);</span><br><span class="line">    Role* biggerRole= user.<span class="built_in">bigger</span>(&amp;monster);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Role.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Role</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">int</span> hpRecover;</span><br><span class="line"><span class="type">int</span> hp;</span><br><span class="line"><span class="type">int</span> lv;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="comment">/*å¦‚æœinlineå‡½æ•°çš„å®šä¹‰ä¸åœ¨ç±»å†…éƒ¨ï¼Œä¹Ÿä¸åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯æ”¾åœ¨æŸä¸ª.cppæ–‡ä»¶ä¸­ï¼Œ</span></span><br><span class="line"><span class="comment">ç¼–è¯‘å™¨ç¡®å®å¯èƒ½å‡ºç°é—®é¢˜ï¼Œå› ä¸ºå®ƒåœ¨é“¾æ¥é˜¶æ®µæ— æ³•æ‰¾åˆ°è¯¥å‡½æ•°çš„å®ç°*/</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">GetHp</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> damage;</span><br><span class="line"><span class="function">Role* <span class="title">bigger</span><span class="params">(Role* role)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Act</span><span class="params">(Role&amp; role)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">Role&amp; <span class="title">SetLv</span><span class="params">(<span class="type">int</span> newLv)</span></span>;</span><br><span class="line"><span class="function">Role&amp; <span class="title">SetHp</span><span class="params">(<span class="type">int</span> newHp)</span></span>;</span><br><span class="line"><span class="function">Role&amp; <span class="title">SetDamage</span><span class="params">(<span class="type">int</span> newDamage)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>å†…è”å‡½æ•°ï¼Œä»¥Role.cppé‡Œé¢çš„å‡½æ•°ä¸ºå‡†ï¼Œé‡å†™åŸåˆ™</p><p><strong>thisæŒ‡é’ˆ</strong></p><p><code>this</code>æŒ‡é’ˆæ˜¯ä¸€ä¸ªæŒ‡å‘è°ƒç”¨æˆå‘˜å‡½æ•°çš„å¯¹è±¡çš„æŒ‡é’ˆã€‚æ¯å½“ä½ åœ¨ä¸€ä¸ªç±»çš„æˆå‘˜å‡½æ•°ä¸­ä½¿ç”¨<code>this</code>æ—¶ï¼Œå®ƒè‡ªåŠ¨æŒ‡å‘å½“å‰è°ƒç”¨è¯¥æˆå‘˜å‡½æ•°çš„å¯¹è±¡ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">MyClass</span>(<span class="type">int</span> val) : <span class="built_in">x</span>(val) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;x = &quot;</span> &lt;&lt; x &lt;&lt; endl;   </span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;this = &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">MyClass <span class="title">obj</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line">    obj.<span class="built_in">show</span>(); <span class="comment">// x = 10   thisæŒ‡é’ˆçš„å€¼æ˜¯å¯¹è±¡çš„åœ°å€</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>this</strong> æŒ‡é’ˆçš„ç‰¹ç‚¹</p><p> Â· <code>this</code>æŒ‡é’ˆæ˜¯éšå¼ä¼ é€’ç»™æˆå‘˜å‡½æ•°çš„ã€‚ä¸éœ€è¦æ˜¾ç¤ºåœ°å°†å®ƒä½œä¸ºå‚æ•°ä¼ é€’ï¼Œå®ƒæ˜¯C++ç¼–è¯‘å™¨è‡ªåŠ¨æä¾›çš„ã€‚</p><p> Â· <code>this</code>æŒ‡é’ˆæ˜¯åªè¯»çš„ã€‚ä½ ä¸èƒ½ä¿®æ”¹ <code>this</code>æŒ‡é’ˆæœ¬èº«ï¼ˆæ—¢ä¸èƒ½è®© <code>this</code> æŒ‡é’ˆæŒ‡å‘å…¶ä»–å¯¹è±¡ï¼‰ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡å®ƒè®¿é—®çš„å¯¹è±¡çš„æˆå‘˜ã€‚</p><p> Â· å¯¹äºéé™æ€æˆå‘˜å‡½æ•°ï¼Œ <code>this</code> æŒ‡é’ˆæ€»æ˜¯å­˜åœ¨çš„ï¼Œè€Œåœ¨é™æ€æˆå‘˜å‡½æ•°ä¸­æ²¡æœ‰thisæŒ‡é’ˆï¼Œå› ä¸ºé™æ€å‡½æ•°ä¸ä¾èµ–ä»»ä½•ç‰¹å®šçš„å¯¹è±¡ã€‚</p><p> Â· <code>this</code> æŒ‡é’ˆçš„ç±»å‹æ˜¯ClassName*ï¼Œ å®ƒæŒ‡å‘è°ƒç”¨æˆå‘˜å‡½æ•°çš„å¯¹è±¡ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Myclass</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">Myclass</span>(<span class="type">int</span> val) : <span class="built_in">x</span>(val) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setX</span><span class="params">(<span class="type">int</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;x = x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>this-&gt;x</code> è¡¨ç¤ºå½“å‰å¯¹è±¡çš„æˆå‘˜å˜é‡xï¼Œè€Œxåˆ™è¡¨ç¤ºå‡½æ•°çš„å‚æ•°ã€‚è¿™æ ·å¯ä»¥é¿å…æˆå‘˜å˜é‡ä¸å‡½æ•°å‚æ•°åç§°å†²çªçš„é—®é¢˜ã€‚</p><p><code>this</code>  æŒ‡é’ˆçš„ä½¿ç”¨åœºæ™¯</p><p>1ï¸âƒ£ åŒºåˆ†æˆå‘˜å˜é‡å’Œå±€éƒ¨å˜é‡</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    <span class="built_in">MyClass</span>(<span class="type">int</span> x)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;x = x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>2ï¸âƒ£ é“¾å¼è°ƒç”¨</p><p><code>this</code> æŒ‡é’ˆçš„è¿”å›å€¼å¯ä»¥ç”¨äºé“¾å¼è°ƒç”¨ï¼Œå¸¸è§äºå®ç°æµå¼æ“ä½œæ¥å£ï¼ˆæ¯”å¦‚std::stringçš„æ“ä½œï¼‰ã€‚è¿”å›<code>*this</code> æ„å‘³ç€è¿”å›å½“å‰å¯¹è±¡çš„å¼•ç”¨ï¼Œä»è€Œå¯ä»¥é“¾å¼è°ƒç”¨å¤šä¸ªæ–¹æ³•ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    <span class="function">MyClass&amp; <span class="title">setX</span><span class="params">(<span class="type">int</span> val)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        x = val;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>; <span class="comment">// è¿”å›å½“å‰å¯¹è±¡çš„å¼•ç”¨ï¼Œå®ç°é“¾å¼è°ƒç”¨</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">show</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;x = &quot;</span> &lt;&lt; x &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">MyClass <span class="title">obj</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line">    obj.<span class="built_in">setX</span>(<span class="number">20</span>).<span class="built_in">setX</span>(<span class="number">30</span>).<span class="built_in">show</span>();  <span class="comment">// é“¾å¼è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ï¸âƒ£ this æŒ‡é’ˆçš„ç‰¹æ®Šæƒ…å†µ</p><p><code>this</code> æŒ‡é’ˆåœ¨é™æ€æˆå‘˜å‡½æ•°ä¸­çš„ä¸å­˜åœ¨ï¼Œé™æ€æˆå‘˜å‡½æ•°ä¸ä¾èµ–äºä»»ä½•ç‰¹å®šçš„å¯¹è±¡ï¼Œå› æ­¤å®ƒä»¬æ²¡æœ‰<code>this</code>æŒ‡é’ˆã€‚ä½ ä¸èƒ½åœ¨é™æ€æˆå‘˜å‡½æ•°ä¸­ä½¿ç”¨<code>this</code>ï¼Œå› ä¸ºé™æ€æˆå‘˜å‡½æ•°æ˜¯ç±»çš„çº§åˆ«ä¸Šçš„ï¼Œè€Œä¸æ˜¯å¯¹è±¡çš„çº§åˆ«ä¸Šçš„ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">staticFunction</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ä¸èƒ½ä½¿ç”¨thisæŒ‡é’ˆï¼Œå› ä¸ºstaticFunction æ˜¯é™æ€æˆå‘˜å‡½æ•°</span></span><br><span class="line">        <span class="comment">// this-&gt; x = 10;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4ï¸âƒ£ <code>this</code> æŒ‡é’ˆä¸ <code>const</code> ä¿®é¥°ç¬¦</p><p> Â· åœ¨å¸¸é‡æˆå‘˜å‡½æ•°ä¸­ï¼Œ<code>this</code> æŒ‡é’ˆæ˜¯ <code>const</code>ç±»å‹çš„ï¼Œè¿™æ„å‘³ç€ä½ ä¸èƒ½é€šè¿‡thisæŒ‡é’ˆè®¿é—®çš„å¯¹è±¡æˆå‘˜ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    <span class="built_in">MyClass</span>(<span class="type">int</span> val) : <span class="built_in">x</span>(val) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">show</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//ä¸èƒ½ä¿®æ”¹æˆå‘˜å˜é‡</span></span><br><span class="line">        <span class="comment">// x = 10;  // é”™è¯¯ï¼š ä¸èƒ½åœ¨constå‡½æ•°ä¸­ä¿®æ”¹å¯¹è±¡çš„çŠ¶æ€</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>5ï¸âƒ£ <code>this</code> æŒ‡é’ˆä¸<code>const</code>å¯¹è±¡</p><p>å¯¹äºå¸¸é‡å¯¹è±¡ï¼Œ<code>this</code> æŒ‡é’ˆä¼šè¢«éšå¼åœ°è½¬æ¢ä¸º<code>const</code> ç±»å‹ï¼Œç¡®ä¿é€šè¿‡<code>this</code>æŒ‡é’ˆè®¿é—®çš„å¯¹è±¡ä¸ä¼šè¢«ä¿®æ”¹ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">printObject</span><span class="params">(<span class="type">const</span> MyClass&amp; obj)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; obj.x &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>6ï¸âƒ£ <code>this</code> æŒ‡é’ˆçš„è¿”å›ç±»å‹</p><p>ç”±äº <code>this</code> æŒ‡é’ˆçš„ç±»å‹æ˜¯å½“å‰ç±»çš„æŒ‡é’ˆï¼Œæ‰€ä»¥å¯ä»¥å°†å®ƒä½œä¸ºè¿”å›å€¼è¿”å›ã€‚è¿™æ ·é€šå¸¸ç”¨äºé“¾å¼è°ƒç”¨æˆ–åœ¨ç±»æˆå‘˜å‡½æ•°ä¸­ä¼ é€’å¯¹è±¡çš„å¼•ç”¨ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    <span class="built_in">MyClass</span>(<span class="type">int</span> val) : <span class="built_in">x</span>(val) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">MyClass* <span class="title">getThis</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;  <span class="comment">// è¿”å›å½“å‰å¯¹è±¡çš„æŒ‡é’ˆã€‚</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>this</code>æŒ‡é’ˆæ˜¯C++ä¸­éå¸¸é‡è¦çš„ç‰¹æ€§ï¼Œå®ƒå…è®¸æˆå‘˜å‡½æ•°è®¿é—®å½“å‰å¯¹è±¡çš„æˆå‘˜ï¼Œå¹¶ä¸”æœ‰åŠ©äºåœ¨ç±»ä¸­å®ç°é“¾å¼è°ƒç”¨ã€åŒºåˆ†å‚æ•°å’Œæˆå‘˜å˜é‡ç­‰åŠŸèƒ½ã€‚ç†è§£<code>this</code>æŒ‡é’ˆå¯¹äºæ·±å…¥æŒæ¡C++è‡³å…³é‡è¦ï¼Œç‰¹åˆ«æ˜¯åœ¨å¯¹è±¡æ“ä½œå’Œå†…å­˜ç®¡ç†æ–¹é¢ã€‚</p><p><strong><code>const</code></strong></p><p><code>const</code> åœ¨å‰é¢è¯´æ˜å‡½æ•°è¿”å›å€¼æ˜¯<code>const</code>  ï¼Œåœ¨åé¢è¯´æ˜è¿™ä¸ªå‡½æ•°æ˜¯<code>const</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Role.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">const</span> Role user;</span><br><span class="line"></span><br><span class="line">Role monster;</span><br><span class="line"><span class="type">const</span> Role* puser&#123; &amp;user &#125;;</span><br><span class="line"><span class="comment">// puser-&gt;damage = 2;  // å¸¸é‡æŒ‡é’ˆä¸èƒ½ç¼–è¯‘</span></span><br><span class="line"><span class="comment">// puser-&gt;    è¿™é‡Œä¸èƒ½è°ƒç”¨æˆå‘˜å‡½æ•°</span></span><br><span class="line">puser-&gt;<span class="built_in">GetHp</span>();  <span class="comment">// GetHp()åé¢åŠ ä¸Šconst å°±å¯ä»¥å®šä¹‰äº†</span></span><br><span class="line">monster.<span class="built_in">GetHp</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Role</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> hp;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">GetHP</span><span class="params">()</span> <span class="type">const</span></span>;   <span class="comment">// const æˆå‘˜å‡½æ•°å†…éƒ¨ä¸€å¾‹ä¸å¯ä»¥åšä»»ä½•æ”¹å˜çš„</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>const</code> å¯¹è±¡ä¸èƒ½ä»¥ä»»ä½•æ–¹å¼æ”¹å˜ï¼Œè¿™æ˜¯<code>const</code> åŸåˆ™ï¼Œåœ¨è¿™ä¸ªåŸåˆ™ä¸‹ï¼Œ<code>const</code>å¯¹è±¡åªèƒ½è°ƒç”¨<code>const</code>æˆå‘˜å‡½æ•°ã€‚</p><p>åœ¨<code>const</code> æˆå‘˜å‡½æ•°ä¸‹ï¼Œ<code>this</code>æŒ‡é’ˆä¹Ÿå˜æˆäº†<code>const</code>æŒ‡é’ˆã€‚</p><p>æˆå‘˜å‡½æ•°æ˜¯<code>const</code>çš„æƒ…å†µä¸‹ï¼Œæƒ³è¿”å›å¼•ç”¨ï¼Œåªèƒ½åœ¨å‰é¢åŠ ä¸Š<code>const</code>ï¼Œæˆ–è€…ä¸è¿”å›å¼•ç”¨ï¼ŒæŒ‰å€¼æ¥ä¼ é€’ã€‚</p><p>1ï¸âƒ£ æ‰€æœ‰æ²¡æœ‰è®¾è®¡ä¿®æ”¹æˆå‘˜å˜é‡çš„æˆå‘˜å‡½æ•°ï¼Œä¸€å¾‹åŠ ä¸Š<code>const</code></p><p>2ï¸âƒ£ åˆ©ç”¨å‡½æ•°é‡è½½</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">GetDamage</span><span class="params">()</span> <span class="type">const</span></span>;  <span class="comment">// const å¯¹è±¡ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">GetDamage</span><span class="params">()</span></span>;   <span class="comment">// éconst å¯¹è±¡ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°</span></span><br></pre></td></tr></table></figure><p><strong>const ç±»å‹è½¬æ¢</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">(Role* p)</span>   <span class="comment">// å¿˜è®°åŠ constäº†ï¼Œ æ‰€ä»¥ä¸‹é¢æ‰è¿›è¡Œç±»å‹è½¬æ¢</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    p-&gt;<span class="built_in">SetHP</span>(<span class="number">5000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">const</span> Role user;</span><br><span class="line">    <span class="type">const</span> Role* puser&#123; &amp;user &#125;;</span><br><span class="line">    <span class="built_in">test</span>((Role*)(&amp;user));  <span class="comment">// C è¯­è¨€çš„è½¬æ¢</span></span><br><span class="line">    <span class="built_in">test</span>(<span class="built_in">const_cast</span>&lt;Role*&gt;(&amp;user));   <span class="comment">// c++ çš„è½¬æ¢</span></span><br><span class="line">    std::cout &lt;&lt; puser-&gt;<span class="built_in">GetHP</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>mutable å…³é”®å­—</strong></p><p><code>mutable</code> å…³é”®å­—æ˜¯ä¸€ä¸ªéå¸¸ç‰¹æ®Šçš„ä¿®é¥°ç¬¦ï¼Œå®ƒä¸»è¦ç”¨äºç±»çš„æ•°æ®æˆå‘˜ä¸Šã€‚<code>mutable</code> çš„ä½œç”¨æ˜¯å…è®¸å³ä½¿åœ¨ <code>const</code> æˆå‘˜å‡½æ•°ä¸­ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹è¢«ä¿®é¥°çš„æˆå‘˜å˜é‡çš„å€¼ã€‚&#96;</p><p>1ï¸âƒ£ <code>const</code> æˆå‘˜å‡½æ•°çš„é™åˆ¶ï¼ŒæŒ‡ä¸€ä¸ªå£°æ˜ä¸º <code>const</code> çš„æˆå‘˜å‡½æ•°ï¼Œè¿™æ„å‘³ç€è¯¥æˆå‘˜å‡½æ•°æ‰¿è¯ºä¸ä¼šä¿®æ”¹å¯¹è±¡çš„çŠ¶æ€ï¼Œå³ä¸ä¼šä¿®æ”¹å¯¹è±¡çš„é <code>mutable</code> æˆå‘˜å˜é‡ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    <span class="built_in">MyClass</span>(<span class="type">int</span> val) : <span class="built_in">x</span>(val) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">show</span><span class="params">()</span> <span class="type">const</span></span>&#123;    <span class="comment">// const æˆå‘˜å‡½æ•°</span></span><br><span class="line">        x = <span class="number">10</span>;    <span class="comment">//  é”™è¯¯ï¼Œ const æˆå‘˜å‡½æ•°ä¸èƒ½ä¿®æ”¹æˆå‘˜å˜é‡</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>show()</code> è¢«å£°æ˜ä¸º <code>const</code> æˆå‘˜å‡½æ•°ï¼Œå®ƒæ‰¿è¯ºä¸ä¿®æ”¹ç±»çš„ä»»ä½•æˆå‘˜ã€‚å› ä¸º <code>x</code> ä¸æ˜¯ <code>mutable</code> æˆå‘˜å˜é‡ï¼Œæ‰€ä»¥è¯•å›¾åœ¨ <code>const</code> æˆå‘˜å‡½æ•°ä¸­ä¿®æ”¹ <code>x</code> æ˜¯ä¸å…è®¸çš„ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚</p><p>2ï¸âƒ£  <code>mutable</code> çš„ä½œç”¨</p><p><code>mutable</code> å…³é”®å­—çš„å‡ºç°å°±æ˜¯ä¸ºäº†å…è®¸æŸäº›ç‰¹å®šæˆå‘˜å˜é‡åœ¨ <code>const</code> æˆå‘˜å‡½æ•°ä¸­ä¿®æ”¹ã€‚è¿™å¯¹å®ç°ç¼“å­˜ã€å»¶è¿Ÿè®¡ç®—ã€è®°å½•æ—¥å¿—ç­‰åœºæ™¯éå¸¸æœ‰ç”¨ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">mutable</span> <span class="type">int</span> x;</span><br><span class="line">    <span class="built_in">MyClass</span>(<span class="type">int</span> val) : <span class="built_in">x</span>(val) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">show</span><span class="params">()</span> <span class="type">const</span></span>&#123;    <span class="comment">// const æˆå‘˜å‡½æ•°</span></span><br><span class="line">        x = <span class="number">10</span>;    <span class="comment">//  å…è®¸ï¼šx æ˜¯ mutableï¼Œ å¯ä»¥åœ¨ const å‡½æ•°ä¸­ä¿®æ”¹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>æ„é€ å‡½æ•°</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> hp;</span><br><span class="line">    <span class="type">int</span> mp;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">GetMP</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> mp; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">SetMP</span><span class="params">(<span class="type">int</span> _lv)</span> </span>&#123; lv = _lv; &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> lv;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    T t1&#123; <span class="number">100</span>,<span class="number">200</span> &#125;;  <span class="comment">// ä¸èƒ½åˆå§‹åŒ–lv</span></span><br><span class="line">    t<span class="number">1.</span><span class="built_in">SetMP</span>(<span class="number">109</span>);  <span class="comment">// å¯ä»¥è®¾ç½®lv</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ„é€ å‡½æ•°åœ¨ç±»è¢«åˆ›å»ºçš„æ—¶å€™è‡ªåŠ¨è¢«è°ƒç”¨ï¼Œä¸€èˆ¬ç”¨æ¥åˆ›å»ºæ–°çš„ç±»å®ä¾‹æ—¶æ‰§è¡Œåˆå§‹åŒ–æ“ä½œï¼Œæ„é€ å‡½æ•°ä¸å®ƒæ‰€åœ¨çš„ç±»åŒåï¼Œå¹¶ä¸”æ²¡æœ‰è¿”å›å€¼ï¼Œä»»ä½•ç±»éƒ½è‡³å°‘æœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼›</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> hp;</span><br><span class="line">    <span class="built_in">T</span>()  <span class="comment">// æ— å‚æ•°çš„æ„é€ å‡½æ•°</span></span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;T()\n&quot;</span>;</span><br><span class="line">        hp = <span class="number">100</span>;</span><br><span class="line">        mp = <span class="number">200</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">T</span>(<span class="type">int</span> _hp, <span class="type">int</span> _mp,)  <span class="comment">// æœ‰å‚æ•°çš„æ„é€ å‡½æ•°</span></span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;T(int,int)\n&quot;</span>;</span><br><span class="line">        hp = _hp;</span><br><span class="line">        mp = _mp;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">T</span>(T&amp; t)   <span class="comment">//  ç•™ä¸‹ç–‘é—®ï¼Œä¸ºä»€ä¹ˆè¦åŠ ä¸ªå¼•ç”¨</span></span><br><span class="line">    &#123;</span><br><span class="line">        hp = t.hp;</span><br><span class="line">        mp = t.<span class="built_in">GetMP</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> mp;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    T t1&#123;<span class="number">100</span>, <span class="number">200</span>&#125;;   <span class="comment">// è°ƒç”¨æœ‰å‚æ•°çš„æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="function">T <span class="title">t2</span><span class="params">(t1)</span></span>;   <span class="comment">// è°ƒç”¨çš„å°±æ˜¯T(T&amp; t)</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;\n.............\n&quot;</span>;</span><br><span class="line">    std::cout &lt;&lt; t<span class="number">1.</span>hp &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; t<span class="number">1.</span><span class="built_in">GetMP</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸€ä¸ªç±»æ²¡æœ‰æ˜æ˜¾çš„å®šä¹‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šè‡ªåŠ¨çš„æ·»åŠ ä¸€ä¸ªé»˜è®¤çš„æ„é€ å‡½æ•°ï¼Œè¿™ä¸ªé»˜è®¤çš„æ„é€ å‡½æ•°æ˜¯æ— å‚æ•°ã€æ— è¿”å›å€¼çš„å‡½æ•°</p><p><strong><code>default</code>å…³é”®å­—</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Role</span>() = <span class="keyword">default</span>;</span><br><span class="line"><span class="built_in">Role</span>(<span class="type">int</span> _lv = <span class="number">500</span>) &#123; lv = _lv; &#125;  <span class="comment">// å¦‚æœæœ‰é»˜è®¤å€¼çš„è¯ç¼–è¯‘å™¨ä¸èƒ½åŒºåˆ†å‡ºæ¥</span></span><br></pre></td></tr></table></figure><p>ä¸å»ºè®®è¿™ä¹ˆå†™</p><p><strong><code>explicit</code> å…³é”®å­—</strong></p><p>è¢« <code>explicit</code> å…³é”®å­—ä¿®é¥°çš„æ„é€ å‡½æ•°ä¼šç¦ç”¨ç±»å‹è½¬æ¢ï¼Œå®ƒå¯ä»¥é˜²æ­¢ç¼–è¯‘å™¨åœ¨è¿›è¡Œç±»å‹è½¬æ¢æ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨æŸäº›æ„é€ å‡½æ•°ã€‚è¿™æ˜¯ä¸ºäº†é¿å…éšå¼ç±»å‹è½¬æ¢ï¼ˆéšå¼æ„é€ æˆ–éšå¼è½¬æ¢ï¼‰å¯¼è‡´æ½œåœ¨çš„é”™è¯¯æˆ–ä¸å¸Œæœ›å‘ç”Ÿçš„è¡Œä¸ºã€‚</p><p>éšå¼ç±»å‹è½¬æ¢çš„é£é™©</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MyClass</span>(<span class="type">int</span> x)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;----------&quot;</span> &lt;&lt; x &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(MyClass obj)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;In foo&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">foo</span>(<span class="number">42</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>foo(42)</code> å®é™…ä¸Šæ˜¯è°ƒç”¨äº† <code>MyClass</code> çš„æ„é€ å‡½æ•°ï¼Œå¹¶å°† <code>42</code> è½¬æ¢ä¸º <code>MyClass</code> ç±»å‹å¯¹è±¡ã€‚è¿™ç§éšå¼è½¬æ¢å¯èƒ½æ˜¯å®‰å…¨çš„ï¼Œä½†å®ƒä¹Ÿå¯èƒ½ä¼šå¼•å…¥æ„å¤–çš„è¡Œä¸ºï¼Œç‰¹åˆ«æ˜¯åœ¨æ„é€ å‡½æ•°çš„é€»è¾‘è¾ƒä¸ºå¤æ‚æ—¶ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">MyClass</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;----------&quot;</span> &lt;&lt; x &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(MyClass obj)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;In foo&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">foo</span>(<span class="built_in">MyClass</span>(<span class="number">42</span>));  <span class="comment">// å¿…é¡»æ˜¾ç¤ºçš„è°ƒç”¨æ„é€ å‡½æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ·±å…¥ç†è§£æ„é€ å‡½æ•°</strong></p><p>ä½¿ç”¨æˆå‘˜åˆå§‹åŒ–åˆ—è¡¨</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ROLE</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> lv;</span><br><span class="line">    <span class="type">int</span> hpRecover;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        hpRecover = <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//  æ•ˆç‡æ›´é«˜  æŸäº›æƒ…å†µä¸‹åªèƒ½ç”¨è¿™ç§æ–¹å¼åˆå§‹åŒ–</span></span><br><span class="line">    <span class="built_in">ROLE</span>(<span class="type">int</span> _lv, <span class="type">int</span> _damage) : lv&#123;_lv&#125;,damage&#123;_damage&#125; &#123;&#125;</span><br><span class="line">    <span class="type">int</span> hp;</span><br><span class="line">    <span class="type">int</span> damage;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Act</span><span class="params">(ROLE&amp; role)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æˆå‘˜å‡½æ•°åˆå§‹åŒ–åˆ—è¡¨è¿™æ ·çš„æ–¹å¼æ„é€ ç±»ï¼Œè¦æ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼Œå³ä¸ºæˆå‘˜èµ‹å€¼çš„é¡ºåºä¸æ˜¯ä¾æ®ä»£ç çš„é¡ºåºï¼Œè€Œæ˜¯æˆå‘˜å˜é‡åœ¨ç±»çš„å‡ºç°é¡ºåºã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ROLE</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> lv;</span><br><span class="line">    <span class="type">int</span> hpRecover;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ROLE</span>(<span class="type">int</span> _lv, <span class="type">int</span> _damage) : lv&#123;_lv&#125;,damage&#123;_damage&#125;,hp&#123;_lv*<span class="number">100</span>&#125;,hpRecover&#123;lv&#125; &#123;&#125;</span><br><span class="line">    <span class="type">int</span> damage;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Act</span><span class="params">(ROLE&amp; role)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å®é™…åˆå§‹åŒ–çš„é¡ºåº</span></span><br><span class="line"><span class="comment">hp=lv*100</span></span><br><span class="line"><span class="comment">hpRecover = lv;</span></span><br><span class="line"><span class="comment">lv = _lv;</span></span><br><span class="line"><span class="comment">damage = _damage;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p><strong>å§”æ‰˜æ„é€ å‡½æ•°</strong></p><p>å®ƒå…è®¸ä¸€ä¸ªæ„é€ å‡½æ•°è°ƒç”¨å¦ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚å§”æ‰˜æ„é€ å‡½æ•°é€šè¿‡å°†å…¶æ„é€ é€»è¾‘å§”æ‰˜ç»™åŒä¸€ç±»ä¸­çš„å¦ä¸€ä¸ªæ„é€ å‡½æ•°æ¥å‡å°‘ä»£ç é‡å¤ï¼Œå¹¶æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ROLE</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> lv;</span><br><span class="line">    <span class="type">int</span> hpRecover;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ROLE</span>():<span class="built_in">ROLE</span>(<span class="number">100</span>,<span class="number">200</span>) &#123;&#125;</span><br><span class="line">    <span class="built_in">ROLE</span>(<span class="type">int</span> _lv, <span class="type">int</span> _damage):lv&#123;_lv&#125;,damage&#123;_damage&#125; &#123;&#125;</span><br><span class="line">    <span class="type">int</span> damage;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Act</span><span class="params">(ROLE&amp; role)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å§”æ‰˜æ„é€ å‡½æ•°åˆå§‹åŒ–åˆ—è¡¨é‡Œä¸èƒ½åˆå§‹åŒ–æˆå‘˜å˜é‡ä¸”åªèƒ½è°ƒç”¨ä¸€æ¬¡åŒä¸€ä¸ªç±»çš„æ„é€ å‡½æ•°</span></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// å§”æ‰˜æ„é€ å‡½æ•°ï¼šè°ƒç”¨å¦ä¸€ä¸ªæ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">Person</span>() : <span class="built_in">Person</span>(<span class="string">&quot;Unknown&quot;</span>, <span class="number">0</span>)  <span class="comment">// å§”æ‰˜ä¹‹åï¼Œè¿™é‡Œå°±ä¸å†™name(name), age(age)è¿™ç§äº†åˆ—è¡¨äº†</span></span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Default constructor called&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦ä¸€ä¸ªæ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">Person</span>(<span class="type">const</span> std::string&amp; name, <span class="type">int</span> age) : <span class="built_in">name</span>(name), <span class="built_in">age</span>(age) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Parameterized constructor called&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Name: &quot;</span> &lt;&lt; name &lt;&lt; <span class="string">&quot;, Age: &quot;</span> &lt;&lt; age &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Person p1;  <span class="comment">// å°†è°ƒç”¨é»˜è®¤æ„é€ å‡½æ•°ï¼Œè¿›è€Œå§”æ‰˜ç»™å¸¦å‚æ•°çš„æ„é€ å‡½æ•°</span></span><br><span class="line">    p<span class="number">1.</span><span class="built_in">display</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function">Person <span class="title">p2</span><span class="params">(<span class="string">&quot;Alice&quot;</span>, <span class="number">30</span>)</span></span>;  <span class="comment">// è°ƒç”¨å¸¦å‚æ•°çš„æ„é€ å‡½æ•°</span></span><br><span class="line">    p<span class="number">2.</span><span class="built_in">display</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å‰¯æœ¬æ„é€ å‡½æ•°</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Role role1;</span><br><span class="line"><span class="function">Role <span class="title">role2</span><span class="params">(role1)</span></span>;</span><br><span class="line"><span class="comment">// ç¼–è¯‘å™¨ä¸ºç±»æŒ‡å®šäº†ä¸€ä¸ªé»˜è®¤çš„å‰¯æœ¬æ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨æŒ‡å®šå‰¯æœ¬æ„é€ å‡½æ•°ã€‚</span></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Role.h</span></span><br><span class="line"><span class="built_in">Role</span>(Role&amp; rl) </span><br><span class="line">&#123;</span><br><span class="line">    hp = rl.hp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line">user.<span class="built_in">setHP</span>(<span class="number">5000</span>);</span><br><span class="line"><span class="function">Role <span class="title">userA</span><span class="params">(user)</span></span>;  <span class="comment">// ä½¿ç”¨æˆ‘ä»¬è‡ªå·±åšçš„æ„é€ å‡½æ•°ï¼Œåªæ‹·è´hpçš„å€¼</span></span><br></pre></td></tr></table></figure><p><code>Role(Role&amp; rl)</code>   å¼•ç”¨é—®é¢˜</p><p>åœ¨ C++ ä¸­ï¼Œå½“ä½ ä¼ é€’å¯¹è±¡ç»™å‡½æ•°æˆ–è€…åœ¨å¯¹è±¡åˆå§‹åŒ–æ—¶ï¼Œå¦‚æœå‚æ•°ç±»å‹ä¸æ˜¯å¼•ç”¨ï¼ˆå³ä¼ å€¼æ–¹å¼ï¼‰ï¼Œé‚£ä¹ˆä¼šå‘ç”Ÿ<strong>å‰¯æœ¬åˆ›å»º</strong>ï¼Œå³ç¼–è¯‘å™¨ä¼šè°ƒç”¨å‰¯æœ¬æ„é€ å‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚ä¼ å€¼ä¼šå¯¼è‡´ä¸€æ¬¡é¢å¤–çš„å¤åˆ¶æ“ä½œï¼Œæ¶ˆè€—é¢å¤–çš„æ—¶é—´å’Œèµ„æºã€‚</p><p>ä½¿ç”¨å¼•ç”¨ç±»å‹å‚æ•°ï¼ˆ<code>Role&amp; rl</code>ï¼‰å¯ä»¥é¿å…è¿™ç§å¤šä½™çš„å¤åˆ¶ï¼Œç›´æ¥å¼•ç”¨åŸæœ‰å¯¹è±¡ã€‚å› æ­¤ï¼Œå‰¯æœ¬æ„é€ å‡½æ•°çš„å‚æ•°ä¸€èˆ¬å®šä¹‰ä¸º<strong>å¸¸é‡å¼•ç”¨</strong>ï¼ˆ<code>const Role&amp; rl</code>ï¼‰ï¼Œæ¥é¿å…å¯¹åŸå¯¹è±¡è¿›è¡Œä¿®æ”¹ã€‚</p><p>å¦‚æœå‰¯æœ¬æ„é€ å‡½æ•°çš„å‚æ•°æ˜¯æŒ‰å€¼ä¼ é€’ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨å‰¯æœ¬æ„é€ å‡½æ•°æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå°è¯•ç”¨è¿™ä¸ªå€¼åˆå§‹åŒ–ä¸€ä¸ªæ–°å¯¹è±¡ã€‚è¿™åˆä¼šè°ƒç”¨å‰¯æœ¬æ„é€ å‡½æ•°ï¼Œè€Œå‰¯æœ¬æ„é€ å‡½æ•°æ˜¯ç”¨æ¥æ„é€ å‰¯æœ¬çš„ï¼Œè¿™ä¼šå¯¼è‡´é€’å½’è°ƒç”¨ï¼Œé€ æˆæ ˆæº¢å‡ºã€‚</p><p>é€šè¿‡ä¼ é€’å¼•ç”¨ï¼Œå‰¯æœ¬æ„é€ å‡½æ•°é¿å…äº†é‡æ–°è°ƒç”¨è‡ªèº«ï¼Œè§£å†³äº†é€’å½’è°ƒç”¨çš„é—®é¢˜ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Role userA = user;  <span class="comment">// userAè¿˜æ²¡æœ‰æ„é€ ï¼ŒæŠŠuserå½“æˆå‚æ•°</span></span><br><span class="line">userA = user;   <span class="comment">// è¿™é‡Œå°±ä¸å†æ„é€ å‡½æ•°äº†</span></span><br></pre></td></tr></table></figure><p><strong>ææ„å‡½æ•°</strong></p><p>ç”¨æ¥é”€æ¯ä¸€ä¸ªç±»ï¼Œææ„å‡½æ•°æ²¡æœ‰å‚æ•°ï¼Œæ²¡æœ‰è¿”å›ç±»å‹ï¼Œä½¿ç”¨defaultæ¥å®šä¹‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">~ç±»å()   <span class="comment">// æ²¡å‚æ•°å°±ä¸èƒ½é‡è½½</span></span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç©ºçš„ææ„å‡½æ•°</span></span><br><span class="line">~<span class="built_in">ROLE</span>() = <span class="keyword">default</span>;  </span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Role</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span>* ary;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Role</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        ary = <span class="keyword">new</span> <span class="type">int</span>[<span class="number">100</span>];</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;\nç±»è¢«åˆ›å»º&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">Role</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span>[] ary;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;\n ç±»è¢«é”€æ¯&quot;</span>;   <span class="comment">// è¿™æ ·å†™é˜²æ­¢å†…å­˜æ³„éœ²</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// std::string å°±ç”¨åˆ°è¿™ç§æŠ€æœ¯</span></span><br></pre></td></tr></table></figure><p><strong>å®ç°å­—ç¬¦ä¸²ç±»<code>hstring</code></strong></p><p><code>std::string</code> è®¾è®¡ä¸€ä¸ªç±» <code>hstirng</code></p><p><code>hstring str(&quot;ä½ å¥½ï¼&quot;);</code>    &#x2F;&#x2F; æ„é€ å‡½æ•°</p><p><code>hstring strA(str);</code>   &#x2F;&#x2F; å‰¯æœ¬æ„é€ å‡½æ•°</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">hstring</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">char</span>* c_str;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">short</span> len;</span><br><span class="line"><span class="function"><span class="type">unsigned</span> <span class="type">short</span> <span class="title">length</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">unsigned</span> <span class="type">short</span> len&#123;&#125;;</span><br><span class="line"><span class="keyword">while</span> (str[len++]);</span><br><span class="line"><span class="keyword">return</span> len;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">hstring</span>()</span><br><span class="line">&#123;</span><br><span class="line">len = <span class="number">1</span>;</span><br><span class="line">c_str = <span class="keyword">new</span> <span class="type">char</span>[<span class="number">1</span>] &#123;<span class="number">0</span>&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">hstring</span>(<span class="type">const</span> <span class="type">char</span>* str)</span><br><span class="line">&#123;</span><br><span class="line">len = <span class="built_in">length</span>(str) + <span class="number">1</span>;</span><br><span class="line"><span class="comment">//c_str = (char*)str;  // æŒ‡å‘äº†å¸¸é‡çš„å†…å­˜ç©ºé—´,æ‰€ä»¥è¿è¡Œèµ·æ¥ä¼šå‡ºé”™</span></span><br><span class="line">c_str = <span class="keyword">new</span> <span class="type">char</span>[len];</span><br><span class="line"><span class="built_in">memcpy</span>(c_str, str, len);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">char</span>* <span class="title">Show</span><span class="params">()</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> c_str;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">~<span class="built_in">hstring</span>() &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">hstring <span class="title">str</span><span class="params">(<span class="string">&quot;ä½ å¥½ï¼ï¼&quot;</span>)</span></span>;</span><br><span class="line">std::cout &lt;&lt; str.<span class="built_in">Show</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç§æœ‰æˆå‘˜å˜é‡çš„è®¿é—®</p><p>åœ¨ C++ ä¸­ï¼Œç±»çš„ç§æœ‰å˜é‡ï¼ˆprivate membersï¼‰åªèƒ½åœ¨ç±»çš„å†…éƒ¨è¿›è¡Œè®¿é—®ï¼Œä¸èƒ½ç›´æ¥ä»ç±»çš„å¤–éƒ¨è¿›è¡Œè®¿é—®ã€‚ç§æœ‰æˆå‘˜æ˜¯ä¸ºäº†å®ç°æ•°æ®å°è£…ï¼ˆEncapsulationï¼‰è¿™ä¸€é¢å‘å¯¹è±¡ç¼–ç¨‹çš„åŸºæœ¬åŸåˆ™ï¼Œç›®çš„æ˜¯éšè—ç±»çš„å†…éƒ¨å®ç°ç»†èŠ‚ï¼Œåªå…è®¸é€šè¿‡å…¬å…±æ¥å£ï¼ˆå¦‚å…¬å…±æˆå‘˜å‡½æ•°ï¼‰æ¥è®¿é—®å’Œä¿®æ”¹ç§æœ‰æ•°æ®ã€‚</p><h3 id="1-å¦‚ä½•è®¿é—®ç±»çš„ç§æœ‰æˆå‘˜"><a href="#1-å¦‚ä½•è®¿é—®ç±»çš„ç§æœ‰æˆå‘˜" class="headerlink" title="1. å¦‚ä½•è®¿é—®ç±»çš„ç§æœ‰æˆå‘˜"></a>1. <strong>å¦‚ä½•è®¿é—®ç±»çš„ç§æœ‰æˆå‘˜</strong></h3><p>C++ æä¾›äº†ä¸€äº›æ–¹æ³•æ¥è®¿é—®å’Œä¿®æ”¹ç±»çš„ç§æœ‰å˜é‡ï¼š</p><h4 id="1-1-é€šè¿‡å…¬å…±æˆå‘˜å‡½æ•°è®¿é—®ç§æœ‰æˆå‘˜"><a href="#1-1-é€šè¿‡å…¬å…±æˆå‘˜å‡½æ•°è®¿é—®ç§æœ‰æˆå‘˜" class="headerlink" title="1.1 é€šè¿‡å…¬å…±æˆå‘˜å‡½æ•°è®¿é—®ç§æœ‰æˆå‘˜"></a>1.1 <strong>é€šè¿‡å…¬å…±æˆå‘˜å‡½æ•°è®¿é—®ç§æœ‰æˆå‘˜</strong></h4><p>æœ€å¸¸è§çš„æ–¹å¼æ˜¯é€šè¿‡å…¬å…±æˆå‘˜å‡½æ•°ï¼ˆé€šå¸¸ç§°ä¸º getter å’Œ setterï¼‰æ¥è®¿é—®æˆ–ä¿®æ”¹ç§æœ‰æˆå‘˜ã€‚ç±»çš„ç§æœ‰æˆå‘˜å¯ä»¥é€šè¿‡è¿™äº›å‡½æ•°æä¾›å¯¹å¤–æ¥å£ã€‚</p><p><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cppå¤åˆ¶ä»£ç </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> privateVar;  <span class="comment">// ç§æœ‰æˆå‘˜å˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// å…¬å…±æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">MyClass</span>(<span class="type">int</span> val) : <span class="built_in">privateVar</span>(val) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getterï¼šè®¿é—®ç§æœ‰æˆå‘˜å˜é‡</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getPrivateVar</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> privateVar;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Setterï¼šä¿®æ”¹ç§æœ‰æˆå‘˜å˜é‡</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setPrivateVar</span><span class="params">(<span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">        privateVar = val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">MyClass <span class="title">obj</span><span class="params">(<span class="number">42</span>)</span></span>;  <span class="comment">// åˆ›å»ºå¯¹è±¡å¹¶åˆå§‹åŒ–ç§æœ‰æˆå‘˜</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Private Var: &quot;</span> &lt;&lt; obj.<span class="built_in">getPrivateVar</span>() &lt;&lt; endl;  <span class="comment">// é€šè¿‡å…¬å…±æˆå‘˜å‡½æ•°è®¿é—®ç§æœ‰æˆå‘˜</span></span><br><span class="line">    obj.<span class="built_in">setPrivateVar</span>(<span class="number">100</span>);  <span class="comment">// ä¿®æ”¹ç§æœ‰æˆå‘˜</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Private Var: &quot;</span> &lt;&lt; obj.<span class="built_in">getPrivateVar</span>() &lt;&lt; endl;  <span class="comment">// å†æ¬¡è®¿é—®ä¿®æ”¹åçš„å€¼</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œç§æœ‰æˆå‘˜å˜é‡ <code>privateVar</code> åªèƒ½é€šè¿‡å…¬å…±çš„ getter å‡½æ•° <code>getPrivateVar()</code> å’Œ setter å‡½æ•° <code>setPrivateVar()</code> è®¿é—®å’Œä¿®æ”¹ã€‚è¿™æ˜¯å®ç°ç±»çš„<strong>æ•°æ®å°è£…</strong>çš„ä¸€ç§å¸¸è§æ–¹æ³•ã€‚</p><h4 id="1-2-é€šè¿‡å‹å…ƒå‡½æ•°ï¼ˆFriend-Functionï¼‰è®¿é—®ç§æœ‰æˆå‘˜"><a href="#1-2-é€šè¿‡å‹å…ƒå‡½æ•°ï¼ˆFriend-Functionï¼‰è®¿é—®ç§æœ‰æˆå‘˜" class="headerlink" title="1.2 é€šè¿‡å‹å…ƒå‡½æ•°ï¼ˆFriend Functionï¼‰è®¿é—®ç§æœ‰æˆå‘˜"></a>1.2 <strong>é€šè¿‡å‹å…ƒå‡½æ•°ï¼ˆFriend Functionï¼‰è®¿é—®ç§æœ‰æˆå‘˜</strong></h4><p>é™¤äº†é€šè¿‡å…¬å…±æˆå‘˜å‡½æ•°å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡å®šä¹‰<strong>å‹å…ƒå‡½æ•°</strong>æ¥è®¿é—®ç§æœ‰æˆå‘˜ã€‚å‹å…ƒå‡½æ•°ä¸æ˜¯ç±»çš„æˆå‘˜å‡½æ•°ï¼Œä½†å®ƒå¯ä»¥è®¿é—®ç±»çš„ç§æœ‰æˆå‘˜ã€‚å‹å…ƒå‡½æ•°è¢«å£°æ˜ä¸ºç±»çš„æœ‹å‹ï¼Œæ‹¥æœ‰å¯¹è¯¥ç±»ç§æœ‰æˆå‘˜çš„è®¿é—®æƒé™ã€‚</p><p><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cppå¤åˆ¶ä»£ç </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> privateVar;  <span class="comment">// ç§æœ‰æˆå‘˜å˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MyClass</span>(<span class="type">int</span> val) : <span class="built_in">privateVar</span>(val) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å£°æ˜å‹å…ƒå‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">friend</span> <span class="type">void</span> <span class="title">showPrivateVar</span><span class="params">(<span class="type">const</span> MyClass&amp; obj)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‹å…ƒå‡½æ•°å®šä¹‰</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">showPrivateVar</span><span class="params">(<span class="type">const</span> MyClass&amp; obj)</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Private Var: &quot;</span> &lt;&lt; obj.privateVar &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">MyClass <span class="title">obj</span><span class="params">(<span class="number">42</span>)</span></span>;</span><br><span class="line">    <span class="built_in">showPrivateVar</span>(obj);  <span class="comment">// é€šè¿‡å‹å…ƒå‡½æ•°è®¿é—®ç§æœ‰æˆå‘˜</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>showPrivateVar()</code> æ˜¯ <code>MyClass</code> ç±»çš„å‹å…ƒå‡½æ•°ï¼Œå®ƒå¯ä»¥ç›´æ¥è®¿é—® <code>MyClass</code> çš„ç§æœ‰æˆå‘˜ <code>privateVar</code>ã€‚</p><h4 id="1-3-é€šè¿‡å‹å…ƒç±»ï¼ˆFriend-Classï¼‰è®¿é—®ç§æœ‰æˆå‘˜"><a href="#1-3-é€šè¿‡å‹å…ƒç±»ï¼ˆFriend-Classï¼‰è®¿é—®ç§æœ‰æˆå‘˜" class="headerlink" title="1.3 é€šè¿‡å‹å…ƒç±»ï¼ˆFriend Classï¼‰è®¿é—®ç§æœ‰æˆå‘˜"></a>1.3 <strong>é€šè¿‡å‹å…ƒç±»ï¼ˆFriend Classï¼‰è®¿é—®ç§æœ‰æˆå‘˜</strong></h4><p>é™¤äº†å‹å…ƒå‡½æ•°ï¼ŒC++ è¿˜å…è®¸æ•´ä¸ªç±»æˆä¸ºå¦ä¸€ä¸ªç±»çš„å‹å…ƒç±»ã€‚å‹å…ƒç±»å¯ä»¥è®¿é—®è¢«å®ƒå£°æ˜ä¸ºå‹å…ƒçš„ç±»çš„ç§æœ‰æˆå‘˜ã€‚</p><p><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cppå¤åˆ¶ä»£ç </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AnotherClass</span>;  <span class="comment">// å‰å‘å£°æ˜</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> privateVar;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MyClass</span>(<span class="type">int</span> val) : <span class="built_in">privateVar</span>(val) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å£°æ˜ AnotherClass ä¸ºå‹å…ƒç±»</span></span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">class</span> <span class="title class_">AnotherClass</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AnotherClass</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">showPrivateVar</span><span class="params">(<span class="type">const</span> MyClass&amp; obj)</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Private Var: &quot;</span> &lt;&lt; obj.privateVar &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">MyClass <span class="title">obj</span><span class="params">(<span class="number">42</span>)</span></span>;</span><br><span class="line">    AnotherClass anotherObj;</span><br><span class="line">    anotherObj.<span class="built_in">showPrivateVar</span>(obj);  <span class="comment">// é€šè¿‡å‹å…ƒç±»è®¿é—®ç§æœ‰æˆå‘˜</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>AnotherClass</code> æ˜¯ <code>MyClass</code> çš„å‹å…ƒç±»ï¼Œå› æ­¤ <code>AnotherClass</code> å¯ä»¥ç›´æ¥è®¿é—® <code>MyClass</code> çš„ç§æœ‰æˆå‘˜ <code>privateVar</code>ã€‚</p><h4 id="1-4-é€šè¿‡æŒ‡é’ˆå’Œå¼•ç”¨è®¿é—®ç§æœ‰æˆå‘˜"><a href="#1-4-é€šè¿‡æŒ‡é’ˆå’Œå¼•ç”¨è®¿é—®ç§æœ‰æˆå‘˜" class="headerlink" title="1.4 é€šè¿‡æŒ‡é’ˆå’Œå¼•ç”¨è®¿é—®ç§æœ‰æˆå‘˜"></a>1.4 <strong>é€šè¿‡æŒ‡é’ˆå’Œå¼•ç”¨è®¿é—®ç§æœ‰æˆå‘˜</strong></h4><p>å¦‚æœæœ‰æŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆæˆ–å¼•ç”¨ï¼Œå¹¶ä¸”ä½ èƒ½é€šè¿‡å…¬å…±æ¥å£è®¿é—®ç§æœ‰æˆå‘˜ï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥é€šè¿‡è¿™äº›æ¥å£æ¥è®¿é—®ç§æœ‰æˆå‘˜ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç›´æ¥é€šè¿‡æŒ‡é’ˆæˆ–å¼•ç”¨è®¿é—®ç§æœ‰æˆå‘˜æ˜¯ä¸å¯è¡Œçš„ï¼Œé™¤éä½¿ç”¨ <code>friend</code> å‡½æ•°æˆ–è€… <code>getter</code> å’Œ <code>setter</code>ã€‚</p><p><strong>ç¤ºä¾‹ä»£ç </strong>ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cppå¤åˆ¶ä»£ç </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> privateVar;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MyClass</span>(<span class="type">int</span> val) : <span class="built_in">privateVar</span>(val) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getter</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getPrivateVar</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> privateVar;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">MyClass <span class="title">obj</span><span class="params">(<span class="number">42</span>)</span></span>;</span><br><span class="line">    MyClass* ptr = &amp;obj;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Private Var via pointer: &quot;</span> &lt;&lt; ptr-&gt;<span class="built_in">getPrivateVar</span>() &lt;&lt; endl;  <span class="comment">// é€šè¿‡æŒ‡é’ˆè®¿é—®</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-æ€»ç»“"><a href="#2-æ€»ç»“" class="headerlink" title="2. æ€»ç»“"></a>2. <strong>æ€»ç»“</strong></h3><ul><li><strong>ç§æœ‰æˆå‘˜å˜é‡</strong>ï¼ˆprivate membersï¼‰æ˜¯ C++ ä¸­ç±»çš„ä¸€éƒ¨åˆ†ï¼Œåªèƒ½åœ¨ç±»å†…éƒ¨è®¿é—®ï¼Œä¸å…è®¸å¤–éƒ¨ç›´æ¥è®¿é—®ã€‚</li><li><strong>å…¬å…±æˆå‘˜å‡½æ•°</strong>ï¼ˆgetter&#x2F;setterï¼‰é€šå¸¸æ˜¯è®¿é—®ç§æœ‰æˆå‘˜çš„æ¨èæ–¹å¼ã€‚é€šè¿‡æä¾›æ§åˆ¶è®¿é—®çš„æ¥å£ï¼Œå¯ä»¥ä¿æŠ¤æ•°æ®çš„å®‰å…¨æ€§å’Œä¸€è‡´æ€§ã€‚</li><li><strong>å‹å…ƒå‡½æ•°</strong>å’Œ<strong>å‹å…ƒç±»</strong>å…è®¸å¤–éƒ¨çš„å‡½æ•°æˆ–ç±»è®¿é—®è¯¥ç±»çš„ç§æœ‰æˆå‘˜ï¼Œä½†è¿™ç§æ–¹å¼é€šå¸¸ä¼šæ‰“ç ´å°è£…æ€§ï¼Œå› æ­¤åº”è¯¥è°¨æ…ä½¿ç”¨ã€‚</li><li>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œé€šå¸¸å»ºè®®å°†ç±»çš„æˆå‘˜å˜é‡è®¾ä¸ºç§æœ‰ï¼Œå¹¶é€šè¿‡å…¬å…±æ¥å£ï¼ˆgetterã€setterï¼‰è¿›è¡Œè®¿é—®å’Œä¿®æ”¹ï¼Œä»¥ç¡®ä¿æ•°æ®çš„æœ‰æ•ˆæ€§å’Œå®‰å…¨æ€§ã€‚</li></ul><p>æ€»ä¹‹ï¼Œè®¿é—®ç±»çš„ç§æœ‰å˜é‡åº”è¯¥éµå¾ª<strong>å°è£…æ€§</strong>çš„åŸåˆ™ï¼Œé¿å…ç›´æ¥åœ¨å¤–éƒ¨è®¿é—®ç±»çš„ç§æœ‰æ•°æ®ï¼Œè€Œæ˜¯é€šè¿‡è®¾è®¡å¥½çš„æ¥å£æ¥è¿›è¡Œæ“ä½œ</p><p>åœ¨ C++ ä¸­ï¼Œ<code>=</code> è¿ç®—ç¬¦ç”¨äºèµ‹å€¼æ“ä½œï¼Œä½†æ˜¯åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œ<code>=</code> è¿ç®—ç¬¦çš„å«ä¹‰å’Œè¡Œä¸ºæ˜¯ä¸åŒçš„ã€‚ä½ æåˆ°çš„ä¸¤ç§æƒ…å†µï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cppå¤åˆ¶ä»£ç </span></span><br><span class="line">Role userA = user; <span class="comment">// è¿™ç§å½¢å¼æ˜¯å¤åˆ¶åˆå§‹åŒ–</span></span><br><span class="line">userA = user;       <span class="comment">// è¿™ç§å½¢å¼æ˜¯èµ‹å€¼æ“ä½œ</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸¤è€…ä¹‹é—´æœ‰å¾ˆå¤§çš„åŒºåˆ«ï¼Œæˆ‘ä»¬å°†é€ä¸€åˆ†æå®ƒä»¬çš„å«ä¹‰å’Œä¸åŒä¹‹å¤„ã€‚</p><h3 id="1-Role-userA-user-â€”â€”-å¤åˆ¶åˆå§‹åŒ–ï¼ˆCopy-Initializationï¼‰"><a href="#1-Role-userA-user-â€”â€”-å¤åˆ¶åˆå§‹åŒ–ï¼ˆCopy-Initializationï¼‰" class="headerlink" title="1. Role userA = user; â€”â€” å¤åˆ¶åˆå§‹åŒ–ï¼ˆCopy Initializationï¼‰"></a>1. <code>Role userA = user;</code> â€”â€” <strong>å¤åˆ¶åˆå§‹åŒ–</strong>ï¼ˆCopy Initializationï¼‰</h3><p>è¿™è¡Œä»£ç å±äº<strong>å¤åˆ¶åˆå§‹åŒ–</strong>ï¼ˆCopy Initializationï¼‰ï¼Œå®ƒé€šå¸¸ä¼šè°ƒç”¨<strong>å‰¯æœ¬æ„é€ å‡½æ•°</strong>ã€‚å®ƒçš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li><strong>é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ <code>userA</code></strong>ï¼Œå¹¶ç”¨ <code>user</code> å¯¹è±¡åˆå§‹åŒ–å®ƒã€‚</li><li>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ<strong>å‰¯æœ¬æ„é€ å‡½æ•°</strong>ä¼šè¢«è°ƒç”¨ï¼Œé€šå¸¸æƒ…å†µä¸‹æ˜¯ <code>Role(const Role&amp; user)</code>ã€‚</li></ul><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>Role userA = user;</code> å®é™…ä¸Šæ˜¯é€šè¿‡è°ƒç”¨ç±»çš„å‰¯æœ¬æ„é€ å‡½æ•°æ¥æ„é€  <code>userA</code> å¯¹è±¡çš„å‰¯æœ¬ã€‚è¿™ç§èµ‹å€¼å½¢å¼ä¼šå¤åˆ¶ <code>user</code> å¯¹è±¡çš„çŠ¶æ€åˆ° <code>userA</code>ã€‚</p><h3 id="å‰¯æœ¬æ„é€ å‡½æ•°çš„å·¥ä½œæµç¨‹ï¼š"><a href="#å‰¯æœ¬æ„é€ å‡½æ•°çš„å·¥ä½œæµç¨‹ï¼š" class="headerlink" title="å‰¯æœ¬æ„é€ å‡½æ•°çš„å·¥ä½œæµç¨‹ï¼š"></a>å‰¯æœ¬æ„é€ å‡½æ•°çš„å·¥ä½œæµç¨‹ï¼š</h3><ul><li>è°ƒç”¨å‰¯æœ¬æ„é€ å‡½æ•°åˆ›å»º <code>userA</code>ã€‚</li><li>å°† <code>user</code> å¯¹è±¡çš„æˆå‘˜å˜é‡çš„å€¼å¤åˆ¶ç»™ <code>userA</code>ã€‚</li><li>è¿™é€šå¸¸ä¼šæ¶‰åŠæˆå‘˜çš„æ·±æ‹·è´ï¼ˆå¦‚æœç±»ä¸­æœ‰åŠ¨æ€åˆ†é…å†…å­˜ç­‰éœ€è¦å¤„ç†çš„èµ„æºï¼‰ã€‚</li></ul><h3 id="2-userA-user-â€”â€”-èµ‹å€¼æ“ä½œï¼ˆAssignmentï¼‰"><a href="#2-userA-user-â€”â€”-èµ‹å€¼æ“ä½œï¼ˆAssignmentï¼‰" class="headerlink" title="2. userA = user; â€”â€” èµ‹å€¼æ“ä½œï¼ˆAssignmentï¼‰"></a>2. <code>userA = user;</code> â€”â€” <strong>èµ‹å€¼æ“ä½œ</strong>ï¼ˆAssignmentï¼‰</h3><p>è¿™è¡Œä»£ç å±äº<strong>èµ‹å€¼æ“ä½œ</strong>ï¼ˆAssignmentï¼‰ï¼Œå®ƒä¼šè°ƒç”¨å¯¹è±¡çš„<strong>èµ‹å€¼è¿ç®—ç¬¦</strong>ã€‚èµ‹å€¼è¿ç®—ç¬¦ç”¨äºå°†ä¸€ä¸ªå·²æœ‰å¯¹è±¡çš„çŠ¶æ€èµ‹å€¼ç»™å¦ä¸€ä¸ªå¯¹è±¡ã€‚æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>è¿™é‡Œ <code>userA</code> æ˜¯å·²ç»å­˜åœ¨çš„å¯¹è±¡ï¼Œè€Œ <code>user</code> æ˜¯å¦ä¸€ä¸ªå¯¹è±¡ã€‚</li><li><code>userA = user;</code> ä¼šè°ƒç”¨ç±»çš„èµ‹å€¼è¿ç®—ç¬¦ï¼Œé€šå¸¸æ˜¯ <code>Role&amp; operator=(const Role&amp; user)</code>ï¼Œè¯¥è¿ç®—ç¬¦ç”¨äºå°† <code>user</code> å¯¹è±¡çš„çŠ¶æ€å¤åˆ¶åˆ° <code>userA</code> ä¸­ã€‚</li></ul><h3 id="èµ‹å€¼è¿ç®—ç¬¦çš„å·¥ä½œæµç¨‹ï¼š"><a href="#èµ‹å€¼è¿ç®—ç¬¦çš„å·¥ä½œæµç¨‹ï¼š" class="headerlink" title="èµ‹å€¼è¿ç®—ç¬¦çš„å·¥ä½œæµç¨‹ï¼š"></a>èµ‹å€¼è¿ç®—ç¬¦çš„å·¥ä½œæµç¨‹ï¼š</h3><ul><li>å¦‚æœç±»çš„èµ‹å€¼è¿ç®—ç¬¦å·²å®šä¹‰ï¼Œ<code>operator=</code> ä¼šè¢«è°ƒç”¨ã€‚</li><li>å®ƒä¼šå°† <code>user</code> å¯¹è±¡ä¸­çš„æ•°æ®æˆå‘˜èµ‹å€¼ç»™ <code>userA</code>ï¼Œå¹¶å¯èƒ½æ¶‰åŠå†…å­˜ç®¡ç†ï¼ˆä¾‹å¦‚ï¼Œé‡Šæ”¾å·²æœ‰èµ„æºã€åˆ†é…æ–°èµ„æºç­‰ï¼‰ã€‚</li><li>å¦‚æœæ²¡æœ‰å®šä¹‰è‡ªå®šä¹‰çš„èµ‹å€¼è¿ç®—ç¬¦ï¼Œç¼–è¯‘å™¨ä¼šæä¾›ä¸€ä¸ªé»˜è®¤çš„èµ‹å€¼è¿ç®—ç¬¦ï¼Œè¯¥é»˜è®¤ç‰ˆæœ¬æ‰§è¡Œé€ä¸ªæˆå‘˜çš„èµ‹å€¼æ“ä½œã€‚</li></ul><h3 id="å…³é”®åŒºåˆ«"><a href="#å…³é”®åŒºåˆ«" class="headerlink" title="å…³é”®åŒºåˆ«"></a>å…³é”®åŒºåˆ«</h3><ol><li><strong>æ“ä½œå¯¹è±¡ä¸åŒï¼š</strong><ul><li><code>Role userA = user;</code> æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ <code>userA</code> å¹¶åˆå§‹åŒ–å®ƒï¼Œè¿™ä¸ªè¿‡ç¨‹è°ƒç”¨çš„æ˜¯å‰¯æœ¬æ„é€ å‡½æ•°ã€‚</li><li><code>userA = user;</code> æ˜¯å°†å·²ç»å­˜åœ¨çš„å¯¹è±¡ <code>userA</code> èµ‹å€¼ä¸º <code>user</code>ï¼Œè¿™ä¸ªè¿‡ç¨‹è°ƒç”¨çš„æ˜¯èµ‹å€¼è¿ç®—ç¬¦ã€‚</li></ul></li><li><strong>è°ƒç”¨çš„å‡½æ•°ä¸åŒï¼š</strong><ul><li><code>Role userA = user;</code> è°ƒç”¨çš„æ˜¯ç±»çš„<strong>å‰¯æœ¬æ„é€ å‡½æ•°</strong>ï¼Œå®ƒåœ¨åˆ›å»ºæ–°å¯¹è±¡æ—¶ç”¨äºåˆå§‹åŒ–ã€‚</li><li><code>userA = user;</code> è°ƒç”¨çš„æ˜¯ç±»çš„<strong>èµ‹å€¼è¿ç®—ç¬¦</strong>ï¼Œå®ƒç”¨äºå°†ä¸€ä¸ªå·²å­˜åœ¨å¯¹è±¡çš„å€¼å¤åˆ¶åˆ°å¦ä¸€ä¸ªå·²å­˜åœ¨å¯¹è±¡ã€‚</li></ul></li><li><strong>åˆ›å»ºæ–°å¯¹è±¡ä¸èµ‹å€¼å¯¹è±¡ï¼š</strong><ul><li>åœ¨ <code>Role userA = user;</code> ä¸­ï¼Œ<code>userA</code> æ˜¯é€šè¿‡å‰¯æœ¬æ„é€ å‡½æ•°åˆ›å»ºçš„ä¸€ä¸ªæ–°å¯¹è±¡ã€‚</li><li>åœ¨ <code>userA = user;</code> ä¸­ï¼Œ<code>userA</code> å·²ç»å­˜åœ¨ï¼Œå®ƒçš„å†…å®¹ä¼šè¢«æ›¿æ¢ä¸º <code>user</code> çš„å†…å®¹ã€‚</li></ul></li><li><strong>æ•ˆç‡è€ƒè™‘ï¼š</strong><ul><li>å‰¯æœ¬æ„é€ å‡½æ•°é€šå¸¸ç”¨äºåˆ›å»ºæ–°å¯¹è±¡ï¼Œå› æ­¤å®ƒéœ€è¦åˆ†é…å†…å­˜å¹¶åˆå§‹åŒ–å¯¹è±¡ã€‚</li><li>èµ‹å€¼è¿ç®—ç¬¦é€šå¸¸åœ¨å¯¹è±¡å·²ç»å­˜åœ¨çš„æƒ…å†µä¸‹æ‰§è¡Œï¼Œå®ƒä¼šå¤„ç†å·²æœ‰å¯¹è±¡çš„èµ„æºï¼Œå¯èƒ½ä¼šåŒ…æ‹¬é‡Šæ”¾èµ„æºã€é‡æ–°åˆ†é…å†…å­˜ç­‰æ“ä½œã€‚</li></ul></li></ol><h3 id="æ·±å…¥ç†è§£èµ‹å€¼è¿ç®—ç¬¦ä¸å‰¯æœ¬æ„é€ å‡½æ•°"><a href="#æ·±å…¥ç†è§£èµ‹å€¼è¿ç®—ç¬¦ä¸å‰¯æœ¬æ„é€ å‡½æ•°" class="headerlink" title="æ·±å…¥ç†è§£èµ‹å€¼è¿ç®—ç¬¦ä¸å‰¯æœ¬æ„é€ å‡½æ•°"></a>æ·±å…¥ç†è§£èµ‹å€¼è¿ç®—ç¬¦ä¸å‰¯æœ¬æ„é€ å‡½æ•°</h3><p>ä¸ºäº†è¿›ä¸€æ­¥ç†è§£å®ƒä»¬çš„è¡Œä¸ºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹å‰¯æœ¬æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦çš„å®ç°ã€‚</p><h4 id="å‰¯æœ¬æ„é€ å‡½æ•°"><a href="#å‰¯æœ¬æ„é€ å‡½æ•°" class="headerlink" title="å‰¯æœ¬æ„é€ å‡½æ•°"></a>å‰¯æœ¬æ„é€ å‡½æ•°</h4><p>å‰¯æœ¬æ„é€ å‡½æ•°çš„ç›®æ ‡æ˜¯åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå®ƒæ¥å—ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¹¶ç”¨è¯¥å¯¹è±¡çš„å†…å®¹åˆå§‹åŒ–æ–°å¯¹è±¡ã€‚å…¸å‹çš„å‰¯æœ¬æ„é€ å‡½æ•°å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cppå¤åˆ¶ä»£ç class Role &#123;</span><br><span class="line">public:</span><br><span class="line">    Role(const Role&amp; other) &#123;</span><br><span class="line">        // é€šè¿‡ other æ¥åˆå§‹åŒ–å½“å‰å¯¹è±¡</span><br><span class="line">        this-&gt;name = other.name;  // å‡è®¾æ˜¯ç®€å•çš„æˆå‘˜å¤åˆ¶</span><br><span class="line">        this-&gt;age = other.age;</span><br><span class="line">        // å¦‚æœæœ‰åŠ¨æ€å†…å­˜åˆ†é…ï¼Œéœ€è¦æ·±æ‹·è´</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="èµ‹å€¼è¿ç®—ç¬¦"><a href="#èµ‹å€¼è¿ç®—ç¬¦" class="headerlink" title="èµ‹å€¼è¿ç®—ç¬¦"></a>èµ‹å€¼è¿ç®—ç¬¦</h4><p>èµ‹å€¼è¿ç®—ç¬¦ç”¨äºå°†ä¸€ä¸ªå·²å­˜åœ¨çš„å¯¹è±¡çš„çŠ¶æ€èµ‹å€¼ç»™å¦ä¸€ä¸ªå·²å­˜åœ¨çš„å¯¹è±¡ã€‚å…¸å‹çš„èµ‹å€¼è¿ç®—ç¬¦å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cppå¤åˆ¶ä»£ç class Role &#123;</span><br><span class="line">public:</span><br><span class="line">    Role&amp; operator=(const Role&amp; other) &#123;</span><br><span class="line">        if (this != &amp;other) &#123;  // é˜²æ­¢è‡ªæˆ‘èµ‹å€¼</span><br><span class="line">            this-&gt;name = other.name;</span><br><span class="line">            this-&gt;age = other.age;</span><br><span class="line">            // å¦‚æœæœ‰åŠ¨æ€å†…å­˜åˆ†é…ï¼Œç¡®ä¿é‡Šæ”¾æ—§çš„èµ„æºå¹¶åˆ†é…æ–°èµ„æº</span><br><span class="line">        &#125;</span><br><span class="line">        return *this;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li><code>Role userA = user;</code> ä½¿ç”¨çš„æ˜¯<strong>å‰¯æœ¬æ„é€ å‡½æ•°</strong>ï¼Œå…¶ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ <code>userA</code> å¹¶ç”¨ <code>user</code> åˆå§‹åŒ–å®ƒã€‚</li><li><code>userA = user;</code> ä½¿ç”¨çš„æ˜¯<strong>èµ‹å€¼è¿ç®—ç¬¦</strong>ï¼Œå…¶ä½œç”¨æ˜¯å°†å·²æœ‰å¯¹è±¡ <code>user</code> çš„å†…å®¹èµ‹å€¼ç»™å·²æœ‰å¯¹è±¡ <code>userA</code>ã€‚</li></ul><p>ä¸¤è€…çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼šå‰¯æœ¬æ„é€ å‡½æ•°è´Ÿè´£æ–°å¯¹è±¡çš„åˆ›å»ºå¹¶è¿›è¡Œåˆå§‹åŒ–ï¼Œè€Œèµ‹å€¼è¿ç®—ç¬¦è´Ÿè´£å·²æœ‰å¯¹è±¡çš„å†…å®¹èµ‹å€¼ã€‚å› æ­¤ï¼Œå®ƒä»¬å„è‡ªæœ‰ä¸åŒçš„æ€§èƒ½å’ŒåŠŸèƒ½ç‰¹ç‚¹ï¼Œé€‚ç”¨äºä¸åŒçš„æƒ…å¢ƒã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cpp06ä¸åŒè¯­è¨€è”åˆç¼–ç¨‹</title>
      <link href="/2024/12/11/cpp06%E4%B8%8D%E5%90%8C%E8%AF%AD%E8%A8%80%E8%81%94%E5%90%88%E7%BC%96%E7%A8%8B/"/>
      <url>/2024/12/11/cpp06%E4%B8%8D%E5%90%8C%E8%AF%AD%E8%A8%80%E8%81%94%E5%90%88%E7%BC%96%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p>â€‹                                                              <strong>æ­¤ç« èŠ‚å¹²è´§è¾ƒå°‘ï¼Œç¬”è®°ä¹Ÿæ¯”è¾ƒæ··ä¹±ï¼Œç†è§£ä¸ºä¸»</strong></p><p><strong>static å’Œ inline</strong></p><p>é™æ€å˜é‡</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ave</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> count;    <span class="comment">// åˆå§‹åŒ–ä¸º0   ç”Ÿå‘½å‘¨æœŸè·Ÿå…¨å±€å˜é‡ä¸€æ ·ï¼ˆå±€éƒ¨å˜é‡ï¼‰  ï¼ˆä¸ä¼šæ”¾åœ¨æ ˆä¸Šé¢ï¼‰</span></span><br><span class="line">    std::cout &lt;&lt; count ++ &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> (a + b) / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é™æ€å˜é‡ï¼ˆæ— è®ºæ˜¯å±€éƒ¨çš„è¿˜æ˜¯å…¨å±€çš„ï¼‰é€šå¸¸è¢«å­˜å‚¨åœ¨ æ•°æ®æ®µï¼ˆdata segmentï¼‰ä¸­ï¼Œè€Œä¸æ˜¯æ ˆæˆ–å †ä¸­ã€‚é™æ€å˜é‡çš„å†…å­˜åˆ†é…åœ¨ç¨‹åºå¯åŠ¨æ—¶å°±å·²å®Œæˆï¼Œå¹¶ä¸”åœ¨æ•´ä¸ªç¨‹åºè¿è¡ŒæœŸé—´éƒ½ä¿æŒæœ‰æ•ˆï¼Œç›´åˆ°ç¨‹åºé€€å‡ºã€‚</span></span><br></pre></td></tr></table></figure><p>å†…è”å‡½æ•°</p><p><strong>å†…è”å‡½æ•°</strong>ï¼ˆInline Functionï¼‰æ˜¯ C++ ä¸­çš„ä¸€ç§å‡½æ•°ä¼˜åŒ–æŠ€æœ¯ï¼Œå®ƒçš„ä½œç”¨æ˜¯è®©ç¼–è¯‘å™¨å°†å‡½æ•°çš„ä»£ç ç›´æ¥åµŒå…¥åˆ°è°ƒç”¨è¯¥å‡½æ•°çš„åœ°æ–¹ï¼Œè€Œä¸æ˜¯é€šè¿‡å‡½æ•°è°ƒç”¨çš„æœºåˆ¶è¿›è¡Œè·³è½¬ã€‚è¿™ç§ä¼˜åŒ–æœ‰åŠ©äºå‡å°‘å‡½æ•°è°ƒç”¨çš„å¼€é”€ï¼ˆå°¤å…¶æ˜¯å¯¹äºçŸ­å°çš„å‡½æ•°ï¼‰ï¼Œä»è€Œæé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚</p><p>é€’å½’å‡½æ•°ä¸èƒ½ç”¨ï¼Œæœ¬èº«å°±éœ€è¦æ ˆç©ºé—´ã€‚</p><p>å¯ä»¥ç”¨ä¸€ä¸ªinlineå£°æ˜ä¸€ä¸ªå†…è”å‡½æ•°   å†…è”å‡½æ•°ä¼šå»ºè®®ç¼–è¯‘å™¨æŠŠè¿™ä¸ªå‡½æ•°å¤„ç†æˆå†…è”ä»£ç ä»¥æå‡æ€§èƒ½</p><p>å§‹ç»ˆæ˜¯å»ºè®®ï¼Œå…·ä½“ç¼–è¯‘å™¨æ˜¯å¦é‡‡çº³ï¼Œç”±ç¼–è¯‘å™¨å†³å®šã€‚ã€‚ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">1</span> + <span class="number">2</span>;   <span class="comment">// åŠ ä¸Šinlineä¹‹åï¼Œç›´æ¥ æŠŠç›¸åº”çš„ä»£ç æ”¾åœ¨è¿™é‡Œäº†  ä¸è°ƒç”¨å‡½æ•°äº†   ç›´æ¥a + b</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä»ç¼–è¯‘å™¨çš„è§’åº¦ç†è§£å®šä¹‰å’Œå£°æ˜</strong></p><p>å‡½æ•°å£°æ˜ï¼ˆä¹Ÿç§°ä¸ºå‡½æ•°åŸå‹ï¼‰æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨å‡½æ•°çš„åç§°ã€è¿”å›ç±»å‹å’Œå‚æ•°ç±»å‹çš„å£°æ˜ï¼Œä½†ä¸åŒ…å«å‡½æ•°ä½“ã€‚å®ƒä¸»è¦ç”¨äºåœ¨è°ƒç”¨å‡½æ•°ä¹‹å‰å‘Šè¯‰ç¼–è¯‘å™¨å‡½æ•°çš„å­˜åœ¨åŠå…¶æ¥å£ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ave</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span>;  <span class="comment">//  </span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> c = <span class="built_in">ave</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ave</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡½æ•°å®šä¹‰æ˜¯å‡½æ•°çš„å®é™…å®ç°ï¼ŒåŒ…å«äº†å‡½æ•°çš„è¿”å›ç±»å‹ã€å‚æ•°ä»¥åŠå‡½æ•°ä½“ã€‚å‡½æ•°å®šä¹‰åŒ…æ‹¬äº†å‡½æ•°çš„é€»è¾‘å®ç°ï¼Œå¹¶ä¸”ä¼šå ç”¨å†…å­˜èµ„æºã€‚</p><ul><li><strong>å‡½æ•°å£°æ˜</strong>åªæä¾›å‡½æ•°çš„æ¥å£ä¿¡æ¯ï¼Œä¸åŒ…å«å®ç°ï¼Œé€šå¸¸ç”¨äºè®©ç¼–è¯‘å™¨åœ¨è°ƒç”¨å‡½æ•°ä¹‹å‰çŸ¥é“å‡½æ•°çš„å­˜åœ¨ã€‚</li><li><strong>å‡½æ•°å®šä¹‰</strong>æä¾›äº†å‡½æ•°çš„å®Œæ•´å®ç°ï¼ŒåŒ…å«äº†å‡½æ•°çš„æ‰€æœ‰ç»†èŠ‚ã€‚</li></ul><p><strong>å˜é‡å’Œå‡½æ•°çš„ä¸åŒï¼ˆå£°æ˜  å®šä¹‰ï¼‰</strong></p><p><code>extern int x;</code>  &#x2F;&#x2F; å£°æ˜å˜é‡ x     å£°æ˜ï¼Œé»˜è®¤æ˜¯extern</p><p><code>extern</code> å…³é”®å­—ç”¨äºå£°æ˜å˜é‡è€Œä¸å®šä¹‰å®ƒã€‚è¿™æ ·å¯ä»¥åœ¨å¤šä¸ªæ–‡ä»¶ä¹‹é—´å…±äº«å˜é‡ã€‚ä¾‹å¦‚ï¼Œå½“ä½ éœ€è¦åœ¨å¤šä¸ªæºæ–‡ä»¶ä¸­ä½¿ç”¨åŒä¸€ä¸ªå…¨å±€å˜é‡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>extern</code> æ¥å£°æ˜è¯¥å˜é‡ã€‚</p><p>x86  32ä½windowsæ“ä½œç³»ç»Ÿä¸‹å†…å­˜åˆ†é…</p><p><strong>å¤´æ–‡ä»¶å’Œæºæ–‡ä»¶</strong></p><p>å¤´æ–‡ä»¶ç”¨äºå£°æ˜ç±»ã€å‡½æ•°ã€å˜é‡ã€å¸¸é‡ç­‰ä¿¡æ¯ï¼Œä½†ä¸åŒ…å«å…·ä½“çš„å®ç°</p><p>å¤´æ–‡ä»¶åªæœ‰åœ¨è°ƒç”¨çš„æ—¶å€™æ‰è¢«ç¼–è¯‘ï¼Œä¸»è¦æ˜¯ç”¨æ¥å†™å£°æ˜çš„ï¼Œä¹Ÿå¯ä»¥å†™å®šä¹‰ã€‚</p><p>å‡½æ•°åªè¦æ˜¯åœ¨ä¸€ä¸ªå·¥ç¨‹é‡Œå°±ä¸èƒ½é‡å¤å®šä¹‰ï¼ˆé‡è½½é™¤å¤–ï¼‰</p><p>æƒ…å†µ 1ï¸âƒ£ é™æ€å‡½æ•°ï¼Œåªåœ¨æ‰€åœ¨çš„cppæ–‡ä»¶ä¸­æœ‰æ•ˆï¼ŒåŠ ä¸Š <code>static</code> å…³é”®å­—ï¼Œé‚£ä¹ˆä¸åŒçš„cppæ–‡ä»¶ä¸­çš„é™æ€å‡½æ•°éƒ½æœ‰å„è‡ªçš„ç©ºé—´ï¼Œå¦‚æœä¸åŠ ï¼Œé‚£ä¹ˆæ•´ä¸ªå·¥ç¨‹é‡Œé¢çš„ç›¸åŒå‡½æ•°åçš„å‡½æ•°éƒ½ç”¨çš„åŒä¸€å—ç©ºé—´ã€‚</p><p>æƒ…å†µ 2ï¸âƒ£ å†…è”å‡½æ•°  ä¹Ÿæ˜¯ä¸€æ ·çš„</p><p>å¦‚æœæ˜¯å˜é‡çš„è¯ï¼Œè¦ç”¨ <code>extern</code> å…³é”®å­—ï¼Œåªå£°æ˜ä¸å®šä¹‰ï¼Œé‚£å†™åœ¨å¤´æ–‡ä»¶é‡Œæ²¡é—®é¢˜ã€‚</p><p>é™æ€å˜é‡ä¹Ÿæ˜¯åœ¨å„è‡ªçš„æºæ–‡ä»¶é‡Œæœ‰æ•ˆã€‚<code>static</code>å…³é”®å­—</p><p>é‡å¤è°ƒç”¨çš„æƒ…å†µä¸ä¼šå‡ºç°é—®é¢˜ï¼ŒåŸå› æ˜¯ <code>#pragma once</code>  ä½†æœ‰çš„ç¼–è¯‘å™¨ä¸æ”¯æŒè¿™ä¸ªå‘½ä»¤äº† </p><p><strong>å¤´æ–‡ä»¶ä¿æŠ¤æœºåˆ¶</strong>ï¼ˆInclude Guardï¼‰ã€‚å¤´æ–‡ä»¶ä¿æŠ¤æœºåˆ¶çš„ç›®çš„æ˜¯é˜²æ­¢å¤´æ–‡ä»¶è¢«å¤šæ¬¡åŒ…å«ï¼Œé¿å…é‡å¤å®šä¹‰å’Œæ½œåœ¨çš„ç¼–è¯‘é”™è¯¯ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _HEMATH_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _HEMATH_</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><ol><li><strong><code>#ifndef _HEMATH_</code></strong>ï¼š<ul><li><code>#ifndef</code> æ˜¯ â€œif not definedâ€ çš„ç¼©å†™ï¼Œæ„æ€æ˜¯â€œå¦‚æœæœªå®šä¹‰â€ã€‚</li><li>å®ƒæ£€æŸ¥æ˜¯å¦å·²å®šä¹‰åä¸º <code>_HEMATH_</code> çš„å®ã€‚å¦‚æœæ²¡æœ‰å®šä¹‰ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„ä»£ç ä¼šè¢«ç¼–è¯‘ï¼›å¦‚æœå·²ç»å®šä¹‰ï¼Œåˆ™è·³è¿‡ã€‚</li><li>è¿™ä¸ªå®é€šå¸¸æ˜¯å¤´æ–‡ä»¶çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨æ¥ç¡®ä¿å¤´æ–‡ä»¶åªè¢«åŒ…å«ä¸€æ¬¡ã€‚</li></ul></li><li><strong><code>#define _HEMATH_</code></strong>ï¼š<ul><li><code>#define</code> ç”¨äºå®šä¹‰å® <code>_HEMATH_</code>ã€‚ä¸€æ—¦å®šä¹‰äº†è¿™ä¸ªå®ï¼Œåç»­çš„ <code>#ifndef</code> å°±ä¼šå¤±è´¥ï¼Œé¿å…é‡å¤åŒ…å«è¯¥å¤´æ–‡ä»¶ã€‚</li><li>å® <code>_HEMATH_</code> åœ¨ç¬¬ä¸€æ¬¡åŒ…å«è¯¥å¤´æ–‡ä»¶æ—¶å®šä¹‰ï¼Œä»¥åä»»ä½•åŒ…å«æ­¤å¤´æ–‡ä»¶çš„åœ°æ–¹éƒ½ä¼šè·³è¿‡å…¶ä¸­çš„å†…å®¹ã€‚</li></ul></li><li><strong><code>#endif</code></strong>ï¼š<ul><li>è¿™æ˜¯ <code>#ifndef</code> çš„ç»“æŸæ ‡å¿—ï¼Œè¡¨ç¤ºæ¡ä»¶ç¼–è¯‘çš„ç»“æŸã€‚å®ƒæ ‡å¿—ç€æ¡ä»¶ä¿æŠ¤ä»£ç å—çš„ç»“æŸã€‚</li></ul></li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¤ºä¾‹ï¼š`hemath.h`</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _HEMATH_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _HEMATH_</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">subtract</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨æºæ–‡ä»¶ä¸­ä½¿ç”¨</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;hemath.h&quot;</span> <span class="comment">// ç¬¬ä¸€æ¬¡åŒ…å«ï¼Œå® _HEMATH_ æ²¡æœ‰å®šä¹‰ï¼Œä¼šè¿›å…¥æ¡ä»¶ç¼–è¯‘åŒºå—</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;hemath.h&quot;</span> <span class="comment">// ç¬¬äºŒæ¬¡åŒ…å«ï¼Œå® _HEMATH_ å·²å®šä¹‰ï¼Œç›´æ¥è·³è¿‡å¤´æ–‡ä»¶å†…å®¹</span></span></span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œç¬¬äºŒæ¬¡ <code>#include</code> æ—¶ï¼Œå¤´æ–‡ä»¶çš„å†…å®¹å°±ä¸ä¼šè¢«é‡æ–°åŒ…å«ï¼Œä»è€Œé¿äº†é‡å¤å®šä¹‰çš„é—®é¢˜ã€‚</p><ul><li>å®åå­—ï¼ˆ<code>_HEMATH_</code>ï¼‰å¯ä»¥è‡ªå®šä¹‰ï¼Œä½†æœ€å¥½ä½¿ç”¨ç‹¬ç‰¹ä¸”å…·æœ‰å…¨å±€å”¯ä¸€æ€§çš„åå­—ï¼Œé€šå¸¸ä½¿ç”¨é¡¹ç›®åæˆ–æ–‡ä»¶åæ¥é¿å…ä¸å…¶ä»–åº“çš„å®å†²çªã€‚</li><li>å¦å¤–ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨ <code>#pragma once</code> æ¥æ›¿ä»£ä¼ ç»Ÿçš„ <code>#ifndef</code> æ–¹å¼ï¼Œè¿™æ ·åšæ›´ç®€æ´ï¼Œå¹¶ä¸”ç°ä»£ç¼–è¯‘å™¨é€šå¸¸ä¼šä¼˜åŒ–å®ƒã€‚</li></ul><p>Cè¯­è¨€ä¸æ”¯æŒå‡½æ•°é‡è½½ï¼Œæ‰€ä»¥æœ‰å¤šä¸ªæºæ–‡ä»¶åŒ…å«ç›¸åŒçš„å‡½æ•°ï¼ŒCè¯­è¨€æŠŠå‡½æ•°ååŠ _  ä½†æ˜¯C++æœ‰å‡½æ•°é‡è½½ä¸èƒ½è¿™æ ·å¤„ç†ï¼Œ.c æ–‡ä»¶å’Œ .cpp æ–‡ä»¶è‹¥æœ‰ç›¸åŒçš„å‡½æ•°ï¼Œä¹Ÿä¸ä¼šå‡ºé”™ï¼Œå› ä¸ºç¼–è¯‘å™¨å¤„ç†ä¹‹å çš„åå­—ä¸ä¸€æ ·</p><p>1ï¸âƒ£ å®šä¹‰åœ¨Cè¯­è¨€é‡Œé¢çš„å‡½æ•°ï¼Œä¸èƒ½åœ¨C++ä¸­ç›´æ¥è®¿é—® ï¼ˆ<strong>è¦ä½¿ç”¨externå…³é”®å­—æ‰è¡Œ</strong>ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">int</span> <span class="title">ave</span><span class="params">()</span></span>;  <span class="comment">// åŠ ä¸Šè¿™ä¸ªå°±èƒ½åœ¨cppæ–‡ä»¶é‡Œé¢è¿è¡Œcä¸­çš„å‡½æ•°äº†</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å†™æ³•1ï¸âƒ£</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">ave</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">pve</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†™æ³•2ï¸âƒ£   ç›´æ¥æŠŠå¤´æ–‡ä»¶ ç”¨extern &quot;C&quot;</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">include</span> <span class="string">&quot;e.h&quot;</span>  <span class="comment">// å¤´æ–‡ä»¶é‡Œé¢çš„å…¨æ˜¯Cçš„é£æ ¼</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ç§æ‰‹æ®µï¼ŒC++å¯ä»¥è°ƒç”¨Cè¯­è¨€ä»£ç </p><p>2ï¸âƒ£<strong>åœ¨Cè¯­è¨€ä¸­è°ƒç”¨C++çš„å‡½æ•°</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> <span class="function"><span class="type">int</span> <span class="title">xve</span><span class="params">()</span> </span>&#123;&#125; <span class="comment">// æŠŠC++ ä¸­çš„å‡½æ•°å®šä¹‰æˆCé£æ ¼å³å¯</span></span><br></pre></td></tr></table></figure><p>ä¸ºäº†è®©Cè¯­è¨€æ–‡ä»¶çŸ¥é“C++ä¸­å®šä¹‰çš„å‡½æ•°ï¼Œåœ¨C++çš„å¤´æ–‡ä»¶ä¸­ä½¿ç”¨ <code>extern &quot;C&quot;</code> æ¥å£°æ˜è¿™äº›å‡½æ•°ã€‚è¿™æ ·ï¼ŒCè¯­è¨€å’ŒC++éƒ½å¯ä»¥åŒ…å«è¿™ä¸ªå¤´æ–‡ä»¶ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// example.h (C++å¤´æ–‡ä»¶)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span>;  <span class="comment">// å£°æ˜C++ä¸­çš„addå‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><p>3ï¸âƒ£ åœ¨Cè¯­è¨€ä»£ç ä¸­ï¼Œä½¿ç”¨extern â€œCâ€ å£°æ˜è¯¥å‡½æ•°ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// example.c (Cæ–‡ä»¶)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span>;  <span class="comment">// å£°æ˜C++ä¸­çš„addå‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> result = add(<span class="number">2</span>, <span class="number">3</span>);  <span class="comment">// è°ƒç”¨C++ä¸­çš„å‡½æ•°</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Result: %d\n&quot;</span>, result);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>C å’Œ c++ æºæ–‡ä»¶æ··ç”¨çš„é—®é¢˜</strong></p><p>å¦‚æœ.c æ–‡ä»¶ å’Œ .cpp æ–‡ä»¶é‡åï¼ˆéƒ½å«aï¼‰ï¼Œé‚£ç¼–è¯‘çš„æ—¶å€™ï¼Œä¼šæœ‰ä¿©a.objï¼Œä¸€ä¸ªæ–‡ä»¶ä¸‹ç›®å½•ä¸‹æœ‰ä¿©a.obj  é‚£ä¹ˆå°±ä¼šå‡ºé—®é¢˜ï¼Œå°½é‡ä¸è¦è®©C++å’ŒCæ–‡ä»¶é‡å</p><p><strong>åˆ›å»ºè‡ªå·±çš„SDK</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;edoyun.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•ä¸€  é…å¥½åŒ…å«ç›®å½•å’Œåº“ç›®å½•ä¹‹åï¼Œå†™ä¸‹é¢çš„æŒ‡ä»¤å³å¯</span></span><br><span class="line"><span class="comment">//#pragma comment(lib,&quot;edoyun.lib&quot;)</span></span><br><span class="line"><span class="comment">// æ–¹æ³•äºŒ  é“¾æ¥å™¨-&gt;è¾“å…¥-&gt;é™„åŠ ä¾èµ–é¡¹</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">std::cout &lt;&lt; edoyun::<span class="built_in">GetVersion</span>();</span><br><span class="line">std::cout &lt;&lt; <span class="built_in">ave</span>(<span class="number">100</span>,<span class="number">300</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/11/28/67480783670e4.png"></p><p><strong>å‡½æ•°è°ƒç”¨çº¦å®š</strong></p><p>å‡½æ•°è°ƒç”¨çº¦å®šæ˜¯å‡½æ•°è°ƒç”¨ä¸è¢«è°ƒç”¨è€…ä¹‹é—´çš„ä¸€ç§åè®®ï¼Œè¿™ä¸ªåè®®ä¸»è¦è§„å®šäº†ä»¥ä¸‹ä¸¤ä¸ªå†…å®¹ï¼š</p><p>å¦‚ä½•ä¼ é€’å‚æ•°    å¦‚ä½•æ¢å¤æ ˆå¹³è¡¡</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">ave</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">ave</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// __cdecl å‚æ•°å…¥æ ˆé¡ºåº ä»å³åˆ°å·¦</span></span><br><span class="line"><span class="comment">// å †æ ˆå¹³è¡¡ï¼šè°è°ƒç”¨è°å¹³è¡¡</span></span><br><span class="line"><span class="comment">// æ­£å› ä¸º__cdeclè¿™ç§å †æ ˆå¹³è¡¡æ–¹å¼ï¼Œèƒ½å¤Ÿæ”¯æŒä¸å®šé‡å‚æ•°</span></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __stdccall <span class="title">ave</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">ave</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// __stdcall å‚æ•°å…¥æ ˆé¡ºåº  ä»å³åˆ°å·¦</span></span><br><span class="line"><span class="comment">// å †æ ˆå¹³è¡¡ï¼šå‡½æ•°è‡ªå·±æ¢å¤æ ˆå¹³è¡¡</span></span><br><span class="line"><span class="comment">// Windows ç¼–ç¨‹ä¸­ WINAPI CALLBACK éƒ½æ˜¯ __stdcall çš„å®</span></span><br><span class="line"><span class="comment">// ç”Ÿæˆçš„å‡½æ•°åä¼šåŠ ä¸‹åˆ’çº¿ï¼Œåé¢è·Ÿ@å’Œå‚æ•°å°ºå¯¸</span></span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/11/28/674823c0b7270.png"></p><p><img src="https://bu.dusays.com/2024/11/28/674823ba10bfe.png"></p><p><strong>é€’å½’å‡½æ•°</strong></p><p><strong>é€’å½’å‡½æ•°</strong>æ˜¯æŒ‡åœ¨å‡½æ•°çš„å®šä¹‰ä¸­ï¼Œè°ƒç”¨äº†å®ƒè‡ªèº«çš„å‡½æ•°ã€‚é€’å½’çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†å¤æ‚çš„é—®é¢˜åˆ†è§£ä¸ºæ›´ç®€å•çš„åŒç±»é—®é¢˜ã€‚é€šè¿‡é€’å½’ï¼Œé—®é¢˜å¯ä»¥è¢«æ‹†è§£æˆè¾ƒå°çš„å­é—®é¢˜ï¼Œç›´åˆ°è¾¾åˆ°æœ€ç®€å•çš„åŸºæœ¬æƒ…å†µï¼ˆå³é€’å½’çš„ç»ˆæ­¢æ¡ä»¶ï¼‰ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">ave</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x == <span class="number">1</span>) <span class="keyword">return</span> x;</span><br><span class="line">    <span class="keyword">return</span> x * <span class="built_in">ave</span>(x - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> std::string;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">Role</span></span><br><span class="line">&#123;</span><br><span class="line">string Id;</span><br><span class="line"><span class="type">int</span> Exp;</span><br><span class="line">&#125;*PROLE;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">GetDataCount</span><span class="params">(string str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> icount&#123;&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; str.<span class="built_in">length</span>(); i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (str[i] == <span class="string">&#x27;;&#x27;</span>)</span><br><span class="line">&#123;</span><br><span class="line">icount++;</span><br><span class="line">i += <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> icount / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GetStringData</span><span class="params">(PROLE prole, string&amp; strData, <span class="type">int</span> istart)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">istart = strData.<span class="built_in">find</span>(<span class="string">&quot;id=&quot;</span>, istart);</span><br><span class="line"><span class="keyword">if</span> (istart == std::string::npos) <span class="keyword">return</span>;</span><br><span class="line"><span class="type">int</span> iend = strData.<span class="built_in">find</span>(<span class="string">&quot;;&quot;</span>, istart + <span class="number">3</span>);</span><br><span class="line">prole-&gt;Id = strData.<span class="built_in">substr</span>(istart + <span class="number">3</span>, iend - istart - <span class="number">3</span>);</span><br><span class="line">istart = iend + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">istart = strData.<span class="built_in">find</span>(<span class="string">&quot;exp=&quot;</span>, istart);</span><br><span class="line">iend = strData.<span class="built_in">find</span>(<span class="string">&quot;;&quot;</span>, istart + <span class="number">4</span>);</span><br><span class="line">prole-&gt;Exp = std::<span class="built_in">stoi</span>(strData.<span class="built_in">substr</span>(istart + <span class="number">4</span>, iend - istart - <span class="number">4</span>));</span><br><span class="line">istart = iend + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">GetStringData</span>(++prole, strData, istart);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">string strData = <span class="string">&quot;id=Tomy Clare;exp=9523;id=Sunny;exp=9523;id=DyBaby;exp=25301;id=Simple;exp=25301;id=Bkacs11;exp=2100;id=DumpX;exp=36520;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> icount&#123; <span class="built_in">GetDataCount</span>(strData) &#125;;</span><br><span class="line">PROLE pRole = <span class="keyword">new</span> Role[icount];</span><br><span class="line"><span class="built_in">GetStringData</span>(pRole, strData, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; icount; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">1</span>; y &lt; icount; y++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (pRole[y].Exp &gt; pRole[y - <span class="number">1</span>].Exp)</span><br><span class="line">&#123;</span><br><span class="line">Role tmp = pRole[y - <span class="number">1</span>];</span><br><span class="line">pRole[y - <span class="number">1</span>] = pRole[y];</span><br><span class="line">pRole[y] = tmp;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; icount; i++)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; pRole[i].Id &lt;&lt; <span class="string">&quot;  &quot;</span> &lt;&lt; pRole[i].Exp &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç¼–è¯‘å™¨</strong></p><p><img src="https://bu.dusays.com/2024/11/28/674823b859eb4.png"></p><p>1ï¸âƒ£ æœªå®šä¹‰è¡Œä¸º</p><p>C++æ ‡å‡†æœªä½œè§„å®šçš„è¡Œä¸ºï¼Œç§°ä¸ºæœªå®šä¹‰è¡Œä¸ºï¼Œæœªå®šä¹‰è¡Œä¸ºçš„ç»“æœæ˜¯ä¸ç¡®å®šçš„ï¼Œå…·ä½“åœ¨ä¸åŒçš„ç¼–è¯‘å™¨ä¸‹ä¼šæœ‰ä¸åŒçš„æ•ˆæœï¼›</p><p><code>c=2*a++ + ++a*6;</code></p><p>è¿™é‡Œå…ˆç®—<code>a++</code> è¿˜æ˜¯å…ˆç®— <code>++ a</code> å°±æ˜¯ä¸€ä¸ªæœªå®šä¹‰è¡Œä¸º</p><p><code>int x = -25602;</code>   <code>x=x&gt;&gt;2;</code>  xçš„ç»“æœåœ¨ä¸åŒç¼–è¯‘å™¨ä¸‹æ˜¯ä¸ç¡®å®šçš„ï¼Œè¿™ä¹Ÿå±äºæœªå®šä¹‰è¡Œä¸ºã€‚</p><p>â€‹<strong>One Definition Rule</strong></p><p>ODRæ˜¯ä¸€ç³»åˆ—è§„åˆ™ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªè§„åˆ™ï¼Œç¨‹åºä¸­å®šä¹‰çš„æ¯ä¸ªå¯¹è±¡éƒ½å¯¹åº”ç€è‡ªå·±çš„è§„åˆ™ï¼›</p><p>ä½†æ˜¯åŸºæœ¬ä¸Šæ¥è®²ï¼Œä»»ä½•å˜é‡ã€å‡½æ•°ã€ç±»ã€æšä¸¾ã€æ¨¡æ¿ï¼Œæ¦‚å¿µåœ¨æ¯ä¸ªè½¬æ¢å•å…ƒä¸­éƒ½åªå…è®¸æœ‰ä¸€ä¸ªå®šä¹‰ï¼›éinlineçš„å‡½æ•°æˆ–è€…å˜é‡ï¼Œåœ¨ç¨‹åºä¸­ï¼Œæœ‰ä¸”åªæœ‰ä¸€ä¸ªå®šä¹‰</p><p>ä»…åœ¨è‡ªå·±çš„è½¬æ¢å•å…ƒæœ‰æ•ˆï¼š</p><p>1ï¸âƒ£ <code>const</code>ç±»å‹çš„å˜é‡ ï¼š<strong>å…¨å±€constå˜é‡</strong>ï¼Œæ²¡æœ‰ç‰¹åˆ«å£°æ˜ï¼Œåªåœ¨å½“å‰è½¬æ¢å•å…ƒå†…å¯è§ã€‚<strong>é™æ€constå˜é‡</strong>ï¼Œåœ¨ç±»æˆ–å‡½æ•°ä¸­çš„ä½œç”¨åŸŸå†…æœ‰æ•ˆï¼Œä¸ä¼šæš´éœ²åˆ°å…¶ä»–åœ°æ–¹ã€‚<strong>å¤–éƒ¨constå˜é‡</strong>ï¼Œä½¿ç”¨<code>extern</code>å…³é”®å­—ä½¿å¾—å˜é‡æ‹¥æœ‰å¤–éƒ¨é“¾æ¥å±æ€§ã€‚ </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> a = <span class="number">10</span>;  <span class="comment">// åªåœ¨å½“å‰æºæ–‡ä»¶æœ‰æ•ˆ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="type">const</span> <span class="type">int</span> b;  <span class="comment">// åœ¨å…¶ä»–æ–‡ä»¶ä¸­ä¹Ÿå¯ä»¥å¼•ç”¨ï¼Œä½†å˜é‡å®šä¹‰åªèƒ½åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­</span></span><br></pre></td></tr></table></figure><p>2ï¸âƒ£ <code>static</code> ç±»å‹çš„å˜é‡ ï¼š<strong>å…¨å±€staticå˜é‡</strong>  ä»…åœ¨å®šä¹‰å®ƒçš„æºæ–‡ä»¶å†…æœ‰æ•ˆï¼Œä¸èƒ½è¢«å…¶ä»–æºæ–‡ä»¶è®¿é—®ã€‚<strong>å±€éƒ¨staticå˜é‡</strong> åªåœ¨å‡½æ•°å†…æœ‰æ•ˆï¼Œä½†å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸæŒç»­æ•´ä¸ªç¨‹åºè¿è¡Œå‘¨æœŸï¼Œåªæœ‰åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶åˆå§‹åŒ–ï¼Œä¹‹åçš„è°ƒç”¨å°†ä¿ç•™ä¸Šä¸€æ¬¡ä¿®æ”¹çš„å€¼ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> global_var = <span class="number">10</span>;  <span class="comment">// åªèƒ½åœ¨å½“å‰æºæ–‡ä»¶æœ‰æ•ˆ</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> local_static = <span class="number">0</span>;  <span class="comment">// åªåœ¨è¯¥å‡½æ•°è°ƒç”¨ä¸­æœ‰æ•ˆï¼Œä½†å…¶ç”Ÿå‘½å‘¨æœŸæŒç»­æ•´ä¸ªç¨‹åº</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 3ï¸âƒ£ <code>inline</code> å˜é‡ï¼šåœ¨å½“å‰è½¬æ¢å•å…ƒå†…ç”Ÿæ•ˆï¼Œä½†æ˜¯å¯ä»¥è·¨å¤šä¸ªè½¬æ¢å•å…ƒå…±äº«ã€‚<code>inline</code>å˜é‡çš„ä½œç”¨ç±»ä¼¼äºå¸¸é‡ï¼Œå…è®¸åœ¨å¤šä¸ªæºæ–‡ä»¶ä¸­å®šä¹‰å’Œä½¿ç”¨ï¼Œè€Œä¸å‘ç”Ÿé‡å¤å®šä¹‰é“¾æ¥é”™è¯¯ã€‚</p><p><code>inline</code>å˜é‡é€šå¸¸ç”¨åœ¨å¤´æ–‡ä»¶ä¸­å®šä¹‰å¸¸é‡æˆ–å…¶ä»–éœ€è¦è·¨å¤šä¸ªæ–‡ä»¶å…±äº«çš„å˜é‡ã€‚<code>inline</code>å˜é‡éµå¾ªä¸€ç¿»è¯‘å•å…ƒä¸€å®ä¾‹çš„è§„åˆ™ï¼Œä¿è¯å¤šä¸ªæºæ–‡ä»¶ä¸­ä¸ä¼šå‡ºç°é‡å¤å®šä¹‰çš„é—®é¢˜ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// header.h</span></span><br><span class="line"><span class="keyword">inline</span> <span class="type">int</span> a = <span class="number">1350</span>;  <span class="comment">// å†…è”å˜é‡ï¼Œå¤šä¸ªç¿»è¯‘å•å…ƒå¯ä»¥å…±äº«è¿™ä¸ªå˜é‡ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// cppæ–‡ä»¶</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;header.h&quot;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    a = <span class="number">2000</span>;   <span class="comment">// ä¿®æ”¹inline å˜é‡</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ€»ç»“ï¼šä»…åœ¨å½“å‰ç¿»è¯‘å•å…ƒç”Ÿæ•ˆçš„ï¼š<code>static</code> å’Œ é»˜è®¤çš„ <code>const</code> å˜é‡ã€‚  å¯ä»¥è·¨å¤šä¸ªç¿»è¯‘å•å…ƒå…±äº«ï¼š<code>inline</code> å˜é‡ã€‚</p><p>åç§°çš„é“¾æ¥å±æ€§ï¼š</p><p>1ï¸âƒ£ å†…éƒ¨é“¾æ¥å±æ€§ï¼šè¯¥åç§°ä»…åœ¨æœ¬è½¬æ¢å•å…ƒä¸­æœ‰æ•ˆã€‚</p><p>2ï¸âƒ£ å¤–éƒ¨é“¾æ¥å±æ€§ï¼šè¯¥åç§°åœ¨å…¶ä»–çš„è½¬æ¢å•å…ƒä¸­ä¹Ÿæœ‰æ•ˆã€‚</p><p>3ï¸âƒ£ æ— é“¾æ¥å±æ€§ï¼š è¯¥åç§°ä»…ä»…èƒ½å¤Ÿç”¨äºè¯¥åç§°çš„ä½œç”¨åŸŸå†…è®¿é—®ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cpp05å‡½æ•°å’Œæ ˆ</title>
      <link href="/2024/12/11/cpp05%E5%87%BD%E6%95%B0%E5%92%8C%E6%A0%88/"/>
      <url>/2024/12/11/cpp05%E5%87%BD%E6%95%B0%E5%92%8C%E6%A0%88/</url>
      
        <content type="html"><![CDATA[<p>æ ˆçš„æœ¬è´¨æ˜¯ä¸€æ®µæå‰åˆ†é…å¥½çš„å†…å­˜ç©ºé—´ï¼Œä¸»è¦å°±æ˜¯ç”¨æ¥å­˜æ”¾ä¸´æ—¶å˜é‡ï¼åªéœ€è¦ç®¡ç†å¥½æ ˆçš„è¯»å†™å°±å¯ä»¥é¿å…é¢‘ç¹çš„å†…å­˜åˆ†é…å’Œä¸å¿…è¦çš„å†…å­˜æµªè´¹ï¼</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">Ave</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    a = a + <span class="number">250</span>;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> c = <span class="number">250</span>;</span><br><span class="line">    <span class="type">int</span> d = <span class="built_in">Ave</span>(a, b);</span><br><span class="line">    c = c + d;</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; Add;</span><br><span class="line">    <span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="type">int</span> x = <span class="built_in">Add</span>(<span class="number">250</span>, <span class="number">50</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>CPU çš„å¯„å­˜å™¨ï¼š</p><p><code>return</code>  çš„å€¼ ä¸€èˆ¬ä½¿ç”¨ eax æ¥ä¼ é€’</p><p><img src="https://bu.dusays.com/2024/11/27/6747130a5ebff.png"></p><p><img src="https://bu.dusays.com/2024/11/27/674713b137197.png"></p>]]></content>
      
      
      <categories>
          
          <category> Cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cpp04å‡½æ•°è¿›é˜¶</title>
      <link href="/2024/12/11/cpp04%E5%87%BD%E6%95%B0%E8%BF%9B%E9%98%B6/"/>
      <url>/2024/12/11/cpp04%E5%87%BD%E6%95%B0%E8%BF%9B%E9%98%B6/</url>
      
        <content type="html"><![CDATA[<h3 id="å‡½æ•°è¿”å›-è¿”å›æŒ‡é’ˆå’Œå¼•ç”¨"><a href="#å‡½æ•°è¿”å›-è¿”å›æŒ‡é’ˆå’Œå¼•ç”¨" class="headerlink" title="å‡½æ•°è¿”å›-è¿”å›æŒ‡é’ˆå’Œå¼•ç”¨"></a>å‡½æ•°è¿”å›-è¿”å›æŒ‡é’ˆå’Œå¼•ç”¨</h3><h4 id="è¿”å›æŒ‡é’ˆä¸è¦è¿”å›å±€éƒ¨å˜é‡"><a href="#è¿”å›æŒ‡é’ˆä¸è¦è¿”å›å±€éƒ¨å˜é‡" class="headerlink" title="è¿”å›æŒ‡é’ˆä¸è¦è¿”å›å±€éƒ¨å˜é‡"></a>è¿”å›æŒ‡é’ˆä¸è¦è¿”å›å±€éƒ¨å˜é‡</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">clen</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; str[i]; i ++ )</span><br><span class="line">    <span class="keyword">return</span> ++i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">char</span>* <span class="title">cstr</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> len = <span class="built_in">clen</span>(str);</span><br><span class="line">   <span class="comment">// char strRt[0x20];   // è¿™å°±æ˜¯é”™è¯¯ç¤ºèŒƒï¼Œè¿”å›äº†ä¸€ä¸ªå±€éƒ¨å˜é‡</span></span><br><span class="line">    <span class="comment">// åªè¦ä¸é‡Šæ”¾ï¼Œä¸€ç›´åœ¨å †ä¸Šé¢</span></span><br><span class="line">    <span class="type">char</span>* strRt = <span class="keyword">new</span> <span class="type">char</span>[len];</span><br><span class="line">    <span class="built_in">memcpy</span>(strRt, str, len);</span><br><span class="line">    <span class="keyword">return</span> strRt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é¡¹ç›®è®¾è®¡</strong></p><p><img src="https://bu.dusays.com/2024/11/24/6742aa525f2f5.png"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">Role</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">char</span>* name;</span><br><span class="line"><span class="type">int</span> Hp;</span><br><span class="line"><span class="type">int</span> maxHp;</span><br><span class="line"><span class="type">int</span> Mp;</span><br><span class="line"><span class="type">int</span> maxMp;</span><br><span class="line"><span class="type">int</span> lv;</span><br><span class="line">&#125;*PROLE, ROLE;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">clen</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> i;</span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; str[i]; i++);</span><br><span class="line"><span class="keyword">return</span> ++i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">char</span>* <span class="title">cstr</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// ä¸è¦è¿”å›ä¸€ä¸ªå±€éƒ¨å˜é‡</span></span><br><span class="line"><span class="type">int</span> len = <span class="built_in">clen</span>(str);</span><br><span class="line"><span class="comment">// åªè¦ä¸é‡Šæ”¾ï¼Œä¸€ç›´åœ¨å †ä¸Šé¢</span></span><br><span class="line"><span class="type">char</span>* strRt = <span class="keyword">new</span> <span class="type">char</span>[len];</span><br><span class="line"><span class="built_in">memcpy</span>(strRt, str, len);</span><br><span class="line"><span class="keyword">return</span> strRt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">ROLE <span class="title">CreateMonster</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str, <span class="type">int</span> Hp, <span class="type">int</span> Mp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ç”³è¯·äº†ç©ºé—´ï¼ŒæŠŠå®ƒè¿”å›ä¹‹åï¼Œè¿˜å¾—èµ‹å€¼åˆ° roleä¸Šé¢ï¼Œé€ æˆäº†æ€§èƒ½æŸå¤±</span></span><br><span class="line">Role rt&#123; <span class="built_in">cstr</span>(str), Hp, Hp, Mp, Mp, <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">return</span> rt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">char</span>* str;</span><br><span class="line">str = <span class="built_in">cstr</span>(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">std::cout &lt;&lt; str;</span><br><span class="line"></span><br><span class="line">ROLE role = <span class="built_in">CreateMonster</span>(<span class="string">&quot;aoteman&quot;</span>, <span class="number">1500</span>, <span class="number">1500</span>);</span><br><span class="line"></span><br><span class="line">std::cout &lt;&lt; role.name &lt;&lt; std::endl;</span><br><span class="line">std::cout &lt;&lt; role.Hp &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*---------------æ”¹è¿›æ–¹æ³•1ï¸âƒ£  è¿”å›æŒ‡é’ˆ--------------------*/</span></span><br><span class="line"><span class="function">PROLE <span class="title">CreateMonster</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str, <span class="type">int</span> Hp, <span class="type">int</span> Mp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// è¿™ä¸‹è¿”å›çš„æ˜¯4å­—èŠ‚çš„æŒ‡é’ˆ</span></span><br><span class="line">PROLE rt = <span class="keyword">new</span> ROLE&#123; <span class="built_in">cstr</span>(str), Hp, Hp, Mp, Mp, <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">return</span> rt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">char</span>* str;</span><br><span class="line">str = <span class="built_in">cstr</span>(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">std::cout &lt;&lt; str;</span><br><span class="line"></span><br><span class="line">PROLE role = <span class="built_in">CreateMonster</span>(<span class="string">&quot;aoteman&quot;</span>, <span class="number">1500</span>, <span class="number">1500</span>);</span><br><span class="line">    <span class="comment">// è¿™æ ·çš„è¯æ€§èƒ½æŠ˜æŸå‡ ä¹æ²¡æœ‰äº†</span></span><br><span class="line">std::cout &lt;&lt; role-&gt;name &lt;&lt; std::endl;</span><br><span class="line">std::cout &lt;&lt; role-&gt;Hp &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*---------------æ”¹è¿›æ–¹æ³•2ï¸âƒ£  è¿”å›å¼•ç”¨--------------------*/</span></span><br><span class="line"><span class="function">ROLE&amp; <span class="title">CreateMonster</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* str, <span class="type">int</span> Hp, <span class="type">int</span> Mp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">PROLE rt = <span class="keyword">new</span>&#123; <span class="built_in">cstr</span>(str), Hp, Hp, Mp, Mp, <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="comment">// ç”±äºæ˜¯å¼•ç”¨ï¼Œæ‰€ä»¥ä¸èƒ½ä¼ ç©ºæŒ‡é’ˆ</span></span><br><span class="line"><span class="keyword">return</span> *rt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">char</span>* str;</span><br><span class="line">str = <span class="built_in">cstr</span>(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">std::cout &lt;&lt; str;</span><br><span class="line"></span><br><span class="line">ROLE&amp; role = <span class="built_in">CreateMonster</span>(<span class="string">&quot;aoteman&quot;</span>, <span class="number">1500</span>, <span class="number">1500</span>);</span><br><span class="line"></span><br><span class="line">std::cout &lt;&lt; role.name &lt;&lt; std::endl;</span><br><span class="line">std::cout &lt;&lt; role.Hp &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ•°ç»„çš„å¼•ç”¨ï¼ˆè¡¥å……ï¼‰"><a href="#æ•°ç»„çš„å¼•ç”¨ï¼ˆè¡¥å……ï¼‰" class="headerlink" title="æ•°ç»„çš„å¼•ç”¨ï¼ˆè¡¥å……ï¼‰"></a>æ•°ç»„çš„å¼•ç”¨ï¼ˆè¡¥å……ï¼‰</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a;</span><br><span class="line"><span class="type">int</span>&amp; b = a;</span><br><span class="line"><span class="type">int</span> c[<span class="number">100</span>];</span><br><span class="line"><span class="comment">// int&amp; d[100] = c;  error</span></span><br><span class="line"><span class="built_in">int</span> (&amp;e)[<span class="number">100</span>] = a;  <span class="comment">// å¿…é¡»ä¸º100 æ‰è¡Œ   è€Œä¸”å¾—å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œeæ˜¯ä¸ªå¼•ç”¨</span></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">ave</span><span class="params">(<span class="type">int</span>(&amp;art)[<span class="number">100</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">sizeof</span>(art) &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> x : art);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> a[<span class="number">100</span>];</span><br><span class="line">    <span class="type">int</span> c[<span class="number">100</span>];</span><br><span class="line">    <span class="built_in">int</span> (&amp;b)[<span class="number">100</span>] = c;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">ave</span>(a);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å³å€¼å¼•ç”¨"><a href="#å³å€¼å¼•ç”¨" class="headerlink" title="å³å€¼å¼•ç”¨"></a>å³å€¼å¼•ç”¨</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Add1</span><span class="params">(<span class="type">int</span>&amp;&amp; a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Add2</span><span class="params">(<span class="type">int</span>&amp; a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> c = <span class="number">320</span> + <span class="number">250</span>;</span><br><span class="line">    <span class="type">int</span>&amp; d = c;</span><br><span class="line">    <span class="comment">// å³å€¼å¼•ç”¨ &amp;&amp;</span></span><br><span class="line">    <span class="comment">// int&amp;&amp; e = d;  å³å€¼å¼•ç”¨ä½ å°±ä¸èƒ½æŒ‡å‘å†…å­˜ä¸­æœ‰ä½ç½®çš„å¯¹è±¡ï¼Œ</span></span><br><span class="line">    <span class="type">int</span>&amp;&amp; e = <span class="number">320</span>;   <span class="comment">// å³å€¼å¼•ç”¨å¯ä»¥æŒ‡å‘ä¸´æ—¶çš„ä¸œè¥¿</span></span><br><span class="line">    </span><br><span class="line">    e = <span class="number">1500</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> x = c + <span class="number">100</span> + <span class="number">200</span>;</span><br><span class="line">    <span class="built_in">Add2</span>(x);</span><br><span class="line">    <span class="comment">// ä½¿ç”¨å³å€¼å¼•ç”¨ï¼Œå‡å°‘ä¸å¿…è¦çš„å†…å­˜æµªè´¹</span></span><br><span class="line">    <span class="built_in">Add1</span>(c + <span class="number">100</span> + <span class="number">200</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Role <span class="title">CrateMonster</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Role rt&#123;<span class="number">100</span>,<span class="number">200</span>&#125;;</span><br><span class="line">    <span class="keyword">return</span> rt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">show</span><span class="params">(Role&amp;&amp; r1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; r<span class="number">1.</span>hp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Show</span>(<span class="built_in">CreateMonster</span>());</span><br><span class="line">    <span class="comment">// åŸæ¥çš„æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªé¢å¤–çš„å˜é‡æ¥ä¿å­˜</span></span><br><span class="line">    <span class="comment">// ROLE role = CreateMonster(&quot;aoteman&quot;, 1500, 1500);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/11/24/6742beef8067c.png"></p><p>å³è¾¹çš„éƒ¨åˆ†ï¼Œ<code>Role r1</code> æ˜¯éœ€è¦åˆ›å»ºå˜é‡çš„ï¼Œæœ‰å†…å­˜å¼€é”€ã€‚  <code>Role&amp; r1</code>æ— æ³•ä¼ é€’å±€éƒ¨å˜é‡ï¼ˆä¸´æ—¶é‡ï¼‰ã€‚</p><p>å·¦è¾¹éƒ¨åˆ†ï¼Œè™½ç„¶Role CreateRole()åˆ†é…åˆ°æ ˆé‡Œï¼Œä½†è·‘åˆ°ä¸‹ä¸€ä¸ªå‡½æ•°ï¼Œè¿™éƒ¨åˆ†å†…å®¹è¦æ“¦é™¤çš„ã€‚</p><h4 id="å‡½æ•°çš„æœ¬è´¨ï¼ˆåº•å±‚ï¼‰"><a href="#å‡½æ•°çš„æœ¬è´¨ï¼ˆåº•å±‚ï¼‰" class="headerlink" title="å‡½æ•°çš„æœ¬è´¨ï¼ˆåº•å±‚ï¼‰"></a>å‡½æ•°çš„æœ¬è´¨ï¼ˆåº•å±‚ï¼‰</h4><p><img src="https://bu.dusays.com/2024/11/24/6742c2f421215.png"> push  æœ‰ä¸ªä½œç”¨  ä¼ å‚çš„    ï¼ŒæŠŠå‚æ•°æ¨åˆ°æ ˆåŒº</p><p><img src="https://bu.dusays.com/2024/11/24/6742c5e9d7b54.png"></p><p>å‡½æ•°çš„åå­—å°±æ˜¯ä¸€ä¸ªå†…å­˜åœ°å€  ä»£ç å°±æ˜¯äºŒè¿›åˆ¶æ•°æ®</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; Add;  <span class="comment">//å‡½æ•°çš„åå­—å°±æ˜¯ä¸€ä¸ªå†…å­˜åœ°å€</span></span><br><span class="line">    </span><br><span class="line">    <span class="type">char</span>* str = (<span class="type">char</span>*)Add;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%02X\n&quot;</span>, (<span class="type">unsigned</span> <span class="type">char</span>)str[i]);</span><br><span class="line">        <span class="comment">// æ‰“å°å‡ºæ¥çš„å†…å®¹å°±æ˜¯å‘½ä»¤å¯¹åº”çš„äºŒè¿›åˆ¶</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æµ‹è¯•ä¸‹èƒ½ä¸èƒ½å†™å…¥</span></span><br><span class="line">    <span class="comment">// str[0] = 25; å‡ºé”™  å¸¸é‡ä¸€æ ·ï¼Œï¼Œä¸è®©å†™</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å‡½æ•°æŒ‡é’ˆ"><a href="#å‡½æ•°æŒ‡é’ˆ" class="headerlink" title="å‡½æ•°æŒ‡é’ˆ"></a>å‡½æ•°æŒ‡é’ˆ</h4><p>å‡½æ•°è¿”å›ç±»å‹  (*å‡½æ•°æŒ‡é’ˆå˜é‡å)(å‚æ•°ç±»å‹  å‚æ•°åç§°, â€¦  å‚æ•°ç±»å‹  å‚æ•°åç§°);</p><p><code>int (*pAdd)(int a, int b)</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–°ç”¨æ³•</span></span><br><span class="line"><span class="comment">// å£°æ˜ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆç±»å‹</span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">char</span><span class="params">(*pfAdd)</span><span class="params">(<span class="type">int</span>, <span class="type">int</span>)</span></span>;</span><br><span class="line"><span class="keyword">using</span> pFAdd = <span class="built_in">char</span> (*)(<span class="type">int</span>, <span class="type">int</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">AddX</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Add1</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ç±»å‹è½¬æ¢  ä¸Šé¢å£°æ˜çš„ ä¸¤ä¸ªç±»å‹</span></span><br><span class="line">    pfAdd pAdd1 = (pfAdd)Add1;</span><br><span class="line">    pFAdd pAdd2 = (pFAdd)AddX;</span><br><span class="line">    <span class="comment">// ç±»å‹ä¸ä¸€æ ·çš„æ—¶å€™ä½¿ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢</span></span><br><span class="line">    <span class="comment">// å£°æ˜å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">    <span class="built_in">int</span> (*pxAdd)(<span class="type">int</span>, <span class="type">int</span>) = AddX;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">pxAdd</span>(<span class="number">1</span>, <span class="number">2</span>) &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">sizeof</span>(pAdd1) &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; <span class="built_in">pAdd1</span>(<span class="number">30</span>, <span class="number">35</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Tips</p><p><img src="https://bu.dusays.com/2024/11/24/6742d6cc78d8f.png"></p><h4 id="ä»å‡½æ•°çš„è§’åº¦å½»åº•è®¤è¯†æ ˆ"><a href="#ä»å‡½æ•°çš„è§’åº¦å½»åº•è®¤è¯†æ ˆ" class="headerlink" title="ä»å‡½æ•°çš„è§’åº¦å½»åº•è®¤è¯†æ ˆ"></a>ä»å‡½æ•°çš„è§’åº¦å½»åº•è®¤è¯†æ ˆ</h4><p>æ ˆååˆ†é‡è¦ï¼Œåº•å±‚å¾ˆé‡è¦</p><p>1ï¸âƒ£ æ ˆæ˜¯é¢„å…ˆåˆ†é…å¥½çš„ï¼Œè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå±€éƒ¨å˜é‡å°±æ”¾åœ¨æ ˆç©ºé—´ä¸Šï¼Œé€šè¿‡æ§åˆ¶espæ¥å®ç°å±€éƒ¨å˜é‡çš„åˆ›å»ºå’Œé‡Šæ”¾</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> c = <span class="number">250</span>;</span><br><span class="line">    <span class="type">int</span> d = <span class="built_in">Ave</span>(a, b);</span><br><span class="line">    c = c + d;</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2ï¸âƒ£ æ ˆå¹³è¡¡å¦‚æœè¢«ç ´åï¼Œå‡½æ•°å°±å¯èƒ½ä¸èƒ½è¿”å›åˆ°é¢„æœŸçš„ä½ç½®ï¼ŒåŒç†ï¼Œåˆ©ç”¨è¿™ä¸ªåŸç†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ§åˆ¶ç›®æ ‡ç¨‹åºè¿›å…¥æŒ‡å®šçš„ä½ç½®ï¼Œæ¥è·å–ç›®æ ‡æ“ä½œç³»ç»Ÿçš„æ§åˆ¶æƒé™ï¼Œè¿™ä¹Ÿå°±æ˜¯æ ˆæ”»å‡»çš„æŠ€æœ¯åŸç†ï¼ŒåŒæ—¶ç¼–å†™ä»£ç æ—¶ä¹Ÿè¦ç§¯æé¢„é˜²æ ˆæ”»å‡»ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00</span>C61073 <span class="number">6</span>A <span class="number">32</span>             push   <span class="number">32</span>h</span><br><span class="line"><span class="number">00</span>C61075 <span class="number">68</span> FA <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    push   <span class="number">0</span>FAh</span><br><span class="line"><span class="number">00</span>C6107A E8 A1 FF FF FF    call   <span class="number">00</span>C61020</span><br><span class="line"><span class="number">00</span>C6107F <span class="number">83</span> C4 <span class="number">0</span>8          add    esp,<span class="number">8</span></span><br><span class="line"><span class="number">00</span>C61082 <span class="number">89</span> <span class="number">45</span> FC          mov    dword ptr [ebp<span class="number">-4</span>],eax</span><br></pre></td></tr></table></figure><p>3ï¸âƒ£ å½“æˆ‘ä»¬é€†å‘çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡å‡½æ•°å¤´éƒ¨çš„sub esp, xæ¥åˆ¤æ–­è¿™ä¸ªå‡½æ•°æœ‰å¤šå°‘å±€éƒ¨å˜é‡</p><p>4ï¸âƒ£ å…³äºCPUå¯„å­˜å™¨çš„è¯´æ˜</p><p>â€‹eaxï¼š å‡½æ•°çš„æ‰§è¡Œç»“æœä¼šé€šè¿‡eaxæ¥ä¼ é€’</p><p>â€‹espï¼š æ ˆé¡¶ï¼Œæ ˆé¡¶ä»¥ä¸‹çš„å€¼ä»£è¡¨ç€æ˜¯å¯ä»¥è®¿é—®çš„å±€éƒ¨å˜é‡ã€‚</p><p>â€‹ebpï¼š æ ˆåº•</p><p>â€‹eipï¼š  CPUæ‰§è¡Œçš„ä½ç½®</p><h4 id="å‡½æ•°é‡è½½ï¼ˆC-å†…å®¹ï¼‰"><a href="#å‡½æ•°é‡è½½ï¼ˆC-å†…å®¹ï¼‰" class="headerlink" title="å‡½æ•°é‡è½½ï¼ˆC++å†…å®¹ï¼‰"></a>å‡½æ•°é‡è½½ï¼ˆC++å†…å®¹ï¼‰</h4><p>å‡½æ•°é‡è½½ï¼ˆFunction Overloadingï¼‰æ˜¯ç¼–ç¨‹ä¸­ä¸€ç§å…è®¸åœ¨åŒä¸€ä¸ªä½œç”¨åŸŸä¸­å®šä¹‰å¤šä¸ªåŒåå‡½æ•°çš„æŠ€æœ¯ã€‚è¿™äº›å‡½æ•°æ ¹æ®å…¶å‚æ•°çš„ä¸ªæ•°æˆ–ç±»å‹çš„ä¸åŒï¼Œèƒ½å¤Ÿæ‰§è¡Œä¸åŒçš„æ“ä½œã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">ave</span><span class="params">(<span class="type">int</span> *a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ave</span><span class="params">(<span class="type">int</span> a[], <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¿™ç§æ˜¯ä¸å¯ä»¥çš„ï¼Œint* a å’Œ  int a[]å…¶å®æ˜¯ä¸€æ ·çš„ </span></span><br><span class="line"><span class="comment">// å‡½æ•°é‡è½½ä½¿ç”¨æ—¶ä¸èƒ½å‡ºç°æ­§ä¹‰</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ave</span><span class="params">(<span class="type">int</span>&amp; a, <span class="type">int</span>&amp; b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ave</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">100</span>, b = <span class="number">100</span>;</span><br><span class="line">    <span class="built_in">ave</span>(a, b);  <span class="comment">// è¿™ç§å°±æ˜¯ä¸è¡Œï¼Œå‡ºç°æ­§ä¹‰äº†  ä¸Šé¢ä¸¤ä¸ªå‡½æ•°éƒ½é€‚ç”¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">ave</span><span class="params">(<span class="type">int</span>&amp; a, <span class="type">int</span>&amp; b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">float</span> <span class="title">ave</span><span class="params">(<span class="type">float</span> a, <span class="type">float</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">char</span> a = <span class="number">100</span>, b = <span class="number">100</span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">ave</span>(a, b) &lt;&lt; std::endl;  <span class="comment">// è‡ªåŠ¨è½¬æˆfloat</span></span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">ave</span>((<span class="type">int</span>)a, (<span class="type">int</span>)b) &lt;&lt; std::endl;</span><br><span class="line">    <span class="comment">// è¿™åœ°æ–¹çš„ è½¬æ¢æ˜¯ä¸´æ—¶ çš„å˜é‡ï¼Œæ²¡æœ‰å›ºå®šçš„å†…å­˜åœ°å€</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">ave</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ave</span><span class="params">(<span class="type">const</span> <span class="type">int</span> a, <span class="type">const</span> <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¸å¯ä»¥é‡è½½ï¼Œæ˜¯ä»¥å€¼ä¼ å‚ï¼Œä¸èƒ½ä¿®æ”¹å†…å­˜é‡Œé¢çš„å€¼ï¼Œæ‰€ä»¥constå½¢åŒè™šè®¾</span></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">ave</span><span class="params">(<span class="type">int</span>&amp; a, <span class="type">int</span>&amp; b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ave</span><span class="params">(<span class="type">const</span>&amp; <span class="type">int</span> a, <span class="type">const</span>&amp; <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¯ä»¥é‡è½½ï¼Œ</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">100</span>, b = <span class="number">100</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> c = <span class="number">20</span>, d = <span class="number">10</span>;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">ave</span>(a, b) &lt;&lt; std::endl;  <span class="comment">//  éè°ƒç”¨ç¬¬ä¸€ä¸ª</span></span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">ave</span>(c, d) &lt;&lt; std::endl;  <span class="comment">//  å¸¸é‡æ‰§è¡Œç¬¬äºŒä¸ª</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&#x2F;&#x2F; å‡½æ•°é‡è½½çš„æ—¶å€™ä¸èƒ½é»˜è®¤å‚æ•°   ç¼–è¯‘å™¨åˆ†ä¸æ¸…</p><h4 id="å‡½æ•°æ¨¡æ¿ï¼ˆC-å†…å®¹ï¼‰"><a href="#å‡½æ•°æ¨¡æ¿ï¼ˆC-å†…å®¹ï¼‰" class="headerlink" title="å‡½æ•°æ¨¡æ¿ï¼ˆC++å†…å®¹ï¼‰"></a>å‡½æ•°æ¨¡æ¿ï¼ˆC++å†…å®¹ï¼‰</h4><p>å…ˆè¯´ä¸‹ä»€ä¹ˆæ˜¯æ¨¡æ¿ï¼Œæ¨¡æ¿å°±æ˜¯ç¼–å†™â€œ<code>ç±»å‹å‚æ•°åŒ–</code>â€çš„ä»£ç ï¼Œç­‰åˆ°ç¼–è¯‘æ—¶å†æ ¹æ®å…·ä½“ç±»å‹ç”Ÿæˆå¯¹åº”ç‰ˆæœ¬ã€‚</p><p>æ¨¡æ¿åœ¨ç¼–è¯‘æ—¶å®ä¾‹åŒ–ï¼Œå½“ç¼–è¯‘å™¨é‡åˆ°æ¨¡æ¿çš„å…·ä½“ä½¿ç”¨æ—¶ï¼Œä¾‹å¦‚è°ƒç”¨æ¨¡æ¿å‡½æ•°æˆ–åˆ›å»ºæ¨¡æ¿ç±»å®ä¾‹æ—¶ï¼Œç¼–è¯‘å™¨ä¼šç”Ÿæˆç›¸åº”çš„ä»£ç ã€‚è¿™ä¸€è¿‡ç¨‹ç§°ä¸ºæ¨¡æ¿çš„å®ä¾‹åŒ–ã€‚</p><p>1ï¸âƒ£å‡½æ•°æ¨¡æ¿  ï¼Œå®šä¹‰é€šç”¨çš„å‡½æ•°é€»è¾‘ï¼Œ<code>template&lt;typename T&gt; T add(T a, T b)</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">T <span class="title">add</span><span class="params">(T a, T b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">add</span>(<span class="number">3</span>, <span class="number">4</span>) &lt;&lt; <span class="string">&quot;\n&quot;</span>;      <span class="comment">// æ¨å¯¼å‡º T=int</span></span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">add</span>(<span class="number">3.5</span>, <span class="number">2.1</span>) &lt;&lt; <span class="string">&quot;\n&quot;</span>;  <span class="comment">// æ¨å¯¼å‡º T=double</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2ï¸âƒ£ç±»æ¨¡æ¿ï¼Œå®šä¹‰é€šç”¨çš„ç±»æˆ–æ•°æ®ç»“æ„ï¼Œ<code>template&lt;typename T&gt; class MyVector</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Box</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    T value;</span><br><span class="line">    <span class="built_in">Box</span>(T val) : <span class="built_in">value</span>(val) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123; std::cout &lt;&lt; value &lt;&lt; <span class="string">&quot;\n&quot;</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">Box&lt;<span class="type">int</span>&gt; <span class="title">intBox</span><span class="params">(<span class="number">10</span>)</span></span>;</span><br><span class="line">    <span class="function">Box&lt;std::string&gt; <span class="title">strBox</span><span class="params">(<span class="string">&quot;hello&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    intBox.<span class="built_in">show</span>();   <span class="comment">// è¾“å‡º 10</span></span><br><span class="line">    strBox.<span class="built_in">show</span>();   <span class="comment">// è¾“å‡º hello</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‹é¢ä¸»è¦ä»‹ç»ä¸‹<strong>å‡½æ•°æ¨¡æ¿</strong></p><p>å‡½æ•°æ¨¡æ¿ï¼ˆFunction Templateï¼‰æ˜¯ C++ ä¸­çš„ä¸€ç§é€šç”¨ç¼–ç¨‹æŠ€æœ¯ï¼Œå…è®¸ç¨‹åºå‘˜ç¼–å†™å¯ä»¥æ“ä½œå¤šç§æ•°æ®ç±»å‹çš„å‡½æ•°ï¼Œè€Œæ— éœ€ä¸ºæ¯ç§æ•°æ®ç±»å‹å•ç‹¬é‡å†™ä»£ç ã€‚å‡½æ•°æ¨¡æ¿é€šè¿‡å¼•å…¥æ¨¡æ¿å‚æ•°ï¼Œä½¿å‡½æ•°çš„ç±»å‹å¯ä»¥åœ¨è°ƒç”¨æ—¶åŠ¨æ€ç¡®å®šã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> type1&gt; <span class="function">type1 <span class="title">ave</span><span class="params">(type1 a, type1 b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (a + b) / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> type1&gt;</span><br><span class="line"><span class="function">type1 <span class="title">ave</span><span class="params">(type1 a, type1 b, type1 c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> (a + b + c) / <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">type1 <span class="title">ave1</span><span class="params">(type1* a, type1* b, type1* c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> (a + b + c) / <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æŠŠtype1å½“ä½œä¸€ç§ç±»å‹æ¥ä½¿ç”¨   æŒ‡é’ˆ  æ•°ç»„  éƒ½å¯ä»¥</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="built_in">ave</span>(<span class="number">12.0f</span>, <span class="number">250.0f</span>, <span class="number">35.33f</span>) &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">ave</span>(<span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>) &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">ave</span>((<span class="type">char</span>)<span class="number">11</span>, (<span class="type">char</span>)<span class="number">12</span>, (<span class="type">char</span>)<span class="number">13</span>) &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŒ‡å®šå‡½æ•°å‚æ•°çš„æ¨¡æ¿</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> type1&gt; <span class="function">type1 <span class="title">ave</span><span class="params">(type1 a, type1 b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (a + b) / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="built_in">ave</span>&lt;<span class="type">int</span>&gt;(<span class="number">12.0f</span>, <span class="number">250.0f</span>, <span class="number">35.33f</span>) &lt;&lt; std::endl;  <span class="comment">// è½¬æ¢æˆintç±»å‹äº†</span></span><br><span class="line">    <span class="comment">// ç›¸å½“äºæ‰§è¡Œä¸‹é¢çš„ä»£ç </span></span><br><span class="line">    <span class="comment">// int ave(int a, int b);   è€Œä¸æ˜¯ float ave(float a, float b);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‡½æ•°é‡è½½å¤§äºå‡½æ•°æ¨¡æ¿</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> type1&gt;</span></span><br><span class="line"><span class="function">type1 <span class="title">bigger</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a &gt; b ? a : b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¾‹å¤–</span></span><br><span class="line"><span class="comment">//template&lt;&gt;</span></span><br><span class="line"><span class="function"><span class="type">int</span>* <span class="title">bigger</span><span class="params">(<span class="type">int</span>* a, <span class="type">int</span>* b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> *a &gt; *b ? a : b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">float</span>* <span class="title">bigger</span><span class="params">(<span class="type">float</span>* a, <span class="type">float</span>* b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> *a &gt; *b ? a : b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> type1&gt;</span></span><br><span class="line"><span class="function">type1 <span class="title">ave</span><span class="params">(type1 a, type1 b, type1 c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (a + b + c) / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// æœ¬æ¥æ˜¯æƒ³ç€å‡å°‘å†…å­˜å¼€é”€ï¼Œä¼ å…¥æŒ‡é’ˆï¼Œç»“æœå‘ç°ï¼Œä¼ å…¥çš„æ˜¯åœ°å€</span></span><br><span class="line">    <span class="type">int</span> a&#123; <span class="number">100</span> &#125;, b&#123; <span class="number">200</span> &#125;, c&#123; <span class="number">300</span> &#125;;</span><br><span class="line">    c = *<span class="built_in">bigger</span>(&amp;a, &amp;b);</span><br><span class="line">    c = *<span class="built_in">ave</span>(&amp;a, &amp;b, &amp;c);   <span class="comment">//ç›¸å½“äºæŠŠå†…å­˜åœ°å€åŠ èµ·æ¥é™¤ä»¥3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…³é”®å­—<strong>auto decltype</strong></p><p>1ï¸âƒ£auto ä¸ä¿ç•™constå±æ€§  <code>const int a&#123; 10 &#125;;</code> <code>auto b = a;</code>  è¿™é‡Œçš„bå°±æ˜¯intç±»å‹ ã€‚</p><p>2ï¸âƒ£ auto ä¼šä¼˜å…ˆæ¨æ–­ä¸ºå€¼ç±»å‹è€Œéå¼•ç”¨ç±»å‹ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> b&#123;<span class="number">200</span>&#125;;</span><br><span class="line"><span class="type">int</span>&amp; l&#123;b&#125;;</span><br><span class="line"><span class="keyword">auto</span> c = l;   <span class="comment">// è¿™é‡Œlè¿˜æ˜¯intç±»å‹</span></span><br></pre></td></tr></table></figure><p>3ï¸âƒ£ auto åˆ©ç”¨å‡½æ•°è¿”å›å€¼æ¥ç¡®å®šç±»å‹çš„æ—¶å€™ï¼Œå‡½æ•°ä¼šæ‰§è¡Œã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> x = <span class="built_in">ave</span>(<span class="number">1</span>,<span class="number">2</span>); <span class="comment">// ave(1,2)ä¼šæ‰§è¡Œ    xçš„ç±»å‹æ ¹æ®aveå‡½æ•°çš„è¿”å›ç±»å‹æ¥ç¡®å®š</span></span><br></pre></td></tr></table></figure><p>æ ¹æ®ç‰¹æ€§2ï¸âƒ£</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#inlcude <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// auto æ‹–å°¾å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">bigger</span><span class="params">(<span class="type">int</span>&amp; a, <span class="type">int</span>&amp; b)</span>-&gt;<span class="type">float</span>   <span class="comment">// è½¬æˆfloatç±»å‹äº†</span></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function"><span class="type">int</span>&amp; <span class="title">bigger</span><span class="params">(<span class="type">int</span>&amp; a, <span class="type">int</span>&amp; b)</span>  <span class="comment">// è¿™é‡Œæ”¹æˆautoä¸è¡Œï¼Œä¼šæŠŠ&amp;è½¬æˆint</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a &gt; b ? a : b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> a&#123;<span class="number">100</span>&#125;;</span><br><span class="line">    <span class="type">int</span> b&#123;<span class="number">200</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// èƒ½è¿™ä¹ˆå†™æ˜¯å› ä¸ºè¿”å›å€¼ä¸æ˜¯ä¸´æ—¶å˜é‡ï¼Œå·¦å€¼</span></span><br><span class="line">    <span class="comment">// bigger(a, b) = 500;  // æ¯”è¾ƒa å’Œ b å“ªä¸ªæ•°å¤§ï¼Œå¤§çš„ æ”¹æˆ500;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>decltypeå…³é”®å­—</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a&#123;&#125;;</span><br><span class="line"><span class="type">unsigned</span> b&#123;&#125;;</span><br><span class="line"><span class="keyword">decltype</span>(a-b) x;  <span class="comment">// ç›¸å½“äºunsigned x;    æœ‰ç¬¦å·æ•°å’Œæ— ç¬¦å·è¿ç®—ï¼Œç»“æœä¸ºæ— ç¬¦å·æ•°</span></span><br></pre></td></tr></table></figure><p>å¦‚æœè¡¨è¾¾å¼æ²¡æœ‰ç»å†è¿‡è¿ç®—ï¼Œé‚£ä¹ˆç±»å‹æ˜¯ä¸€æ ·çš„ï¼Œ  å¯ä»¥ä¿ç•™å¼•ç”¨å±æ€§  ï¼ˆå¼•ç”¨å¿…é¡»åˆå§‹åŒ–ï¼‰</p><p>ï¼ˆæ²¡æœ‰å›ºå®šå†…å­˜åœ°å€çš„æƒ…å†µï¼‰å¦‚æœç»å†è¿‡è¿ç®—äº†ï¼Œä¼šæ ¹æ®ç»“æœçš„ç±»å‹æ¥æ¨æ–­ç±»å‹</p><p>ï¼ˆæœ‰å›ºå®šå†…å­˜åœ°å€çš„æƒ…å†µï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a&#123;<span class="number">100</span>&#125;;</span><br><span class="line"><span class="type">int</span>* pa&#123;&amp;a&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">decltype</span>(*pa) x = a;<span class="comment">// x æ˜¯int ç±»å‹çš„å¼•ç”¨</span></span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/11/24/674327db2d723.png"></p><p><code>decltype(pa[5]) x;</code>  ç›¸å½“äºint&amp; x    pa[5]æ˜¯æœ‰åœ°å€çš„ï¼Œåªæ˜¯ä¸å½’æˆ‘ä»¬è®¿é—®è€Œå·²</p><p><img src="https://bu.dusays.com/2024/11/24/674328e67c835.png"></p><h4 id=""><a href="#" class="headerlink" title=""></a><img src="https://bu.dusays.com/2024/11/24/67432a50d20d6.png"></h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">bigger</span><span class="params">(<span class="type">int</span>&amp; a, <span class="type">int</span>&amp; b)</span>-&gt;<span class="title">decltype</span><span class="params">(a &gt; b ? a : b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a &gt; b ? a : b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">decltype</span>(<span class="keyword">auto</span>) <span class="title">bigger</span><span class="params">(<span class="type">int</span>&amp; a, <span class="type">int</span>&amp; b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a &gt; b ? a : b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ¨æ–­å‡½æ•°æ¨¡æ¿è¿”å›ç±»å‹"><a href="#æ¨æ–­å‡½æ•°æ¨¡æ¿è¿”å›ç±»å‹" class="headerlink" title="æ¨æ–­å‡½æ•°æ¨¡æ¿è¿”å›ç±»å‹"></a>æ¨æ–­å‡½æ•°æ¨¡æ¿è¿”å›ç±»å‹</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T1, <span class="keyword">typename</span> T2&gt;</span></span><br><span class="line"><span class="function">T1 <span class="title">ave</span><span class="params">(T2 a, T1 b)</span>   <span class="comment">// T1</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (a + b) / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// è¿”å›ç±»å‹æ˜¯ç”±åé¢çš„å†³å®šçš„</span></span><br><span class="line">    <span class="built_in">ave</span>(<span class="number">100.02f</span>, <span class="number">200</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T1, <span class="keyword">typename</span> T2&gt;</span></span><br><span class="line"><span class="function"><span class="title">delctype</span><span class="params">(<span class="keyword">auto</span>)</span> <span class="title">bigger</span><span class="params">(T1&amp; a, T2&amp; b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a &gt; b ? a : b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">float</span> a = <span class="number">50</span>;</span><br><span class="line">    <span class="type">int</span> b = <span class="number">50000</span>;</span><br><span class="line">    <span class="comment">// float&amp; lx = b;</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">bigger</span>(a, b);  <span class="comment">// ç»“æœæ˜¯ä¸ªfloatå¼•ç”¨ï¼Œä½†æ˜¯ä¸èƒ½æŒ‡å‘intç±»å‹</span></span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å‡½æ•°æ¨¡æ¿å‚æ•°çš„é»˜è®¤å€¼"><a href="#å‡½æ•°æ¨¡æ¿å‚æ•°çš„é»˜è®¤å€¼" class="headerlink" title="å‡½æ•°æ¨¡æ¿å‚æ•°çš„é»˜è®¤å€¼"></a>å‡½æ•°æ¨¡æ¿å‚æ•°çš„é»˜è®¤å€¼</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// è¿”å›å€¼é»˜è®¤ä¸ºintç±»å‹, å»ºè®®å†™åœ¨å‰é¢</span></span><br><span class="line"><span class="comment">// å¦ä¸€ç§å†™æ³•,  å¯ä»¥ä¸æŒ‡å®šäº†ï¼Œè·Ÿç€T1 èµ°</span></span><br><span class="line"><span class="comment">// template&lt;typename T1, typename T2, typename TR = T1&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> TR </span>= <span class="type">int</span>, <span class="keyword">typename</span> T1, <span class="keyword">typename</span> T2&gt;</span><br><span class="line"><span class="function">TR <span class="title">ave</span><span class="params">(T1 a, T2 b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (a + b) / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‡½æ•°æ¨¡æ¿å¯ä»¥æœ‰éç±»å‹çš„æ¨¡æ¿å‚æ•°</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> type1, <span class="type">int</span> max, <span class="type">int</span> min&gt;</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">AddHp</span><span class="params">(type1&amp; hp, type1 damage)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    hp -= damage;</span><br><span class="line">    <span class="keyword">if</span> (hp &gt; max) hp = max;</span><br><span class="line">    <span class="keyword">return</span> hp &lt; min;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®è·µï¼Œè¯•ä¸‹è¿™ä¸ªå‡½æ•°</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="type">int</span> max, <span class="type">int</span> min, <span class="keyword">typename</span> type1&gt;   <span class="comment">// å»ºè®®å°† éç±»å‹å‚æ•°å†™åœ¨å‰é¢</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">ChangeHp</span><span class="params">(type1&amp; hp, type1 damage)</span>  <span class="comment">// max å’Œ min ä¸æ˜¯å˜é‡</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    hp -= damage;</span><br><span class="line">    <span class="keyword">if</span> (hp &gt; max) hp = max;</span><br><span class="line">    <span class="keyword">return</span> hp &lt; min;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> hp = <span class="number">2500</span>;</span><br><span class="line">    <span class="comment">// const int x = 2500;</span></span><br><span class="line">    <span class="comment">// ChangHp&lt;x,1000&gt;(hp, 100);  // è¿™æ ·ä¼šæŠ¥é”™ï¼Œx æ˜¯å¸¸é‡æ‰å¯ä»¥ï¼Œè¿™ä¹Ÿè¯´æ˜äº†maxå’Œminä¸æ˜¯å˜é‡</span></span><br><span class="line">    <span class="built_in">ChangHp</span>&lt;<span class="number">2000</span>,<span class="number">1000</span>&gt;(hp, <span class="number">100</span>);   <span class="comment">// &lt;&gt;é‡Œé¢çš„æ•°æ®éœ€è¦æŒ‡å®š</span></span><br><span class="line">    std::cout &lt;&lt; hp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  æŒ‡å®šé»˜è®¤å€¼</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// æŒ‡å®šé»˜è®¤å€¼ä¹‹åï¼Œåœ¨mainé‡Œé¢å°±ä¸éœ€è¦&lt;&gt;æ¥æŒ‡å®šmax  minçš„å€¼äº†</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="type">int</span> max </span>= <span class="number">2000</span>, <span class="type">int</span> min = <span class="number">1000</span>, <span class="keyword">typename</span> type1&gt;</span><br><span class="line"><span class="type">bool</span> <span class="built_in">ChangeHp</span>(type1&amp; hp, type1 damage) </span><br><span class="line">&#123;</span><br><span class="line">    hp -= damage;</span><br><span class="line">    <span class="keyword">if</span> (hp &gt; max) hp = max;</span><br><span class="line">    <span class="keyword">return</span> hp &lt; min;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> hp = <span class="number">2500</span>;</span><br><span class="line">    <span class="built_in">ChangHp</span>(hp, <span class="number">100</span>);</span><br><span class="line">    std::cout &lt;&lt; hp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†éç±»å‹å‚æ•°å†™åœ¨åé¢</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†max å’Œ min è½¬æ¢ä¸ºtype1ç±»å‹</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> type1, type1 max = <span class="number">2000</span>, type1 min = <span class="number">1000</span>, &gt; type1 ç±»å‹</span><br><span class="line"><span class="type">bool</span> <span class="built_in">ChangeHp</span>(type1&amp; hp, type1 damage) </span><br><span class="line">&#123;</span><br><span class="line">    hp -= damage;</span><br><span class="line">    <span class="keyword">if</span> (hp &gt; max) hp = max;</span><br><span class="line">    <span class="keyword">return</span> hp &lt; min;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/11/25/6743c6535c905.png"></p><p><strong>å¤„ç†ä¸åŒå…ƒç´ æ•°ç»„çš„æ¨¡æ¿å‡½æ•°</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="type">short</span> count&gt;</span></span><br><span class="line"><span class="function">T <span class="title">ave</span><span class="params">(T(&amp;ary)[count])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    T all&#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; count; i ++ )</span><br><span class="line">        all += ary[i];</span><br><span class="line">    <span class="keyword">return</span> all / count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> a[<span class="number">5</span>]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">ave</span>(a);  <span class="comment">// countçš„å€¼æ˜¯é€šè¿‡æ•°ç»„å¤§å°è‡ªåŠ¨æ¨å¯¼å‡ºæ¥çš„</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ˜¾å¼æŒ‡å®šæ¨¡æ¿å‚æ•°</span></span><br><span class="line">    <span class="comment">//std::cout &lt;&lt; ave&lt;int, 5&gt;(a) &lt;&lt; std::endl;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åªæŒ‡å®š count çš„å€¼</span></span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">ave</span>&lt;<span class="keyword">decltype</span>(a[<span class="number">0</span>]), <span class="number">5</span>&gt;(a) &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å°é¡¹ç›®ï¼šä¸‡èƒ½æ’åºå·¥å…·</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Swap</span><span class="params">(T&amp; a, T&amp; b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    T tmp&#123; a &#125;;</span><br><span class="line">    a = b;</span><br><span class="line">    b = tmp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Sort</span><span class="params">(T* ary, <span class="type">unsigned</span> count, <span class="type">bool</span> BigSort = <span class="literal">true</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">unsigned</span> i = <span class="number">1</span>; i &lt; count; i ++ )</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">unsigned</span> i = <span class="number">1</span>; i &lt; count; i ++ )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">bool</span> bcase = BigSort &gt; ary[i] &gt; ary[i - <span class="number">1</span>] : ary[i] &lt; ary[i - <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span> (bcase) <span class="built_in">Swap</span>(ary[i], ary[i - <span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> a[<span class="number">6</span>]&#123; <span class="number">123</span>, <span class="number">343</span>, <span class="number">434</span>, <span class="number">1</span>, <span class="number">3454</span>, <span class="number">33</span>&#125;;</span><br><span class="line">    <span class="type">short</span> a1[<span class="number">6</span>]&#123; <span class="number">123</span>, <span class="number">343</span>, <span class="number">434</span>, <span class="number">1</span>, <span class="number">3454</span>, <span class="number">33</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    std::string a2[<span class="number">5</span>]&#123; <span class="string">&quot;12&quot;</span>,<span class="string">&quot;asd&quot;</span>,<span class="string">&quot;sdf&quot;</span>,<span class="string">&quot;sesdas&quot;</span>,<span class="string">&quot;sdasd&quot;</span> &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">Sort</span>(a1, <span class="number">6</span>);</span><br><span class="line"><span class="built_in">Sort</span>(a, <span class="number">6</span>);</span><br><span class="line"><span class="built_in">Sort</span>(a2, <span class="number">5</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> x : a)std::cout &lt;&lt; x &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> x : a1)std::cout &lt;&lt; x &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> x : a2)std::cout &lt;&lt; x &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cpp03å‡½æ•°</title>
      <link href="/2024/12/11/cpp03%E5%87%BD%E6%95%B0/"/>
      <url>/2024/12/11/cpp03%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<p><strong>å‡½æ•°å‚æ•°ï¼šæŒ‡é’ˆå‚æ•°</strong></p><ul><li>å¦‚æœéœ€è¦ä¼ é€’å¤§å‹æ•°æ®ç»“æ„ï¼Œå¯ä»¥ä¼ é€’æŒ‡é’ˆè€Œä¸æ˜¯æ•´ä¸ªæ•°æ®ç»“æ„ï¼Œé¿å…å¤åˆ¶æ•°æ®ã€‚</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Add</span><span class="params">(<span class="type">int</span>* x, <span class="type">int</span>* y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    (*x) *= <span class="number">100</span>;</span><br><span class="line">    (*y) *= <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">return</span> (*x) + (*y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> x = <span class="number">2</span>, y = <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> c = <span class="built_in">Add</span>(&amp;x, &amp;y);</span><br><span class="line">    <span class="comment">//x å’Œ  y çš„å€¼éƒ½æ”¹äº†  æŒ‡é’ˆæ”¹çš„æ˜¯å†…å­˜ä¸­çš„æ•°å€¼</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;c=&quot;</span> &lt;&lt; c &lt;&lt; <span class="string">&quot;x=&quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&quot;y=&quot;</span> &lt;&lt; y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åº”ç”¨</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Role</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> Hp;</span><br><span class="line">    <span class="type">int</span> Mp;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">int Exp(Role r1)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    return r1.Hp + r1.Mp;</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Exp</span><span class="params">(Role* r1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> r1-&gt;Hp + r1-&gt;Mp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Role r1&#123;<span class="number">500</span>,<span class="number">200</span>&#125;;</span><br><span class="line">    <span class="comment">//c = Exp(r1);</span></span><br><span class="line">    c = <span class="built_in">Exp</span>(&amp;r1);  <span class="comment">// æ•ˆç‡å¤§å¤§æå‡</span></span><br><span class="line">    std::cout &lt;&lt; c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¿å…ä¿®éšæ„ä¿®æ”¹å€¼ï¼Œä½¿ç”¨å¸¸é‡æŒ‡é’ˆé™å®šåªè¯»æ“ä½œ</p><p>æ¸¸æˆå°ç¨‹åº</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Role</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> Hp;</span><br><span class="line">    <span class="type">int</span> Mp;</span><br><span class="line">    <span class="type">int</span> damage;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Act</span><span class="params">(<span class="type">const</span> Role* Acter, Role* beActer)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    beActer-&gt;Hp -= Acter-&gt;damage;</span><br><span class="line">    <span class="keyword">return</span> beActer-&gt;Hp &lt;= <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Role User&#123; <span class="number">1000</span>,<span class="number">1500</span>,<span class="number">2222220</span> &#125;;</span><br><span class="line">    Role Monster&#123; <span class="number">1500</span>,<span class="number">100</span>,<span class="number">100</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Act</span>(&amp;Monster, &amp;User))</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;è§’è‰²æ­»äº¡ï¼ï¼&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">Act</span>(&amp;User, &amp;Monster)) std::cout &lt;&lt; <span class="string">&quot;æ€ªç‰©æ­»äº¡ï¼è·å¾—å± é¾™å®åˆ€ï¼&quot;</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ•°ç»„å‚æ•°</strong></p><p>æ•°ç»„å‚æ•°ä¸¤ç§æ–¹å¼(ç­‰ä»·ï¼Œæ±‡ç¼–ä»£ç ä¹Ÿä¸€æ ·)</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Sort</span><span class="params">(<span class="type">int</span> ary[], <span class="type">unsigned</span> count)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; count; i ++ )</span><br><span class="line">        std::cout &lt;&lt; ary[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Sort</span><span class="params">(<span class="type">int</span>* ary. <span class="type">unsigned</span> count)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; count; i ++ )</span><br><span class="line">        std::cout &lt;&lt; ary[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸‹é¢è¿™ä¿©éƒ½ä¸èƒ½ç»™åˆ°é¢„æœŸçš„ç»“æœ</span></span><br><span class="line"><span class="comment">// æŒ‡é’ˆï¼Œèƒ½å¾—åˆ°åœ°å€ï¼Œä½†æ˜¯å¾—ä¸åˆ°æ€»å¤§å°ï¼Œåé¢è¿˜å¾—ä¼ å…¥ä¸ªæ•°ç»„å¤§å°æ‰è¡Œ  åŠ ä¸ªunsigned </span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Sort</span><span class="params">(<span class="type">int</span> ary[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">sizeof</span>(ary);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Sort</span><span class="params">(<span class="type">int</span> ary[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">sizeof</span>(ary);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>äºŒç»´æ•°ç»„</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¿…é¡»æŒ‡å®šåé¢çš„</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Sort</span><span class="params">(<span class="type">int</span> ary[][<span class="number">2</span>] <span class="type">unsigned</span> count)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> a[<span class="number">3</span>][<span class="number">2</span>]&#123;&#123;<span class="number">1</span>,<span class="number">2</span>&#125;,&#123;<span class="number">3</span>,<span class="number">4</span>&#125;,&#123;<span class="number">5</span>,<span class="number">6</span>&#125;&#125;;</span><br><span class="line">    <span class="built_in">Sort</span>(a,<span class="number">3</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½œä¸šï¼Œæ”¹é€ Sortå‡½æ•°</p><p><strong>å¼•ç”¨å‚æ•°</strong></p><p>å¯ä»¥åƒæŒ‡é’ˆä¸€æ ·ï¼Œè®¾å®šåªèƒ½è¯»ä¸èƒ½å†™</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Role</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> hp;</span><br><span class="line">    <span class="type">int</span> mp;</span><br><span class="line">    <span class="type">int</span> damage;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Act</span><span class="params">(<span class="type">const</span> Role&amp; Acter, Role&amp; beAct)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    beAct.hp -= Acter.damage;</span><br><span class="line">    <span class="keyword">return</span> beAct.hp &lt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Role user&#123;<span class="number">200</span>,<span class="number">300</span>,<span class="number">850</span>&#125;;</span><br><span class="line">    Role monster&#123;<span class="number">800</span>,<span class="number">300</span>,<span class="number">50</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Act</span>(user,monster)) std::cout &lt;&lt; <span class="string">&quot;æ€ªç‰©æ­»äº¡ï¼Œè·å¾—ã€‚ã€‚ã€‚ã€‚&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æŒ‡é’ˆå’Œå¼•ç”¨çš„åŒºåˆ«</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Act</span><span class="params">(Role&amp; Acter, Role&amp; beAct)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Act</span><span class="params">(Role* Acter, Role* beAct)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Act</span>(<span class="literal">nullptr</span>, <span class="literal">nullptr</span>);</span><br><span class="line"><span class="comment">// åŒºåˆ«ï¼šæŒ‡é’ˆå¯ä»¥ä¼ å…¥nullptrç©ºæŒ‡é’ˆ, è€Œå¼•ç”¨ä¸å¯ä»¥ã€‚</span></span><br></pre></td></tr></table></figure><p>*&amp;</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Roleç±»å‹çš„æŒ‡é’ˆçš„å¼•ç”¨</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Act</span><span class="params">(<span class="type">const</span> Role&amp; Acter, Role* beAct)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    beAct-&gt;hp -= Acter.damage;</span><br><span class="line">    <span class="type">bool</span> bEnd = beAct-&gt;hp&lt;<span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®©beActæŒ‡å‘Acter</span></span><br><span class="line">    beAct = (Role*)&amp;Acter;</span><br><span class="line">    <span class="keyword">return</span> beAct-&gt;hp &lt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Role user&#123;<span class="string">&quot;å¥¥ç‰¹æ›¼&quot;</span>,<span class="number">200</span>,<span class="number">300</span>,<span class="number">500</span>&#125;;</span><br><span class="line">    Role monster&#123;<span class="string">&quot;å°æ€ªå…½&quot;</span>,<span class="number">800</span>,<span class="number">300</span>,<span class="number">50</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    Role* pRole = &amp;monster;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¾“å‡ºçš„nameè¿˜æ˜¯å°æ€ªå…½ï¼Œå› ä¸ºåœ¨å‡½æ•°ä½œç”¨å†…beActæŒ‡å‘äº†Acter,ä½†æ˜¯pRoleæ²¡æœ‰æŒ‡å‘Acter</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Act</span>(user, pRole)) std::cout &lt;&lt; pRole-&gt;Name &lt;&lt; <span class="string">&quot;æ€ªç‰©æ­»äº¡ã€‚ã€‚ã€‚&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£å†³åŠæ³•</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Act</span><span class="params">(<span class="type">const</span> Role&amp; Acter, Role*&amp; beAct)</span></span>;</span><br><span class="line"><span class="comment">// è¿™æ · pRoleä¹ŸæŒ‡å‘Acteräº†</span></span><br></pre></td></tr></table></figure><p>å®Œæ•´çš„ä»£ç å¦‚ä¸‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Role</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> Name[<span class="number">0x20</span>];</span><br><span class="line">    <span class="type">int</span> Hp;</span><br><span class="line">    <span class="type">int</span> Mp;</span><br><span class="line">    <span class="type">int</span> damage;</span><br><span class="line">&#125;*PROLE;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Act</span><span class="params">(<span class="type">const</span> Role* Acter, PROLE&amp; beActer)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    beAct-&gt;hp -= Acter-&gt;damage;</span><br><span class="line">    <span class="type">bool</span> bEnd = beAct-&gt;hp&lt;<span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    beAct = (Role*)&amp;Acter;</span><br><span class="line">    <span class="keyword">return</span> beAct-&gt;hp &lt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Role user&#123;<span class="string">&quot;å¥¥ç‰¹æ›¼&quot;</span>,<span class="number">200</span>,<span class="number">300</span>,<span class="number">500</span>&#125;;</span><br><span class="line">    Role monster&#123;<span class="string">&quot;å°æ€ªå…½&quot;</span>,<span class="number">800</span>,<span class="number">300</span>,<span class="number">50</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    PROLE pRole = &amp;monster;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Act</span>(user, pRole)) std::cout &lt;&lt; pRole-&gt;Name &lt;&lt; <span class="string">&quot;æ€ªç‰©æ­»äº¡ã€‚ã€‚ã€‚&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æŒ‰å€¼ä¼ é€’ vs æŒ‰å¼•ç”¨ä¼ é€’</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Act</span><span class="params">(<span class="type">const</span> Role* Acter, PROLE beActer)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// beActer æ˜¯ PROLE çš„æ‹·è´ï¼Œä¿®æ”¹å®ƒä¸ä¼šå½±å“åŸå§‹çš„ PROLE</span></span><br><span class="line">    beActer = (Role*)&amp;Acter;</span><br><span class="line">    <span class="keyword">return</span> beActer-&gt;Hp &lt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒbeActer æ˜¯ PROLE çš„æ‹·è´ï¼Œä¿®æ”¹ beActer åä¸ä¼šå½±å“ pRoleã€‚pRole ä¾ç„¶æŒ‡å‘åŸå§‹çš„ monsterã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Act</span><span class="params">(<span class="type">const</span> Role* Acter, PROLE&amp; beActer)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// beActer æ˜¯ PROLE çš„å¼•ç”¨ï¼Œä¿®æ”¹å®ƒä¼šå½±å“åŸå§‹çš„ PROLE</span></span><br><span class="line">    beActer = (Role*)&amp;Acter;</span><br><span class="line">    <span class="keyword">return</span> beActer-&gt;Hp &lt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">Add</span><span class="params">(<span class="type">int</span>* x, <span class="type">int</span>* y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    (*x) *= <span class="number">100</span>;  <span class="comment">// ä¿®æ”¹ x æŒ‡å‘çš„å€¼</span></span><br><span class="line">    (*y) *= <span class="number">10</span>;   <span class="comment">// ä¿®æ”¹ y æŒ‡å‘çš„å€¼</span></span><br><span class="line">    <span class="keyword">return</span> (*x) + (*y);  <span class="comment">// è¿”å›ä¿®æ”¹åçš„å€¼ä¹‹å’Œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ä¸ªä¾‹å­ä¹Ÿæ˜¯å€¼ä¼ é€’ï¼Œä½†å› ä¸ºé€šè¿‡æŒ‡é’ˆè§£å¼•ç”¨(*x å’Œ *y)ä¿®æ”¹äº†æŒ‡é’ˆæ‰€æŒ‡å‘çš„å˜é‡çš„å€¼ï¼Œæ‰€ä»¥ä¸‹é¢çš„ä»£ç å®é™…ä¸Šæ˜¯ä¿®æ”¹äº†åŸå§‹å˜é‡çš„å†…å®¹ã€‚æ‰€ä»¥ï¼Œå°½ç®¡æ˜¯å€¼ä¼ é€’ï¼Œä½†æ˜¯é€šè¿‡æŒ‡é’ˆä¼ é€’æ•°æ®å¯¼è‡´çš„æ•ˆæœæ˜¯ä¿®æ”¹äº†åŸå§‹æ•°æ®ã€‚</p><ul><li><strong>æŒ‡é’ˆæœ¬èº«æ˜¯å€¼ä¼ é€’</strong>ï¼ˆå‡½æ•°å†…çš„æŒ‡é’ˆ <code>x</code> å’Œ <code>y</code> æ˜¯åŸå§‹æŒ‡é’ˆçš„å‰¯æœ¬ï¼‰ã€‚</li><li><strong>æŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å®¹æ˜¯é€šè¿‡è§£å¼•ç”¨ä¿®æ”¹çš„</strong>ï¼ˆå› æ­¤ä¿®æ”¹äº†åŸå§‹æ•°æ®ï¼‰ã€‚</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(<span class="type">int</span>&amp; a, <span class="type">int</span>&amp; b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> tmp = ary[i];</span><br><span class="line">    ary[i] = ary[i - <span class="number">1</span>];</span><br><span class="line">    ary[i - <span class="number">1</span>] = tmp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Sort</span><span class="params">(<span class="type">int</span> ary[], <span class="type">unsigned</span> count, <span class="type">bool</span> BigSort)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; count; i ++ )</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; count; i ++ )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">bool</span> bcase = BigSort?ary[i] &gt; ary[i - <span class="number">1</span>] : ary[i] &lt; ary[i - <span class="number">1</span>];</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (bcase) <span class="built_in">swap</span>(ary[i], ary[i - <span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é»˜è®¤å®å‚</strong></p><p>ç”¨æˆ·ä¸æŒ‡å®šå€¼çš„æ—¶å€™ï¼Œå°±ä½¿ç”¨é»˜è®¤çš„å€¼</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Sort</span><span class="params">(<span class="type">int</span> ary[], <span class="type">unsigned</span> count, <span class="type">bool</span> BigSort = <span class="literal">true</span>)</span></span></span><br></pre></td></tr></table></figure><p>é»˜è®¤å‚æ•°åªèƒ½æ”¾åœ¨æœ€å</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> a = <span class="number">100</span>, b = <span class="number">200</span>)</span></span>; <span class="comment">// æ­£ç¡®ï¼Œ ç›¸å½“äºAdd(100,200);</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> a = <span class="number">100</span>, <span class="type">int</span> b)</span></span>;  <span class="comment">// é”™è¯¯</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b = <span class="number">100</span>, <span class="type">int</span> c = <span class="number">250</span>)</span></span>; <span class="comment">// æ­£ç¡®</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span>&amp; b = <span class="number">100</span>)</span></span>;   <span class="comment">//error   å¼•ç”¨çš„æœ¬è´¨æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å®š100é”™äº†</span></span><br></pre></td></tr></table></figure><p><strong>ä¸å®šé‡å‚æ•°</strong></p><p>main: å¤„ç†å‘½ä»¤è¡Œé€‰é¡¹ ï¼Œæœ‰æ—¶å€™éœ€è¦ç»™mainä¼ é€’å®å‚ï¼Œä¸€ç§å¸¸è§çš„æƒ…å†µæ˜¯ç”¨æˆ·é€šè¿‡è®¾ç½®ä¸€ç»„é€‰é¡¹æ¥ç¡®å®šå‡½æ•°æ‰€è¦æ‰§è¡Œçš„æ“ä½œã€‚å‡å®šmainå‡½æ•°ä½äºå¯æ‰§è¡Œæ–‡ä»¶progä¹‹å†…ï¼Œå‘ç¨‹åºä¼ é€’ä¸‹é¢çš„é€‰é¡¹</p><p><code>prog -d -o ofile data0</code></p><p>è¿™äº›å‘½ä»¤è¡Œé€šè¿‡ä¸¤ä¸ªå¯é€‰çš„å½¢å‚ä¼ é€’ç»™mainå‡½æ•°</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, cahr* argv[])</span> </span>&#123;...&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒä¸ªå½¢å‚æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå®ƒçš„å…ƒç´ æ˜¯æŒ‡å‘Cé£æ ¼å­—ç¬¦ä¸²çš„æŒ‡é’ˆï¼šç¬¬ä¸€ä¸ªå½¢å‚argcè¡¨ç¤ºæ•°ç»„ä¸­å­—ç¬¦ä¸²çš„æ•°é‡ã€‚å› ä¸ºç¬¬äºŒä¸ªå½¢å‚æ˜¯æ•°ç»„ï¼Œæ‰€ä»¥mainå‡½æ•°ä¹Ÿå¯ä»¥å®šä¹‰æˆï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> </span>&#123;...&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ argv æŒ‡å‘char* ã€‚ã€‚</p><p>å½“å®å‚ä¼ ç»™mainå‡½æ•°ä¹‹åï¼Œargvçš„ç¬¬ä¸€ä¸ªå…ƒç´ æŒ‡å‘ç¨‹åºçš„åå­—æˆ–è€…ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œæ¥ä¸‹æ¥çš„å…ƒç´ ä¸€æ¬¡ä¼ é€’å‘½ä»¤è¡Œæä¾›çš„å®å‚ã€‚æœ€åä¸€ä¸ªæŒ‡é’ˆä¹‹åçš„å…ƒç´ ä¿è¯ä¸º0 ã€‚</p><p><code>argv[0] = &quot;prog&quot;;</code></p><p><code>argv[1] = &quot;-d&quot;;</code></p><p><code>argv[2] = &quot;-o&quot;;</code></p><p><code>argv[3] = &quot;ofile&quot;;</code></p><p><code>argv[4] = &quot;data0&quot;;</code></p><p><code>argv[5] = 0;</code></p><p>ä¾‹é¢˜ï¼šè¾“å‡ºç¨‹åºåå­—å’Œè·¯å¾„</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span> </span>&#123;</span><br><span class="line">    <span class="comment">// argv[0] æ˜¯ç¨‹åºå®Œæ•´çš„è·¯å¾„ï¼ˆåŒ…æ‹¬æ–‡ä»¶åï¼‰</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;ç¨‹åºåå­—&quot;</span> &lt;&lt; argv[<span class="number">0</span>] &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* programName = <span class="built_in">strrchr</span>(argv[<span class="number">0</span>], <span class="string">&#x27;\\&#x27;</span>);</span><br><span class="line">    <span class="comment">// strrchr æ˜¯ä¸€ä¸ª å­—ç¬¦ä¸²å‡½æ•°ï¼Œç”¨äºæŸ¥æ‰¾è·¯å¾„ä¸­æœ€åä¸€æ¬¡å‡ºç°åæ–œæ \ä½ç½®ã€‚</span></span><br><span class="line">    <span class="comment">// å¦‚æœæ‰¾åˆ°åæ–œæ ï¼Œè¿”å›æŒ‡å‘å®ƒçš„æŒ‡é’ˆ   å¦åˆ™è¿”å›nullptr</span></span><br><span class="line">    <span class="keyword">if</span> (programName != <span class="literal">nullptr</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        programName++;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;ç¨‹åºåç§°ï¼š&quot;</span> &lt;&lt; programName &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;ç¨‹åºåç§°ï¼š&quot;</span> &lt;&lt; argv[<span class="number">0</span>] &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨åˆšå­¦çš„findæ–¹æ³•</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(argc &gt; <span class="number">0</span>) std::string programPath = argv[<span class="number">0</span>];</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;ç¨‹åºè·¯å¾„ï¼š&quot;</span> &lt;&lt; programPath &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    std::<span class="type">size_t</span> lastSlash = programPath.<span class="built_in">rfind</span>(<span class="string">&#x27;\\&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (lastSlash == std::string::npos) lastSlash = programPath.<span class="built_in">rfind</span>(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (lastSlash != std::string::npos)</span><br><span class="line">    &#123;</span><br><span class="line">        std::string programName = programPath.<span class="built_in">substr</span>(lastSlash + <span class="number">1</span>);</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;ç¨‹åºåç§°ï¼š &quot;</span> &lt;&lt; programName &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> std::cout &lt;&lt; <span class="string">&quot;ç¨‹åºåç§°ï¼š &quot;</span> &lt;&lt; programPath &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¯å˜å½¢å‚çš„å‡½æ•°</strong></p><p>ä½¿ç”¨ <code>...</code> è¯­æ³•ï¼ˆC é£æ ¼çš„å¯å˜å‚æ•°ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdarg&gt;</span>  <span class="comment">// å¤´æ–‡ä»¶æ”¯æŒå¯å˜å‚æ•°</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printNumbers</span><span class="params">(<span class="type">int</span> count, ...)</span> </span>&#123;</span><br><span class="line">    va_list args;</span><br><span class="line">    <span class="comment">// å¯ä»¥ä½¿ç”¨char* args&#123;&#125;; æ›¿ä»£</span></span><br><span class="line">    <span class="comment">// å‘Šè¯‰argsæœ‰å¤šå°‘ä¸ªå‚æ•°</span></span><br><span class="line">    <span class="built_in">va_start</span>(args, count);  <span class="comment">// åˆå§‹åŒ– args ä»¥è®¿é—®å¯å˜å‚æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å°ä¼ å…¥çš„æ‰€æœ‰å‚æ•°</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; count; ++i) &#123;</span><br><span class="line">        <span class="comment">// è¦è¯»çš„æŒ‡é’ˆ  å’Œ  å‚æ•°çš„ç±»å‹</span></span><br><span class="line">        <span class="comment">// æ¯è°ƒç”¨ä¸€æ¬¡ï¼Œå°±èƒ½è·å–ä¸‹ä¸€ä¸ªå‚æ•°</span></span><br><span class="line">        <span class="type">int</span> num = <span class="built_in">va_arg</span>(args, <span class="type">int</span>);  <span class="comment">// è·å–ä¸‹ä¸€ä¸ªå‚æ•°ï¼Œç±»å‹ä¸º int</span></span><br><span class="line">        std::cout &lt;&lt; num &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">va_end</span>(args);  <span class="comment">// æ¸…ç†  é‡Šæ”¾args</span></span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printNumbers</span>(<span class="number">3</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>);  <span class="comment">// æ‰“å° 10 20 30</span></span><br><span class="line">    <span class="built_in">printNumbers</span>(<span class="number">5</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);  <span class="comment">// æ‰“å° 1 2 3 4 5</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>std::initializer_list</code>(C++11ä¹‹å)</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;initializer_list&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printNumbers</span><span class="params">(std::initializer_list&lt;<span class="type">int</span>&gt; nums)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">        std::cout &lt;&lt; num &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printNumbers</span>(&#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>&#125;);  <span class="comment">// æ‰“å° 10 20 30</span></span><br><span class="line">    <span class="built_in">printNumbers</span>(&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;);  <span class="comment">// æ‰“å° 1 2 3 4 5</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>std::vector</code> æˆ–è€…å…¶ä»–å®¹å™¨</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printNumbers</span><span class="params">(<span class="type">const</span> std::vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> num : nums) &#123;</span><br><span class="line">        std::cout &lt;&lt; num &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printNumbers</span>(&#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>&#125;);  <span class="comment">// æ‰“å° 10 20 30</span></span><br><span class="line">    <span class="built_in">printNumbers</span>(&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;);  <span class="comment">// æ‰“å° 1 2 3 4 5</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <code>std::function</code>  å’Œ Lambda è¡¨è¾¾å¼ï¼ˆé«˜çº§ç”¨æ³•ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">applyFunction</span><span class="params">(std::function&lt;<span class="type">void</span>()&gt; func)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">func</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Lambda æ¥å—ä¸å®šæ•°é‡å‚æ•°</span></span><br><span class="line">    <span class="built_in">applyFunction</span>([]() &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Lambda with no arguments!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¸€ä¸ªå°ä½œä¸š</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">const</span> <span class="type">char</span>* <span class="title">ReadRef</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* ref, <span class="type">const</span> <span class="type">char</span>* cmds)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; cmds[i]; i ++ )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (cmds[i] == ref[<span class="number">0</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">bool</span> found = <span class="literal">true</span>;</span><br><span class="line">            <span class="type">int</span>  x;</span><br><span class="line">            <span class="keyword">for</span> (x = <span class="number">0</span>; ref[x]; x ++ )</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (ref[x] != cmds[i + x])</span><br><span class="line">                &#123;</span><br><span class="line">                    found = <span class="literal">false</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (found) <span class="keyword">return</span> &amp;cmds[i + x];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* id = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* pass = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* country = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; argc; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!id) id = <span class="built_in">ReadRef</span>(<span class="string">&quot;id:&quot;</span>, argv[i]);</span><br><span class="line">        <span class="keyword">if</span> (!pass) pass = <span class="built_in">ReadRef</span>(<span class="string">&quot;pass:&quot;</span>, argv[i]);</span><br><span class="line">        <span class="keyword">if</span> (!country) country = <span class="built_in">ReadRef</span>(<span class="string">&quot;country:&quot;</span>, argv[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (id &amp;&amp; pass &amp;&amp; country) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;æ³¨å†ŒæˆåŠŸï¼\n&quot;</span>;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;è´¦å·ï¼š&quot;</span> &lt;&lt; id &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;å¯†ç ï¼š&quot;</span> &lt;&lt; pass &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;å›½å®¶ï¼š&quot;</span> &lt;&lt; country &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;å‚æ•°ä¸è¶³ï¼è¯·æŒ‰ä»¥ä¸‹æ ¼å¼è°ƒç”¨ç¨‹åºï¼š\n&quot;</span>;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;./program id:&lt;your_id&gt; pass:&lt;your_pass&gt; country:&lt;your_country&gt;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cpp02è”åˆä½“å’Œå­—ç¬¦</title>
      <link href="/2024/12/11/cpp02%E8%81%94%E5%90%88%E4%BD%93%E5%92%8C%E5%AD%97%E7%AC%A6/"/>
      <url>/2024/12/11/cpp02%E8%81%94%E5%90%88%E4%BD%93%E5%92%8C%E5%AD%97%E7%AC%A6/</url>
      
        <content type="html"><![CDATA[<p><strong>è”åˆä½“è¯­æ³•</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç¤ºèŒƒ</span></span><br><span class="line"><span class="keyword">union</span> <span class="title class_">USER</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">short</span> sHP;</span><br><span class="line">    <span class="type">int</span> nHP;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// é€šè¿‡union å¯ä»¥åˆ›å»ºä¸€ä¸ªè”åˆä½“ï¼Œunionä¸­çš„æˆå‘˜å˜é‡å…±äº«å†…å­˜ï¼Œå› æ­¤unionçš„æ•°æ®ç±»å‹å¤§å°ç”±å…¶æœ€å¤§çš„æˆå‘˜å˜é‡å†³å®šã€‚</span></span><br></pre></td></tr></table></figure><p>å®è·µä¸€ä¸‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è”åˆä½“</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">union</span> <span class="title class_">USER</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">short</span> sHP;</span><br><span class="line"><span class="type">int</span> nHP;</span><br><span class="line"><span class="type">double</span> fHP;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">union</span> &#123;</span><br><span class="line"><span class="type">short</span> sHP;</span><br><span class="line"><span class="type">int</span> nHP;</span><br><span class="line"><span class="type">double</span> fHP;</span><br><span class="line">&#125; ls;<span class="comment">// ä¸é‡ç”¨ï¼Œä¸´æ—¶çš„ </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">Test</span> &#123;</span><br><span class="line"><span class="type">short</span> sHP;</span><br><span class="line"><span class="type">int</span> nHP;</span><br><span class="line"><span class="type">double</span> fHP;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// å†…å­˜åˆ†é…   æ²¡æœ‰åˆå§‹åŒ–</span></span><br><span class="line">USER user;</span><br><span class="line">Test t;</span><br><span class="line">std::cout &lt;&lt; <span class="built_in">sizeof</span>(user) &lt;&lt; std::endl; </span><br><span class="line">std::cout &lt;&lt; <span class="built_in">sizeof</span>(t) &lt;&lt; std::endl;  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">user.sHP = <span class="number">100</span>;<span class="comment">//[100][0][][][][][][]</span></span><br><span class="line">std::cout &lt;&lt; user.sHP &lt;&lt; std::endl;  <span class="comment">// 100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//[100][0][ï¼Ÿ][ï¼Ÿ][ï¼Ÿ][ï¼Ÿ][ï¼Ÿ][ï¼Ÿ]</span></span><br><span class="line"><span class="comment">// è®¿é—®4ä¸ªæ ¼å­ï¼Œä½†æœ‰ä¿©æ²¡æœ‰åˆå§‹åŒ–ï¼Œä¸çŸ¥é“æ˜¯ä»€ä¹ˆå€¼</span></span><br><span class="line">std::cout &lt;&lt; user.nHP &lt;&lt; std::endl;  </span><br><span class="line">user.nHP = <span class="number">0</span>;</span><br><span class="line">std::cout &lt;&lt; user.nHP &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœªå‘½åçš„è”åˆä½“æ˜¯ä¾›ä¸´æ—¶ä½¿ç”¨çš„ï¼</p><p><strong>C è¯­è¨€ä¸­ å­—ç¬¦ä¸²çš„æ‹¼æ¥</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> str[<span class="number">0x10</span>] = <span class="string">&quot;123&quot;</span>;</span><br><span class="line"><span class="type">char</span> strB[<span class="number">0x10</span>] = <span class="string">&quot;456&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> strC[<span class="number">0x20</span>];</span><br><span class="line"><span class="built_in">memcpy</span>(strC, str, <span class="built_in">strlen</span>(str));</span><br><span class="line"><span class="built_in">memcpy</span>(strC + <span class="built_in">strlen</span>(str), strB, <span class="built_in">strlen</span>(strB) + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; strC;</span><br></pre></td></tr></table></figure><p><strong>C++ ä¸­ å­—ç¬¦ä¸²æ‹¼æ¥</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">string str&#123;<span class="string">&quot;12345&quot;</span>&#125;;</span><br><span class="line"><span class="comment">// ä¸å¿…è€ƒè™‘æº¢å‡º</span></span><br><span class="line">std::cout &lt;&lt; str &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">string str1&#123; <span class="string">&quot;123455&quot;</span>, <span class="number">3</span> &#125;; <span class="comment">// åªè¦å‰é¢ä¸‰ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">std::cout &lt;&lt; str1 &lt;&lt; std::endl;  <span class="comment">// è¾“å‡º123</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">string str2&#123; <span class="string">&quot;0123456&quot;</span>,<span class="number">2</span>,<span class="number">3</span> &#125;;  <span class="comment">// ä»2å¼€å§‹æˆªå–3ä½</span></span><br><span class="line">std::cout &lt;&lt; str2 &lt;&lt; std::endl;</span><br><span class="line"><span class="comment">// å¯¹ä¸­æ–‡æ”¯æŒçš„ä¸å¤ªå¥½</span></span><br><span class="line">string str3&#123; <span class="string">&quot;ä½ å¥½å•Šå•Šå•Š&quot;</span>, <span class="number">3</span> &#125;;</span><br><span class="line">std::cout &lt;&lt; str3 &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line"><span class="function">string <span class="title">str4</span><span class="params">(<span class="number">6</span>, <span class="string">&#x27;a&#x27;</span>)</span></span>;  <span class="comment">// 6ä¸ª  a</span></span><br><span class="line"><span class="function">string <span class="title">str5</span><span class="params">(<span class="number">6</span>, <span class="number">65</span>)</span></span>;  <span class="comment">//è½¬æˆå¤§å†™çš„A</span></span><br><span class="line">std::cout &lt;&lt; str4 &lt;&lt; std::endl;</span><br><span class="line">std::cout &lt;&lt; str5 &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿æ¥å­—ç¬¦ä¸²</span></span><br><span class="line">string str6, str7;</span><br><span class="line">str6 = <span class="string">&quot;123&quot;</span>;</span><br><span class="line">str7 = <span class="string">&quot;456&quot;</span>;</span><br><span class="line"></span><br><span class="line">str6 = str7 + <span class="string">&quot; &quot;</span> + <span class="string">&quot;123&quot;</span>;  <span class="comment">// è¿™é‡Œä¸€å®šè¦æœ‰string ç±»å‹çš„å˜é‡åœ¨è¿™é‡Œ</span></span><br><span class="line">std::cout &lt;&lt; str6 &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŠŠæ•°å­—è½¬æ¢æˆå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="type">int</span> age;</span><br><span class="line">std::cin &gt;&gt; age;</span><br><span class="line"></span><br><span class="line">string st;</span><br><span class="line">st = <span class="string">&quot; ç”¨æˆ·çš„å¹´é¾„æ˜¯ï¼š&quot;</span>;</span><br><span class="line">str7 = st + std::<span class="built_in">to_string</span>(age);</span><br><span class="line">std::cout &lt;&lt; str7;</span><br></pre></td></tr></table></figure><p><strong>C++ ä¸­å­—ç¬¦ä¸²æ‹¼æ¥ï¼ˆè¿›é˜¶ï¼‰</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::string;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SoftName <span class="string">&quot;EDY&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SoftVersion <span class="string">&quot;2.0&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">string str;</span><br><span class="line"></span><br><span class="line"><span class="comment">//str = &quot;1233&quot; + &quot;1222&quot;;</span></span><br><span class="line"><span class="comment">// ä¸èƒ½ç›´æ¥è¿æ¥ä¸¤ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">str = string&#123; <span class="string">&quot;!22&quot;</span> &#125; + <span class="string">&quot;1233&quot;</span>;  <span class="comment">// æŠŠå­—ç¬¦ä¸²æ”¾åˆ°ä¸´æ—¶å˜é‡é‡Œé¢å°±å¯ä»¥äº†</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">//str = &quot;1233&quot; + &quot;bcbc&quot; + string&#123; &quot;!22&quot; &#125;;   error</span></span><br><span class="line"><span class="comment">// å‰é¢ä¸¤ä¸ªåŠ æ³•æ˜¯ç›´æ¥çš„å­—ç¬¦ä¸²çš„å­—é¢é‡</span></span><br><span class="line"><span class="comment">//æ”¹è¿›</span></span><br><span class="line">str = <span class="string">&quot;abc&quot;</span> + (<span class="string">&quot;bcd&quot;</span> + string&#123; <span class="string">&quot;123&quot;</span> &#125;); <span class="comment">// è¿™æ ·å°±å¯ä»¥äº†</span></span><br><span class="line"></span><br><span class="line">str += <span class="string">&quot;aka&quot;</span>;  <span class="comment">// æ²¡é—®é¢˜</span></span><br><span class="line"><span class="comment">//str += &quot;aka&quot; + &quot;bka&quot;;    +çš„ä¼˜å…ˆçº§å¤§äº   +=</span></span><br><span class="line"><span class="comment">// è§£å†³åŠæ³•å¦‚ä¸‹</span></span><br><span class="line">str += <span class="string">&quot;aka&quot;</span> + string&#123; <span class="string">&quot;bka&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">string strB;</span><br><span class="line"><span class="comment">// è¿æ¥</span></span><br><span class="line">strB = <span class="string">&quot;!23&quot;</span><span class="string">&quot;233&quot;</span>;</span><br><span class="line"><span class="comment">// å”¯ä¸€ç”¨é€”</span></span><br><span class="line">strB = SoftName SoftVersion;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å­—ç¬¦ä¸²è¿æ¥  å­—ç¬¦</span></span><br><span class="line">    string strC&#123;<span class="string">&quot;123&quot;</span>&#125;;</span><br><span class="line">    <span class="type">char</span> a;</span><br><span class="line">    std::cin &gt;&gt; a;</span><br><span class="line">    str += a;  <span class="comment">// å…è®¸è¿™æ ·è¿æ¥</span></span><br><span class="line">    <span class="comment">// æ³¨æ„äº‹é¡¹</span></span><br><span class="line">    str += a + <span class="string">&#x27;o&#x27;</span>;  <span class="comment">// ä¸¤ä¸ªå­—ç¬¦  æ˜¯ä¿©å¸¸é‡ï¼Œå¯ä»¥ç›¸åŠ     å­—ç¬¦a ä¸ å­—ç¬¦oç›¸åŠ ä¹‹åå†è¿æ¥</span></span><br><span class="line">    <span class="comment">// ç›¸å½“äº</span></span><br><span class="line">    str += <span class="built_in">char</span>(a + <span class="string">&#x27;o&#x27;</span>);</span><br><span class="line">    <span class="comment">// å­—ç¬¦ä¸²ä¸èƒ½ç›¸åŠ çš„åŸå› æ˜¯ï¼Œ å­—ç¬¦ä¸²æ˜¯ä¸¤ä¸ªcharç±»å‹çš„æ•°ç»„</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//æ‹¼æ¥æ–¹æ³•</span></span><br><span class="line">    string strD&#123;<span class="string">&quot;123&quot;</span>&#125;;</span><br><span class="line">    strD.<span class="built_in">append</span>(<span class="string">&quot;456&quot;</span>);  <span class="comment">// åœ¨å­—ç¬¦ä¸²åé¢æ‹¼æ¥ä¸Š456</span></span><br><span class="line">    strD.<span class="built_in">append</span>(<span class="string">&quot;222&quot;</span>).<span class="built_in">append</span>(<span class="string">&quot;dfddd&quot;</span>);  <span class="comment">// æ— é™  åŠ append</span></span><br><span class="line">    <span class="comment">// æ‹¼æ¥çš„æ—¶å€™ä¹Ÿå¯ä»¥æœ‰é€‰æ‹©</span></span><br><span class="line">    strD.<span class="built_in">append</span>(<span class="string">&quot;123455&quot;</span>, <span class="number">2</span>); <span class="comment">// ä»2å¼€å§‹æ‹¼æ¥   è·Ÿå­—ç¬¦ä¸²åˆå§‹åŒ–ç”¨æ³•ä¸€æ ·</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æˆªå–å­—ç¬¦ä¸²</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.<span class="built_in">substr</span>(èµ·å§‹ä½ç½®,è¦æˆªå–çš„é•¿åº¦);</span><br><span class="line"></span><br><span class="line">std::string str&#123;<span class="string">&quot;123456&quot;</span>&#125;;</span><br><span class="line">std::string strsub&#123;str.<span class="built_in">substr</span>(<span class="number">1</span>)&#125;;  <span class="comment">// strsub = &quot;23456&quot;</span></span><br><span class="line">std::string strsubA&#123;str.<span class="built_in">substr</span>(<span class="number">1</span>, <span class="number">3</span>)&#125;; <span class="comment">// strsubA = &quot;234&quot;;</span></span><br><span class="line"></span><br><span class="line">string strB;</span><br><span class="line"><span class="comment">// ä¹Ÿå¯ä»¥è¿ç€æˆªå–ï¼Œä½†æ˜¯è¦æ”¾åˆ°ä¸€ä¸ªæ–°çš„stringé‡Œé¢</span></span><br><span class="line">strB = str.<span class="built_in">substr</span>(<span class="number">7</span>).<span class="built_in">substr</span>(<span class="number">3</span>);  <span class="comment">// æå–ä»ç´¢å¼•7å¼€å§‹çš„å­å­—ç¬¦ä¸²ï¼ˆåŒ…æ‹¬ç´¢å¼• 7 çš„å­—ç¬¦ï¼‰ï¼Œ ç›´åˆ°å­—ç¬¦ä¸²æœ«å°¾ã€‚.substr(3) åœ¨ä¸Šä¸€æ­¥çš„åŸºç¡€ä¸Šï¼Œä»ç´¢å¼• 3 å¼€å§‹æå–å­å­—ç¬¦ä¸² ï¼ˆåŒ…æ‹¬ç´¢å¼•3 çš„å­—ç¬¦ï¼‰ï¼Œ ç›´åˆ°å­—ç¬¦ä¸²æœ«å°¾ã€‚</span></span><br><span class="line"><span class="comment">// å­—ç¬¦ä¸²çš„ç´¢å¼•ä¹Ÿæ˜¯ä»0å¼€å§‹çš„</span></span><br><span class="line"><span class="comment">// substrä¸ä¼šæ”¹å˜strçš„å€¼ï¼Œè€Œappendä¼šæ”¹å˜</span></span><br></pre></td></tr></table></figure><p><strong>è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string str&#123;<span class="string">&quot;222222&quot;</span>&#125;;</span><br><span class="line"><span class="comment">// å¯¹ä¸­æ–‡å­—ç¬¦ä¸²é•¿åº¦çš„è®¡ç®—è¿˜æ˜¯ä¸å‡†ç¡®</span></span><br><span class="line">std::cout &lt;&lt; str.<span class="built_in">length</span>();</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ­£å¸¸è®¡ç®—å­—ç¬¦ä¸²çš„æ–¹æ³•</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;locale&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¾ç½®åŒºåŸŸä¸ºä¸­æ–‡   ç¡®ä¿å®½å­—ç¬¦è¾“å…¥/è¾“å‡ºæµèƒ½æ­£ç¡®å¤„ç†ä¸­æ–‡å­—ç¬¦ã€‚</span></span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL, <span class="string">&quot;chs&quot;</span>);</span><br><span class="line">    <span class="type">wchar_t</span> wstr[<span class="number">255</span>]; <span class="comment">// å®šä¹‰å®½å­—ç¬¦æ•°ç»„</span></span><br><span class="line">    std::wcout &lt;&lt; <span class="string">L&quot;è¯·è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²: &quot;</span>;</span><br><span class="line">    std::wcin.<span class="built_in">getline</span>(wstr, <span class="number">255</span>); <span class="comment">// ä½¿ç”¨å®½å­—ç¬¦è¾“å…¥</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> length = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; wstr[i] != <span class="string">L&#x27;\0&#x27;</span>; ++i) &#123; <span class="comment">// éå†å®½å­—ç¬¦æ•°ç»„</span></span><br><span class="line">        ++length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    std::wcout &lt;&lt; <span class="string">L&quot;å­—ç¬¦ä¸²çš„é•¿åº¦æ˜¯: &quot;</span> &lt;&lt; length &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å­—ç¬¦ä¸²æ¯”è¾ƒ</strong></p><p>1ï¸âƒ£ æ¯”è¾ƒç›¸åŒçš„å†…å®¹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span>* str_1&#123;(<span class="type">char</span>*)<span class="string">&quot;123456&quot;</span>&#125;;</span><br><span class="line"><span class="type">char</span>* str_2&#123;(<span class="type">char</span>*)<span class="string">&quot;123456&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">std::cout &lt;&lt; (str1 == str2) &lt;&lt; std::endl;  <span class="comment">// åœ°å€ç›¸ç­‰ï¼Œè¿›è¡Œä¼˜åŒ–ä¹‹åæŒ‡å‘ç›¸åŒçš„ä½ç½®</span></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span>* str_1&#123;(<span class="type">char</span>*)<span class="string">&quot;123456&quot;</span>&#125;;</span><br><span class="line"><span class="type">char</span>* str_2 = <span class="keyword">new</span> <span class="type">char</span>[<span class="number">7</span>];</span><br><span class="line">std::cin &gt;&gt; str_2;</span><br><span class="line"></span><br><span class="line">std::cout &lt;&lt; (str1 == str2) &lt;&lt; std::endl;  <span class="comment">// è¾“å…¥123456  æ˜¯ä¸ç›¸ç­‰çš„</span></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">string str_1&#123;<span class="string">&quot;123456&quot;</span>&#125;;</span><br><span class="line">string str_2;</span><br><span class="line"></span><br><span class="line">std::cin &gt;&gt; str_2;</span><br><span class="line">std::cout &lt;&lt; (str1 == str2) &lt;&lt; std::endl;   <span class="comment">// æ‰‹åŠ¨è¾“å…¥123456   æ˜¯ç›¸ç­‰çš„</span></span><br></pre></td></tr></table></figure><p>2ï¸âƒ£ æ¯”è¾ƒä¸åŒçš„å†…å®¹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">string str_1&#123;<span class="string">&quot;abcdef&quot;</span>&#125;;</span><br><span class="line">string str_2&#123;<span class="string">&quot;bcdefg&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»ç¬¬ä¸€ä¸ªå­—ç¬¦å¼€å§‹æ¯”è¾ƒï¼Œå¦‚æœæ¯”å‡ºæ¥å¤§å°åé¢å°±ä¸æ¯”è¾ƒäº†</span></span><br><span class="line"><span class="keyword">if</span>(str_1 &gt; str_2)</span><br><span class="line">&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;å¤§äº&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> std::cout &lt;&lt; <span class="string">&quot;å°äºç­‰äº&quot;</span>;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string str_1&#123;<span class="string">&quot;abcdef&quot;</span>&#125;;</span><br><span class="line">str<span class="number">1.</span><span class="built_in">compare</span>(<span class="string">&quot;bcdefg&quot;</span>); <span class="comment">// è¿”å›ä¸€ä¸ªintç±»å‹çš„å€¼</span></span><br><span class="line"><span class="comment">// å¦‚æœstr1æ¯”å¦å¤–ä¸€ä¸ªå­—ç¬¦ä¸²å°è¿”å›è´Ÿæ•° -1ï¼Œ å¦‚æœç›¸ç­‰è¿”å› 0  å¦‚æœå¤§äºè¿”å› 1</span></span><br></pre></td></tr></table></figure><p>3ï¸âƒ£ æˆªå–ä¸€æ®µä¹‹åè¿›è¡Œæ¯”è¾ƒ</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">string strA&#123;<span class="string">&quot;abc cdef&quot;</span>&#125;;</span><br><span class="line">strA.<span class="built_in">compare</span>(<span class="number">5</span>,<span class="number">4</span>,<span class="string">&quot;cdef&quot;</span>); <span class="comment">// æˆªå–çš„æ˜¯strA   compare(èµ·å§‹ä½ç½®,å‚ä¸æ¯”è¾ƒçš„é•¿åº¦,è¢«æ¯”è¾ƒçš„å­—ç¬¦ä¸²);</span></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">string strA&#123;<span class="string">&quot;abc cdef&quot;</span>&#125;;</span><br><span class="line">strA.<span class="built_in">compare</span>(<span class="number">5</span>,<span class="number">4</span>,<span class="string">&quot;cdef ghijklm&quot;</span>, <span class="number">0</span>, <span class="number">4</span>); <span class="comment">// å‰é¢æˆªå›¾çš„strAï¼Œ åé¢æˆªå–çš„æ˜¯&quot;cdef ghijklm&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">string strA&#123;<span class="string">&quot;username:5620;studentId:655555&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">std::cout &lt;&lt; strA.<span class="built_in">find</span>(<span class="string">&quot;studentId:&quot;</span>); <span class="comment">// è¿”å›å­—ç¬¦ä¸²çš„èµ·å§‹ä½ç½®</span></span><br><span class="line">std::cout &lt;&lt; strA.<span class="built_in">substr</span>(strA.<span class="built_in">find</span>(<span class="string">&quot;studentId:&quot;</span>)); <span class="comment">// è¾“å‡º  studentId:655555</span></span><br><span class="line">std::cout &lt;&lt; strA.<span class="built_in">substr</span>(strA.<span class="built_in">find</span>(<span class="string">&quot;studentId:&quot;</span>) + <span class="number">10</span>); <span class="comment">//è¾“å‡º655555</span></span><br></pre></td></tr></table></figure><p>è¡¥å……  find()  æ–¹æ³• çš„ç”¨æ³•</p><p><img src="https://bu.dusays.com/2024/11/21/673ee8f79c446.png"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str.<span class="built_in">find</span>(<span class="string">&quot;sdajklfdkasjlkfjlas&quot;</span>, <span class="number">0</span>, <span class="number">10</span>); <span class="comment">//åœ¨å­—ç¬¦ä¸² str ä¸­ï¼Œä»ä½ç½® 0 å¼€å§‹ï¼ŒæŸ¥æ‰¾å­—ç¬¦ä¸² &quot;sdajklfdkasjlkfjlas&quot; çš„å‰ 10 ä¸ªå­—ç¬¦æ˜¯å¦å­˜åœ¨ã€‚</span></span><br></pre></td></tr></table></figure><p>å€’ç€æœç´¢</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¡¨ç¤ºä»å­—ç¬¦ä¸² str çš„ ç´¢å¼• 0 ä½ç½®å‘å‰ï¼ˆä»å³åˆ°å·¦æŸ¥æ‰¾ï¼‰å¯»æ‰¾ç›®æ ‡å­—ç¬¦ä¸² &quot;sdajklfdkasjlkfjlas&quot;</span></span><br><span class="line">str.<span class="built_in">rfind</span>(<span class="string">&quot;sdajklfdkasjlkfjlas&quot;</span>, <span class="number">0</span>); </span><br></pre></td></tr></table></figure><p><strong>å­—ç¬¦ä¸²çš„åº”ç”¨â€“å°é¡¹ç›®</strong></p><p><img src="https://bu.dusays.com/2024/11/21/673ef4d76891d.png"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::string;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">string str&#123; <span class="string">&quot;id=user;pas=632105;role=é˜¿æ£®;&quot;</span> &#125;;</span><br><span class="line">string strIn;</span><br><span class="line">string strOut;</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;è¯·è¾“å…¥æ‚¨è¦æŸ¥é˜…çš„å±æ€§ï¼š\n&quot;</span>;</span><br><span class="line">std::cin &gt;&gt; strIn;</span><br><span class="line"><span class="type">int</span> lfind = str.<span class="built_in">find</span>(strIn + <span class="string">&quot;=&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (lfind == std::string::npos)</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;æŸ¥æ‰¾çš„å±æ€§ä¸å­˜åœ¨&quot;</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> lend = str.<span class="built_in">find</span>(<span class="string">&quot;;&quot;</span>, lfind);</span><br><span class="line">strOut = str.<span class="built_in">substr</span>(lfind + strIn.<span class="built_in">length</span>() + <span class="number">1</span>, lend - lfind - strIn.<span class="built_in">length</span>() - <span class="number">1</span>);</span><br><span class="line">std::cout &lt;&lt; strOut &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ’å…¥å­—ç¬¦ä¸²</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¯­æ³•</span></span><br><span class="line">.<span class="built_in">insert</span>();</span><br><span class="line">string id&#123;<span class="string">&quot;id=;&quot;</span>&#125;;</span><br><span class="line">id.<span class="built_in">insert</span>(<span class="number">3</span>,<span class="string">&quot;testId&quot;</span>);</span><br><span class="line">std::cout &lt;&lt; id;</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/11/21/673f1c5e64bea.png"></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–¹æ³•äºŒ</span></span><br><span class="line">string id&#123;<span class="string">&quot;id=&quot;</span>&#125;;</span><br><span class="line"><span class="comment">// ä»ç´¢å¼•æ’å…¥6ä¸ª*</span></span><br><span class="line">id.<span class="built_in">insert</span>(<span class="number">3</span>,<span class="number">6</span>,<span class="string">&#x27;*&#x27;</span>);</span><br><span class="line">std::cout &lt;&lt; id &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">id.<span class="built_in">insert</span>(<span class="number">3</span>, <span class="string">&quot;testid&quot;</span>);</span><br><span class="line">std::cout &lt;&lt; id;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">string id&#123;<span class="string">&quot;id=&quot;</span>&#125;;</span><br><span class="line"><span class="comment">// 3 æ˜¯ä»idå­—ç¬¦ä¸²ç´¢å¼•3å¼€å§‹æ’å…¥ï¼Œåé¢çš„ç¬¬ä¸€ä¸ª6æ˜¯ä»å­—ç¬¦ä¸²&quot;killertestid&quot;ç´¢å¼•6å¼€å§‹æ’å…¥6ä¸ªå­—ç¬¦åˆ°å­—ç¬¦ä¸²idä¸­</span></span><br><span class="line">id.<span class="built_in">insert</span>(<span class="number">3</span>,<span class="string">&quot;killertestid&quot;</span>, <span class="number">6</span>, <span class="number">6</span>);</span><br><span class="line">std::cout &lt;&lt; id &lt;&lt; std::endl;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string id&#123;<span class="string">&quot;id=&quot;</span>&#125;;</span><br><span class="line"><span class="comment">// åœ¨idå­—ç¬¦ä¸²ç´¢å¼•3å¼€å§‹æ’å…¥ ï¼Œ  ç„¶åä»å­—ç¬¦ä¸²&quot;killertestid123456&quot;çš„kå¼€å§‹æ’å…¥6ä¸ª</span></span><br><span class="line">id.<span class="built_in">insert</span>(<span class="number">3</span>,<span class="string">&quot;killertestid123456&quot;</span>,<span class="number">6</span>);</span><br></pre></td></tr></table></figure><p><strong>æŒ‡é’ˆæ•°ç»„å­—ç¬¦ä¸²</strong></p><p>strå’Œ str[0] ä¸æ˜¯ä¸€ä¸ªä½ç½®ï¼Œå…·ä½“è·Ÿæ•°ç»„æœ‰åŒºåˆ«ï¼Œæ¶‰åŠåˆ°è¿ç®—ç¬¦é‡è½½</p><p>strçš„åœ°å€å’Œstr[0]çš„åœ°å€å·®4</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string str&#123;<span class="string">&quot;12344&quot;</span>&#125;;</span><br><span class="line"><span class="comment">// ä¸è½¬intä¼šå½“ä½œå­—ç¬¦ä¸²æ¥è¾“å‡º</span></span><br><span class="line">std::cout &lt;&lt; (<span class="type">int</span>)&amp;str &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; (<span class="type">int</span>)&amp;str[<span class="number">0</span>] &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; (<span class="type">int</span>)&amp;str[<span class="number">1</span>];</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">string str&#123;<span class="string">&quot;12345&quot;</span>&#125;;</span><br><span class="line">std::cout &lt;&lt; str[<span class="number">0</span>] &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">std::cout &lt;&lt; (<span class="type">int</span>)&amp;str &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; (<span class="type">int</span>)&amp;str[<span class="number">0</span>] &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; (<span class="type">int</span>)&amp;str[<span class="number">1</span>] &lt;&lt; std::endl;</span><br><span class="line">str = str + <span class="string">&quot;534894539823478923&quot;</span>;</span><br><span class="line"><span class="comment">// str  è·Ÿ str[0]åœ°å€ç›¸å·®å°±å¾ˆå¤šäº†ï¼Œéœ€è¦é‡æ–°åˆ†é…å†…å­˜åœ°å€</span></span><br><span class="line">std::cout &lt;&lt; (<span class="type">int</span>)&amp;str &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; (<span class="type">int</span>)&amp;str[<span class="number">0</span>] &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; (<span class="type">int</span>)&amp;str[<span class="number">1</span>] &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line"><span class="comment">// .c_str() è¿”å›çš„æ˜¯ const char*ï¼Œä¸èƒ½ç›´æ¥é€šè¿‡æŒ‡é’ˆä¿®æ”¹å­—ç¬¦ä¸²å†…å®¹ã€‚</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* baseStr = str.<span class="built_in">c_str</span>();</span><br><span class="line"><span class="comment">// baseStr[0] = &#x27;5&#x27;;   ä¸å…è®¸ä¿®æ”¹</span></span><br><span class="line">std::cout &lt;&lt; (<span class="type">int</span>)&amp;str &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; (<span class="type">int</span>)&amp;str[<span class="number">0</span>] &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; (<span class="type">int</span>)&amp;str[<span class="number">1</span>] &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; (<span class="type">int</span>)baseStr &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// C++ 17 ä¹‹å .data()æ–¹æ³•å¾—åˆ°çš„æ˜¯ä¸€ä¸ªchar* çš„æŒ‡é’ˆ</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* dataStr = str.<span class="built_in">data</span>();</span><br><span class="line"><span class="comment">// dataStr[0] = &#x27;5&#x27;;   ä¸å…è®¸ä¿®æ”¹</span></span><br><span class="line">std::cout &lt;&lt; (<span class="type">int</span>)&amp;str &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; (<span class="type">int</span>)&amp;str[<span class="number">0</span>] &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; (<span class="type">int</span>)&amp;str[<span class="number">1</span>] &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; (<span class="type">int</span>)baseStr &lt;&lt; std::endl;</span><br></pre></td></tr></table></figure><ul><li>è¿”å›ä¸€ä¸ª <code>const char*</code> æŒ‡é’ˆï¼ŒæŒ‡å‘ä»¥ç©ºå­—ç¬¦ <code>\0</code> ç»“å°¾çš„ C é£æ ¼å­—ç¬¦ä¸²ã€‚</li><li>è¿”å›çš„å­—ç¬¦ä¸²æ•°æ®ä¸ <code>std::string</code> å¯¹è±¡å†…éƒ¨ä¿æŒä¸€è‡´ï¼Œä½†ä¸èƒ½ä¿®æ”¹è¿”å›å€¼ï¼ˆå®ƒæ˜¯ <code>const</code> çš„ï¼‰ã€‚</li></ul><p><strong>å­—ç¬¦ä¸²æ›¿æ¢</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¯­æ³•1</span></span><br><span class="line">.<span class="built_in">replace</span>(è¦æ›¿æ¢çš„å†…å®¹çš„èµ·å§‹ä½ç½®ï¼Œè¦æ›¿æ¢çš„é•¿åº¦ï¼Œâ€œæ›¿æ¢åçš„å†…å®¹â€);</span><br><span class="line"></span><br><span class="line">string strId&#123;<span class="string">&quot;id=user;&quot;</span>&#125;;</span><br><span class="line"><span class="comment">// æ›¿æ¢ä»ç´¢å¼• 3 å¼€å§‹çš„ 4 ä¸ªå­—ç¬¦ä¸º &quot;zhangsan&quot;</span></span><br><span class="line">strId.replace&#123;<span class="number">3</span>,<span class="number">4</span>,<span class="string">&quot;zhangsan&quot;</span>&#125;;</span><br><span class="line">std::cout &lt;&lt; strId;  <span class="comment">// id=zhangsan</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯­æ³•2</span></span><br><span class="line">.<span class="built_in">replace</span>(è¦æ›¿æ¢çš„å†…å®¹çš„èµ·å§‹ä½ç½®ï¼Œè¦æ›¿æ¢çš„é•¿åº¦ï¼Œæ›¿æ¢åçš„å­—ç¬¦é•¿åº¦ï¼Œâ€˜å­—ç¬¦â€™);</span><br><span class="line"><span class="comment">// æ›¿æ¢ä»ç´¢å¼• 3 å¼€å§‹çš„ 4 ä¸ªå­—ç¬¦ï¼Œç”¨ 6 ä¸ª &#x27;*&#x27; æ›¿æ¢</span></span><br><span class="line">str.<span class="built_in">replace</span>(<span class="number">3</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="string">&#x27;*&#x27;</span>);</span><br><span class="line"><span class="comment">// strçš„å†…å®¹ä¸ºï¼šid=******</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯­æ³•3</span></span><br><span class="line">.<span class="built_in">replace</span>(è¦æ›¿æ¢çš„å†…å®¹çš„èµ·å§‹ä½ç½®ï¼Œè¦æ›¿æ¢çš„é•¿åº¦ï¼Œ<span class="string">&quot;æ›¿æ¢åçš„å†…å®¹&quot;</span>ï¼Œæ›¿æ¢åå†…å®¹çš„é•¿åº¦èŠ‚é€‰);</span><br><span class="line"><span class="comment">// æ›¿æ¢ä»ç´¢å¼• 3 å¼€å§‹çš„ 4 ä¸ªå­—ç¬¦ï¼Œç”¨ &quot;zhangsan!pkaq&quot; çš„å‰ 8 ä¸ªå­—ç¬¦æ›¿æ¢</span></span><br><span class="line">str.<span class="built_in">replace</span>(<span class="number">3</span>,<span class="number">4</span>,<span class="string">&quot;zhangsan!pkaq&quot;</span>,<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯­æ³•4</span></span><br><span class="line">.<span class="built_in">replace</span>(è¦æ›¿æ¢çš„å†…å®¹çš„èµ·å§‹ä½ç½®ï¼Œè¦æ›¿æ¢çš„é•¿åº¦ï¼Œ<span class="string">&quot;æ›¿æ¢åçš„å†…å®¹&quot;</span>ï¼Œæ›¿æ¢åçš„å†…å®¹çš„èµ·å§‹ä½ç½®ï¼Œæ›¿æ¢åå†…å®¹çš„é•¿åº¦èŠ‚é€‰);</span><br><span class="line"><span class="comment">// æ›¿æ¢ä»ç´¢å¼• 3 å¼€å§‹çš„ 4 ä¸ªå­—ç¬¦ï¼Œç”¨ &quot;zhangsan!pkaq&quot; çš„ä»ç¬¬9ä¸ªå­—ç¬¦å¼€å§‹æˆªå–ï¼Œæˆªå–4ä¸ª</span></span><br><span class="line">str.<span class="built_in">replace</span>(<span class="number">3</span>,<span class="number">4</span>,<span class="string">&quot;zhangsan!pkaq&quot;</span>,<span class="number">9</span>ï¼Œ,<span class="number">4</span>);</span><br></pre></td></tr></table></figure><p><strong>åˆ é™¤å­—ç¬¦ä¸²å†…å®¹</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¯­æ³•1</span></span><br><span class="line">.<span class="built_in">erase</span>(è¦åˆ é™¤çš„èµ·å§‹ä½ç½®,è¦åˆ é™¤çš„èµ·å§‹é•¿åº¦);</span><br><span class="line"></span><br><span class="line">string str&#123;<span class="string">&quot;id=user;&quot;</span>&#125;;</span><br><span class="line">str.<span class="built_in">erase</span>(<span class="number">3</span>,<span class="number">4</span>);</span><br><span class="line"><span class="comment">// id=;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯­æ³•2</span></span><br><span class="line">.<span class="built_in">erase</span>(è¦åˆ é™¤çš„èµ·å§‹ä½ç½®); <span class="comment">// ä»èµ·å§‹ä½ç½®å¼€å§‹åˆ é™¤æ‰€æœ‰å†…å®¹</span></span><br><span class="line">string str&#123;<span class="string">&quot;id=user;&quot;</span>&#125;;</span><br><span class="line">str.<span class="built_in">erase</span>(<span class="number">3</span>);</span><br><span class="line"><span class="comment">// id = </span></span><br><span class="line"></span><br><span class="line">.<span class="built_in">erase</span>();   <span class="comment">//åˆ é™¤å­—ç¬¦ä¸²æ‰€æœ‰å†…å®¹   æ“¦é™¤</span></span><br><span class="line">.<span class="built_in">clear</span>();   <span class="comment">//åˆ é™¤å­—ç¬¦ä¸²æ‰€æœ‰å†…å®¹   æ¸…é›¶</span></span><br></pre></td></tr></table></figure><p><strong>å­—ç¬¦ä¸²ï¼ˆè¡¥å……ï¼‰</strong></p><p>è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">string strIn;</span><br><span class="line">std::cin &gt;&gt; strIn;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> length&#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; strIn[i]; i ++ )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// åœ¨ ASCII ç¼–ç ä¸­ï¼Œå•å­—èŠ‚å­—ç¬¦ï¼ˆå¦‚è‹±æ–‡ã€æ•°å­—ï¼‰å‡ä¸ºéè´Ÿæ•°ï¼ˆ0-127ï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> (strIn[i] &lt; <span class="number">0</span>) i ++ ;</span><br><span class="line">    length ++ ;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¿™æ ·å°±èƒ½ç»Ÿè®¡å‡ºå­—ç¬¦ä¸ªæ•°äº†</span></span><br><span class="line">std::cout &lt;&lt; length;</span><br></pre></td></tr></table></figure><p>å­—ç¬¦ä¸²è½¬æ¢</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">string cIn = <span class="string">&quot;123&quot;</span>;</span><br><span class="line"><span class="type">int</span> x = std::<span class="built_in">stoi</span>(cIn); <span class="comment">// è½¬æ¢æˆintç±»å‹</span></span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/11/21/673f31c813942.png"></p><p>å­—ç¬¦ä¸²æµ</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::string;</span><br><span class="line"><span class="keyword">using</span> std::stringstream;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    stringstream strS;</span><br><span class="line">    <span class="comment">// è¿™æ˜¯æŒ‰ç…§16è¿›åˆ¶æ¥è¾“å‡ºçš„</span></span><br><span class="line">    strS &lt;&lt; <span class="string">&quot;ä½ å¥½&quot;</span> &lt;&lt; <span class="string">&quot;123 [&quot;</span> &lt;&lt; std::hex &lt;&lt; <span class="number">12530</span> &lt;&lt; <span class="string">&quot;]&quot;</span>;</span><br><span class="line">    string strX = strS.<span class="built_in">str</span>();</span><br><span class="line">    std::cout &lt;&lt; strX;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å­—ç¬¦ä¸²é¡¹ç›®</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> std::string;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">Role</span></span><br><span class="line">&#123;</span><br><span class="line">    string Id;</span><br><span class="line">    <span class="type">int</span> Exp;</span><br><span class="line">&#125;*PROLE;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    string strData = <span class="string">&quot;id=Tomy Clare;exp=9523;id=Sunny;exp=9523;id=DyBaby;exp=25301;id=Simple;exp=25301;id=Bkacs11;exp=2100;id=Dudu;exp=2122;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> istart&#123;&#125;, iend&#123;&#125;, icount&#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; strData.<span class="built_in">length</span>(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (strData[i] == <span class="string">&#x27;;&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            icount++;</span><br><span class="line">            i += <span class="number">3</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    PROLE pRole = <span class="keyword">new</span> Role[icount / <span class="number">2</span>];</span><br><span class="line">    icount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// æŸ¥æ‰¾åˆ°id=   åˆ™æŠŠistart å°†æ›´æ–°ä¸º &quot;id=&quot; é¦–æ¬¡å‡ºç°çš„ç´¢å¼•</span></span><br><span class="line">        istart = strData.<span class="built_in">find</span>(<span class="string">&quot;id=&quot;</span>, istart);</span><br><span class="line">        <span class="keyword">if</span> (istart == std::string::npos) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        iend = strData.<span class="built_in">find</span>(<span class="string">&quot;;&quot;</span>, istart + <span class="number">3</span>);</span><br><span class="line">        <span class="comment">// ä»istartå¼€å§‹æˆªå–ï¼Œæˆªå–é•¿åº¦å°±æ˜¯iend-istart-3</span></span><br><span class="line">        pRole[icount].Id = strData.<span class="built_in">substr</span>(istart + <span class="number">3</span>, iend - istart - <span class="number">3</span>);</span><br><span class="line">        istart = iend + <span class="number">1</span>;</span><br><span class="line">        iend = strData.<span class="built_in">find</span>(<span class="string">&quot;;&quot;</span>, istart + <span class="number">4</span>);</span><br><span class="line">        <span class="comment">// åœ¨è¿™é‡Œ icount ++ çœå»åé¢å†++ äº†</span></span><br><span class="line"></span><br><span class="line">        pRole[icount++].Exp = std::<span class="built_in">stoi</span>(strData.<span class="built_in">substr</span>(istart + <span class="number">4</span>, iend - istart - <span class="number">4</span>));</span><br><span class="line">        istart = iend + <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">while</span> (<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†’æ³¡æ’åº  ç»å…¸å†’æ³¡æ’åº</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; icount - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; icount - i - <span class="number">1</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (pRole[j].Exp &lt; pRole[j + <span class="number">1</span>].Exp ||</span><br><span class="line">                (pRole[j].Exp == pRole[j + <span class="number">1</span>].Exp &amp;&amp; pRole[j].Id &gt; pRole[j + <span class="number">1</span>].Id)) &#123;</span><br><span class="line">                Role temp = pRole[j];</span><br><span class="line">                pRole[j] = pRole[j + <span class="number">1</span>];</span><br><span class="line">                pRole[j + <span class="number">1</span>] = temp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; icount; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; pRole[i].Id &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; pRole[i].Exp &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cpp01æ•°ç»„ã€å®¹å™¨æŒ‡é’ˆ</title>
      <link href="/2024/12/11/cpp01%E6%95%B0%E7%BB%84%E3%80%81%E5%AE%B9%E5%99%A8%E6%8C%87%E9%92%88/"/>
      <url>/2024/12/11/cpp01%E6%95%B0%E7%BB%84%E3%80%81%E5%AE%B9%E5%99%A8%E6%8C%87%E9%92%88/</url>
      
        <content type="html"><![CDATA[<p><strong>æ•°ç»„</strong>ï¼š</p><p>std::arrayä¸­ï¼Œå¯ä»¥é€šè¿‡at()æ¥è®¿é—®æ•°ç»„çš„å†…å®¹ï¼Œå¦‚æœè¶Šç•Œäº†å°±ä¼šæŠ›å‡ºè¶Šç•Œå¼‚å¸¸ </p><p>æ•°ç»„å®‰å…¨ï¼šç”±äºæ•°ç»„çš„æœ¬è´¨æ˜¯å‘æ“ä½œç³»ç»Ÿç”³è¯·äº†ä¸€å—å†…å­˜ï¼Œå› æ­¤è¶Šç•Œçš„æ•°ç»„å°†ä¼šè®¿é—®åˆ°ä¸è¯¥è®¿é—®çš„åœ°å€ï¼Œè¿™ç§è¶Šç•Œå°†ä¼šé€ æˆç¨‹åºå´©æºƒï¼ŒBUGé”™è¯¯ï¼Œæ›´å¯æ€•çš„æ˜¯ï¼Œæ•°ç»„è¶Šç•Œæ¼æ´ï¼Œå¯èƒ½ä¼šè®©æ”»å‡»è€…æ‹¿åˆ°æ“ä½œç³»ç»Ÿçš„æ§åˆ¶æƒã€‚</p><p><strong>å®¹å™¨</strong>ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;æ•°æ®ç±»å‹&gt; å˜é‡å;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; s;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; s&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"><span class="function">std::vector&lt;<span class="type">int</span>&gt; <span class="title">s</span><span class="params">(<span class="number">5</span>)</span></span>;  <span class="comment">// è®¾ç½®äº†5ä¸ªå¤§å°çš„å®¹å™¨</span></span><br><span class="line"><span class="function">std::vector&lt;<span class="type">int</span>&gt; <span class="title">s</span><span class="params">(<span class="number">5</span>,<span class="number">100</span>)</span></span>;  <span class="comment">// è¿™ä¸ªå®¹å™¨æ‹¥æœ‰äº”ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ çš„åˆå§‹å€¼ä¸º100</span></span><br></pre></td></tr></table></figure><p>å®¹å™¨çš„å‡ ä¸ªæ–°ç”¨æ³•ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; s;</span><br><span class="line">s.<span class="built_in">push_back</span>(å€¼);  <span class="comment">//å°†å€¼æ·»åŠ åˆ°å®¹å™¨æœ«å°¾</span></span><br><span class="line">s.<span class="built_in">pop_back</span>();  <span class="comment">//å°†æœ«å°¾çš„å€¼åˆ é™¤æ‰</span></span><br><span class="line">s.<span class="built_in">insert</span>(s.<span class="built_in">begin</span>()<span class="number">+2</span>, <span class="number">2</span>); <span class="comment">// åœ¨æŒ‡å®šä½ç½®æ’å…¥å…ƒç´ </span></span><br><span class="line">s.<span class="built_in">assign</span>(<span class="number">10</span>,<span class="number">100</span>); <span class="comment">//å°†sé‡æ–°åˆå§‹åŒ–ä¸ºæ‹¥æœ‰10ä¸ªå…ƒç´   æ¯ä¸ªå…ƒç´ ä½100çš„å®¹å™¨</span></span><br><span class="line">s.<span class="built_in">erase</span>(s.<span class="built_in">begin</span>() + <span class="number">2</span>);   <span class="comment">// åˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ </span></span><br><span class="line">s.<span class="built_in">clear</span>(); <span class="comment">// å°†å®¹å™¨æ¸…ç©º</span></span><br><span class="line">s.<span class="built_in">empty</span>(); <span class="comment">//çœ‹çœ‹æ˜¯ä¸æ˜¯ç©ºçš„</span></span><br></pre></td></tr></table></figure><p><strong>å®¹å™¨ä¾‹å­</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vector éå†</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; vec = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : vec) &#123;</span><br><span class="line">        std::cout &lt;&lt; v &lt;&lt; <span class="string">&quot; &quot;</span>;  <span class="comment">// è¾“å‡ºå…ƒç´ å€¼</span></span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*-------------------------------------------------------------------*/</span></span><br><span class="line"><span class="comment">// ä½¿ç”¨å¼•ç”¨é¿å…æ‹·è´</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;std::string&gt; vec = &#123;<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;Charlie&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; name : vec) &#123;  <span class="comment">// ä½¿ç”¨å¼•ç”¨é¿å…æ‹·è´</span></span><br><span class="line">        name += <span class="string">&quot; (modified)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; name : vec) &#123;  <span class="comment">// ä½¿ç”¨å¸¸é‡å¼•ç”¨åªè¯»è®¿é—®</span></span><br><span class="line">        std::cout &lt;&lt; name &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå† map å®¹å™¨</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::map&lt;std::string, <span class="type">int</span>&gt; m = &#123;&#123;<span class="string">&quot;Alice&quot;</span>, <span class="number">25</span>&#125;, &#123;<span class="string">&quot;Bob&quot;</span>, <span class="number">30</span>&#125;, &#123;<span class="string">&quot;Eve&quot;</span>, <span class="number">35</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// c++17åŠä»¥ä¸Šæ‰å¯ä»¥</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; [key, value] : m) &#123;  <span class="comment">// ä½¿ç”¨ç»“æ„åŒ–ç»‘å®š</span></span><br><span class="line">        std::cout &lt;&lt; key &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; value &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†æ•°ç»„</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> arr[] = &#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> num : arr) &#123;</span><br><span class="line">        std::cout &lt;&lt; num &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†unordered_map</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::unordered_map&lt;std::string, <span class="type">int</span>&gt; um = &#123;&#123;<span class="string">&quot;One&quot;</span>, <span class="number">1</span>&#125;, &#123;<span class="string">&quot;Two&quot;</span>, <span class="number">2</span>&#125;, &#123;<span class="string">&quot;Three&quot;</span>, <span class="number">3</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; pair : um) &#123;</span><br><span class="line">        std::cout &lt;&lt; pair.first &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; pair.second &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç»“æ„åŒ–ç»‘å®š</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// std::pair  é€šè¿‡first second æ¥è®¿é—®pairæˆå‘˜</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::pair&lt;<span class="type">int</span>, std::string&gt; p = &#123;<span class="number">1</span>, <span class="string">&quot;Alice&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ç»“æ„åŒ–ç»‘å®š</span></span><br><span class="line">    <span class="keyword">auto</span> [id, name] = p;</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;ID: &quot;</span> &lt;&lt; id &lt;&lt; <span class="string">&quot;, Name: &quot;</span> &lt;&lt; name &lt;&lt; std::endl;</span><br><span class="line">    <span class="comment">// è¾“å‡º  ID: 1, Name: Alice</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// std::tuple</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tuple&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::tuple&lt;<span class="type">int</span>, <span class="type">double</span>, std::string&gt; t = &#123;<span class="number">1</span>, <span class="number">3.14</span>, <span class="string">&quot;Hello&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ç»“æ„åŒ–ç»‘å®š</span></span><br><span class="line">    <span class="keyword">auto</span> [a, b, c] = t;</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; a &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; b &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; c &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//éå†std::map</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::map&lt;std::string, <span class="type">int</span>&gt; m = &#123;&#123;<span class="string">&quot;Alice&quot;</span>, <span class="number">30</span>&#125;, &#123;<span class="string">&quot;Bob&quot;</span>, <span class="number">25</span>&#125;, &#123;<span class="string">&quot;Charlie&quot;</span>, <span class="number">35</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; [key, value] : m) &#123;  <span class="comment">// è§£æ„é”®å€¼å¯¹</span></span><br><span class="line">        std::cout &lt;&lt; key &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; value &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è§£æ„æ•°ç»„</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> arr[<span class="number">3</span>] = &#123;<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> [x, y, z] = arr;  <span class="comment">// è§£æ„æ•°ç»„</span></span><br><span class="line">    std::cout &lt;&lt; x &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; y &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; z &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£æ„ç”¨æˆ·è‡ªå®šä¹‰ç±»å‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    std::string name;</span><br><span class="line">    <span class="type">double</span> salary;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Person p = &#123;<span class="number">101</span>, <span class="string">&quot;Alice&quot;</span>, <span class="number">75000.0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> [id, name, salary] = p;  <span class="comment">// è§£æ„ç»‘å®š</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;ID: &quot;</span> &lt;&lt; id &lt;&lt; <span class="string">&quot;, Name: &quot;</span> &lt;&lt; name &lt;&lt; <span class="string">&quot;, Salary: &quot;</span> &lt;&lt; salary &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç‰¹æ®Šåº”ç”¨ï¼šéèšåˆç±»å‹ï¼ˆæ¶‰åŠé‡è½½ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tuple&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line">    std::string name;</span><br><span class="line">    <span class="type">double</span> salary;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Person</span>(<span class="type">int</span> i, std::string n, <span class="type">double</span> s) : <span class="built_in">id</span>(i), <span class="built_in">name</span>(n), <span class="built_in">salary</span>(s) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">struct</span> <span class="title class_">std</span>::tuple_size&lt;Person&gt;;</span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">auto</span> std::<span class="built_in">get</span>&lt;<span class="number">0</span>&gt;(<span class="type">const</span> Person&amp;) -&gt; <span class="type">int</span>;</span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">auto</span> std::<span class="built_in">get</span>&lt;<span class="number">1</span>&gt;(<span class="type">const</span> Person&amp;) -&gt; std::string;</span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">auto</span> std::<span class="built_in">get</span>&lt;<span class="number">2</span>&gt;(<span class="type">const</span> Person&amp;) -&gt; <span class="type">double</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç‰¹åŒ– std::tuple_size å’Œ std::get</span></span><br><span class="line"><span class="keyword">namespace</span> std &#123;</span><br><span class="line">    <span class="keyword">template</span> &lt;&gt; <span class="keyword">struct</span> <span class="title class_">tuple_size</span>&lt;Person&gt; : std::integral_constant&lt;<span class="type">size_t</span>, <span class="number">3</span>&gt; &#123;&#125;;</span><br><span class="line">    <span class="keyword">template</span> &lt;&gt; <span class="keyword">auto</span> <span class="built_in">get</span>&lt;<span class="number">0</span>&gt;(<span class="type">const</span> Person&amp; p) &#123; <span class="keyword">return</span> p.id; &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;&gt; <span class="keyword">auto</span> <span class="built_in">get</span>&lt;<span class="number">1</span>&gt;(<span class="type">const</span> Person&amp; p) &#123; <span class="keyword">return</span> p.name; &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;&gt; <span class="keyword">auto</span> <span class="built_in">get</span>&lt;<span class="number">2</span>&gt;(<span class="type">const</span> Person&amp; p) &#123; <span class="keyword">return</span> p.salary; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">Person <span class="title">p</span><span class="params">(<span class="number">101</span>, <span class="string">&quot;Bob&quot;</span>, <span class="number">85000.0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> [id, name, salary] = p;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;ID: &quot;</span> &lt;&lt; id &lt;&lt; <span class="string">&quot;, Name: &quot;</span> &lt;&lt; name &lt;&lt; <span class="string">&quot;, Salary: &quot;</span> &lt;&lt; salary &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/11/18/673ab200dc43b.png"></p><p><strong>æŒ‡é’ˆ</strong></p><p> æŒ‡é’ˆè¯­æ³•ï¼šæ•°æ®ç±»å‹ * å˜é‡åç§°</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æŒ‡é’ˆå¿…é¡»åˆå§‹åŒ–  æŒ‡é’ˆå…¶å®å°±æ˜¯å­˜å‚¨çš„åˆ«çš„å˜é‡çš„å†…å­˜åœ°å€</span></span><br><span class="line"><span class="type">int</span>* a;  <span class="comment">//æŒ‡é’ˆæ˜¯å†…å­˜åœ°å€  å»ºè®®ç¬¬ä¸€ç§å†™æ³•</span></span><br><span class="line"><span class="type">int</span> *b;  <span class="comment">//ä¸¤ç§å†™æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¦æ“ä½œçš„å†…å­˜åœ°å€</span></span><br><span class="line"><span class="comment">// è¦æ“ä½œçš„å†…å­˜å¤§å°</span></span><br><span class="line"><span class="type">int</span>* pa = &amp;a;</span><br></pre></td></tr></table></figure><p><strong>æŒ‡é’ˆ</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a[]&#123; <span class="number">10001</span>,<span class="number">20001</span>,<span class="number">30001</span>,<span class="number">40001</span> &#125;;</span><br><span class="line"><span class="type">int</span>* ptr&#123; &amp;a[<span class="number">0</span>] &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æŒ‡é’ˆ+1æ˜¯ 1 * æ•°æ®ç±»å‹çš„å¤§å°</span></span><br><span class="line">std::cout &lt;&lt; ptr &lt;&lt; std::endl;<span class="comment">//ptrçš„å€¼å°±æ˜¯a[0]çš„åœ°å€</span></span><br><span class="line">std::cout &lt;&lt; &amp;a[<span class="number">0</span>] &lt;&lt; std::endl;</span><br><span class="line">std::cout &lt;&lt; *ptr &lt;&lt; std::endl;<span class="comment">//*ptrå°±æ˜¯a[0]çš„å€¼</span></span><br><span class="line">std::cout &lt;&lt; (*ptr)++ &lt;&lt; std::endl;<span class="comment">//å…ˆè¾“å‡º*ptrçš„å€¼  ä¸º10001ï¼Œç„¶åå¯¹*ptr  åŠ   1</span></span><br><span class="line">std::cout &lt;&lt; a[<span class="number">0</span>] &lt;&lt; std::endl;  <span class="comment">// a[0]å˜ä¸º10002</span></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;------------åˆ†ç•Œçº¿----------------&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">std::cout &lt;&lt; ptr &lt;&lt; std::endl;<span class="comment">//ptrçš„å€¼å°±æ˜¯a[0]çš„åœ°å€</span></span><br><span class="line">std::cout &lt;&lt; *ptr++ &lt;&lt; std::endl;<span class="comment">//++çš„ä¼˜å…ˆçº§é«˜ï¼Œå…ˆå¯¹ptr++ï¼Œåœ¨å¯¹ptråšè§£å¼•ç”¨çš„æ“ä½œ</span></span><br><span class="line">std::cout &lt;&lt; a[<span class="number">0</span>] &lt;&lt; std::endl;<span class="comment">// a[0]çš„å€¼ä¸å˜</span></span><br><span class="line">std::cout &lt;&lt; *ptr &lt;&lt; std::endl;<span class="comment">//ptrè¿›è¡ŒåŠ ä¸€æ“ä½œä¹‹åï¼ŒæŒ‡å‘a[1],  è¾“å‡º20001</span></span><br><span class="line">std::cout &lt;&lt; ptr &lt;&lt; std::endl;<span class="comment">//ptrçš„å€¼å¢åŠ äº†ä¸€ä¸ªintç±»å‹çš„å¤§å°ï¼Œ4ä¸ªå­—èŠ‚</span></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;------------åˆ†ç•Œçº¿----------------&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æŒ‡é’ˆçš„æŒ‡é’ˆï¼ŒæŒ‡é’ˆä¹Ÿæ˜¯ä¸ªå˜é‡ï¼Œæœ¬èº«ä¹Ÿæœ‰åœ°å€ï¼Œç°åœ¨è¦æ“ä½œptrçš„å†…å­˜</span></span><br><span class="line"><span class="comment">//ä¸è€ƒè™‘å‰é¢è¿›è¡Œçš„æ“ä½œ</span></span><br><span class="line"><span class="type">int</span>** pptr&#123; &amp;ptr &#125;;<span class="comment">//è¿™æ ·å®šä¹‰å°±æ˜¯æŒ‡é’ˆçš„æŒ‡é’ˆ</span></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;æ•°ç»„a[0]çš„åœ°å€ä¸ºï¼š &quot;</span> &lt;&lt; ptr &lt;&lt; std::endl;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;æ•°ç»„a[0]çš„åœ°å€ä¸ºï¼š &quot;</span> &lt;&lt; &amp;a[<span class="number">0</span>] &lt;&lt; std::endl;<span class="comment">//è¿™é‡Œptrå’Œ&amp;a[0]è¾“å‡ºçš„ç›¸åŒ</span></span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;ptrçš„åœ°å€ä¸ºï¼š&quot;</span> &lt;&lt; pptr &lt;&lt; std::endl;<span class="comment">//è¿™é‡Œè¾“å‡ºptrçš„åœ°å€</span></span><br><span class="line">std::cout &lt;&lt; *pptr &lt;&lt; std::endl;<span class="comment">//*pptrè§£å¼•ç”¨pptrï¼Œå¾—åˆ°ptrçš„å€¼ï¼Œå³a[0]åœ°å€</span></span><br><span class="line">std::cout &lt;&lt; **pptr &lt;&lt; std::endl;<span class="comment">//**pptrè¿›ä¸€æ­¥è§£å¼•ç”¨ï¼Œå¾—åˆ°a[0]çš„å€¼</span></span><br><span class="line"></span><br><span class="line">*pptr = &amp;a[<span class="number">1</span>];</span><br><span class="line">std::cout &lt;&lt; *pptr &lt;&lt; std::endl;<span class="comment">//ä½¿ç”¨*pptræŠŠptrçš„å€¼æ”¹æˆa[1]æ•°ç»„çš„å†…å­˜åœ°å€</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç±»ä¼¼çš„ï¼Œå¯ä»¥å®šä¹‰ä¸‹é¢è¿™ç§</span></span><br><span class="line"><span class="type">int</span>*** ppptr&#123; &amp;pptr &#125;;</span><br><span class="line">std::cout &lt;&lt; ***ppptr &lt;&lt; std::endl;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;------------åˆ†ç•Œçº¿----------------&quot;</span> &lt;&lt; std::endl;</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/11/13/6734530db4262.png"></p><p><strong>å¸¸é‡æŒ‡é’ˆ</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//const å˜é‡ç±»å‹*  åªèƒ½æŒ‡å‘ä¸€ä¸ªå¸¸é‡</span></span><br><span class="line"><span class="comment">// ç‰¹ç‚¹ï¼ŒæŒ‡é’ˆçš„æŒ‡å‘å¯ä»¥ä¿®æ”¹ï¼Œä½†æ˜¯æŒ‡é’ˆæŒ‡å‘çš„å€¼ä¸å¯ä»¥ä¿®æ”¹</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> a&#123; <span class="number">100</span> &#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> b&#123; <span class="number">200</span> &#125;;</span><br><span class="line"><span class="type">int</span> c&#123; <span class="number">300</span> &#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span>* p&#123; &amp;a &#125;;</span><br><span class="line"><span class="comment">// *p = 500;  ä¸å¯ä»¥ä¿®æ”¹å€¼</span></span><br><span class="line">std::cout &lt;&lt; *p &lt;&lt; std::endl;</span><br><span class="line">p = &amp;b;  <span class="comment">// å¯ä»¥ä¿®æ”¹æŒ‡å‘</span></span><br><span class="line">p = &amp;c;  <span class="comment">// å¸¸é‡æŒ‡é’ˆä¹Ÿå¯ä»¥æŒ‡å‘éå¸¸é‡å˜é‡</span></span><br><span class="line"><span class="comment">// *p = 2000;  å¸¸é‡æŒ‡é’ˆå°±æ˜¯ä¸è®©æ”¹</span></span><br></pre></td></tr></table></figure><p><strong>æŒ‡é’ˆå¸¸é‡</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç‰¹ç‚¹ï¼šæŒ‡é’ˆçš„æŒ‡å‘ä¸å¯ä»¥æ”¹ï¼ŒæŒ‡é’ˆæŒ‡å‘çš„å€¼å¯ä»¥æ”¹ï¼ˆå†…å­˜ä¸­çš„æ•°æ®å¯ä»¥æ›´æ”¹ï¼‰</span></span><br><span class="line"><span class="type">int</span> a&#123; <span class="number">100</span> &#125;;</span><br><span class="line"><span class="type">int</span> b&#123; <span class="number">200</span> &#125;;</span><br><span class="line"><span class="type">int</span>* <span class="type">const</span> p&#123; &amp;a &#125;;</span><br><span class="line"><span class="comment">//p = &amp;b;   ä¸èƒ½ä¿®æ”¹æŒ‡å‘</span></span><br><span class="line">*p = <span class="number">999</span>;  <span class="comment">//å¯ä»¥ä¿®æ”¹æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜ç©ºé—´</span></span><br><span class="line">std::cout &lt;&lt; a &lt;&lt; std::endl; <span class="comment">//  è¿™æ—¶å€™aè¾“å‡º 999ï¼›</span></span><br></pre></td></tr></table></figure><p><strong>æŒ‡å‘å¸¸é‡çš„å¸¸é‡æŒ‡é’ˆ</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//const å˜é‡ç±»å‹* const</span></span><br><span class="line"><span class="comment">//ç‰¹ç‚¹ï¼šæŒ‡é’ˆçš„æŒ‡å‘å’ŒæŒ‡é’ˆæŒ‡å‘çš„å€¼éƒ½ä¸å¯ä»¥ä¿®æ”¹ </span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> a&#123; <span class="number">100</span> &#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> b&#123; <span class="number">200</span> &#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span>* <span class="type">const</span> p&#123; &amp;a &#125;;</span><br><span class="line"><span class="comment">//p = &amp;b;  ä¸èƒ½ä¿®æ”¹æŒ‡å‘</span></span><br><span class="line"><span class="comment">//*p = 999;  ä¸èƒ½ä¿®æ”¹å†…å­˜ç©ºé—´é‡Œé¢çš„å€¼</span></span><br></pre></td></tr></table></figure><p><strong>è¡¥å……ï¼ˆæŒ‡é’ˆæœ‰å…³çš„ç±»å‹è½¬æ¢ ï¼‰</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> a&#123; <span class="number">100</span> &#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> b&#123; <span class="number">200</span> &#125;;</span><br><span class="line"><span class="comment">//int* pa&#123; &amp;a &#125;;   å¸¸é‡</span></span><br><span class="line"><span class="type">int</span>* pa&#123; (<span class="type">int</span>*)&amp;a &#125;;   <span class="comment">//é€šè¿‡è½¬æ¢æ˜¯å¯ä»¥çš„</span></span><br><span class="line">*p = <span class="number">9500</span>;<span class="comment">//è¿™ç§æ“ä½œæ˜¯å…è®¸çš„ï¼Œä½†æ˜¯açš„å€¼ä¸å˜</span></span><br><span class="line">std::cout &lt;&lt; *pa &lt;&lt; std::endl;</span><br></pre></td></tr></table></figure><p><strong>æŒ‡é’ˆæ•°ç»„è¡¥å……</strong></p><p>æŒ‡é’ˆæ•°ç»„æ˜¯<strong>ä¸€ä¸ªæ•°ç»„</strong>ï¼Œæ•°ç»„çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯æŒ‡é’ˆã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>* p[<span class="number">5</span>];</span><br></pre></td></tr></table></figure><p> p æ˜¯ä¸€ä¸ªåŒ…å«5ä¸ªæŒ‡é’ˆçš„æ•°ç»„ã€‚  æ¯ä¸ªæŒ‡é’ˆå¯ä»¥æŒ‡å‘ä¸€ä¸ªintç±»å‹çš„å˜é‡ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = <span class="number">10</span>, b = <span class="number">20</span>, c = <span class="number">30</span>;</span><br><span class="line"><span class="type">int</span>* p[<span class="number">3</span>];</span><br><span class="line">p[<span class="number">0</span>] = &amp;a;</span><br><span class="line">p[<span class="number">1</span>] = &amp;b;</span><br><span class="line">p[<span class="number">2</span>] = &amp;c;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡æŒ‡é’ˆæ•°ç»„æ¥è®¿é—®å˜é‡ã€‚</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;a = %d, b = %d, c = %d&quot;</span>, *p[<span class="number">0</span>], *p[<span class="number">1</span>], *p[<span class="number">2</span>]);</span><br><span class="line"><span class="comment">// p[0] æ˜¯ç¬¬ä¸€ä¸ªæŒ‡é’ˆï¼Œ *p[0] åˆ™è®¿é—®æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹ã€‚</span></span><br></pre></td></tr></table></figure><p>æ•°ç»„æŒ‡é’ˆ æ˜¯<strong>ä¸€ä¸ªæŒ‡é’ˆ</strong>ï¼Œå®ƒæŒ‡å‘ä¸€ä¸ªæ•°ç»„ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> (*p)[<span class="number">5</span>];</span><br></pre></td></tr></table></figure><p>p æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘åŒ…å«5ä¸ªæ•´å‹å…ƒç´ çš„æ•°ç»„ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a[<span class="number">5</span>] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line"><span class="built_in">int</span> (*p)[<span class="number">5</span>];</span><br><span class="line">p = &amp;a;   <span class="comment">// p æŒ‡å‘ æ•°ç»„ a</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™æ ·æ¥è®¿é—®æ•°ç»„ </span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;First element: %d\n&quot;</span>, (*p)[<span class="number">0</span>]);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Second element: %d\n&quot;</span>, (*p)[<span class="number">1</span>]);</span><br></pre></td></tr></table></figure><p>æ•°ç»„æŒ‡é’ˆæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘æ•´ä¸ªæ•°ç»„ã€‚</p><p>ä½¿ç”¨*p è§£å¼•ç”¨æ•°ç»„æŒ‡é’ˆï¼Œå¯ä»¥è·å¾—æ•°ç»„æœ¬èº«ï¼Œ ç„¶åå¯ä»¥é€šè¿‡ä¸‹æ ‡æ“ä½œè®¿é—®æ•°ç»„å…ƒç´ ã€‚</p><p>æ•°ç»„æŒ‡é’ˆåœ¨å¤šç»´æ•°ç»„æ“ä½œä¸­éå¸¸å¸¸ç”¨ã€‚  </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a[<span class="number">5</span>]&#123; <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span> &#125;;</span><br><span class="line"><span class="type">int</span>* ptrA&#123; a &#125;;</span><br><span class="line"><span class="type">int</span>* ptrB&#123; &amp;a[<span class="number">0</span>] &#125;;   <span class="comment">//ä»æ±‡ç¼–è¯­è¨€å¾—å‡ºï¼Œaæ”¾çš„å°±æ˜¯a[0]çš„åœ°å€</span></span><br><span class="line"><span class="type">int</span>* ptrC&#123; a + <span class="number">1</span> &#125;;</span><br><span class="line"></span><br><span class="line">std::cout &lt;&lt; ptrC[<span class="number">1</span>] &lt;&lt; std::endl;  <span class="comment">//è¾“å‡ºçš„ æ˜¯3</span></span><br><span class="line">std::cout &lt;&lt; ptrA[<span class="number">1</span>] &lt;&lt; std::endl;  <span class="comment">//ä¹Ÿå¯ä»¥è¿™æ ·è®¿é—®a[1]</span></span><br><span class="line">std::cout &lt;&lt; <span class="built_in">sizeof</span>(a) &lt;&lt;std::endl;  <span class="comment">//è¾“å‡ºå¤§å°æ˜¯20  å¤„ç†açš„æ—¶å€™æŠŠå®ƒå½“ä½œæ•°ç»„å¤„ç†</span></span><br><span class="line">std::cout &lt;&lt; <span class="built_in">sizeof</span>(ptrA) &lt;&lt;std::endl; <span class="comment">//è¾“å‡ºå¤§å°æ˜¯4</span></span><br><span class="line"><span class="comment">//åº•å±‚æ¥è¯´aæ˜¯ä¸ªæŒ‡é’ˆï¼Œæ˜é¢ä¸Šè¿˜æ˜¯æ•°ç»„</span></span><br><span class="line"><span class="comment">//æŒ‡é’ˆå¯ä»¥å½“æ•°ç»„æ¥ç”¨ï¼Œæ•°ç»„å¯ä»¥å½“æŒ‡é’ˆæ¥è¯»</span></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¤šç»´æ•°ç»„åœ¨å†…å­˜ä¸­ä¸å­˜åœ¨ï¼Œåªæ˜¯æˆ‘ä»¬å‘Šè¯‰å†…å­˜è¿™ä¹ˆè®¿é—®è€Œå·²</span></span><br><span class="line"><span class="type">int</span> test[<span class="number">2</span>][<span class="number">5</span>]</span><br><span class="line">&#123;</span><br><span class="line">&#123;<span class="number">1001</span>,<span class="number">1002</span>,<span class="number">1003</span>,<span class="number">1004</span>,<span class="number">1005</span>&#125;,</span><br><span class="line">&#123;<span class="number">2001</span>,<span class="number">2002</span>,<span class="number">2003</span>,<span class="number">2004</span>,<span class="number">2005</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span>* ptest&#123; (<span class="type">int</span>*)test &#125;;</span><br><span class="line">std::cout &lt;&lt; test[<span class="number">1</span>][<span class="number">4</span>] &lt;&lt; std::endl;</span><br><span class="line">std::cout &lt;&lt; ptest[<span class="number">9</span>] &lt;&lt; std::endl;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> test[<span class="number">2</span>][<span class="number">5</span>]</span><br><span class="line">&#123;</span><br><span class="line">&#123;<span class="number">1001</span>,<span class="number">1002</span>,<span class="number">1003</span>,<span class="number">1004</span>,<span class="number">1005</span>&#125;,</span><br><span class="line">&#123;<span class="number">2001</span>,<span class="number">2002</span>,<span class="number">2003</span>,<span class="number">2004</span>,<span class="number">2005</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span>* ptestA[<span class="number">5</span>]; <span class="comment">//  æŒ‡é’ˆæ•°ç»„ï¼Œ  5ä¸ªintç±»å‹çš„æŒ‡é’ˆ</span></span><br><span class="line"><span class="built_in">int</span> (*ptest)[<span class="number">5</span>]&#123;test&#125;;<span class="comment">//  é¦–å…ˆæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œç±»å‹æ˜¯æ•°ç»„æŒ‡é’ˆï¼Œæ¯ä¸€è¡Œèƒ½å­˜å‚¨5ä¸ªæ•°æ®</span></span><br><span class="line">ptest = ptest + <span class="number">1</span>;</span><br><span class="line">std::cout &lt;&lt; ptest &lt;&lt; std::endl; <span class="comment">//æ¯”åŸæ¥å¢åŠ äº†6 * int çš„å¤§å°ï¼Œå› ä¸ºptestæ˜¯ä¸ªæ•°ç»„æŒ‡é’ˆï¼Œé€»è¾‘æ˜¯6</span></span><br><span class="line">std::cout &lt;&lt; ptest[<span class="number">0</span>][<span class="number">1</span>] &lt;&lt; std::endl; <span class="comment">//æ•°ç»„æŒ‡é’ˆå¯ä»¥ä½¿ç”¨äºŒç»´æ•°ç»„çš„æ–¹å¼è®¿é—®æ•°æ®</span></span><br><span class="line">std::cout &lt;&lt; <span class="built_in">sizeof</span>(ptest) &lt;&lt; std::endl;  <span class="comment">//å¤§å°æ˜¯4å­—èŠ‚ ï¼Œæ‰€ä»¥ptestå°±æ˜¯ä¸ªæŒ‡é’ˆï¼Œä¸æ˜¯æ•°ç»„</span></span><br></pre></td></tr></table></figure><p><strong>æ•°ç»„å†è¡¥å……</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> test[<span class="number">2</span>][<span class="number">5</span>]</span><br><span class="line">&#123;</span><br><span class="line">&#123;<span class="number">1001</span>,<span class="number">1002</span>,<span class="number">1003</span>,<span class="number">1004</span>,<span class="number">1005</span>&#125;,</span><br><span class="line">&#123;<span class="number">2001</span>,<span class="number">2002</span>,<span class="number">2003</span>,<span class="number">2004</span>,<span class="number">2005</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">std::cout &lt;&lt; test[<span class="number">0</span>] &lt;&lt; std::endl; <span class="comment">//è¿™æ˜¯ä¸ªåœ°å€</span></span><br><span class="line"><span class="comment">//a + [] * int</span></span><br></pre></td></tr></table></figure><p><strong>Cè¯­è¨€å†…å­˜åˆ†é…</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>* p = (<span class="type">int</span>*)<span class="built_in">malloc</span>(x * <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line"><span class="type">int</span>* pa = (<span class="type">int</span>*)<span class="built_in">calloc</span>(x, <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;------------------------&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"><span class="type">int</span>* p = (<span class="type">int</span>*)<span class="built_in">malloc</span>(<span class="number">4</span>);</span><br><span class="line">p = (<span class="type">int</span>*)<span class="built_in">realloc</span>(p, <span class="number">8</span>);  <span class="comment">//é‡æ–°åˆ†é…äº†å¤§å°,åŸæ¥è¾“å…¥çš„å€¼è¿˜åœ¨</span></span><br><span class="line"><span class="comment">//åŸæ¥åˆ†é…äº†100ï¼Œåé¢æ›´æ”¹ä¸º50ï¼Œé‚£å†…å­˜åœ°å€ä¸ä¼šå˜</span></span><br><span class="line"><span class="comment">//åŸæ¥åˆ†é…äº†100ï¼Œåé¢æ”¹æˆ200ï¼Œå†…å­˜åœ°å€ä¼šå˜ï¼Œä½†æ˜¯ä¼šæŠŠåŸæ¥çš„å†…å­˜çš„å†…å®¹æ‹·è´åˆ°æ–°çš„å†…å­˜ä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">free</span>(p);</span><br><span class="line"><span class="built_in">free</span>(pa);</span><br><span class="line"></span><br><span class="line"><span class="comment">//p å’Œ paçš„å€¼æˆäº†æ‚¬æŒ‚æŒ‡é’ˆï¼Œ</span></span><br><span class="line"><span class="comment">//æ‰€ä»¥freeä¹‹åæ”¹æˆp = 0, pa = 0;</span></span><br></pre></td></tr></table></figure><p><strong>C++å†…å­˜åˆ†é…</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ•°æ®ç±»å‹* æŒ‡é’ˆå˜é‡åç§° = new æ•°æ®ç±»å‹;</span></span><br><span class="line"><span class="type">int</span>* pa = <span class="keyword">new</span> <span class="type">int</span>;</span><br><span class="line"><span class="comment">//æ•°æ®ç±»å‹* æŒ‡é’ˆå˜é‡åç§° = new æ•°æ®ç±»å‹[æ•°é‡];</span></span><br><span class="line"><span class="type">int</span>* p = <span class="keyword">new</span> <span class="type">int</span>[<span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">---------------------------------------------------</span><br><span class="line">p = <span class="keyword">new</span> <span class="type">int</span>[x];</span><br><span class="line">*p = <span class="number">500</span>;</span><br><span class="line">p[<span class="number">0</span>] = <span class="number">500</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸¤ç§é‡Šæ”¾å†…å­˜çš„æ–¹å¼ï¼Œä¸è¦æ··ç”¨</span></span><br><span class="line"><span class="keyword">delete</span> pa;</span><br><span class="line"><span class="keyword">delete</span>[] p;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--------------------------------------------------</span><br><span class="line"><span class="comment">//å†…å­˜å¤åˆ¶</span></span><br><span class="line"><span class="type">int</span> a[<span class="number">5</span>]&#123;<span class="number">1001</span>,<span class="number">1002</span>,<span class="number">1003</span>,<span class="number">1004</span>,<span class="number">1005</span>&#125;;</span><br><span class="line"><span class="type">int</span>* p = <span class="keyword">new</span> <span class="type">int</span>[<span class="number">5</span>];</span><br><span class="line"><span class="built_in">memcpy</span>(p,a,<span class="number">5</span>*<span class="built_in">sizeof</span>(<span class="type">int</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//è®¾ç½®å†…å­˜</span></span><br><span class="line"><span class="comment">//memset å¯ä»¥æŒ‡å®šå†…å­˜åŒºåŸŸæ¯ä¸€ä¸ªå­—èŠ‚çš„å€¼éƒ½è®¾ç½®ä¸ºval,</span></span><br><span class="line"><span class="type">int</span>* pa = <span class="keyword">new</span> <span class="type">int</span>[<span class="number">100</span>];</span><br><span class="line"><span class="comment">//è¿™é‡Œå°±æ˜¯è®¾ç½®æˆ0 äº†</span></span><br><span class="line"><span class="built_in">memset</span>(p,<span class="number">0</span>,<span class="number">100</span>*<span class="built_in">sizeof</span>(<span class="type">int</span>));</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">meeset</span><span class="params">(<span class="type">void</span>* _dst, <span class="type">int</span> val, <span class="type">size_t</span> size)</span></span></span><br><span class="line"><span class="function"><span class="comment">// valèŒƒå›´æ˜¯0x 00 --- 0x ff   å¦‚æœè®¾ç½®0x1234ï¼Œé‚£ä¹ˆåªä¼šä¿å­˜34</span></span></span><br><span class="line"><span class="function"><span class="comment">//memsetå¯ä»¥å°†æŒ‡å®šå†…å­˜åŒºåŸŸæ¯ä¸€ä¸ªå­—èŠ‚éƒ½è®¾ç½®ä¸ºvalï¼Œ_sizeä¸ºè¦è®¾ç½®çš„é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰</span></span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨åŠ¨æ€å†…å­˜åˆ†é…é£é™©</p><p>å¦‚æœé‡Šæ”¾å†…å­˜åæ²¡æœ‰æ¸…é›¶ï¼Œå¾ˆå±é™©ï¼Œä½¿ç”¨newå¯èƒ½ä¼šæŠ¥é”™</p><p>é‡å¤é‡Šæ”¾</p><p>å†…å­˜ç¢ç‰‡</p><p>ä¸æ¨èCè¯­è¨€å’ŒC++é‡Šæ”¾å†…å­˜çš„è¯­å¥æ··ç”¨</p><p><strong>å¼•ç”¨</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ•°æ®ç±»å‹&amp; å˜é‡åç§°&#123;å¼•ç”¨å¯¹è±¡çš„åç§°&#125;;</span></span><br><span class="line"><span class="comment">//å¼•ç”¨ç±»å‹ä¸€å®šè¦åˆå§‹åŒ–ï¼Œå°±ç›¸å½“äºä¸€ä¸ªåˆ«å</span></span><br><span class="line"><span class="type">int</span> a&#123;<span class="number">500</span>&#125;;</span><br><span class="line"><span class="type">int</span> b&#123;<span class="number">100</span>&#125;;</span><br><span class="line"><span class="type">int</span>&amp; la&#123;a&#125;;</span><br><span class="line">la = <span class="number">500</span>; <span class="comment">// ç›¸å½“äº a = 500;</span></span><br><span class="line"><span class="comment">//å®ƒä»¬æ‰€æœ‰çš„åœ°å€éƒ½æ˜¯ä¸€æ ·çš„</span></span><br><span class="line"><span class="comment">//å¼•ç”¨è®¾ç½®ä¹‹åå°±ä¸èƒ½æ›´æ”¹äº†</span></span><br><span class="line"></span><br><span class="line">la = b; <span class="comment">// a çš„å€¼ç¼–ç¨‹äº†100</span></span><br></pre></td></tr></table></figure><p><strong>æ™ºèƒ½æŒ‡é’ˆ</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">std::unique_ptr&lt;<span class="type">int</span>[]&gt; intPtr&#123;std::<span class="built_in">make_unique</span>&lt;<span class="type">int</span>[]&gt;(<span class="number">5</span>)&#125;;  <span class="comment">// æ˜¯æœ‰äº”ä¸ªè¿™ç§å˜é‡</span></span><br><span class="line">std::unique_ptr&lt;<span class="type">int</span>&gt; intPtrA&#123;std::<span class="built_in">make_unique</span>&lt;<span class="type">int</span>&gt;(<span class="number">5</span>)&#125;;     <span class="comment">// æŠŠæŒ‡é’ˆåˆå§‹åŒ–ä¸º5</span></span><br><span class="line"></span><br><span class="line">intPtr.<span class="built_in">reset</span>();  <span class="comment">// å°†æŒ‡é’ˆåœ°å€æ¸…é›¶ï¼Œç„¶åæŠŠå†…å­˜ç©ºé—´è¿˜ç»™æ“ä½œç³»ç»Ÿ</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span>* a = <span class="keyword">new</span> <span class="type">int</span>[<span class="number">5</span>];</span><br><span class="line">a = intPtr.<span class="built_in">get</span>();  <span class="comment">// å°†intPtrçš„å†…å­˜åœ°å€èµ‹å€¼ç»™a</span></span><br><span class="line"></span><br><span class="line">a = intPtr.<span class="built_in">release</span>();  <span class="comment">// æŠŠæŒ‡é’ˆè®¾ç½®ä¸º0ï¼Œä½†è¿˜ä¼šèŒƒå›´å ç”¨å†…å­˜çš„åœ°å€</span></span><br></pre></td></tr></table></figure><p><strong>æ™ºèƒ½æŒ‡é’ˆçš„è½¬ç§»</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">std::unique_ptr&lt;<span class="type">int</span>[]&gt; intPtr&#123;std::<span class="built_in">make_unique</span>&lt;<span class="type">int</span>[]&gt;(<span class="number">5</span>)&#125;; </span><br><span class="line">std::unique_ptr&lt;<span class="type">int</span>[]&gt; intPtrA&#123;&#125;;  </span><br><span class="line"></span><br><span class="line">intPtrA = std::<span class="built_in">move</span>(intPtr);  <span class="comment">// intPtrè¢«æ¸…é›¶äº†ï¼Œå¤±æ•ˆäº†ï¼ŒintPtrAæŒ‡å‘åŸæ¥intPtræŒ‡å‘çš„ä½ç½®</span></span><br></pre></td></tr></table></figure><p><strong>å…±äº«æ™ºèƒ½æŒ‡é’ˆ</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>* a&#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¯­æ³•</span></span><br><span class="line">std::shared_ptr&lt;ç±»å‹&gt; å˜é‡åç§°&#123;&#125;;</span><br><span class="line">std::shared_ptr&lt;<span class="type">int</span>&gt; ptrA&#123;&#125;; <span class="comment">// è®¾ç½®ä¸ºç©º</span></span><br><span class="line">std::shared_ptr&lt;<span class="type">int</span>&gt; ptrB&#123;std::<span class="built_in">make_shared</span>&lt;<span class="type">int</span>&gt;(<span class="number">5</span>)&#125;; <span class="comment">//å°†è¿™ä¸ªæŒ‡é’ˆåˆå§‹åŒ–ä¸º5</span></span><br><span class="line"><span class="comment">//std::make_sharedä¸æ”¯æŒæ•°ç»„</span></span><br><span class="line">std::shared_ptr&lt;<span class="type">int</span>[]&gt; ptrC&#123;<span class="keyword">new</span> <span class="type">int</span>[<span class="number">5</span>]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;&#125;;</span><br><span class="line">std::cout &lt;&lt; ptrA &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; ptrC[<span class="number">0</span>] &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; *ptrB;</span><br><span class="line"><span class="comment">/*----------------------------------------------------*/</span></span><br><span class="line"><span class="comment">//å¦‚ä½•å…±äº«</span></span><br><span class="line">std::shared_ptr&lt;<span class="type">int</span>&gt; ptrA&#123;std::<span class="built_in">make_shared</span>&lt;<span class="type">int</span>&gt;(<span class="number">5</span>)&#125;;</span><br><span class="line">std::shared_ptr&lt;<span class="type">int</span>&gt; ptrB&#123;ptrA&#125;;</span><br><span class="line"><span class="comment">//ä¸¤ä¸ªæŒ‡é’ˆå¯ä»¥æŒ‡å‘åŒä¸€ä¸ªåœ°æ–¹</span></span><br><span class="line">std::cout &lt;&lt; ptrB &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; *ptrB &lt;&lt; std::endl;</span><br><span class="line">std::cout &lt;&lt; ptrA &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; *ptrA;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‡è®¾æœ‰  A  B C  ä¸‰ä¸ªæŒ‡é’ˆæŒ‡å‘è¿™å—åŒºåŸŸï¼Œåªæœ‰å½“æ‰€æœ‰çš„æŒ‡é’ˆéƒ½é‡Šæ”¾äº†ï¼Œæ‰ä¼šé‡Šæ”¾å†…å­˜ç©ºé—´</span></span><br><span class="line"><span class="comment">// ä¼šæœ‰ä¸€ä¸ªè®¡æ•°å™¨ï¼Œæ¥è®°å½•æœ‰å‡ ä¸ªæŒ‡é’ˆæŒ‡å‘è¿™å—åŒºåŸŸ</span></span><br><span class="line"><span class="type">long</span> std::shared_ptr.<span class="built_in">use_count</span>(); <span class="comment">// .use_count() ä¼šè¿”å›å½“å‰æŒ‡é’ˆå…±æœ‰å¤šå°‘ä¸ªå¯¹è±¡è°ƒç”¨</span></span><br><span class="line"></span><br><span class="line">std::cout &lt;&lt; ptrA.<span class="built_in">use_count</span>() &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¼šå°†å½“å‰å…±äº«æŒ‡é’ˆè®¾ç½®ä¸ºç©ºï¼ŒåŒæ—¶å¦‚æœå½“å‰æ™ºèƒ½æŒ‡é’ˆæ˜¯æœ€åä¸€ä¸ªæ‹¥æœ‰è¯¥æŒ‡é’ˆçš„å¯¹è±¡ï¼Œé‚£ä¹ˆå°†é‡Šæ”¾å†…å­˜ã€‚</span></span><br><span class="line">std::shared_ptr.<span class="built_in">reset</span>();</span><br><span class="line"></span><br><span class="line">ptrB.<span class="built_in">reset</span>();</span><br><span class="line">std::cout &lt;&lt; ptrB &lt;&lt; <span class="string">&quot; &quot;</span>;<span class="comment">//*ptrBä½¿ç”¨ä¸äº†ï¼Œå› ä¸ºè¢«é‡Šæ”¾äº†</span></span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/11/16/67389b688486f.png"></p><p><strong>æŒ‡é’ˆå’Œç»“æ„ä½“</strong></p><p>é€šè¿‡æŒ‡é’ˆè®¿é—®è‡ªå®šä¹‰æ•°æ®ç±»å‹ï¼ˆåŸºç¡€éƒ¨åˆ†ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">Role</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> HP;</span><br><span class="line">    <span class="type">int</span> MP;</span><br><span class="line">&#125;* PRole;</span><br><span class="line"><span class="comment">// ä¸Šé¢ä¸å†™*å·ç›¸å½“äºç»™Roleæ”¹äº†ä¸ªåå­—ï¼Œå†™äº†*å·å°±æ˜¯ç±»å‹æŒ‡é’ˆçš„æ„æ€</span></span><br><span class="line"><span class="comment">//ä»¥å‰å£°æ˜æŒ‡é’ˆéœ€è¦Role*    ç°åœ¨åªéœ€è¦PRoleå³å¯</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Role user;</span><br><span class="line">    PRole puser = &amp;user;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//  ä½¿ç”¨æŒ‡é’ˆåç§»æ¥è®¿é—®æ•°æ®</span></span><br><span class="line">    puser-&gt;HP = <span class="number">50</span>;</span><br><span class="line">    puser-&gt;MP = <span class="number">100</span>;</span><br><span class="line">    user.HP = <span class="number">50</span>;</span><br><span class="line">    user.MP = <span class="number">50</span>;</span><br><span class="line">    std::cout &lt;&lt; (*puser).HP &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; puser-&gt;HP &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å†…å­˜å¯¹é½é—®é¢˜</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">Role</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> op;</span><br><span class="line">    <span class="type">int</span> HP;</span><br><span class="line">    <span class="type">int</span> MP;</span><br><span class="line">    <span class="type">short</span> x;</span><br><span class="line">    <span class="type">short</span> x1;</span><br><span class="line">&#125;* PRole;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Role user;</span><br><span class="line">    PRole puser = &amp;user;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">sizeof</span>(Role);</span><br><span class="line">    <span class="comment">// æ³¨é”€æ‰ x1 å’Œä¸æ³¨é”€ x1 çš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œæ¶‰åŠåˆ°å†…å­˜å¯¹é½é—®é¢˜ã€‚</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†…å­˜å¯¹é½æ˜¯æŒ‡åœ¨å†…å­˜ä¸­å­˜å‚¨æ•°æ®æ—¶ï¼Œæ•°æ®çš„èµ·å§‹åœ°å€æŒ‰ç‰¹å®šçš„è§„åˆ™å¯¹é½ï¼Œè€Œä¸æ˜¯ä»»æ„çš„å†…å­˜åœ°å€ã€‚</p><ul><li>ç›®çš„ï¼šæé«˜ CPU è®¿é—®å†…å­˜çš„æ•ˆç‡ï¼Œå› ä¸ºç°ä»£ CPU é€šå¸¸æŒ‰å­—èŠ‚ã€å­—æˆ–æ›´å¤§å•ä½ï¼ˆå¦‚ 4 å­—èŠ‚æˆ– 8 å­—èŠ‚ï¼‰è¯»å–å†…å­˜ã€‚</li><li>ç»“æœï¼šå¯èƒ½ä¼šåœ¨æ•°æ®ä¹‹é—´å¼•å…¥å¡«å……å­—èŠ‚ï¼ˆpaddingï¼‰ï¼Œä»¥æ»¡è¶³å¯¹é½è§„åˆ™</li></ul><p>å¯¹é½åŸåˆ™</p><p>æ¯ä¸ªæˆå‘˜çš„åœ°å€å¿…é¡»æ˜¯<strong>å¯¹é½ç³»æ•°</strong>çš„æ•´æ•°å€ã€‚</p><ul><li>å¯¹é½ç³»æ•° &#x3D; <strong>æˆå‘˜å¤§å°</strong> æˆ– <strong>é»˜è®¤å¯¹é½æ•°</strong>ï¼Œå–è¾ƒå°å€¼ã€‚</li></ul><p>ç»“æ„ä½“æ€»å¤§å°å¿…é¡»æ˜¯<strong>ç»“æ„ä½“æœ€å¤§å¯¹é½ç³»æ•°</strong>çš„å€æ•°ã€‚</p><p><u>æŒ‡å®šå‡ ä¸ªå­—èŠ‚å¯¹é½</u></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> pack(2)  <span class="comment">// æŒ‡å®š 2 å­—èŠ‚å¯¹é½</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> a;</span><br><span class="line">    <span class="type">int</span> b;</span><br><span class="line">    <span class="type">short</span> c;</span><br><span class="line">&#125;PackedExample;</span><br><span class="line"><span class="meta">#packma pack(); <span class="comment">// æ¢å¤é»˜è®¤å¯¹é½</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç›´æ¥è¾“å‡ºè¿™ä¸ªç»“æ„ä½“å æ®çš„å¤§å°</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;sizeof(PackedExample): %zu\n&quot;</span>, <span class="built_in">sizeof</span>(PackedExample));</span><br></pre></td></tr></table></figure><p><strong>æŒ‡é’ˆå®‰å…¨</strong></p><p>æ‚¬æŒ‚æŒ‡é’ˆå’Œé‡æŒ‡é’ˆ</p><ol><li><p><strong>æ‚¬æŒ‚æŒ‡é’ˆ</strong>: æ‚¬æŒ‚æŒ‡é’ˆäº§ç”ŸäºæŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å­˜å·²è¢«é‡Šæ”¾æˆ–è€…å¤±æ•ˆåï¼ŒæŒ‡é’ˆæœ¬èº«æ²¡æœ‰åŠæ—¶æ›´æ–°æˆ–æ¸…ç©ºã€‚åœ¨è¯¥å†…å­˜é‡Šæ”¾ä¹‹åï¼Œä»»ä½•é€šè¿‡è¿™ä¸ªæ‚¬æŒ‚æŒ‡é’ˆçš„å¼•ç”¨æˆ–æ“ä½œéƒ½æ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºè¿™å—å†…å­˜å¯èƒ½å·²ç»é‡æ–°åˆ†é…ç»™äº†å…¶ä»–çš„æ•°æ®ã€‚</p><p>ç¤ºä¾‹ï¼šå½“ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘åŠ¨æ€åˆ†é…ï¼ˆæ¯”å¦‚ä½¿ç”¨<code>malloc</code>æˆ–<code>new</code>ï¼‰çš„å†…å­˜ï¼Œå¹¶ä¸”éšåè¯¥å†…å­˜è¢«é‡Šæ”¾æ‰ï¼ˆä½¿ç”¨<code>free</code>æˆ–<code>delete</code>ï¼‰ï¼Œè€Œæ²¡æœ‰å°†æŒ‡é’ˆè®¾ç½®ä¸º<code>NULL</code>ï¼Œæ­¤æ—¶è¿™ä¸ªæŒ‡é’ˆå°±å˜æˆäº†æ‚¬æŒ‚æŒ‡é’ˆã€‚</p></li><li><p><strong>é‡æŒ‡é’ˆ</strong>: é‡æŒ‡é’ˆé€šå¸¸æ˜¯æŒ‡æœªåˆå§‹åŒ–çš„æŒ‡é’ˆï¼Œå®ƒæ²¡æœ‰è¢«è®¾ç½®ä¸ºä»»ä½•æœ‰æ•ˆçš„åœ°å€ã€‚ç”±äºå®ƒå¯èƒ½æŒ‡å‘ä»»æ„ä½ç½®ï¼Œå¯¹é‡æŒ‡é’ˆçš„è§£å¼•ç”¨æ˜¯å±é™©çš„ï¼Œå¹¶ä¸”å¯èƒ½ä¼šå¯¼è‡´éš¾ä»¥é¢„æµ‹çš„è¡Œä¸ºç”šè‡³ç¨‹åºå´©æºƒã€‚</p><p>ç¤ºä¾‹ï¼šå£°æ˜äº†ä¸€ä¸ªæŒ‡é’ˆå˜é‡ä½†æ˜¯æ²¡æœ‰ç»™å®ƒèµ‹äºˆç¡®å®šçš„åˆå§‹å€¼ï¼Œç„¶åå°±å¼€å§‹ä½¿ç”¨è¿™ä¸ªæŒ‡é’ˆã€‚</p></li></ol><p>å°½ç®¡ä¸¤è€…çœ‹ä¼¼ç›¸ä¼¼ï¼Œä½†æ˜¯äº§ç”ŸåŸå› å’Œè§£å†³æ–¹å¼æœ‰æ‰€ä¸åŒï¼š</p><ul><li><strong>æ‚¬æŒ‚æŒ‡é’ˆé—®é¢˜</strong>å¯ä»¥é€šè¿‡ç¡®ä¿æŒ‡é’ˆåœ¨é‡Šæ”¾å…³è”çš„å†…å­˜èµ„æºåç«‹å³è¢«è®¾ä¸º<code>NULL</code>æ¥é¿å…ã€‚</li><li><strong>é‡æŒ‡é’ˆé—®é¢˜</strong>åˆ™éœ€è¦ç¡®ä¿æ¯ä¸ªæŒ‡é’ˆå˜é‡åœ¨ä½¿ç”¨å‰éƒ½è¢«æ˜ç¡®åˆå§‹åŒ–ä¸ºä¸€ä¸ªåˆæ³•çš„åœ°å€æˆ–<code>NULL</code>ã€‚</li></ul><p>å¤„ç†è¿™ä¸¤ç§ç±»å‹çš„æŒ‡é’ˆæ—¶ï¼Œç¼–ç¨‹ä¸­çš„æœ€ä½³å®è·µæ˜¯å§‹ç»ˆç¡®ä¿ä½ çš„æŒ‡é’ˆåœ¨å£°æ˜åå¾—åˆ°é€‚å½“çš„åˆå§‹åŒ–ï¼Œåœ¨èµ„æºè¢«é‡Šæ”¾ä¹‹åæ›´æ–°çŠ¶æ€ï¼Œå¹¶ä¸”åœ¨è§£å¼•ç”¨ä¹‹å‰æ£€æŸ¥å…¶æœ‰æ•ˆæ€§ã€‚</p><p>æŒ‡é’ˆå­˜åœ¨çš„ä¿©é—®é¢˜ï¼š</p><p>1ï¸âƒ£ æŒ‡é’ˆæ²¡æœ‰äº†ï¼Œå†…å­˜ç©ºé—´è¿˜åœ¨</p><p>2ï¸âƒ£ å†…å­˜ç©ºé—´é‡Šæ”¾äº†ï¼ŒæŒ‡é’ˆè¿˜æœ‰</p><p>é‡æŒ‡é’ˆï¼ˆæ‚¬æŒ‚æŒ‡é’ˆï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é‡æŒ‡é’ˆ</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span>* p;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span>* a = <span class="keyword">new</span> <span class="type">int</span>[<span class="number">5</span>];</span><br><span class="line">        p = a;</span><br><span class="line">        a[<span class="number">2</span>] = <span class="number">555</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::cout &lt;&lt; p[<span class="number">2</span>]; <span class="comment">// å†…å­˜ç©ºé—´è¿˜åœ¨ï¼Œæ²¡æœ‰é‡Šæ”¾</span></span><br><span class="line">    <span class="comment">// è¿™å°±æ˜¯é‡æŒ‡é’ˆ  ï¼ˆæ‚¬æŒ‚æŒ‡é’ˆï¼‰</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ”¹æ­£æ–¹æ³•ï¼šä½¿ç”¨ æ™ºèƒ½æŒ‡é’ˆ</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>* p;</span><br><span class="line">&#123;</span><br><span class="line">    std::unique_ptr&lt;<span class="type">int</span>[]&gt; a&#123; std::<span class="built_in">make_unique</span>&lt;<span class="type">int</span>[]&gt;(<span class="number">50</span>) &#125;;</span><br><span class="line">    a[<span class="number">2</span>] = <span class="number">250</span>;</span><br><span class="line">    p = a.<span class="built_in">get</span>();</span><br><span class="line">    std::cout &lt;&lt; p[<span class="number">2</span>];  <span class="comment">// è¾“å‡º250</span></span><br><span class="line">&#125; <span class="comment">// æ‹¬å·ç»“æŸåï¼Œå†…å­˜ç©ºé—´ä¼šé‡Šæ”¾æ‰</span></span><br><span class="line"></span><br><span class="line">std::cout &lt;&lt; p[<span class="number">2</span>]; <span class="comment">// è¾“å‡º-572662307,  è¯´æ˜å†…å­˜ç©ºé—´è¢«é‡Šæ”¾äº†</span></span><br></pre></td></tr></table></figure><p>å¦å¤–ä¸€ç§æƒ…å†µï¼Œå­˜åœ¨æ ˆé‡Œé¢ï¼Œæ‹¬å·  ä¹‹åæ ˆç©ºé—´æ²¡æœ‰è¢«å›æ”¶ï¼ˆå¦‚æœåˆ†é…åˆ°å‡½æ•°é‡Œé¢ï¼Œé‚£ä¹ˆå°±ä¸ä¼šå‡ºç°è¿™ç§é—®é¢˜ï¼‰</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>* p;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> a[<span class="number">5</span>]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line">    p = a;</span><br><span class="line">    std::cout &lt;&lt; p[<span class="number">0</span>] &lt;&lt; std::endl;  <span class="comment">// è¾“å‡º1</span></span><br><span class="line">&#125;</span><br><span class="line">std::cout &lt;&lt; p[<span class="number">0</span>] &lt;&lt; std::endl;  <span class="comment">// è¾“å‡º1</span></span><br></pre></td></tr></table></figure><p>å†…å­˜ç©ºé—´é‡Šæ”¾äº†ï¼Œä½†æ˜¯æŒ‡é’ˆè¿˜åœ¨</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>* p;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span>* a = <span class="keyword">new</span> <span class="type">int</span>[<span class="number">5</span>];</span><br><span class="line">    p = a;</span><br><span class="line">    std::cout &lt;&lt; p[<span class="number">0</span>] &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">delete</span>[] a;</span><br><span class="line">&#125;</span><br><span class="line">std::cout &lt;&lt; p[<span class="number">0</span>];   <span class="comment">// pæŒ‡é’ˆè¿˜åœ¨</span></span><br></pre></td></tr></table></figure><p>è¡¥å……çŸ¥è¯†ï¼š.get()å‡½æ•°</p><p>1ï¸âƒ£std::shared_ptr<code>å’Œ</code>std::unique_ptr    åœ¨æ™ºèƒ½æŒ‡é’ˆä¸­ï¼Œ.get() ç”¨äºè·å–æ‰€ç®¡ç†çš„åŸå§‹æŒ‡é’ˆã€‚è¿”å›æŒ‡æ­£æŒ‡é’ˆå†…éƒ¨æ‰€ç®¡ç†çš„åŸå§‹æŒ‡é’ˆï¼Œä½†ä¸ä¼šæ›´æ”¹å…¶æ‰€æœ‰æƒæˆ–è€…ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</p><p>2ï¸âƒ£åœ¨è¾“å…¥æµ(std::istream)ä¸­ï¼Œ.get()ç”¨äºä»è¾“å…¥æµä¸­è¯»å–å­—ç¬¦ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¨‹åºç¤ºä¾‹</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">std::istringstream <span class="title">input</span><span class="params">(<span class="string">&quot;HEllo World&quot;</span>)</span></span>;</span><br><span class="line"><span class="type">char</span> c;</span><br><span class="line"><span class="keyword">while</span> (input.<span class="built_in">get</span>(c))  std::cout &lt;&lt; c;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å †å’Œæ ˆ</strong></p><p>å †çš„æœ¬è´¨å°±æ˜¯ç©ºé—²å†…å­˜ï¼ŒC++ä¸­æŠŠå †ç§°ä¸ºè‡ªç”±å­˜å‚¨åŒºï¼Œåªè¦æ˜¯ä½ çš„ç¨‹åºåŠ è½½åï¼Œæ²¡æœ‰å ç”¨ç©ºé—²çš„å†…å­˜ï¼Œéƒ½æ˜¯è‡ªç”±å­˜å‚¨åŒºï¼Œæˆ‘ä»¬ç”¨newæˆ–è€…mallocç”³è¯·çš„ä¸€å—æ–°å†…å­˜åŒºåŸŸï¼Œéƒ½æ˜¯æ“ä½œç³»ç»Ÿä»å †ä¸Šæ“ä½œçš„ã€‚</p><p>æ ˆæ˜¯ç¨‹åºç¼–è¯‘æ—¶å°±å·²ç»ç¡®å®šå¤§å°çš„ä¸€æ®µå†…å­˜åŒºåŸŸï¼Œä¸»è¦æ˜¯ç”¨äºä¸´æ—¶å˜é‡çš„å­˜å‚¨ï¼Œæ ˆçš„æ•ˆç‡é«˜äºå †ï¼Œä½†æ˜¯å®¹é‡æœ‰é™.</p><p><strong>æ±‡ç¼–çŸ¥è¯†ï¼ˆè¡¥å……ï¼‰</strong></p><p>åœ¨æ±‡ç¼–è¯­è¨€ä¸­ï¼Œ<code>LEA</code>ï¼ˆLoad Effective Addressï¼‰æŒ‡ä»¤ç”¨äºå°†ä¸€ä¸ªå†…å­˜åœ°å€åŠ è½½åˆ°å¯„å­˜å™¨ä¸­ï¼Œè€Œä¸æ˜¯ç›´æ¥è®¿é—®è¯¥å†…å­˜åœ°å€çš„å€¼ã€‚ç®€å•æ¥è¯´ï¼Œ<code>LEA</code> è®¡ç®—å†…å­˜åœ°å€çš„æœ‰æ•ˆå€¼ï¼Œå¹¶å°†å…¶å­˜å…¥ç›®æ ‡å¯„å­˜å™¨ï¼Œè€Œä¸æ˜¯ä»è¯¥å†…å­˜åœ°å€åŠ è½½æ•°æ®ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¬”è®° </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¼šè®®è®°å½•</title>
      <link href="/2024/12/11/%E4%BC%9A%E8%AE%AE%E8%AE%B0%E5%BD%95/"/>
      <url>/2024/12/11/%E4%BC%9A%E8%AE%AE%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h3 id="2024-11-11-ç¬¬ä¸€æ¬¡ä¼šè®®"><a href="#2024-11-11-ç¬¬ä¸€æ¬¡ä¼šè®®" class="headerlink" title="2024.11.11  ç¬¬ä¸€æ¬¡ä¼šè®®"></a>2024.11.11  ç¬¬ä¸€æ¬¡ä¼šè®®</h3><p>æ²¡æœ‰å›ç­”å¥½çš„å†…å®¹ï¼š</p><p>ASCIIã€Unicodeç¼–ç ï¼Œenum å’Œ enum classçš„åŒºåˆ«</p><ol><li><strong>ASCIIã€Unicodeç¼–ç </strong></li></ol><p>ASCIIç ä½¿ç”¨æŒ‡å®šçš„7ä½æˆ–è€…8ä½äºŒè¿›åˆ¶æ•°ç»„åˆæ¥è¡¨ç¤º128æˆ–256ç§å¯èƒ½çš„å­—ç¬¦ã€‚æ ‡å‡†çš„ASCIIç ä½¿ç”¨7ä½äºŒè¿›åˆ¶æ•°(å‰©ä¸‹ä¸€ä½äºŒè¿›åˆ¶ä½0)æ¥è¡¨ç¤ºæ‰€æœ‰çš„å¤§å†™å­—æ¯å’Œå°å†™å­—æ¯ï¼Œæ•°å­—0-9ã€æ ‡ç‚¹ç¬¦å·ï¼Œä»¥åŠåœ¨ç¾å¼è‹±è¯­ä¸­ä½¿ç”¨çš„ç‰¹æ®Šæ§åˆ¶å­—ç¬¦ã€‚æœ€åä¸€ä½ç”¨äºå¥‡å¶æ ¡éªŒã€‚</p><p>ASCIIæ˜¯å•å­—èŠ‚ç¼–ç ï¼Œæ— æ³•ç”¨æ¥è¡¨ç¤ºä¸­æ–‡ï¼Œæ‰€ä»¥ä¸­å›½åˆ¶å®šäº†GB2312ç¼–ç ï¼ŒæŠŠä¸­æ–‡ç¼–è¿›å»ã€‚</p><p>Unicodeï¼šæŠŠæ‰€æœ‰çš„è¯­è¨€éƒ½ç»Ÿä¸€åˆ°ä¸€å¥—ç¼–ç é‡Œé¢ï¼Œè¿™æ ·å°±ä¸ä¼šæœ‰ä¹±ç çš„é—®é¢˜ã€‚æœ€å¸¸ç”¨çš„æ˜¯ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼ˆååƒ»çš„å­—ç¬¦ä½¿ç”¨4ä¸ªå­—èŠ‚ï¼‰</p><p>UTF8  å¯å˜é•¿ç¼–ç ï¼ŒæŠŠä¸€ä¸ªUnicodeå­—ç¬¦æ ¹æ®ä¸åŒçš„æ•°å­—å¤§å°ç¼–ç æˆ1-6å­—èŠ‚ï¼Œå¸¸ç”¨çš„è‹±æ–‡å­—æ¯è¢«ç¼–ç æˆ 1ä¸ªå­—èŠ‚ï¼Œæ±‰å­—é€šå¸¸æ˜¯ä¸‰ä¸ªå­—èŠ‚ï¼Œåªæœ‰ç”Ÿåƒ»å­—æ‰è¢«ç¼–ç æˆ4-6ä¸ªå­—èŠ‚ã€‚ä¼ è¾“çš„æ–‡æœ¬å«æœ‰å¤§é‡è‹±æ–‡ï¼Œä½¿ç”¨UTF-8ç¼–ç å°±èƒ½èŠ‚çœç©ºé—´ã€‚</p><p><img src="https://bu.dusays.com/2024/11/13/6734516268bb0.png" alt="image-20241112124850995"></p><p><img src="https://bu.dusays.com/2024/11/13/673451626be7b.png"></p><ol start="2"><li><strong>enum ä¸ enum class</strong></li></ol><p>enumè¢«ç§°ä¸ºä¸é™å®šèŒƒå›´çš„æšä¸¾ï¼Œenum classè¢«ç§°ä¸ºé™å®šèŒƒå›´çš„æšä¸¾</p><p>1ï¸âƒ£enumæ˜¯ä¼ ç»Ÿçš„æšä¸¾ç±»å‹ï¼š</p><p>â€‹æšä¸¾å€¼å¯ä»¥éšå¼è½¬æ¢æˆæ•´æ•°ã€‚</p><p>â€‹ä½œç”¨åŸŸï¼šenumä¸­çš„æˆå‘˜æ˜¯å…¨å±€çš„ï¼Œå¯èƒ½å¯¼è‡´åå­—å†²çªã€‚ä¸¤ä¸ªæšä¸¾ç±»å‹å®šä¹‰äº†ç›¸åŒçš„æšä¸¾å˜é‡åå­—ï¼Œå°±ä¼šå‡ºç°é”™è¯¯ã€‚</p><p>â€‹ç±»å‹å®‰å…¨ï¼šä¸å…·å¤‡ä¸¥æ ¼çš„ç±»å‹å®‰å…¨ï¼Œæ— æ„ä¸­ä¸æ•´æ•°æˆ–å…¶ä»–æšä¸¾ç±»å‹æ··ç”¨ã€‚</p><p>2ï¸âƒ£enum class</p><p>â€‹ä½œç”¨åŸŸï¼šenum classä¸­çš„æˆå‘˜æ˜¯å±€éƒ¨ä¸æšä¸¾ç±»å‹æœ¬èº«çš„ï¼Œä¸ä¼šé€ æˆåå­—å†²çª</p><p>â€‹æ˜¾ç¤ºè½¬æ¢ï¼šè¦å°†enum class çš„æˆå‘˜è½¬æ¢æˆæ•´æ•°ï¼Œå¿…é¡»ä½¿ç”¨static_cast</p><p>â€‹ç±»å‹å®‰å…¨ï¼šenum class æ›´åŠ å®‰å…¨ï¼Œæšä¸¾å€¼ä¸ä¼šéšå¼è½¬æ¢ä¸ºæ•´æ•°ï¼Œå¿…é¡»æ˜¾ç¤ºè½¬æ¢</p><ol start="3"><li><p>gotoä»€ä¹ˆæ—¶å€™ä¸èƒ½è·³ï¼Ÿ</p><p>1ï¸âƒ£è·³è½¬è¿›å…¥å…¶ä»–ä½œç”¨åŸŸï¼š<code>goto</code>ä¸èƒ½è·³è½¬åˆ°ä¸€ä¸ªä¸åŒä½œç”¨åŸŸçš„æ ‡ç­¾ã€‚ä¾‹å¦‚ï¼Œä¸èƒ½ä»å¤–éƒ¨ä½œç”¨åŸŸè·³è½¬è¿›å…¥ä¸€ä¸ªå‡½æ•°å†…éƒ¨ï¼Œæˆ–ä»å¾ªç¯æˆ–æ¡ä»¶è¯­å¥å¤–éƒ¨è·³å…¥å…¶å†…éƒ¨ã€‚</p><p>2ï¸âƒ£è·¨è¶Šå¯¹è±¡çš„åˆå§‹åŒ–ï¼šå¦‚æœè·³è½¬ä¼šå¯¼è‡´è·¨è¶Šå…·æœ‰éå¹³å‡¡ææ„å‡½æ•°çš„å¯¹è±¡çš„åˆå§‹åŒ–ï¼Œåˆ™ä¼šå‡ºç°ç¼–è¯‘é”™è¯¯ã€‚è¿™æ˜¯å› ä¸ºè·³è¿‡å¯¹è±¡åˆå§‹åŒ–å¯èƒ½å¯¼è‡´æœªå®šä¹‰è¡Œä¸ºï¼Œä¾‹å¦‚èµ„æºæœªæ­£ç¡®åˆ†é…ã€‚</p><p>3ï¸âƒ£ä»£æ›¿ç»“æ„åŒ–æ§åˆ¶è¯­å¥ï¼š<code>goto</code>è¯­å¥é€šå¸¸ä¸åº”å½“ä»£æ›¿<code>for</code>ã€<code>while</code>ã€<code>do-while</code>ç­‰ç»“æ„åŒ–æ§åˆ¶è¯­å¥ï¼Œå› ä¸ºè¿™æ ·ä¼šä½¿ä»£ç æ›´éš¾ç†è§£å’Œç»´æŠ¤ã€‚åº”ä¼˜å…ˆä½¿ç”¨è¿™äº›ç»“æ„åŒ–çš„å¾ªç¯å’Œåˆ†æ”¯ç»“æ„ã€‚</p><p>4ï¸âƒ£è·¨è¶Šå†…å­˜ç®¡ç†ä»£ç å—ï¼Œåœ¨C++ä¸­ï¼Œç®¡ç†å†…å­˜ï¼ˆå¦‚<code>new</code>å’Œ<code>delete</code>ï¼‰æ—¶ä¸å®œä½¿ç”¨<code>goto</code>ï¼Œå› ä¸ºå®¹æ˜“å¯¼è‡´èµ„æºæ³„éœ²ã€‚ç”¨<code>goto</code>è·³è¿‡ç‰¹å®šçš„ä»£ç å¯èƒ½å¯¼è‡´å†…å­˜æˆ–èµ„æºæœªé‡Šæ”¾ã€‚</p></li></ol><h3 id="2024-11-18-ç¬¬äºŒæ¬¡ä¼šè®®"><a href="#2024-11-18-ç¬¬äºŒæ¬¡ä¼šè®®" class="headerlink" title="2024.11.18  ç¬¬äºŒæ¬¡ä¼šè®®"></a>2024.11.18  ç¬¬äºŒæ¬¡ä¼šè®®</h3><p>æ²¡æœ‰å›ç­”å¥½çš„é—®é¢˜ï¼šæ™ºèƒ½æŒ‡é’ˆã€å·¦å€¼å³å€¼</p><ol><li><strong>æ™ºèƒ½æŒ‡é’ˆ</strong></li></ol><p>æ™ºèƒ½æŒ‡é’ˆæ˜¯C++ ä¸­ç”¨äºè‡ªåŠ¨ç®¡ç†åŠ¨æ€å†…å­˜çš„å¯¹è±¡ã€‚å®ƒæ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»ï¼Œé€šè¿‡å°è£…æ™®é€šæŒ‡é’ˆçš„è¡Œä¸ºï¼Œå®ç°è‡ªåŠ¨èµ„æºç®¡ç†ï¼ˆå†…å­˜é‡Šæ”¾ï¼‰ï¼Œä»è€Œé¿å…å¸¸è§çš„å†…å­˜æ³„éœ²å’Œæ‚¬å‚æŒ‡é’ˆé—®é¢˜ã€‚</p><p>1ï¸âƒ£ ç‹¬å å‹æ™ºèƒ½æŒ‡é’ˆ std::unique_ptr</p><p>ç‹¬å æ‰€æœ‰æƒï¼ŒåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªstd::unique_ptrç®¡ç†æŸä¸ªèµ„æºï¼Œé€‚ç”¨äºéœ€è¦æ˜ç¡®è¡¨ç¤ºæ‰€æœ‰æƒçš„åœºæ™¯ã€‚<strong>ä¸å¯å¤åˆ¶ï¼Œä½†å¯ä»¥è½¬ç§»æ‰€æœ‰æƒ</strong>ã€‚</p><p>ç¤ºä¾‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::unique_ptr&lt;<span class="type">int</span>&gt; ptr1 = std::<span class="built_in">make_unique</span>&lt;<span class="type">int</span>&gt;(<span class="number">10</span>);  <span class="comment">// åˆ†é…å†…å­˜å¹¶èµ‹å€¼</span></span><br><span class="line">    std::cout &lt;&lt; *ptr1 &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//std::unique_ptr&lt;int&gt; ptr2 = ptr1; é”™è¯¯çš„  ä¸å…è®¸å¤åˆ¶</span></span><br><span class="line">    std::unique_ptr&lt;<span class="type">int</span>&gt; ptr2 = std::<span class="built_in">move</span>(ptr1); <span class="comment">// è½¬ç§»æ‰€æœ‰æƒ</span></span><br><span class="line">    <span class="keyword">if</span> (!ptr1)</span><br><span class="line">    &#123;</span><br><span class="line">        std::unique_ptr&lt;<span class="type">int</span>&gt; ptr2 = std::<span class="built_in">move</span>(ptr1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2ï¸âƒ£ std::shared_ptr</p><p>å…±äº«æ‰€æœ‰æƒï¼Œå¤šä¸ªstd::shared_ptrå¯ä»¥å…±äº«åŒä¸€ç§èµ„æºã€‚é€‚ç”¨äºå¤šä¸ªå¯¹è±¡éœ€è¦è®¿é—®åŒä¸€èµ„æºçš„åœºæ™¯ã€‚ä½¿ç”¨è®¡æ•°ç®¡ç†èµ„æºã€‚å¼•ç”¨è®¡æ•°ä¸º0æ—¶ï¼Œèµ„æºæ‰ä¼šè¢«é‡Šæ”¾ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::shared_ptr&lt;<span class="type">int</span>&gt; ptr1 = std::<span class="built_in">make_shared</span>&lt;<span class="type">int</span>&gt;(<span class="number">20</span>); <span class="comment">// åˆ†é…å†…å­˜ </span></span><br><span class="line">    std::shared_ptr&lt;<span class="type">int</span>&gt; ptr2 = ptr1; <span class="comment">// å…±äº«æ‰€æœ‰æƒ</span></span><br><span class="line">    std::cout &lt;&lt; *ptr1 &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; *ptr2 &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    ptr<span class="number">1.</span><span class="built_in">reset</span>(); <span class="comment">// é‡Šæ”¾ptr1å¯¹èµ„æºçš„å¼•ç”¨</span></span><br><span class="line">    <span class="keyword">if</span> (!ptr1)</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;ptr1 is null, but ptr2 still owns the resource.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ï¸âƒ£ std::weak_ptr</p><p>å¼±å¼•ç”¨ï¼Œä¸å‚ä¸å¼•ç”¨è®¡æ•°ç®¡ç†ã€‚è§£å†³std::share_ptrçš„å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚éœ€è¦ä½¿ç”¨lock() æ–¹æ³•å°† std::weak_ptr è½¬åŒ–ä¸º std::shared_ptræ¥è®¿é—®èµ„æºã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::shared_ptr&lt;<span class="type">int</span>&gt; sharedPtr = std::<span class="built_in">make_shared</span>&lt;<span class="type">int</span>&gt;(<span class="number">30</span>);</span><br><span class="line">    std::weak_ptr&lt;<span class="type">int</span>&gt; weakPtr = sharedPtr;  <span class="comment">// å¼±å¼•ç”¨, ä¸å¢åŠ å¼•ç”¨è®¡æ•°</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">auto</span> lockedPtr = weakPtr.<span class="built_in">lock</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; *lockedPtr &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Resource is no longer available.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    sharedPtr.<span class="built_in">reset</span>(); <span class="comment">// é‡Šæ”¾èµ„æº</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">auto</span> lockedPtr = weakPtr.<span class="built_in">lock</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; *lockedPtr &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Resource is no longer available.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ™ºèƒ½æŒ‡é’ˆçš„<strong>ä¼˜ç‚¹</strong>ï¼šè‡ªåŠ¨é‡Šæ”¾å†…å­˜ï¼Œ å‡å°‘new&#x2F;deleteå¸¦æ¥çš„éº»çƒ¦ã€‚  é¿å…å†…å­˜æ³„éœ²å’Œæ‚¬å‚æŒ‡é’ˆé—®é¢˜ã€‚  ä»£ç æ›´ç®€æ´ã€æ›´å®‰å…¨ã€‚  <strong>ç”¨é€”</strong>ï¼šåŠ¨æ€å†…å­˜åˆ†é…æ—¶ï¼Œç¡®ä¿èµ„æºè¢«ç‹¬å ç®¡ç†ä¸”ä½¿ç”¨å®Œæˆåè‡ªåŠ¨é‡Šæ”¾ã€‚ç®¡ç†ä¸éœ€è¦å…±äº«çš„èµ„æºï¼Œå¦‚æ–‡ä»¶å¥æŸ„ã€å•çº¿ç¨‹å¯¹è±¡ç­‰ã€‚</p><p>æ³¨æ„äº‹é¡¹ï¼š</p><p>1ï¸âƒ£ ä¸è¦åŒæ—¶ä½¿ç”¨æ™®é€šæŒ‡é’ˆå’Œæ™ºèƒ½æŒ‡é’ˆç®¡ç†ç»Ÿä¸€èµ„æº</p><p>2ï¸âƒ£ std::shared_ptr å¯èƒ½å¸¦æ¥æ€§èƒ½å¼€é”€ (ç”±äºå¼•ç”¨è®¡æ•°ç®¡ç†)ã€‚</p><p>3ï¸âƒ£ std::weak_ptr è§£å†³ std::shared_ptrçš„å¾ªç¯å¼•ç”¨é—®é¢˜ ã€‚</p><p><strong>å¾ªç¯å¼•ç”¨é—®é¢˜</strong> æ˜¯æŒ‡åœ¨ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆï¼ˆå°¤å…¶æ˜¯ <code>std::shared_ptr</code>ï¼‰æ—¶ï¼Œç”±äºä¸¤ä¸ªæˆ–å¤šä¸ªå¯¹è±¡äº’ç›¸å¼•ç”¨å¯¹æ–¹ï¼Œå¯¼è‡´å¼•ç”¨è®¡æ•°æ°¸è¿œæ— æ³•é™ä¸ºé›¶ï¼Œèµ„æºæ— æ³•é‡Šæ”¾ï¼Œé€ æˆ <strong>å†…å­˜æ³„æ¼</strong> çš„é—®é¢˜ã€‚</p><ol start="2"><li>å·¦å€¼å’Œå³å€¼</li></ol><p>å·¦å€¼ï¼ˆlvalue, locator valueï¼‰è¡¨ç¤ºäº†ä¸€ä¸ªå æ®å†…å­˜ä¸­æŸä¸ªå¯è¯†åˆ«çš„ä½ç½®ï¼ˆä¹Ÿå°±æ˜¯ä¸€ä¸ªåœ°å€ï¼‰çš„å¯¹è±¡ã€‚</p><p>å³å€¼ï¼ˆrvalueï¼‰åˆ™ä½¿ç”¨æ’é™¤æ³•æ¥å®šä¹‰ã€‚ä¸€ä¸ªè¡¨è¾¾å¼ä¸æ˜¯ å·¦å€¼ å°±æ˜¯ å³å€¼ ã€‚é‚£ä¹ˆï¼Œå³å€¼æ˜¯ä¸€ä¸ª ä¸è¡¨ç¤ºå†…å­˜ä¸­æŸä¸ªå¯è¯†åˆ«ä½ç½®çš„å¯¹è±¡çš„è¡¨è¾¾å¼ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> var;</span><br><span class="line">var = <span class="number">4</span>;</span><br></pre></td></tr></table></figure><p>èµ‹å€¼æ“ä½œéœ€è¦å·¦æ“ä½œæ•°æ˜¯ä¸€ä¸ªå·¦å€¼ã€‚varæ˜¯ä¸€ä¸ªæœ‰å†…å­˜ä½ç½®çš„å¯¹è±¡ï¼Œå› æ­¤å®ƒæ˜¯å·¦å€¼ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">4</span> = var;</span><br><span class="line">(var + <span class="number">1</span>) = <span class="number">4</span>;</span><br></pre></td></tr></table></figure><p>å¸¸é‡ 4 å’Œè¡¨è¾¾å¼ var +  1 éƒ½ä¸æ˜¯å·¦å€¼ï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯è¡¨è¾¾å¼çš„ä¸´æ—¶ç»“æœï¼Œè€Œæ²¡æœ‰å¯è¯†çš„å†…å­˜ä½ç½®ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> <span class="number">2</span>;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// é”™è¯¯ï¼Œfooè¿”å›çš„æ˜¯ä¸€ä¸ªä¸´æ—¶çš„å€¼ã€‚å®ƒæ˜¯ä¸€ä¸ªå³å€¼ï¼Œèµ‹å€¼ç»™å®ƒæ˜¯é”™è¯¯çš„ã€‚</span></span><br><span class="line">    <span class="built_in">foo</span>() = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> globalvar = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span>&amp; <span class="title">foo</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> globalvar;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">foo</span>() = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œfooè¿”å›ä¸€ä¸ªå¼•ç”¨ã€‚å¼•ç”¨äº†ä¸€ä¸ªå·¦å€¼ï¼Œå› æ­¤å¯ä»¥èµ‹å€¼ç»™å®ƒã€‚</p><p>C++ ä¸­å‡½æ•°å¯ä»¥è¿”å›å·¦å€¼çš„åŠŸèƒ½å¯¹å®ç°ä¸€äº›é‡è½½çš„æ“ä½œç¬¦éå¸¸é‡è¦ã€‚ä¸‹é¢æ˜¯é‡è½½æ–¹æ‹¬å·æ“ä½œç¬¦[]ï¼Œæ¥å®ç°ä¸€äº›æŸ¥æ‰¾è®¿é—®çš„æ“ä½œï¼Œå¦‚std::map ä¸­çš„æ–¹æ‹¬å·ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">std::map&lt;<span class="type">int</span>, <span class="type">float</span>&gt; mymap;</span><br><span class="line">mymap[<span class="number">10</span>] = <span class="number">5.6</span>;</span><br></pre></td></tr></table></figure><p>ä¹‹æ‰€ä»¥èƒ½èµ‹å€¼ç»™mymap[10], æ˜¯å› ä¸ºstd::map::operator[] çš„é‡è½½è¿”å›çš„æ˜¯ä¸€ä¸ªå¯èµ‹å€¼çš„å¼•ç”¨ã€‚</p><p><strong>å¯ä¿®æ”¹çš„å·¦å€¼</strong></p><p>å¯ä»¥å‡ºç°åœ¨èµ‹å€¼æ“ä½œå·¦è¾¹çš„å€¼ï¼Œä½†æ˜¯åŠ å…¥constå…³é”®å­—åï¼Œè¿™ä¸ªå®šä¹‰ä¸å†æˆç«‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> a = <span class="number">10</span>;  <span class="comment">// &#x27;a&#x27; æ˜¯å·¦å€¼</span></span><br><span class="line">a = <span class="number">10</span>;   <span class="comment">// ä½†ä¸å¯ä»¥èµ‹å€¼ç»™å®ƒ</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥å¯èµ‹å€¼çš„å·¦å€¼è¢«ç§°ä¸º å¯ä¿®æ”¹å·¦å€¼. C99æ ‡å‡†å®šä¹‰å¯ä¿®æ”¹å·¦å€¼ä¸º:</p><p>å¯ä¿®æ”¹å·¦å€¼æ˜¯ç‰¹æ®Šçš„å·¦å€¼ï¼Œä¸å«æœ‰æ•°ç»„ç±»å‹ã€ä¸å®Œæ•´ç±»å‹ã€const ä¿®é¥°çš„ç±»å‹ã€‚å¦‚æœå®ƒæ˜¯ <code>struct</code> æˆ– <code>union</code>ï¼Œå®ƒçš„æˆå‘˜éƒ½ï¼ˆé€’å½’åœ°ï¼‰ä¸åº”å«æœ‰ const ä¿®é¥°çš„ç±»å‹ã€‚</p><p><strong>å·¦å€¼ä¸å³å€¼çš„è½¬æ¢</strong></p><p>å·¦å€¼å¯ä»¥è½¬æˆå³å€¼</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = <span class="number">1</span>;     <span class="comment">// a æ˜¯å·¦å€¼</span></span><br><span class="line"><span class="type">int</span> b = <span class="number">2</span>;     <span class="comment">// b æ˜¯å·¦å€¼</span></span><br><span class="line"><span class="type">int</span> c = a + b; <span class="comment">// + éœ€è¦å³å€¼ï¼Œæ‰€ä»¥ a å’Œ b è¢«è½¬æ¢æˆå³å€¼</span></span><br><span class="line">               <span class="comment">// + è¿”å›å³å€¼</span></span><br></pre></td></tr></table></figure><p>å³å€¼ä¸å¯ä»¥è½¬æˆå·¦å€¼,å› ä¸ºè¿åäº†å·¦å€¼çš„æœ¬è´¨.  ä½†æ˜¯å³å€¼å¯ä»¥é€šè¿‡æ˜¾å¼çš„æ–¹æ³•äº§ç”Ÿå·¦å€¼. </p><p>ä¾‹å¦‚, ä¸€å…ƒè§£å¼•ç”¨è¿ç®—ç¬¦ â€˜*â€™ éœ€è¦ä¸€ä¸ªå³å€¼å‚æ•°, ä½†è¿”å›ä¸€ä¸ªå·¦å€¼ç»“æœ. </p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> arr[] = &#123;<span class="number">1</span>, <span class="number">2</span>&#125;;</span><br><span class="line"><span class="type">int</span>* p = &amp;arr[<span class="number">0</span>];</span><br><span class="line">*(p + <span class="number">1</span>) = <span class="number">10</span>;   <span class="comment">//p + 1æ˜¯å³å€¼,   ä½†*(p + 1) æ˜¯å·¦å€¼</span></span><br></pre></td></tr></table></figure><p>ç›¸åçš„,ä¸€å…ƒå»åœ°å€æ“ä½œç¬¦â€™&amp;â€™ éœ€è¦ä¸€ä¸ªå·¦å€¼å‚æ•°,è¿”å›ä¸€ä¸ªå³å€¼</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> var = <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span>* b_arr = &amp;(var + <span class="number">1</span>);  <span class="comment">// &amp;  éœ€è¦å·¦å€¼å‚æ•°</span></span><br><span class="line"><span class="type">int</span>* addr = &amp;var;    <span class="comment">// æ­£ç¡®,  varæ˜¯å·¦å€¼</span></span><br><span class="line">&amp;var = <span class="number">40</span>;   <span class="comment">//é”™è¯¯, èµ‹å€¼æ“ä½œçš„å·¦æ“ä½œæ•°éœ€è¦çš„æ˜¯å·¦å€¼</span></span><br></pre></td></tr></table></figure><p>â€˜&amp;â€™ ç¬¦å·è¿˜æœ‰å¦ä¸€ä¸ªåŠŸèƒ½â€”â€“å®šä¹‰å¼•ç”¨ç±»å‹.  å¼•ç”¨ç±»å‹åˆå«åšâ€å·¦å€¼å¼•ç”¨â€.  å› æ­¤ä¸èƒ½å°†ä¸€ä¸ªå³å€¼èµ‹å€¼ç»™(éå¸¸é‡çš„) å·¦å€¼å¼•ç”¨:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::string&amp; sref = std::<span class="built_in">string</span>();  <span class="comment">// é”™è¯¯: éå¸¸é‡çš„å¼•ç”¨ &#x27;std::string&amp;&#x27; é”™è¯¯åœ°ä½¿ç”¨å³å€¼ &#x27;std::string&#x27; åˆå§‹åŒ–</span></span><br></pre></td></tr></table></figure><p><em>å¸¸é‡çš„</em> å·¦å€¼å¼•ç”¨å¯ä»¥ä½¿ç”¨å³å€¼èµ‹å€¼ã€‚å› ä¸ºä½ æ— æ³•é€šè¿‡å¸¸é‡çš„å¼•ç”¨ä¿®æ”¹å˜é‡çš„å€¼ï¼Œä¹Ÿå°±ä¸ä¼šå‡ºç°ä¿®æ”¹äº†å³å€¼çš„æƒ…å†µã€‚è¿™ä¹Ÿä½¿å¾— C++ ä¸­ä¸€ä¸ªå¸¸è§çš„ä¹ æƒ¯æˆä¸ºå¯èƒ½ï¼šå‡½æ•°çš„å‚æ•°ä½¿ç”¨å¸¸é‡å¼•ç”¨æ¥æ”¶å‚æ•°ï¼Œé¿å…åˆ›å»ºä¸å¿…è¦çš„ä¸´æ—¶å¯¹è±¡ã€‚</p><p><strong>CVé™å®šçš„å³å€¼</strong></p><p>ä¸€ä¸ªéå‡½æ•°ã€éæ•°ç»„çš„ç±»å‹ T çš„å·¦å€¼å¯ä»¥è½¬æ¢ä¸ºå³å€¼ã€‚ [â€¦] å¦‚æœ T ä¸æ˜¯ç±»ç±»å‹ã€è¯‘æ³¨ï¼šç±»ç±»å‹å³ C++ ä¸­ä½¿ç”¨ç±»å®šä¹‰çš„ç±»å‹ï¼ŒåŒºåˆ«ä¸å†…ç½®ç±»å‹ã€‘ï¼Œè½¬æ¢åçš„å³å€¼çš„ç±»å‹æ˜¯ T çš„ æœªé™å®š CV çš„ç‰ˆæœ¬</p><p>æ¯ä¸ªç±»å‹éƒ½æœ‰ä¸‰ä¸ªå¯¹åº”çš„CV-é™å®šç±»å‹ç‰ˆæœ¬: const é™å®š   volatile é™å®š å’Œ const-volatile é™å®šç‰ˆæœ¬.  æœ‰æˆ–æ— CVé™å®šçš„ç±»å‹æ˜¯ä¸åŒçš„ç±»å‹, ä½†æ˜¯å†™æ³•å’Œèµ‹å€¼éœ€æ±‚éƒ½æ˜¯ç›¸åŒçš„.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">()</span> <span class="type">const</span> </span>&#123; std::cout &lt;&lt; <span class="string">&quot;A::foo() const\n&quot;</span>; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123; std::cout &lt;&lt; <span class="string">&quot;A::foo()\n&quot;</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">A <span class="title">bar</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">A</span>(); &#125;</span><br><span class="line"><span class="function"><span class="type">const</span> A <span class="title">cbar</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">A</span>(); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">bar</span>().<span class="built_in">foo</span>();</span><br><span class="line">    <span class="built_in">cbar</span>().<span class="built_in">foo</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>main</code> ä¸­çš„ç¬¬äºŒä¸ªå‡½æ•°è°ƒç”¨å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ <code>A</code> ä¸­çš„ <code>foo() const</code> å‡½æ•°ï¼Œå› ä¸º <code>cbar</code> è¿”å›çš„ç±»å‹æ˜¯ <code>const A</code>ï¼Œè¿™å’Œ <code>A</code> æ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»å‹ã€‚è¿™å°±æ˜¯ä¸Šé¢çš„å¼•ç”¨ä¸­æœ€åä¸€å¥è¯æ‰€è¡¨è¾¾çš„æ„æ€ã€‚å¦å¤–æ³¨æ„åˆ°ï¼Œ<code>cbar</code> çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå³å€¼ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªå®é™…çš„ CV é™å®šçš„å³å€¼çš„ä¾‹å­ã€‚</p><p><strong>å³å€¼å¼•ç”¨</strong></p><p>å·¦å€¼å’Œå³å€¼çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼Œå·¦å€¼å¯ä»¥è¢«ä¿®æ”¹ï¼Œè€Œå³å€¼ä¸èƒ½ã€‚ä¸è¿‡ï¼ŒC++11 æ”¹å˜äº†è¿™ä¸€åŒºåˆ«ã€‚åœ¨ä¸€äº›ç‰¹æ®Šçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å³å€¼çš„å¼•ç”¨ï¼Œå¹¶å¯¹å³å€¼è¿›è¡Œä¿®æ”¹ã€‚</p><p>ä½¿ç”¨ <code>&amp;&amp;</code> è¡¨ç¤ºã€‚å®ƒä¸“é—¨ç”¨äºç»‘å®šå³å€¼ï¼Œä»è€Œä½¿ç¨‹åºå¯ä»¥æ“ä½œå³å€¼ï¼ˆä¸´æ—¶å¯¹è±¡ï¼‰ã€‚</p><p>ç”¨é€”: 1ï¸âƒ£ ç§»åŠ¨è¯­ä¹‰, é€šè¿‡ç§»åŠ¨å³å€¼èµ„æº(å¦‚åŠ¨æ€å†…å­˜) é¿å…æ‹·è´, æå‡æ€§èƒ½. 2ï¸âƒ£å®Œç¾è½¬å‘:ä¿ç•™å‡½æ•°æ¨¡æ¿ä¸­å‚æ•°çš„å€¼ç±»åˆ«(å·¦å€¼æˆ–å³å€¼)</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    std::string str1 = <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">    std::string str2 = std::<span class="built_in">move</span>(str1);   <span class="comment">// std::move å°† str1 è½¬ä¸ºå³å€¼</span></span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;str2&quot;</span> &lt;&lt; str2 &lt;&lt; std::endl;  <span class="comment">//è¾“å‡ºHello</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;str1&quot;</span> &lt;&lt; str1 &lt;&lt; std::endl;  <span class="comment">// str1 çš„èµ„æºå·²ç»è¢«è½¬ç§», å¯èƒ½ä¸ºç©º</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://bu.dusays.com/2024/11/19/673c83b590a66.png"></p><p>Q: å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªè¡¨è¾¾å¼æ˜¯å·¦å€¼è¿˜æ˜¯å³å€¼?</p><p>1ï¸âƒ£ å¦‚æœèƒ½å–åœ°å€ (&amp; æ“ä½œç¬¦èƒ½æˆåŠŸ) , åˆ™ä¸ºå·¦å€¼</p><p>2ï¸âƒ£ å¦‚æœä¸èƒ½å–åœ°å€, ä½†å¯ä»¥ç”¨ä½œå³ä¾§èµ‹å€¼, åˆ™ä¸ºå³å€¼</p><p>å¼•ç”¨å³å€¼ ä¸»è¦æ˜¯ä¸ºäº†æ”¯æŒç§»åŠ¨è¯­ä¹‰, ä»¥å‡å°‘ä¸å¿…è¦çš„èµ„æºæ‹·è´, ä»¥æé«˜ç¨‹åºæ•ˆç‡</p><p>æ€»ç»“ :</p><p> å·¦å€¼ : æœ‰æ˜ç¡®çš„å†…å­˜ä½ç½®, ç”Ÿå‘½å‘¨æœŸå¯æ§, å¯å–åœ°å€.</p><p> å³å€¼:  ä¸´æ—¶å€¼, ç”Ÿå‘½å‘¨æœŸçŸ­, é€šå¸¸ä¸å¯ä¿®æ”¹.</p><p> å³å€¼å¼•ç”¨ï¼šé€šè¿‡&amp;&amp;æ“ä½œç¬¦ï¼Œå…è®¸æ“ä½œå³å€¼ï¼Œä¸»è¦ç”¨äºç§»åŠ¨è¯­ä¹‰å’Œå®Œç¾è½¬å‘ã€‚</p><h3 id="2024-11-25-ç¬¬ä¸‰æ¬¡ä¼šè®®"><a href="#2024-11-25-ç¬¬ä¸‰æ¬¡ä¼šè®®" class="headerlink" title="2024.11.25 ç¬¬ä¸‰æ¬¡ä¼šè®®"></a>2024.11.25 ç¬¬ä¸‰æ¬¡ä¼šè®®</h3><p>æ²¡æœ‰å›ç­”å¥½çš„å†…å®¹ï¼š æ•°ç»„æŒ‡é’ˆã€å †æ ˆæº¢å‡º</p><h4 id="æ•°ç»„æŒ‡é’ˆ"><a href="#æ•°ç»„æŒ‡é’ˆ" class="headerlink" title="æ•°ç»„æŒ‡é’ˆ"></a>æ•°ç»„æŒ‡é’ˆ</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> a[<span class="number">5</span>]&#123; <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span> &#125;;</span><br><span class="line"><span class="built_in">int</span> (*p)[<span class="number">5</span>] = &amp;a;   <span class="comment">// æ•°ç»„æŒ‡é’ˆ</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">sizeof</span>(*p));   <span class="comment">// </span></span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%p\n&quot;</span>, a);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%p\n&quot;</span>, &amp;a);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%p\n&quot;</span>, &amp;a[<span class="number">0</span>]);   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>p</code> æŒ‡é’ˆæŒ‡å‘åŒ…å«äº”ä¸ªæ•´å‹å…ƒç´ çš„æ•°ç»„æŒ‡é’ˆã€‚æ³¨æ„è¿™é‡Œçš„<code>(*p)</code>è¡¨æ˜<code>p</code>æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œè€Œ<code>[5]</code>è¡¨ç¤ºå®ƒæŒ‡å‘çš„å¯¹è±¡æ˜¯ä¸€ä¸ªåŒ…å«5ä¸ªå…ƒç´ çš„æ•°ç»„ã€‚å¹¶ä¸”å°† <code>p</code> åˆå§‹åŒ–ä¸ºæŒ‡å‘å‰é¢å®šä¹‰çš„æ•°ç»„ <code>a</code> çš„åœ°å€ï¼ˆé€šè¿‡ <code>&amp;a</code> å–æ•°ç»„ <code>a</code> çš„åœ°å€æ¥èµ‹å€¼ç»™ <code>p</code>ï¼‰</p><p>åœ¨è¿™é‡Œï¼Œ<code>*p</code> å®é™…ä¸Šå°±æ˜¯ <code>p</code> æ‰€æŒ‡å‘çš„é‚£ä¸ªåŒ…å« 5 ä¸ªæ•´å‹å…ƒç´ çš„æ•°ç»„ï¼ˆå› ä¸º <code>p</code> æ˜¯æŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼Œè§£å¼•ç”¨ <code>*p</code> å°±å¾—åˆ°å®ƒæŒ‡å‘çš„æ•°ç»„æœ¬èº«ï¼‰ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%p\n&quot;</span>, a);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%p\n&quot;</span>, &amp;a);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%p\n&quot;</span>, &amp;a[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure><p><code>printf(&quot;%p\n&quot;, a);</code>ï¼šè¿™é‡Œè¾“å‡ºæ•°ç»„ <code>a</code> çš„é¦–å…ƒç´ åœ°å€ï¼Œå‰é¢æåˆ°æ•°ç»„ååœ¨å¾ˆå¤šæƒ…å†µä¸‹å¯ä»¥ä»£è¡¨é¦–å…ƒç´ åœ°å€ï¼Œæ‰€ä»¥å®ƒä¼šè¾“å‡ºæ•°ç»„ <code>a</code> ç¬¬ä¸€ä¸ªå…ƒç´ åœ¨å†…å­˜ä¸­çš„åœ°å€ã€‚</p><p><code>printf(&quot;%p\n&quot;, &amp;a);</code>ï¼šè¿™é‡Œé€šè¿‡ <code>&amp;a</code> å–çš„æ˜¯æ•´ä¸ªæ•°ç»„ <code>a</code> çš„åœ°å€ï¼Œè™½ç„¶æ•°ç»„é¦–å…ƒç´ åœ°å€çš„å€¼å’Œæ•´ä¸ªæ•°ç»„çš„åœ°å€çš„å€¼åœ¨æ•°å€¼ä¸Šé€šå¸¸æ˜¯ä¸€æ ·çš„ï¼ˆåœ¨ç»å¤§å¤šæ•°å¸¸è§çš„å®ç°ä¸­ï¼‰ï¼Œä½†å®ƒä»¬çš„ç±»å‹æ˜¯ä¸åŒçš„ï¼Œä¸€ä¸ªæ˜¯æŒ‡å‘æ•°ç»„é¦–å…ƒç´ çš„æŒ‡é’ˆï¼ˆ<code>int*</code> ç±»å‹çš„æŒ‡é’ˆï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯æŒ‡å‘æ•´ä¸ªæ•°ç»„çš„æŒ‡é’ˆï¼ˆ<code>int (*)[5]</code> ç±»å‹çš„æŒ‡é’ˆï¼‰ã€‚</p><p><code>printf(&quot;%p\n&quot;, &amp;a[0]);</code>ï¼šè¿™æ˜¯å–æ•°ç»„ <code>a</code> çš„é¦–å…ƒç´  <code>a[0]</code> çš„åœ°å€ï¼Œå…¶æ•ˆæœå’Œç›´æ¥ä½¿ç”¨ <code>a</code> ï¼ˆåœ¨ä»£è¡¨é¦–å…ƒç´ åœ°å€è¿™ä¸ªæ„ä¹‰ä¸Šï¼‰æ˜¯ä¸€æ ·çš„ï¼ŒåŒæ ·ä¼šè¾“å‡ºæ•°ç»„ <code>a</code> ç¬¬ä¸€ä¸ªå…ƒç´ åœ¨å†…å­˜ä¸­çš„åœ°å€ã€‚</p><h4 id="æŒ‡é’ˆæ•°ç»„"><a href="#æŒ‡é’ˆæ•°ç»„" class="headerlink" title="æŒ‡é’ˆæ•°ç»„"></a>æŒ‡é’ˆæ•°ç»„</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span>* a[<span class="number">5</span>]&#123; &#125;;  <span class="comment">// æŒ‡é’ˆæ•°ç»„  åŒ…å«5ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ çš„ç±»å‹éƒ½æ˜¯int* </span></span><br><span class="line"><span class="type">int</span>** p = a;   <span class="comment">// </span></span><br><span class="line"><span class="type">int</span>* (*p)[<span class="number">5</span>] = &amp;a;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªåä¸º <code>a</code> çš„æ•°ç»„ï¼Œå®ƒåŒ…å« 5 ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ çš„ç±»å‹éƒ½æ˜¯ <code>int*</code>ï¼Œä¹Ÿå°±æ˜¯æŒ‡å‘æ•´å‹çš„æŒ‡é’ˆç±»å‹ã€‚é€šè¿‡ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨ <code>&#123; &#125;</code>ï¼Œå°†è¿™ 5 ä¸ªæŒ‡é’ˆå…ƒç´ åˆå§‹åŒ–ä¸ºç©ºæŒ‡é’ˆï¼ˆé»˜è®¤åˆå§‹å€¼ï¼‰ã€‚æœ¬è´¨ä¸Šï¼Œ<code>a</code> æ˜¯ä¸€ä¸ªå¯ä»¥å­˜æ”¾ 5 ä¸ªæŒ‡å‘æ•´å‹å˜é‡çš„æŒ‡é’ˆçš„æ•°ç»„ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>** p = a;</span><br></pre></td></tr></table></figure><p>äºŒçº§æŒ‡é’ˆåˆå§‹åŒ–ä¸º<code>a</code>ã€‚ä¹‹æ‰€ä»¥èƒ½è¿™æ ·èµ‹å€¼ï¼Œæ˜¯å› ä¸ºæ•°ç»„å <code>a</code> åœ¨è¿™ç§æƒ…å†µä¸‹ä¼šéšå¼è½¬æ¢ä¸ºæŒ‡å‘æ•°ç»„é¦–å…ƒç´ çš„æŒ‡é’ˆï¼Œ è€Œ <code>a</code> çš„é¦–å…ƒç´ ç±»å‹æ˜¯ <code>int*</code> ï¼Œæ‰€ä»¥ <code>p</code> è¿™ä¸ªäºŒçº§æŒ‡é’ˆå°±å¯ä»¥æŒ‡å‘ <code>a</code> æ•°ç»„ ï¼ˆæˆ–è€…è¯´æŒ‡å‘ <code>a</code> æ•°ç»„çš„é¦–å…ƒç´ ï¼Œé¦–å…ƒç´ æœ¬èº«ä¹Ÿæ˜¯æŒ‡é’ˆç±»å‹ï¼‰ã€‚è¿™æ„å‘³ç€é€šè¿‡ <code>p</code> å¯ä»¥é—´æ¥æ“ä½œ <code>a</code> æ•°ç»„ä¸­çš„æŒ‡é’ˆå…ƒç´ ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>* (*p)[<span class="number">5</span>] = &amp;a;</span><br></pre></td></tr></table></figure><p><code>int* (*p)[5]</code> è¡¨ç¤º <code>p</code> æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘çš„æ˜¯ä¸€ä¸ªåŒ…å«5ä¸ªå…ƒç´ çš„æ•°ç»„ï¼Œè€Œè¿™ä¸ªæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ ç±»å‹åˆæ˜¯ <code>int*</code></p><p>ï¼ˆæŒ‡å‘æ•´å‹çš„æŒ‡é’ˆï¼‰ã€‚ç„¶åé€šè¿‡ <code>&amp;a</code> å°† <code>p</code> åˆå§‹åŒ–ä¸ºæŒ‡å‘å‰é¢å®šä¹‰çš„ <code>a</code> æ•°ç»„çš„åœ°å€ã€‚</p><h3 id="2024-12-04-ç¬¬å››æ¬¡ä¼šè®®"><a href="#2024-12-04-ç¬¬å››æ¬¡ä¼šè®®" class="headerlink" title="2024.12.04 ç¬¬å››æ¬¡ä¼šè®®"></a>2024.12.04 ç¬¬å››æ¬¡ä¼šè®®</h3><p>å®Œæˆäº†è¿ç®—ç¬¦é‡è½½çš„ä½œä¸šï¼Œå¹¶ä¸”å¼€å§‹QTéƒ¨åˆ†çš„å­¦ä¹ ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ä¼šè®®å†…å®¹è®°å½• </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
